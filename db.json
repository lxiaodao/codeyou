{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":0},{"_id":"themes/material-flow/source/style.less","path":"style.less","modified":1,"renderable":1},{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":0},{"_id":"source/images/code.svg","path":"images/code.svg","modified":0,"renderable":0},{"_id":"themes/material-flow/source/js/app.js","path":"js/app.js","modified":1,"renderable":1},{"_id":"themes/material-flow/source/js/jquery.fitvids.js","path":"js/jquery.fitvids.js","modified":1,"renderable":1},{"_id":"themes/material-flow/source/js/search.js","path":"js/search.js","modified":1,"renderable":1},{"_id":"themes/material-flow/source/fonts/icomoon.eot","path":"fonts/icomoon.eot","modified":0,"renderable":1},{"_id":"themes/material-flow/source/fonts/icomoon.svg","path":"fonts/icomoon.svg","modified":1,"renderable":1},{"_id":"themes/material-flow/source/fonts/icomoon.ttf","path":"fonts/icomoon.ttf","modified":0,"renderable":1},{"_id":"themes/material-flow/source/fonts/icomoon.woff","path":"fonts/icomoon.woff","modified":0,"renderable":1},{"_id":"themes/material-flow/source/fonts/selection.json","path":"fonts/selection.json","modified":1,"renderable":1},{"_id":"source/about/index/about.jpg","path":"about/index/about.jpg","modified":0,"renderable":0},{"_id":"source/images/about.jpg","path":"images/about.jpg","modified":0,"renderable":0}],"Cache":[{"_id":"themes/material-flow/LICENSE","hash":"0e12aed461110e809af1a52728f499f852e85e0a","modified":1570773015728},{"_id":"themes/material-flow/README.md","hash":"9d1c177b082bfd250844f5eeb0e32e3528abc053","modified":1570773015730},{"_id":"themes/material-flow/_config.yml","hash":"634cd84d85fd5ae98e5f3db0a6070cfeffc34d10","modified":1570773015731},{"_id":"source/_data/links.yml","hash":"4c82cd7102db45aca6c3bf117f195c7fdad67e31","modified":1486643075397},{"_id":"source/_data/widgets.yml","hash":"c60b9b6f0df6b283dc40c400f27b171e4dd0d2e0","modified":1487039318514},{"_id":"source/_data/menu.yml","hash":"ae54bd002dc4becdd9aeb6080fb59bcfd9a55407","modified":1486643075397},{"_id":"source/about/index.md","hash":"74f3df464460141e02d0e8670a98d10b5af9d368","modified":1570773015707},{"_id":"source/_posts/2014-multi-university-training-contest-4.md","hash":"6ef5087cce3eaa56aaf3a13d607ae89fe2b4d025","modified":1484531883965},{"_id":"source/_posts/ASP-NET-MVC4note2.md","hash":"7c43793e82be6425b4dfe4448f9cdf798f150cd3","modified":1484531883965},{"_id":"source/_posts/ASP-NET-MVC4-note1-Simplemembership.md","hash":"4be2b9b09a1957a2a51a7e41921acbe0451760fa","modified":1484531883965},{"_id":"source/_posts/CentOS2@1-4.md","hash":"51dfb688da2911632abe3433862a139caf29b4b9","modified":1570773015632},{"_id":"source/_posts/CentOS1@1-3.md","hash":"fb405bc8b267a5c44942c895c01adaa8f97287e5","modified":1570773015631},{"_id":"source/_posts/Kubernetes-&-Deepin-Settings@1-12.md","hash":"25425ec6116a7c81a95d1134d47cc16c4f15fc12","modified":1570773015641},{"_id":"source/_posts/Xiaomi-Openwrt-&&-Git.md","hash":"6a4de2f5c031f9a01c7d7f735bfadc57879a540d","modified":1570773015647},{"_id":"source/_posts/Kubernetes部署@1-5.md","hash":"3fbe1b79e4e0d13d97a027aac8456f516c17eba1","modified":1570773015643},{"_id":"source/_posts/Pandorabox-transparent-proxy.md","hash":"3fbb5fcd085525b342c6d2408f95cb295fcb949d","modified":1570773015645},{"_id":"source/_posts/_hello-world.md","hash":"0db4d8b162ec0f35404f8bd085f18deadd9045d7","modified":1570773015648},{"_id":"source/_posts/_tired.md","hash":"eb4fdcc56daacadf58006768b22211b2e9d47a30","modified":1570773015650},{"_id":"source/_posts/acm-international-collegiate-programming-contest-asia-regional-contest-tokyo-problem-d-space-golf.md","hash":"0f997dfc70f3f6b886369816ff3ed03962d2b9f0","modified":1484531883965},{"_id":"source/_posts/dom-compatibility-note.md","hash":"a57cc1e4af02895a0469a60b001253ba8978129b","modified":1570773015656},{"_id":"source/_posts/baylor6622-absurdistan-roads.md","hash":"a07326817f4432eadb36f4a340d0ee7bb25c596f","modified":1484531883965},{"_id":"source/_posts/fft-thoughts.md","hash":"98def161fb35d160ff87eedc227980faf5954868","modified":1484531883965},{"_id":"source/_posts/github-tips.md","hash":"f5d381b2bdef0b49ffa07613038328a65352b571","modified":1484531883965},{"_id":"source/_posts/hdu-4952-number-transformation.md","hash":"0717053af1f24008992d243c689eb5d3ee45aca9","modified":1484531883965},{"_id":"source/_posts/hdu-2874-connections-between-cities.md","hash":"0f529f14c59b0cc6dcb80a9c71098359b12da656","modified":1484531883965},{"_id":"source/_posts/hdu-4945-2048.md","hash":"d33dc04c3d0f81fa0b30406208fb6b28858507a7","modified":1484531883965},{"_id":"source/_posts/hdu4612-warm-up.md","hash":"cca548f3110aa89bbb34557072e30106b002d05e","modified":1484531883969},{"_id":"source/_posts/hdu4005-the-war.md","hash":"41ee81dcb5c4e2b54bbf55e59747b1cdc22dc3a7","modified":1484531883969},{"_id":"source/_posts/hdu-4965-fast-matrix-calculation.md","hash":"a73cc3965547ff2a585fb778273182fb22513963","modified":1484531883965},{"_id":"source/_posts/hdu4888-redraw-beautiful-drawings.md","hash":"63368c7520bc7910f514233f4dca4c06f4252b4a","modified":1484531883969},{"_id":"source/_posts/herbustluftwm-config.md","hash":"f98bce1e14f18f7933c9eaa5a462e48bdad409d7","modified":1570773015674},{"_id":"source/_posts/hdu4944-fsfs-game.md","hash":"7d06e0686dd02d428cb028f9c48ecb409b49d426","modified":1484531883969},{"_id":"source/_posts/intro-of-fft.md","hash":"eb41faade6135ab3a8c3b95b0e5e75953613c0eb","modified":1484531883969},{"_id":"source/_posts/hexo-speedup-instantclick.md","hash":"9e18e17cdec4d00db7c52d869445871a81b8362b","modified":1484549818742},{"_id":"source/_posts/hexo-lightum-enhance.md","hash":"4e8963342c69de0c02ffc68d48bbaa315562ba24","modified":1484549877189},{"_id":"source/_posts/kde4-config.md","hash":"1390e398b284c4206ca90d4672000c95c813a879","modified":1570773015682},{"_id":"source/_posts/kde-to-mac.md","hash":"58e7a5a7187636e97f106105914814700ed4fd02","modified":1570773015681},{"_id":"source/_posts/netease-music-api.md","hash":"bfee8d6a71508a0eca94eadac3301c36b208be75","modified":1570773015685},{"_id":"source/_posts/man-man-de.md","hash":"b38d9095dd37e83f92c50fdd4f39ceb70b923a5b","modified":1570773015683},{"_id":"source/_posts/neutron-code.md","hash":"d56236dfb7c436761a40929fc4deab2f46cf9a1b","modified":1570773015686},{"_id":"source/_posts/pygobject-tutorial-1.md","hash":"b3f531ade888f6e756b0dc325464dcb6861faecd","modified":1570773015690},{"_id":"source/_posts/poj1989-distance-queries.md","hash":"2e63ce830a157c7e9c33fe3413d3a4ea75750031","modified":1484531883969},{"_id":"source/_posts/poj1330-nearest-common-ancestors.md","hash":"d8634402077c668122ca1da1fa729d39814592c2","modified":1484531883969},{"_id":"source/_posts/shadowsocks-account.md","hash":"4b4d1894a3d5bc51d1bf8157f63c12308590a670","modified":1484531883969},{"_id":"source/_posts/sublime-config-web.md","hash":"7c701480a5d017fef40f67cf3033cd315499492f","modified":1484531883969},{"_id":"source/_posts/xfce4-config.md","hash":"3f0c2b24c078dc3be720c8ae6a4f93606f2f37c0","modified":1570773015698},{"_id":"source/_posts/wine-font-config.md","hash":"eee621d8c441919cba4110100ab71b1036b723ee","modified":1484531883973},{"_id":"source/_posts/timus-1996-cipher-message-3-kmpfft.md","hash":"bdc09019f11fa62f65916108c8ceb7fc65a7471b","modified":1484531883973},{"_id":"source/_posts/zjnu2082.md","hash":"dc43f41decfeb211b4801d683f508323e2b27b6a","modified":1484531883973},{"_id":"source/_posts/zjnu2073-geasscode.md","hash":"31d7e4593123c189b20be891e73f0f14176f63fd","modified":1484531883973},{"_id":"source/_posts/zjnu2085.md","hash":"d70c610c59166e0e64a804c5039f562e101ec32a","modified":1484531883973},{"_id":"source/_posts/zoj-month-contest-d-determinant-and-matrix.md","hash":"145485e272404eeb4e20d006151946a04b9576a5","modified":1484531883973},{"_id":"source/images/favicon.ico","hash":"57e19c18bfe2f77a1bc3229dc104114dc171ce72","modified":1486643075397},{"_id":"themes/material-flow/layout/archive.ejs","hash":"ca51625164abe022be8a440fe62b5f66f5b4421b","modified":1570773015754},{"_id":"themes/material-flow/layout/category.ejs","hash":"c97be36b33bb44957778587f00c978f2d28016f8","modified":1486643075397},{"_id":"themes/material-flow/layout/index.ejs","hash":"c97be36b33bb44957778587f00c978f2d28016f8","modified":1486643075397},{"_id":"themes/material-flow/layout/layout.ejs","hash":"f493debff25d73371c536f9dc15414e2d0f54af2","modified":1570773015757},{"_id":"themes/material-flow/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1486643075397},{"_id":"themes/material-flow/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1486643075397},{"_id":"themes/material-flow/layout/tag.ejs","hash":"c97be36b33bb44957778587f00c978f2d28016f8","modified":1486643075397},{"_id":"themes/material-flow/source/style.less","hash":"a003dab76221b7a4076bb7a15a60dcc456fad672","modified":1570773015800},{"_id":"source/images/avatar.jpg","hash":"445c00332b7f381b21820ea422e5bc7f4f236aaa","modified":1486643075397},{"_id":"source/images/code.svg","hash":"ac38cfd4b89734536d02cd3d0c6d690afb2e980d","modified":1486643075397},{"_id":"themes/material-flow/layout/_widget/about.ejs","hash":"f550008a98862c48da9492fb9bdc69653cb31456","modified":1570773015748},{"_id":"themes/material-flow/layout/_widget/categories.ejs","hash":"bde7f44e08fd9046fd9b44876f4b2fec9357bf7d","modified":1570773015749},{"_id":"themes/material-flow/layout/_widget/friendly-links.ejs","hash":"87d0f85ab29ee5cac05e4f28fcf6652d187eba93","modified":1487065019905},{"_id":"themes/material-flow/layout/_widget/tagcloud.ejs","hash":"9fc962c86dd577d34910225a0b503cfe45e1b824","modified":1570773015752},{"_id":"themes/material-flow/layout/_partial/archive.ejs","hash":"a92ccba847e9687b0d118a5de41837fa6d9bf8ee","modified":1570773015733},{"_id":"themes/material-flow/layout/_partial/article.ejs","hash":"67688e727cacba0c09cbb61bf3a1583d8e6fbc3a","modified":1570773015734},{"_id":"themes/material-flow/layout/_partial/categories.ejs","hash":"67a1281303e6e32607b232cb2a16c2d8878c011e","modified":1570773015736},{"_id":"themes/material-flow/layout/_partial/footer.ejs","hash":"81bf99424865dd96bf970f5ff4cea2bdcb1562ce","modified":1570773015737},{"_id":"themes/material-flow/layout/_partial/head.ejs","hash":"c9c800d6a2245df41e8a8950c32aab45bc469812","modified":1570773015738},{"_id":"themes/material-flow/layout/_partial/header.ejs","hash":"19edd4bcc46632ecced156b2638213e31ffaf907","modified":1570773015740},{"_id":"themes/material-flow/layout/_partial/loading.ejs","hash":"02bd745f5177e589c7febe1ee1a02031c861b199","modified":1570773015741},{"_id":"themes/material-flow/layout/_partial/post.ejs","hash":"6a83c16809f7afa581a1b22be8a933d4e25f4b50","modified":1570773015743},{"_id":"themes/material-flow/layout/_partial/side.ejs","hash":"97baa21b3428268128f764e89cd85e6d0274cd45","modified":1570773015746},{"_id":"themes/material-flow/layout/_partial/scripts.ejs","hash":"9c936ea339d7b4b4453b9430452ef75beed2222c","modified":1570773015745},{"_id":"themes/material-flow/source/js/app.js","hash":"fbd6b7f2b270a68acf4a92d8519540a06ecaeab0","modified":1570773015774},{"_id":"themes/material-flow/source/js/jquery.fitvids.js","hash":"498d2b1a5cfd53ce9b320c9ccd7d53ea7b04ffb7","modified":1570773015775},{"_id":"themes/material-flow/source/js/lovewallpaper.json","hash":"a714f82ea13dc267080a5686140df98b19ccd9a5","modified":1487125727361},{"_id":"themes/material-flow/source/js/search.js","hash":"bd98ebee93f42ea04d10a7e77bda30fccdf67822","modified":1570773015777},{"_id":"themes/material-flow/source/fonts/icomoon.eot","hash":"931a892fd6307c0cfcbb71511ad4a38b3dd20edf","modified":1492757376000},{"_id":"themes/material-flow/source/fonts/icomoon.svg","hash":"d2f6755d619e577d90537e7e92640a2e1b833f6f","modified":1570773015767},{"_id":"themes/material-flow/source/fonts/icomoon.ttf","hash":"6192fb2b38c94f77d1fed08c1969fab5ffe9a30c","modified":1492757376000},{"_id":"themes/material-flow/source/fonts/icomoon.woff","hash":"0356e9be814a04187c641371fd95a7a8d9111200","modified":1492757376000},{"_id":"themes/material-flow/source/fonts/selection.json","hash":"63e57a0fdd6138c8872f8cafa24b951eaf9fd564","modified":1570773015771},{"_id":"themes/material-flow/source/less/_archive.less","hash":"306c2e1b4a62ba1a241d11efd3935f69178e0927","modified":1570773015780},{"_id":"themes/material-flow/source/less/_article.less","hash":"18436487ed48bb5eefe8e5079ce6adf6841be3ac","modified":1570773015781},{"_id":"themes/material-flow/source/less/_base.less","hash":"50e21f998d7903cb0fa3700a4e535c3ac55e70f9","modified":1570773015783},{"_id":"themes/material-flow/source/less/_defines.less","hash":"9f8e54c4f05e9fa76649aa3abb9d0a8d3a3ce76a","modified":1570773015784},{"_id":"themes/material-flow/source/less/_fonts.less","hash":"cdb77d9bd7a3e62ec3f29ece0b258719a8c5691c","modified":1570773015785},{"_id":"themes/material-flow/source/less/_footer.less","hash":"712ff89e8a4085966ceb5130a07c0a05a2c380b2","modified":1570773015787},{"_id":"themes/material-flow/source/less/_header.less","hash":"83f4fef0a16299b47bcefb16bd5896e436027498","modified":1570773015788},{"_id":"themes/material-flow/source/less/_main.less","hash":"6dba91f400478b6ff526a671a0a6e841c32e3732","modified":1570773015789},{"_id":"themes/material-flow/source/less/_normalize.less","hash":"08678839e42ca4fea4367a847f38464081a4d35b","modified":1570773015791},{"_id":"themes/material-flow/source/less/_pagination.less","hash":"616db8447e79e902bf7b207d1fe3c2fd6a4785b9","modified":1570773015793},{"_id":"themes/material-flow/source/less/_search.less","hash":"d3fdc7b15a80eb0b4204426c2351ea4464d167ff","modified":1570773015794},{"_id":"themes/material-flow/source/less/_side.less","hash":"196ca8a94a40b9bb6694e652bd449b7620a5d5f8","modified":1570773015796},{"_id":"themes/material-flow/source/less/_tog.less","hash":"bff0ab3b06e14a3c171ccd53061f8ccddb1e2fc2","modified":1487066264450},{"_id":"themes/material-flow/source/less/_widget.less","hash":"6fbeb4e44bcceeb7dcc4a12f1682672a2ee90596","modified":1570773015798},{"_id":"source/about/index/about.jpg","hash":"5fe63645d5dc28c2e4eb42c6c4a7ff5641b111e3","modified":1484531883973},{"_id":"source/images/about.jpg","hash":"a97c9f444ad256f09c48bf94ffc84e0798dae790","modified":1484531883977},{"_id":"source/_posts/Basic Algorithms in Go.md","hash":"94a425fc6c4df521d0d7b1296891b09923de1acd","modified":1570773015630},{"_id":"source/_posts/斐波那契堆之Go实现.md","hash":"fd7ff0e8b3d40e71ccb48941866fe68d85ee6b4b","modified":1570773015705},{"_id":"source/_posts/beautifull-i3.md","hash":"e822b0ea4d23ab9083f77c176e7c62c06577be35","modified":1570773015654},{"_id":"themes/material-flow/layout/_widget/links.ejs","hash":"9634db1722323a0637a8e8cbe82d4363b1c2d293","modified":1570773015751},{"_id":"themes/material-flow/source/less/_toc.less","hash":"0d46c18a05e7b26c416791b90a5bd3f4669c3268","modified":1570773015797},{"_id":"source/_posts/GraphQL Learn (1) - Queries and Mutations.md","hash":"f748d8ff3d8546a0b3ec9af974aed2a5cda0e779","modified":1570773015634},{"_id":"source/_posts/GraphQL Learn (2) - Schemas and Types.md","hash":"3797a9608aa2e28ba449cd13736d07bff83eec9a","modified":1570773015635},{"_id":"source/_posts/GraphQL Learn (3) - Validation.md","hash":"07ba5de3cb1372c37e27b5caf61965616ed95719","modified":1570773015637},{"_id":"source/_posts/GraphQL Learn (4) - Execution.md","hash":"31a9005f307e5ba527e5fb107bc548b37323a0c4","modified":1570773015638},{"_id":"source/_posts/GraphQL Learn (5) - Introspection.md","hash":"67277e44e48b50df3efc614c2e5c06abe074c595","modified":1570773015640}],"Category":[{"name":"ACM","_id":"ciz5e9kzk00035rgxthvkzp4k"},{"name":"ASP.NET","_id":"ciz5e9kzv00085rgxd6kfi2t0"},{"name":"Linux","_id":"ciz5e9l07000j5rgxfcgnkvtm"},{"name":"Tech Daily","_id":"ciz5e9l0f00105rgxx1q2l8uv"},{"name":"Cloud Computing","_id":"ciz5e9l0g00175rgxbg8ss62i"},{"name":"Openwrt","_id":"ciz5e9l0h001b5rgxeijiytjl"},{"name":"Web","_id":"ciz5e9l0i001e5rgx2bsi3qov"},{"name":"Git","_id":"ciz5e9l0j001j5rgxpw3qul8d"},{"name":"Hexo","_id":"ciz5e9l1q003q5rgx5sqpruu5"},{"name":"GFW","_id":"ciz5e9l2100475rgxkis8v4ek"},{"name":"Python","_id":"ciz5e9l24004i5rgxvx5z7bdx"},{"name":"IDE/Editor","_id":"ciz5e9l29004u5rgxeykp4y99"},{"name":"Wine","_id":"ciz5e9l2e00535rgxc9w4w50f"}],"Data":[],"Page":[{"title":"关于我","date":"2016-11-23T10:11:44.000Z","_content":"\n一个热衷于造轮子的少年，喜欢：\n- Python\n- Javascript\n- Go\n\n同时我也喜欢：\n- Doctor Who\n- Chopin && Rachmaninov\n\n我的联系方式：\n\n- Telegram:  `@kevinsfork`\n- Github：   [stkevintan](https://github.com/stkevintan)\n- Twttier:   [Kevinsfork](https://twitter.com/kevinsfork)\n- Mail:      <stkevintan@zju.edu.cn>","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2016-11-23 18:11:44\n---\n\n一个热衷于造轮子的少年，喜欢：\n- Python\n- Javascript\n- Go\n\n同时我也喜欢：\n- Doctor Who\n- Chopin && Rachmaninov\n\n我的联系方式：\n\n- Telegram:  `@kevinsfork`\n- Github：   [stkevintan](https://github.com/stkevintan)\n- Twttier:   [Kevinsfork](https://twitter.com/kevinsfork)\n- Mail:      <stkevintan@zju.edu.cn>","updated":"2019-10-11T05:50:15.707Z","path":"about/index.html","_id":"ciz5e9kzb00005rgxnfdkmt8v","comments":1,"layout":"page","content":"<p>一个热衷于造轮子的少年，喜欢：</p>\n<ul>\n<li>Python</li>\n<li>Javascript</li>\n<li>Go</li>\n</ul>\n<p>同时我也喜欢：</p>\n<ul>\n<li>Doctor Who</li>\n<li>Chopin &amp;&amp; Rachmaninov</li>\n</ul>\n<p>我的联系方式：</p>\n<ul>\n<li>Telegram:  <code>@kevinsfork</code></li>\n<li>Github：   <a href=\"https://github.com/stkevintan\" target=\"_blank\" rel=\"noopener\">stkevintan</a></li>\n<li>Twttier:   <a href=\"https://twitter.com/kevinsfork\" target=\"_blank\" rel=\"noopener\">Kevinsfork</a></li>\n<li>Mail:      <a href=\"mailto:&#x73;&#x74;&#107;&#101;&#118;&#105;&#110;&#x74;&#97;&#110;&#64;&#x7a;&#106;&#x75;&#46;&#101;&#100;&#117;&#x2e;&#99;&#110;\" target=\"_blank\" rel=\"noopener\">&#x73;&#x74;&#107;&#101;&#118;&#105;&#110;&#x74;&#97;&#110;&#64;&#x7a;&#106;&#x75;&#46;&#101;&#100;&#117;&#x2e;&#99;&#110;</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>一个热衷于造轮子的少年，喜欢：</p>\n<ul>\n<li>Python</li>\n<li>Javascript</li>\n<li>Go</li>\n</ul>\n<p>同时我也喜欢：</p>\n<ul>\n<li>Doctor Who</li>\n<li>Chopin &amp;&amp; Rachmaninov</li>\n</ul>\n<p>我的联系方式：</p>\n<ul>\n<li>Telegram:  <code>@kevinsfork</code></li>\n<li>Github：   <a href=\"https://github.com/stkevintan\" target=\"_blank\" rel=\"noopener\">stkevintan</a></li>\n<li>Twttier:   <a href=\"https://twitter.com/kevinsfork\" target=\"_blank\" rel=\"noopener\">Kevinsfork</a></li>\n<li>Mail:      <a href=\"mailto:&#x73;&#x74;&#107;&#101;&#118;&#105;&#110;&#x74;&#97;&#110;&#64;&#x7a;&#106;&#x75;&#46;&#101;&#100;&#117;&#x2e;&#99;&#110;\" target=\"_blank\" rel=\"noopener\">&#x73;&#x74;&#107;&#101;&#118;&#105;&#110;&#x74;&#97;&#110;&#64;&#x7a;&#106;&#x75;&#46;&#101;&#100;&#117;&#x2e;&#99;&#110;</a></li>\n</ul>\n"}],"Post":[{"title":"2014 Multi-University Training Contest 4","id":"36","date":"2014-07-31T11:09:32.000Z","_content":"心情就像倒数第二楼那样。\n\nCLJ，我也保证不打死你……\n\nPS:最后一楼朱大神还暴露了。","source":"_posts/2014-multi-university-training-contest-4.md","raw":"title: 2014 Multi-University Training Contest 4\ncategories:\n  - ACM\nid: 36\ndate: 2014-07-31 19:09:32\ntags: 只言片语\n---\n心情就像倒数第二楼那样。\n\nCLJ，我也保证不打死你……\n\nPS:最后一楼朱大神还暴露了。","slug":"2014-multi-university-training-contest-4","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9kzd00015rgx6k961ovc","content":"<p>心情就像倒数第二楼那样。</p>\n<p>CLJ，我也保证不打死你……</p>\n<p>PS:最后一楼朱大神还暴露了。</p>\n","excerpt":"","more":"<p>心情就像倒数第二楼那样。</p>\n<p>CLJ，我也保证不打死你……</p>\n<p>PS:最后一楼朱大神还暴露了。</p>\n"},{"title":"ASP.NET MVC 4笔记（二）","date":"2015-02-24T02:50:00.000Z","_content":"1. 有Timestamp修饰的表在修改已有的记录是一定要将该字段复制，也就是说一定要在Edit网页里面添加一行：\n\t\t@Html.HiddenFor(model => model.RowVersion)\n2. WebSecurity.CreateAccount必须在Userprofile里面先创建账户。\n\t\tSystem.Diagnostics.Debug.WriteLine(\"OnAction:\" + controller + \"/\" + action);\n3. 转换string数组到int数组\n\t\tint[] HostsList = Array.ConvertAll<string, int>(Request[\"HostsId\"].Split(','), u => int.Parse(u));","source":"_posts/ASP-NET-MVC4note2.md","raw":"title: ASP.NET MVC 4笔记（二）\ntags:\n  - C#\n  - asp.net mvc4\ncategories:\n  - ASP.NET\ndate: 2015-02-24 10:50:00\n---\n1. 有Timestamp修饰的表在修改已有的记录是一定要将该字段复制，也就是说一定要在Edit网页里面添加一行：\n\t\t@Html.HiddenFor(model => model.RowVersion)\n2. WebSecurity.CreateAccount必须在Userprofile里面先创建账户。\n\t\tSystem.Diagnostics.Debug.WriteLine(\"OnAction:\" + controller + \"/\" + action);\n3. 转换string数组到int数组\n\t\tint[] HostsList = Array.ConvertAll<string, int>(Request[\"HostsId\"].Split(','), u => int.Parse(u));","slug":"ASP-NET-MVC4note2","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9kzi00025rgxgb9pkka7","content":"<ol>\n<li>有Timestamp修饰的表在修改已有的记录是一定要将该字段复制，也就是说一定要在Edit网页里面添加一行：<pre><code>@Html.HiddenFor(model =&gt; model.RowVersion)\n</code></pre></li>\n<li>WebSecurity.CreateAccount必须在Userprofile里面先创建账户。<pre><code>System.Diagnostics.Debug.WriteLine(&quot;OnAction:&quot; + controller + &quot;/&quot; + action);\n</code></pre></li>\n<li>转换string数组到int数组<pre><code>int[] HostsList = Array.ConvertAll&lt;string, int&gt;(Request[&quot;HostsId&quot;].Split(&apos;,&apos;), u =&gt; int.Parse(u));\n</code></pre></li>\n</ol>\n","excerpt":"","more":"<ol>\n<li>有Timestamp修饰的表在修改已有的记录是一定要将该字段复制，也就是说一定要在Edit网页里面添加一行：<pre><code>@Html.HiddenFor(model =&gt; model.RowVersion)\n</code></pre></li>\n<li>WebSecurity.CreateAccount必须在Userprofile里面先创建账户。<pre><code>System.Diagnostics.Debug.WriteLine(&quot;OnAction:&quot; + controller + &quot;/&quot; + action);\n</code></pre></li>\n<li>转换string数组到int数组<pre><code>int[] HostsList = Array.ConvertAll&lt;string, int&gt;(Request[&quot;HostsId&quot;].Split(&apos;,&apos;), u =&gt; int.Parse(u));\n</code></pre></li>\n</ol>\n"},{"title":"ASP.NET MVC4笔记（一） 扩展Simplemembership","date":"2015-02-24T02:45:07.000Z","_content":"```C#\nusing System.Web.Mvc;\n\nnamespace MvcClassManageSystem.ActionFilters\n{\n    public class LogStateFilterAttribute : ActionFilterAttribute\n    {\n        public override void OnActionExecuting(ActionExecutingContext filterContext)\n        {\n            base.OnActionExecuting(filterContext);\n            //string controller = filterContext.RouteData.Values[\"controller\"].ToString();\n            //string action = filterContext.RouteData.Values[\"action\"].ToString();\n            //System.Diagnostics.Debug.WriteLine(\"OnAction:\" + controller + \"/\" + action);\n\n            if (WebMatrix.WebData.WebSecurity.IsAuthenticated == true)\n            {\n                filterContext.Result = new RedirectToRouteResult(new System.Web.Routing.RouteValueDictionary(new { Controller = \"Home\", action = \"Index\" }));\n            }\n        }\n    }\n}\n```\n<!--more-->\n```C#\npublic static class WebUtility\n    {\n        private static SimpleMembershipProvider membership = (SimpleMembershipProvider)Membership.Provider;\n        public static void CreateUserAndAccount(UserProfile userProfile, string Password)\n        {\n            WebSecurity.CreateUserAndAccount(userProfile.UserName, Password, new\n            {\n                //TO DO 数据库/模型更改之后别忘记修改此处！！！\n                ClassId = userProfile.ClassId,\n                UserExtraInfo_Phone = userProfile.UserExtraInfo.Phone,\n                UserExtraInfo_Gender = userProfile.UserExtraInfo.Gender,\n                UserExtraInfo_BirthDay = userProfile.UserExtraInfo.BirthDay,\n                UserExtraInfo_UserDesc = userProfile.UserExtraInfo.UserDesc\n            });\n        }\n        public static void DeleteUserAndAccount(string UserName)\n        {\n            membership.DeleteAccount(UserName);\n            Roles.RemoveUserFromRoles(UserName, Roles.GetRolesForUser(UserName));\n            membership.DeleteUser(UserName, true);\n        }\n        public static void ResetPassword(string UserName, string NewPassword)\n        {\n            WebSecurity.ResetPassword(WebSecurity.GeneratePasswordResetToken(UserName, 1), NewPassword);\n        }\n    }\n```\n\n```C#\nusing System.Web.Mvc;\nnamespace MvcClassManageSystem.Filters\n{\n    public class MyAuthorizeAttribute : AuthorizeAttribute\n    {\n        protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)\n        {\n            base.HandleUnauthorizedRequest(filterContext);\n            if (filterContext.HttpContext.User.Identity.IsAuthenticated)\n            {\n                filterContext.Result = new RedirectResult(\"/Account/AccessError\");\n            }\n        }\n    }\n}\n```\n\n```C#\nusing System.Data.Entity;\nusing System.Linq;\nusing System.Web.Security;\nusing WebMatrix.WebData;\nnamespace MvcClassManageSystem.Models\n{\n    public class InitSecurityDb : DropCreateDatabaseAlways<DBManager>\n    {\n        protected override void Seed(DBManager context)\n        {\n            WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n            var roles = (SimpleRoleProvider)Roles.Provider;\n \n            string[] RolesList = new string[] { \"Admin\", \"Teacher\", \"Student\" };\n            foreach (var item in RolesList)\n            {\n                if (!roles.RoleExists(item))\n                {\n                    roles.CreateRole(item);\n                }\n            }\n            //设置初始班级\n            int ClassIndex = 0;\n            using (var db = new DBManager())\n            {\n                var ret = db.ClassProfiles.SingleOrDefault(m => m.ClassName.CompareTo(\"未知班级\") == 0);\n                if (ret == null)\n                {\n                    ret = db.ClassProfiles.Add(new ClassProfile\n                    {\n                        ClassName = \"未知班级\",\n                        Desc = \"班级未知或无意义\"\n                    });\n                    db.SaveChanges();\n                }\n                ClassIndex = ret.ClassId;\n            }\n            if (!WebSecurity.UserExists(\"管理员\"))\n            {\n                WebUtility.CreateUserAndAccount(new UserProfile()\n                {\n                    UserName = \"管理员\",\n                    ClassId = ClassIndex,\n                    UserExtraInfo = new UserExtraInfo()\n                    {\n                        Phone = \"18267912632\",\n                        Gender = MvcClassManageSystem.Models.Gender.男,\n                        BirthDay = new System.DateTime(1993, 9, 28),\n                        UserDesc = \"本站的管理员！\"\n                    }\n                }, \"admin\");\n                System.Web.Security.Roles.AddUserToRole(\"管理员\", \"Admin\");\n            }\n        }\n    }\n}\n```\n```C#\n protected void Application_Start()\n        {\n            Database.SetInitializer<DBManager>(new InitSecurityDb());\n            DBManager db = new DBManager();\n            db.Database.Initialize(true);\n            if (!WebSecurity.Initialized)\n            {\n                WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n            }\n\n            AreaRegistration.RegisterAllAreas();\n            WebApiConfig.Register(GlobalConfiguration.Configuration);\n            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);\n            RouteConfig.RegisterRoutes(RouteTable.Routes);\n            BundleConfig.RegisterBundles(BundleTable.Bundles);\n            AuthConfig.RegisterAuth();\n        }\n```","source":"_posts/ASP-NET-MVC4-note1-Simplemembership.md","raw":"title: ASP.NET MVC4笔记（一） 扩展Simplemembership\ndate: 2015-02-24 10:45:07\ntags: [C#,asp.net mvc4,simplemembership]\ncategories: ASP.NET\n---\n```C#\nusing System.Web.Mvc;\n\nnamespace MvcClassManageSystem.ActionFilters\n{\n    public class LogStateFilterAttribute : ActionFilterAttribute\n    {\n        public override void OnActionExecuting(ActionExecutingContext filterContext)\n        {\n            base.OnActionExecuting(filterContext);\n            //string controller = filterContext.RouteData.Values[\"controller\"].ToString();\n            //string action = filterContext.RouteData.Values[\"action\"].ToString();\n            //System.Diagnostics.Debug.WriteLine(\"OnAction:\" + controller + \"/\" + action);\n\n            if (WebMatrix.WebData.WebSecurity.IsAuthenticated == true)\n            {\n                filterContext.Result = new RedirectToRouteResult(new System.Web.Routing.RouteValueDictionary(new { Controller = \"Home\", action = \"Index\" }));\n            }\n        }\n    }\n}\n```\n<!--more-->\n```C#\npublic static class WebUtility\n    {\n        private static SimpleMembershipProvider membership = (SimpleMembershipProvider)Membership.Provider;\n        public static void CreateUserAndAccount(UserProfile userProfile, string Password)\n        {\n            WebSecurity.CreateUserAndAccount(userProfile.UserName, Password, new\n            {\n                //TO DO 数据库/模型更改之后别忘记修改此处！！！\n                ClassId = userProfile.ClassId,\n                UserExtraInfo_Phone = userProfile.UserExtraInfo.Phone,\n                UserExtraInfo_Gender = userProfile.UserExtraInfo.Gender,\n                UserExtraInfo_BirthDay = userProfile.UserExtraInfo.BirthDay,\n                UserExtraInfo_UserDesc = userProfile.UserExtraInfo.UserDesc\n            });\n        }\n        public static void DeleteUserAndAccount(string UserName)\n        {\n            membership.DeleteAccount(UserName);\n            Roles.RemoveUserFromRoles(UserName, Roles.GetRolesForUser(UserName));\n            membership.DeleteUser(UserName, true);\n        }\n        public static void ResetPassword(string UserName, string NewPassword)\n        {\n            WebSecurity.ResetPassword(WebSecurity.GeneratePasswordResetToken(UserName, 1), NewPassword);\n        }\n    }\n```\n\n```C#\nusing System.Web.Mvc;\nnamespace MvcClassManageSystem.Filters\n{\n    public class MyAuthorizeAttribute : AuthorizeAttribute\n    {\n        protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)\n        {\n            base.HandleUnauthorizedRequest(filterContext);\n            if (filterContext.HttpContext.User.Identity.IsAuthenticated)\n            {\n                filterContext.Result = new RedirectResult(\"/Account/AccessError\");\n            }\n        }\n    }\n}\n```\n\n```C#\nusing System.Data.Entity;\nusing System.Linq;\nusing System.Web.Security;\nusing WebMatrix.WebData;\nnamespace MvcClassManageSystem.Models\n{\n    public class InitSecurityDb : DropCreateDatabaseAlways<DBManager>\n    {\n        protected override void Seed(DBManager context)\n        {\n            WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n            var roles = (SimpleRoleProvider)Roles.Provider;\n \n            string[] RolesList = new string[] { \"Admin\", \"Teacher\", \"Student\" };\n            foreach (var item in RolesList)\n            {\n                if (!roles.RoleExists(item))\n                {\n                    roles.CreateRole(item);\n                }\n            }\n            //设置初始班级\n            int ClassIndex = 0;\n            using (var db = new DBManager())\n            {\n                var ret = db.ClassProfiles.SingleOrDefault(m => m.ClassName.CompareTo(\"未知班级\") == 0);\n                if (ret == null)\n                {\n                    ret = db.ClassProfiles.Add(new ClassProfile\n                    {\n                        ClassName = \"未知班级\",\n                        Desc = \"班级未知或无意义\"\n                    });\n                    db.SaveChanges();\n                }\n                ClassIndex = ret.ClassId;\n            }\n            if (!WebSecurity.UserExists(\"管理员\"))\n            {\n                WebUtility.CreateUserAndAccount(new UserProfile()\n                {\n                    UserName = \"管理员\",\n                    ClassId = ClassIndex,\n                    UserExtraInfo = new UserExtraInfo()\n                    {\n                        Phone = \"18267912632\",\n                        Gender = MvcClassManageSystem.Models.Gender.男,\n                        BirthDay = new System.DateTime(1993, 9, 28),\n                        UserDesc = \"本站的管理员！\"\n                    }\n                }, \"admin\");\n                System.Web.Security.Roles.AddUserToRole(\"管理员\", \"Admin\");\n            }\n        }\n    }\n}\n```\n```C#\n protected void Application_Start()\n        {\n            Database.SetInitializer<DBManager>(new InitSecurityDb());\n            DBManager db = new DBManager();\n            db.Database.Initialize(true);\n            if (!WebSecurity.Initialized)\n            {\n                WebSecurity.InitializeDatabaseConnection(\"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n            }\n\n            AreaRegistration.RegisterAllAreas();\n            WebApiConfig.Register(GlobalConfiguration.Configuration);\n            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);\n            RouteConfig.RegisterRoutes(RouteTable.Routes);\n            BundleConfig.RegisterBundles(BundleTable.Bundles);\n            AuthConfig.RegisterAuth();\n        }\n```","slug":"ASP-NET-MVC4-note1-Simplemembership","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9kzo00055rgxprbvyyew","content":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">using System.Web.Mvc;</div><div class=\"line\"></div><div class=\"line\">namespace MvcClassManageSystem.ActionFilters</div><div class=\"line\">&#123;</div><div class=\"line\">    public class LogStateFilterAttribute : ActionFilterAttribute</div><div class=\"line\">    &#123;</div><div class=\"line\">        public override void OnActionExecuting(ActionExecutingContext filterContext)</div><div class=\"line\">        &#123;</div><div class=\"line\">            base.OnActionExecuting(filterContext);</div><div class=\"line\">            //string controller = filterContext.RouteData.Values[&quot;controller&quot;].ToString();</div><div class=\"line\">            //string action = filterContext.RouteData.Values[&quot;action&quot;].ToString();</div><div class=\"line\">            //System.Diagnostics.Debug.WriteLine(&quot;OnAction:&quot; + controller + &quot;/&quot; + action);</div><div class=\"line\"></div><div class=\"line\">            if (WebMatrix.WebData.WebSecurity.IsAuthenticated == true)</div><div class=\"line\">            &#123;</div><div class=\"line\">                filterContext.Result = new RedirectToRouteResult(new System.Web.Routing.RouteValueDictionary(new &#123; Controller = &quot;Home&quot;, action = &quot;Index&quot; &#125;));</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">public static class WebUtility</div><div class=\"line\">    &#123;</div><div class=\"line\">        private static SimpleMembershipProvider membership = (SimpleMembershipProvider)Membership.Provider;</div><div class=\"line\">        public static void CreateUserAndAccount(UserProfile userProfile, string Password)</div><div class=\"line\">        &#123;</div><div class=\"line\">            WebSecurity.CreateUserAndAccount(userProfile.UserName, Password, new</div><div class=\"line\">            &#123;</div><div class=\"line\">                //TO DO 数据库/模型更改之后别忘记修改此处！！！</div><div class=\"line\">                ClassId = userProfile.ClassId,</div><div class=\"line\">                UserExtraInfo_Phone = userProfile.UserExtraInfo.Phone,</div><div class=\"line\">                UserExtraInfo_Gender = userProfile.UserExtraInfo.Gender,</div><div class=\"line\">                UserExtraInfo_BirthDay = userProfile.UserExtraInfo.BirthDay,</div><div class=\"line\">                UserExtraInfo_UserDesc = userProfile.UserExtraInfo.UserDesc</div><div class=\"line\">            &#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">        public static void DeleteUserAndAccount(string UserName)</div><div class=\"line\">        &#123;</div><div class=\"line\">            membership.DeleteAccount(UserName);</div><div class=\"line\">            Roles.RemoveUserFromRoles(UserName, Roles.GetRolesForUser(UserName));</div><div class=\"line\">            membership.DeleteUser(UserName, true);</div><div class=\"line\">        &#125;</div><div class=\"line\">        public static void ResetPassword(string UserName, string NewPassword)</div><div class=\"line\">        &#123;</div><div class=\"line\">            WebSecurity.ResetPassword(WebSecurity.GeneratePasswordResetToken(UserName, 1), NewPassword);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">using System.Web.Mvc;</div><div class=\"line\">namespace MvcClassManageSystem.Filters</div><div class=\"line\">&#123;</div><div class=\"line\">    public class MyAuthorizeAttribute : AuthorizeAttribute</div><div class=\"line\">    &#123;</div><div class=\"line\">        protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)</div><div class=\"line\">        &#123;</div><div class=\"line\">            base.HandleUnauthorizedRequest(filterContext);</div><div class=\"line\">            if (filterContext.HttpContext.User.Identity.IsAuthenticated)</div><div class=\"line\">            &#123;</div><div class=\"line\">                filterContext.Result = new RedirectResult(&quot;/Account/AccessError&quot;);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\">using System.Data.Entity;</div><div class=\"line\">using System.Linq;</div><div class=\"line\">using System.Web.Security;</div><div class=\"line\">using WebMatrix.WebData;</div><div class=\"line\">namespace MvcClassManageSystem.Models</div><div class=\"line\">&#123;</div><div class=\"line\">    public class InitSecurityDb : DropCreateDatabaseAlways&lt;DBManager&gt;</div><div class=\"line\">    &#123;</div><div class=\"line\">        protected override void Seed(DBManager context)</div><div class=\"line\">        &#123;</div><div class=\"line\">            WebSecurity.InitializeDatabaseConnection(&quot;DefaultConnection&quot;, &quot;UserProfile&quot;, &quot;UserId&quot;, &quot;UserName&quot;, autoCreateTables: true);</div><div class=\"line\">            var roles = (SimpleRoleProvider)Roles.Provider;</div><div class=\"line\"> </div><div class=\"line\">            string[] RolesList = new string[] &#123; &quot;Admin&quot;, &quot;Teacher&quot;, &quot;Student&quot; &#125;;</div><div class=\"line\">            foreach (var item in RolesList)</div><div class=\"line\">            &#123;</div><div class=\"line\">                if (!roles.RoleExists(item))</div><div class=\"line\">                &#123;</div><div class=\"line\">                    roles.CreateRole(item);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            //设置初始班级</div><div class=\"line\">            int ClassIndex = 0;</div><div class=\"line\">            using (var db = new DBManager())</div><div class=\"line\">            &#123;</div><div class=\"line\">                var ret = db.ClassProfiles.SingleOrDefault(m =&gt; m.ClassName.CompareTo(&quot;未知班级&quot;) == 0);</div><div class=\"line\">                if (ret == null)</div><div class=\"line\">                &#123;</div><div class=\"line\">                    ret = db.ClassProfiles.Add(new ClassProfile</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        ClassName = &quot;未知班级&quot;,</div><div class=\"line\">                        Desc = &quot;班级未知或无意义&quot;</div><div class=\"line\">                    &#125;);</div><div class=\"line\">                    db.SaveChanges();</div><div class=\"line\">                &#125;</div><div class=\"line\">                ClassIndex = ret.ClassId;</div><div class=\"line\">            &#125;</div><div class=\"line\">            if (!WebSecurity.UserExists(&quot;管理员&quot;))</div><div class=\"line\">            &#123;</div><div class=\"line\">                WebUtility.CreateUserAndAccount(new UserProfile()</div><div class=\"line\">                &#123;</div><div class=\"line\">                    UserName = &quot;管理员&quot;,</div><div class=\"line\">                    ClassId = ClassIndex,</div><div class=\"line\">                    UserExtraInfo = new UserExtraInfo()</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        Phone = &quot;18267912632&quot;,</div><div class=\"line\">                        Gender = MvcClassManageSystem.Models.Gender.男,</div><div class=\"line\">                        BirthDay = new System.DateTime(1993, 9, 28),</div><div class=\"line\">                        UserDesc = &quot;本站的管理员！&quot;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;, &quot;admin&quot;);</div><div class=\"line\">                System.Web.Security.Roles.AddUserToRole(&quot;管理员&quot;, &quot;Admin&quot;);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"> protected void Application_Start()</div><div class=\"line\">        &#123;</div><div class=\"line\">            Database.SetInitializer&lt;DBManager&gt;(new InitSecurityDb());</div><div class=\"line\">            DBManager db = new DBManager();</div><div class=\"line\">            db.Database.Initialize(true);</div><div class=\"line\">            if (!WebSecurity.Initialized)</div><div class=\"line\">            &#123;</div><div class=\"line\">                WebSecurity.InitializeDatabaseConnection(&quot;DefaultConnection&quot;, &quot;UserProfile&quot;, &quot;UserId&quot;, &quot;UserName&quot;, autoCreateTables: true);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            AreaRegistration.RegisterAllAreas();</div><div class=\"line\">            WebApiConfig.Register(GlobalConfiguration.Configuration);</div><div class=\"line\">            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);</div><div class=\"line\">            RouteConfig.RegisterRoutes(RouteTable.Routes);</div><div class=\"line\">            BundleConfig.RegisterBundles(BundleTable.Bundles);</div><div class=\"line\">            AuthConfig.RegisterAuth();</div><div class=\"line\">        &#125;</div></pre></td></tr></table></figure>","excerpt":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">using System.Web.Mvc;</div><div class=\"line\"></div><div class=\"line\">namespace MvcClassManageSystem.ActionFilters</div><div class=\"line\">&#123;</div><div class=\"line\">    public class LogStateFilterAttribute : ActionFilterAttribute</div><div class=\"line\">    &#123;</div><div class=\"line\">        public override void OnActionExecuting(ActionExecutingContext filterContext)</div><div class=\"line\">        &#123;</div><div class=\"line\">            base.OnActionExecuting(filterContext);</div><div class=\"line\">            //string controller = filterContext.RouteData.Values[&quot;controller&quot;].ToString();</div><div class=\"line\">            //string action = filterContext.RouteData.Values[&quot;action&quot;].ToString();</div><div class=\"line\">            //System.Diagnostics.Debug.WriteLine(&quot;OnAction:&quot; + controller + &quot;/&quot; + action);</div><div class=\"line\"></div><div class=\"line\">            if (WebMatrix.WebData.WebSecurity.IsAuthenticated == true)</div><div class=\"line\">            &#123;</div><div class=\"line\">                filterContext.Result = new RedirectToRouteResult(new System.Web.Routing.RouteValueDictionary(new &#123; Controller = &quot;Home&quot;, action = &quot;Index&quot; &#125;));</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">public static class WebUtility</div><div class=\"line\">    &#123;</div><div class=\"line\">        private static SimpleMembershipProvider membership = (SimpleMembershipProvider)Membership.Provider;</div><div class=\"line\">        public static void CreateUserAndAccount(UserProfile userProfile, string Password)</div><div class=\"line\">        &#123;</div><div class=\"line\">            WebSecurity.CreateUserAndAccount(userProfile.UserName, Password, new</div><div class=\"line\">            &#123;</div><div class=\"line\">                //TO DO 数据库/模型更改之后别忘记修改此处！！！</div><div class=\"line\">                ClassId = userProfile.ClassId,</div><div class=\"line\">                UserExtraInfo_Phone = userProfile.UserExtraInfo.Phone,</div><div class=\"line\">                UserExtraInfo_Gender = userProfile.UserExtraInfo.Gender,</div><div class=\"line\">                UserExtraInfo_BirthDay = userProfile.UserExtraInfo.BirthDay,</div><div class=\"line\">                UserExtraInfo_UserDesc = userProfile.UserExtraInfo.UserDesc</div><div class=\"line\">            &#125;);</div><div class=\"line\">        &#125;</div><div class=\"line\">        public static void DeleteUserAndAccount(string UserName)</div><div class=\"line\">        &#123;</div><div class=\"line\">            membership.DeleteAccount(UserName);</div><div class=\"line\">            Roles.RemoveUserFromRoles(UserName, Roles.GetRolesForUser(UserName));</div><div class=\"line\">            membership.DeleteUser(UserName, true);</div><div class=\"line\">        &#125;</div><div class=\"line\">        public static void ResetPassword(string UserName, string NewPassword)</div><div class=\"line\">        &#123;</div><div class=\"line\">            WebSecurity.ResetPassword(WebSecurity.GeneratePasswordResetToken(UserName, 1), NewPassword);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">using System.Web.Mvc;</div><div class=\"line\">namespace MvcClassManageSystem.Filters</div><div class=\"line\">&#123;</div><div class=\"line\">    public class MyAuthorizeAttribute : AuthorizeAttribute</div><div class=\"line\">    &#123;</div><div class=\"line\">        protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)</div><div class=\"line\">        &#123;</div><div class=\"line\">            base.HandleUnauthorizedRequest(filterContext);</div><div class=\"line\">            if (filterContext.HttpContext.User.Identity.IsAuthenticated)</div><div class=\"line\">            &#123;</div><div class=\"line\">                filterContext.Result = new RedirectResult(&quot;/Account/AccessError&quot;);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\">using System.Data.Entity;</div><div class=\"line\">using System.Linq;</div><div class=\"line\">using System.Web.Security;</div><div class=\"line\">using WebMatrix.WebData;</div><div class=\"line\">namespace MvcClassManageSystem.Models</div><div class=\"line\">&#123;</div><div class=\"line\">    public class InitSecurityDb : DropCreateDatabaseAlways&lt;DBManager&gt;</div><div class=\"line\">    &#123;</div><div class=\"line\">        protected override void Seed(DBManager context)</div><div class=\"line\">        &#123;</div><div class=\"line\">            WebSecurity.InitializeDatabaseConnection(&quot;DefaultConnection&quot;, &quot;UserProfile&quot;, &quot;UserId&quot;, &quot;UserName&quot;, autoCreateTables: true);</div><div class=\"line\">            var roles = (SimpleRoleProvider)Roles.Provider;</div><div class=\"line\"> </div><div class=\"line\">            string[] RolesList = new string[] &#123; &quot;Admin&quot;, &quot;Teacher&quot;, &quot;Student&quot; &#125;;</div><div class=\"line\">            foreach (var item in RolesList)</div><div class=\"line\">            &#123;</div><div class=\"line\">                if (!roles.RoleExists(item))</div><div class=\"line\">                &#123;</div><div class=\"line\">                    roles.CreateRole(item);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            //设置初始班级</div><div class=\"line\">            int ClassIndex = 0;</div><div class=\"line\">            using (var db = new DBManager())</div><div class=\"line\">            &#123;</div><div class=\"line\">                var ret = db.ClassProfiles.SingleOrDefault(m =&gt; m.ClassName.CompareTo(&quot;未知班级&quot;) == 0);</div><div class=\"line\">                if (ret == null)</div><div class=\"line\">                &#123;</div><div class=\"line\">                    ret = db.ClassProfiles.Add(new ClassProfile</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        ClassName = &quot;未知班级&quot;,</div><div class=\"line\">                        Desc = &quot;班级未知或无意义&quot;</div><div class=\"line\">                    &#125;);</div><div class=\"line\">                    db.SaveChanges();</div><div class=\"line\">                &#125;</div><div class=\"line\">                ClassIndex = ret.ClassId;</div><div class=\"line\">            &#125;</div><div class=\"line\">            if (!WebSecurity.UserExists(&quot;管理员&quot;))</div><div class=\"line\">            &#123;</div><div class=\"line\">                WebUtility.CreateUserAndAccount(new UserProfile()</div><div class=\"line\">                &#123;</div><div class=\"line\">                    UserName = &quot;管理员&quot;,</div><div class=\"line\">                    ClassId = ClassIndex,</div><div class=\"line\">                    UserExtraInfo = new UserExtraInfo()</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        Phone = &quot;18267912632&quot;,</div><div class=\"line\">                        Gender = MvcClassManageSystem.Models.Gender.男,</div><div class=\"line\">                        BirthDay = new System.DateTime(1993, 9, 28),</div><div class=\"line\">                        UserDesc = &quot;本站的管理员！&quot;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;, &quot;admin&quot;);</div><div class=\"line\">                System.Web.Security.Roles.AddUserToRole(&quot;管理员&quot;, &quot;Admin&quot;);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"> protected void Application_Start()</div><div class=\"line\">        &#123;</div><div class=\"line\">            Database.SetInitializer&lt;DBManager&gt;(new InitSecurityDb());</div><div class=\"line\">            DBManager db = new DBManager();</div><div class=\"line\">            db.Database.Initialize(true);</div><div class=\"line\">            if (!WebSecurity.Initialized)</div><div class=\"line\">            &#123;</div><div class=\"line\">                WebSecurity.InitializeDatabaseConnection(&quot;DefaultConnection&quot;, &quot;UserProfile&quot;, &quot;UserId&quot;, &quot;UserName&quot;, autoCreateTables: true);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            AreaRegistration.RegisterAllAreas();</div><div class=\"line\">            WebApiConfig.Register(GlobalConfiguration.Configuration);</div><div class=\"line\">            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);</div><div class=\"line\">            RouteConfig.RegisterRoutes(RouteTable.Routes);</div><div class=\"line\">            BundleConfig.RegisterBundles(BundleTable.Bundles);</div><div class=\"line\">            AuthConfig.RegisterAuth();</div><div class=\"line\">        &#125;</div></pre></td></tr></table></figure>"},{"title":"Centos初始化2","date":"2017-01-03T16:00:00.000Z","_content":"\n## proxychains-ng\n\n```bash\ngit clone https://github.com/rofl0r/proxychains-ng\ncd proxychains-ng                                 \n./configure --prefix=/usr --sysconfdir=/etc \nmake\nmake install\nmake install-config   # 生成配置文件\necho 'http 10.100.100.136 4411' >> /etc/proxychains.conf  # 输入代理设置\n```\n\n<!-- more -->\n\n## TMUX\n\nCentOS的版本太老，手动编译最新版本\n\n```bash\nyum install ncurses-devel libevent-devel\ncurl -L https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz | tar xz\ncd tmux-2.3\n./configure\nmake\nmake install\n```\n\n如果出现`protocol version mismatch`错误，说明现在tmux正在运行，手动结束掉即可。\n\n```bash\nkill -9 `pidof tmux`\n```\n\n\n\n### theme\n\n```bash\ngit clone https://github.com/gpakosz/.tmux.git\nln -s -f .tmux/.tmux.conf\ncp .tmux/.tmux.conf.local .\nvim .tmux.conf.local #编辑配置文件\n# 去掉status left/right sections separators后面几行的注释（终端字体需要支持Powerline）\n# 启用 force vi mode\n```\n\n### shortcuts\n\n```bash\n# Session\n:new[-s name]  # new session\n:kill-session[-t name] # kill session\n:ls # list sessions\nC-c # new session\ns  # list and select sessions\n$  # name session\n\n==============================================\n\n# Window\nc  # create window\nw  # list windows\nn  # next window\np  # previous window\nf  # find window\n,  # name window\n&  # kill window\n\n===============================================\n\n# Panes\n%  #vertical split\n\"  # horizontal split\no  # swap panes\nq  # show pane numbers\nx  # kill pane\n+  # 最大化pane，再按一次还原\n-  # restore pane from window\n⍽  # space - toggle between layouts\nq  # (Show pane numbers, when the numbers show up type the key to goto that pane)\n{  # (Move the current pane left)\n}  # (Move the current pane right)\nz  # toggle pane zoom\n方向键 # select the sibling pane\nC-方向键 # resize current pane\n\n================================================\n\n# Misc\nd  # detach\nt  # big clock\n?  # list shortcuts\n:  # prompt\n```\n\n### Tmux Plugin Manager && tmux-yank\n\ntmux-yank可以将tmux的paste-buffer中的文字拷贝到系统剪贴板\n\n```bash\nyumi xclip # 安装依赖\ngit clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm \nvim .tmux.conf # 在最后添加下面几行，注意不是 .tmux.conf.local!!!\n```\n\n```bash\n# List of plugins\nset -g @plugin 'tmux-plugins/tpm'\nset -g @plugin 'tmux-plugins/tmux-yank'\n\n# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)\nrun '~/.tmux/plugins/tpm/tpm'\n```\n\n然后，重新加载tmux，按<prefix> + I 安装`tmux-yank`插件\n\n然后，并不能奏效，因为xclip需要有X服务。然而ssh客户端Centos只是纯命令行。需要开启`X11Forwarding`\n\n## X11Forwarding\n\n1. 在远程Centos中的`/etc/ssh/ssh_config`文件中，添加`X11Forwarding yes`\n\n2. 在远程Centos中安装认证软件：`yumi xorg-x11-xauth`\n\n3. 在本地ssh连接命令添加`-Y`参数\n\n   启用x11转发之后就可以在Centos中启动x11程序了，可以安装轻量级的xfce4-terminal方便操作。\n\n## Prezto\n\n```bash\n  git clone --recursive https://github.com/sorin-ionescu/prezto.git \"${ZDOTDIR:-$HOME}/.zprezto\"\nrm -rf .zshrc .zpreztorc .zlogin .zlogout .zprofile .zshenv .zhistory .zcompdump\nsetopt EXTENDED_GLOB\nfor rcfile in \"${ZDOTDIR:-$HOME}\"/.zprezto/runcoms/^README.md(.N); do\n  ln -s \"$rcfile\" \"${ZDOTDIR:-$HOME}/.${rcfile:t}\"\ndone\n\n# 主题列表\nprompt -l\n# 预览主题\nprompt -p NAME\n# 做个备份\nmv .zpreztorc .zpreztorc.tmp\n# 添加常用插件(不要第二次运行，而是手动修改.zpreztorc文件)\nawk -v s=\"syntax-highlighting git command-not-found yum history-substring-search autosuggestions\" \\\n'BEGIN{n=split(s,m)}/'\\''utility'\\''\\s+\\\\/{for(i=1;i<=n;i++)printf(\"  '\\''%s'\\'' \\\\\\n\",m[i])}{print}' .zpreztorc.tmp > .zpreztorc\n# 修改默认主题（推荐 skwp）\nsed -i \"s/\\(zstyle.*theme\\s\\).*/\\1'skwp'/\" .zpreztorc\n```\n\n\nYum Aliases\n-------\n\n- `yumc` removes package(s) and leaves.\n- `yumi` installs package(s).\n- `yumh` displays history.\n- `yuml` lists packages.\n- `yumL` lists installed packages.\n- `yumq` displays package information.\n- `yumr` removes package(s).\n- `yums` searches for a package.\n- `yumu` updates packages.\n- `yumU` upgrades packages.\n\n\n## spf13 Vim\n\n```bash\ncurl https://j.mp/spf13-vim3 -L > spf13-vim.sh && sh spf13-vim.sh\n```\n\n","source":"_posts/CentOS2@1-4.md","raw":"---\ntitle: Centos初始化2\ndate: 2017-1-4\ntags:\n  - centos\n  - tmux\n  - prezto\ncategories:\n  - Linux\n---\n\n## proxychains-ng\n\n```bash\ngit clone https://github.com/rofl0r/proxychains-ng\ncd proxychains-ng                                 \n./configure --prefix=/usr --sysconfdir=/etc \nmake\nmake install\nmake install-config   # 生成配置文件\necho 'http 10.100.100.136 4411' >> /etc/proxychains.conf  # 输入代理设置\n```\n\n<!-- more -->\n\n## TMUX\n\nCentOS的版本太老，手动编译最新版本\n\n```bash\nyum install ncurses-devel libevent-devel\ncurl -L https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz | tar xz\ncd tmux-2.3\n./configure\nmake\nmake install\n```\n\n如果出现`protocol version mismatch`错误，说明现在tmux正在运行，手动结束掉即可。\n\n```bash\nkill -9 `pidof tmux`\n```\n\n\n\n### theme\n\n```bash\ngit clone https://github.com/gpakosz/.tmux.git\nln -s -f .tmux/.tmux.conf\ncp .tmux/.tmux.conf.local .\nvim .tmux.conf.local #编辑配置文件\n# 去掉status left/right sections separators后面几行的注释（终端字体需要支持Powerline）\n# 启用 force vi mode\n```\n\n### shortcuts\n\n```bash\n# Session\n:new[-s name]  # new session\n:kill-session[-t name] # kill session\n:ls # list sessions\nC-c # new session\ns  # list and select sessions\n$  # name session\n\n==============================================\n\n# Window\nc  # create window\nw  # list windows\nn  # next window\np  # previous window\nf  # find window\n,  # name window\n&  # kill window\n\n===============================================\n\n# Panes\n%  #vertical split\n\"  # horizontal split\no  # swap panes\nq  # show pane numbers\nx  # kill pane\n+  # 最大化pane，再按一次还原\n-  # restore pane from window\n⍽  # space - toggle between layouts\nq  # (Show pane numbers, when the numbers show up type the key to goto that pane)\n{  # (Move the current pane left)\n}  # (Move the current pane right)\nz  # toggle pane zoom\n方向键 # select the sibling pane\nC-方向键 # resize current pane\n\n================================================\n\n# Misc\nd  # detach\nt  # big clock\n?  # list shortcuts\n:  # prompt\n```\n\n### Tmux Plugin Manager && tmux-yank\n\ntmux-yank可以将tmux的paste-buffer中的文字拷贝到系统剪贴板\n\n```bash\nyumi xclip # 安装依赖\ngit clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm \nvim .tmux.conf # 在最后添加下面几行，注意不是 .tmux.conf.local!!!\n```\n\n```bash\n# List of plugins\nset -g @plugin 'tmux-plugins/tpm'\nset -g @plugin 'tmux-plugins/tmux-yank'\n\n# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)\nrun '~/.tmux/plugins/tpm/tpm'\n```\n\n然后，重新加载tmux，按<prefix> + I 安装`tmux-yank`插件\n\n然后，并不能奏效，因为xclip需要有X服务。然而ssh客户端Centos只是纯命令行。需要开启`X11Forwarding`\n\n## X11Forwarding\n\n1. 在远程Centos中的`/etc/ssh/ssh_config`文件中，添加`X11Forwarding yes`\n\n2. 在远程Centos中安装认证软件：`yumi xorg-x11-xauth`\n\n3. 在本地ssh连接命令添加`-Y`参数\n\n   启用x11转发之后就可以在Centos中启动x11程序了，可以安装轻量级的xfce4-terminal方便操作。\n\n## Prezto\n\n```bash\n  git clone --recursive https://github.com/sorin-ionescu/prezto.git \"${ZDOTDIR:-$HOME}/.zprezto\"\nrm -rf .zshrc .zpreztorc .zlogin .zlogout .zprofile .zshenv .zhistory .zcompdump\nsetopt EXTENDED_GLOB\nfor rcfile in \"${ZDOTDIR:-$HOME}\"/.zprezto/runcoms/^README.md(.N); do\n  ln -s \"$rcfile\" \"${ZDOTDIR:-$HOME}/.${rcfile:t}\"\ndone\n\n# 主题列表\nprompt -l\n# 预览主题\nprompt -p NAME\n# 做个备份\nmv .zpreztorc .zpreztorc.tmp\n# 添加常用插件(不要第二次运行，而是手动修改.zpreztorc文件)\nawk -v s=\"syntax-highlighting git command-not-found yum history-substring-search autosuggestions\" \\\n'BEGIN{n=split(s,m)}/'\\''utility'\\''\\s+\\\\/{for(i=1;i<=n;i++)printf(\"  '\\''%s'\\'' \\\\\\n\",m[i])}{print}' .zpreztorc.tmp > .zpreztorc\n# 修改默认主题（推荐 skwp）\nsed -i \"s/\\(zstyle.*theme\\s\\).*/\\1'skwp'/\" .zpreztorc\n```\n\n\nYum Aliases\n-------\n\n- `yumc` removes package(s) and leaves.\n- `yumi` installs package(s).\n- `yumh` displays history.\n- `yuml` lists packages.\n- `yumL` lists installed packages.\n- `yumq` displays package information.\n- `yumr` removes package(s).\n- `yums` searches for a package.\n- `yumu` updates packages.\n- `yumU` upgrades packages.\n\n\n## spf13 Vim\n\n```bash\ncurl https://j.mp/spf13-vim3 -L > spf13-vim.sh && sh spf13-vim.sh\n```\n\n","slug":"CentOS2@1-4","published":1,"updated":"2019-10-11T05:50:15.632Z","_id":"ciz5e9kzr00065rgxgfv57oer","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"proxychains-ng\"><a href=\"#proxychains-ng\" class=\"headerlink\" title=\"proxychains-ng\"></a>proxychains-ng</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/rofl0r/proxychains-ng</span><br><span class=\"line\"><span class=\"built_in\">cd</span> proxychains-ng                                 </span><br><span class=\"line\">./configure --prefix=/usr --sysconfdir=/etc </span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">make install-config   <span class=\"comment\"># 生成配置文件</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'http 10.100.100.136 4411'</span> &gt;&gt; /etc/proxychains.conf  <span class=\"comment\"># 输入代理设置</span></span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h2 id=\"TMUX\"><a href=\"#TMUX\" class=\"headerlink\" title=\"TMUX\"></a>TMUX</h2><p>CentOS的版本太老，手动编译最新版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install ncurses-devel libevent-devel</span><br><span class=\"line\">curl -L https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz | tar xz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> tmux-2.3</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>如果出现<code>protocol version mismatch</code>错误，说明现在tmux正在运行，手动结束掉即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">kill</span> -9 `pidof tmux`</span><br></pre></td></tr></table></figure>\n<h3 id=\"theme\"><a href=\"#theme\" class=\"headerlink\" title=\"theme\"></a>theme</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/gpakosz/.tmux.git</span><br><span class=\"line\">ln -s -f .tmux/.tmux.conf</span><br><span class=\"line\">cp .tmux/.tmux.conf.local .</span><br><span class=\"line\">vim .tmux.conf.local <span class=\"comment\">#编辑配置文件</span></span><br><span class=\"line\"><span class=\"comment\"># 去掉status left/right sections separators后面几行的注释（终端字体需要支持Powerline）</span></span><br><span class=\"line\"><span class=\"comment\"># 启用 force vi mode</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"shortcuts\"><a href=\"#shortcuts\" class=\"headerlink\" title=\"shortcuts\"></a>shortcuts</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Session</span></span><br><span class=\"line\">:new[-s name]  <span class=\"comment\"># new session</span></span><br><span class=\"line\">:<span class=\"built_in\">kill</span>-session[-t name] <span class=\"comment\"># kill session</span></span><br><span class=\"line\">:ls <span class=\"comment\"># list sessions</span></span><br><span class=\"line\">C-c <span class=\"comment\"># new session</span></span><br><span class=\"line\">s  <span class=\"comment\"># list and select sessions</span></span><br><span class=\"line\">$  <span class=\"comment\"># name session</span></span><br><span class=\"line\"></span><br><span class=\"line\">==============================================</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Window</span></span><br><span class=\"line\">c  <span class=\"comment\"># create window</span></span><br><span class=\"line\">w  <span class=\"comment\"># list windows</span></span><br><span class=\"line\">n  <span class=\"comment\"># next window</span></span><br><span class=\"line\">p  <span class=\"comment\"># previous window</span></span><br><span class=\"line\">f  <span class=\"comment\"># find window</span></span><br><span class=\"line\">,  <span class=\"comment\"># name window</span></span><br><span class=\"line\">&amp;  <span class=\"comment\"># kill window</span></span><br><span class=\"line\"></span><br><span class=\"line\">===============================================</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Panes</span></span><br><span class=\"line\">%  <span class=\"comment\">#vertical split</span></span><br><span class=\"line\"><span class=\"string\">\"  # horizontal split</span></span><br><span class=\"line\"><span class=\"string\">o  # swap panes</span></span><br><span class=\"line\"><span class=\"string\">q  # show pane numbers</span></span><br><span class=\"line\"><span class=\"string\">x  # kill pane</span></span><br><span class=\"line\"><span class=\"string\">+  # 最大化pane，再按一次还原</span></span><br><span class=\"line\"><span class=\"string\">-  # restore pane from window</span></span><br><span class=\"line\"><span class=\"string\">⍽  # space - toggle between layouts</span></span><br><span class=\"line\"><span class=\"string\">q  # (Show pane numbers, when the numbers show up type the key to goto that pane)</span></span><br><span class=\"line\"><span class=\"string\">&#123;  # (Move the current pane left)</span></span><br><span class=\"line\"><span class=\"string\">&#125;  # (Move the current pane right)</span></span><br><span class=\"line\"><span class=\"string\">z  # toggle pane zoom</span></span><br><span class=\"line\"><span class=\"string\">方向键 # select the sibling pane</span></span><br><span class=\"line\"><span class=\"string\">C-方向键 # resize current pane</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">================================================</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># Misc</span></span><br><span class=\"line\"><span class=\"string\">d  # detach</span></span><br><span class=\"line\"><span class=\"string\">t  # big clock</span></span><br><span class=\"line\"><span class=\"string\">?  # list shortcuts</span></span><br><span class=\"line\"><span class=\"string\">:  # prompt</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Tmux-Plugin-Manager-amp-amp-tmux-yank\"><a href=\"#Tmux-Plugin-Manager-amp-amp-tmux-yank\" class=\"headerlink\" title=\"Tmux Plugin Manager &amp;&amp; tmux-yank\"></a>Tmux Plugin Manager &amp;&amp; tmux-yank</h3><p>tmux-yank可以将tmux的paste-buffer中的文字拷贝到系统剪贴板</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yumi xclip <span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm </span><br><span class=\"line\">vim .tmux.conf <span class=\"comment\"># 在最后添加下面几行，注意不是 .tmux.conf.local!!!</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># List of plugins</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -g @plugin <span class=\"string\">'tmux-plugins/tpm'</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -g @plugin <span class=\"string\">'tmux-plugins/tmux-yank'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)</span></span><br><span class=\"line\">run <span class=\"string\">'~/.tmux/plugins/tpm/tpm'</span></span><br></pre></td></tr></table></figure>\n<p>然后，重新加载tmux，按<prefix> + I 安装<code>tmux-yank</code>插件</prefix></p>\n<p>然后，并不能奏效，因为xclip需要有X服务。然而ssh客户端Centos只是纯命令行。需要开启<code>X11Forwarding</code></p>\n<h2 id=\"X11Forwarding\"><a href=\"#X11Forwarding\" class=\"headerlink\" title=\"X11Forwarding\"></a>X11Forwarding</h2><ol>\n<li><p>在远程Centos中的<code>/etc/ssh/ssh_config</code>文件中，添加<code>X11Forwarding yes</code></p>\n</li>\n<li><p>在远程Centos中安装认证软件：<code>yumi xorg-x11-xauth</code></p>\n</li>\n<li><p>在本地ssh连接命令添加<code>-Y</code>参数</p>\n<p>启用x11转发之后就可以在Centos中启动x11程序了，可以安装轻量级的xfce4-terminal方便操作。</p>\n</li>\n</ol>\n<h2 id=\"Prezto\"><a href=\"#Prezto\" class=\"headerlink\" title=\"Prezto\"></a>Prezto</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  git <span class=\"built_in\">clone</span> --recursive https://github.com/sorin-ionescu/prezto.git <span class=\"string\">\"<span class=\"variable\">$&#123;ZDOTDIR:-$HOME&#125;</span>/.zprezto\"</span></span><br><span class=\"line\">rm -rf .zshrc .zpreztorc .zlogin .zlogout .zprofile .zshenv .zhistory .zcompdump</span><br><span class=\"line\"><span class=\"built_in\">setopt</span> EXTENDED_GLOB</span><br><span class=\"line\"><span class=\"keyword\">for</span> rcfile <span class=\"keyword\">in</span> <span class=\"string\">\"<span class=\"variable\">$&#123;ZDOTDIR:-$HOME&#125;</span>\"</span>/.zprezto/runcoms/^README.md(.N); <span class=\"keyword\">do</span></span><br><span class=\"line\">  ln -s <span class=\"string\">\"<span class=\"variable\">$rcfile</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;ZDOTDIR:-$HOME&#125;</span>/.<span class=\"variable\">$&#123;rcfile:t&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 主题列表</span></span><br><span class=\"line\">prompt -l</span><br><span class=\"line\"><span class=\"comment\"># 预览主题</span></span><br><span class=\"line\">prompt -p NAME</span><br><span class=\"line\"><span class=\"comment\"># 做个备份</span></span><br><span class=\"line\">mv .zpreztorc .zpreztorc.tmp</span><br><span class=\"line\"><span class=\"comment\"># 添加常用插件(不要第二次运行，而是手动修改.zpreztorc文件)</span></span><br><span class=\"line\">awk -v s=<span class=\"string\">\"syntax-highlighting git command-not-found yum history-substring-search autosuggestions\"</span> \\</span><br><span class=\"line\"><span class=\"string\">'BEGIN&#123;n=split(s,m)&#125;/'</span>\\<span class=\"string\">''</span>utility<span class=\"string\">'\\'</span><span class=\"string\">'\\s+\\\\/&#123;for(i=1;i&lt;=n;i++)printf(\"  '</span>\\<span class=\"string\">''</span>%s<span class=\"string\">'\\'</span><span class=\"string\">' \\\\\\n\",m[i])&#125;&#123;print&#125;'</span> .zpreztorc.tmp &gt; .zpreztorc</span><br><span class=\"line\"><span class=\"comment\"># 修改默认主题（推荐 skwp）</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s/\\(zstyle.*theme\\s\\).*/\\1'skwp'/\"</span> .zpreztorc</span><br></pre></td></tr></table></figure>\n<h2 id=\"Yum-Aliases\"><a href=\"#Yum-Aliases\" class=\"headerlink\" title=\"Yum Aliases\"></a>Yum Aliases</h2><ul>\n<li><code>yumc</code> removes package(s) and leaves.</li>\n<li><code>yumi</code> installs package(s).</li>\n<li><code>yumh</code> displays history.</li>\n<li><code>yuml</code> lists packages.</li>\n<li><code>yumL</code> lists installed packages.</li>\n<li><code>yumq</code> displays package information.</li>\n<li><code>yumr</code> removes package(s).</li>\n<li><code>yums</code> searches for a package.</li>\n<li><code>yumu</code> updates packages.</li>\n<li><code>yumU</code> upgrades packages.</li>\n</ul>\n<h2 id=\"spf13-Vim\"><a href=\"#spf13-Vim\" class=\"headerlink\" title=\"spf13 Vim\"></a>spf13 Vim</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://j.mp/spf13-vim3 -L &gt; spf13-vim.sh &amp;&amp; sh spf13-vim.sh</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"proxychains-ng\"><a href=\"#proxychains-ng\" class=\"headerlink\" title=\"proxychains-ng\"></a>proxychains-ng</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/rofl0r/proxychains-ng</span><br><span class=\"line\"><span class=\"built_in\">cd</span> proxychains-ng                                 </span><br><span class=\"line\">./configure --prefix=/usr --sysconfdir=/etc </span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">make install-config   <span class=\"comment\"># 生成配置文件</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'http 10.100.100.136 4411'</span> &gt;&gt; /etc/proxychains.conf  <span class=\"comment\"># 输入代理设置</span></span><br></pre></td></tr></table></figure>","more":"<h2 id=\"TMUX\"><a href=\"#TMUX\" class=\"headerlink\" title=\"TMUX\"></a>TMUX</h2><p>CentOS的版本太老，手动编译最新版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install ncurses-devel libevent-devel</span><br><span class=\"line\">curl -L https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz | tar xz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> tmux-2.3</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>如果出现<code>protocol version mismatch</code>错误，说明现在tmux正在运行，手动结束掉即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">kill</span> -9 `pidof tmux`</span><br></pre></td></tr></table></figure>\n<h3 id=\"theme\"><a href=\"#theme\" class=\"headerlink\" title=\"theme\"></a>theme</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/gpakosz/.tmux.git</span><br><span class=\"line\">ln -s -f .tmux/.tmux.conf</span><br><span class=\"line\">cp .tmux/.tmux.conf.local .</span><br><span class=\"line\">vim .tmux.conf.local <span class=\"comment\">#编辑配置文件</span></span><br><span class=\"line\"><span class=\"comment\"># 去掉status left/right sections separators后面几行的注释（终端字体需要支持Powerline）</span></span><br><span class=\"line\"><span class=\"comment\"># 启用 force vi mode</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"shortcuts\"><a href=\"#shortcuts\" class=\"headerlink\" title=\"shortcuts\"></a>shortcuts</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Session</span></span><br><span class=\"line\">:new[-s name]  <span class=\"comment\"># new session</span></span><br><span class=\"line\">:<span class=\"built_in\">kill</span>-session[-t name] <span class=\"comment\"># kill session</span></span><br><span class=\"line\">:ls <span class=\"comment\"># list sessions</span></span><br><span class=\"line\">C-c <span class=\"comment\"># new session</span></span><br><span class=\"line\">s  <span class=\"comment\"># list and select sessions</span></span><br><span class=\"line\">$  <span class=\"comment\"># name session</span></span><br><span class=\"line\"></span><br><span class=\"line\">==============================================</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Window</span></span><br><span class=\"line\">c  <span class=\"comment\"># create window</span></span><br><span class=\"line\">w  <span class=\"comment\"># list windows</span></span><br><span class=\"line\">n  <span class=\"comment\"># next window</span></span><br><span class=\"line\">p  <span class=\"comment\"># previous window</span></span><br><span class=\"line\">f  <span class=\"comment\"># find window</span></span><br><span class=\"line\">,  <span class=\"comment\"># name window</span></span><br><span class=\"line\">&amp;  <span class=\"comment\"># kill window</span></span><br><span class=\"line\"></span><br><span class=\"line\">===============================================</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Panes</span></span><br><span class=\"line\">%  <span class=\"comment\">#vertical split</span></span><br><span class=\"line\"><span class=\"string\">\"  # horizontal split</span></span><br><span class=\"line\"><span class=\"string\">o  # swap panes</span></span><br><span class=\"line\"><span class=\"string\">q  # show pane numbers</span></span><br><span class=\"line\"><span class=\"string\">x  # kill pane</span></span><br><span class=\"line\"><span class=\"string\">+  # 最大化pane，再按一次还原</span></span><br><span class=\"line\"><span class=\"string\">-  # restore pane from window</span></span><br><span class=\"line\"><span class=\"string\">⍽  # space - toggle between layouts</span></span><br><span class=\"line\"><span class=\"string\">q  # (Show pane numbers, when the numbers show up type the key to goto that pane)</span></span><br><span class=\"line\"><span class=\"string\">&#123;  # (Move the current pane left)</span></span><br><span class=\"line\"><span class=\"string\">&#125;  # (Move the current pane right)</span></span><br><span class=\"line\"><span class=\"string\">z  # toggle pane zoom</span></span><br><span class=\"line\"><span class=\"string\">方向键 # select the sibling pane</span></span><br><span class=\"line\"><span class=\"string\">C-方向键 # resize current pane</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">================================================</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># Misc</span></span><br><span class=\"line\"><span class=\"string\">d  # detach</span></span><br><span class=\"line\"><span class=\"string\">t  # big clock</span></span><br><span class=\"line\"><span class=\"string\">?  # list shortcuts</span></span><br><span class=\"line\"><span class=\"string\">:  # prompt</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Tmux-Plugin-Manager-amp-amp-tmux-yank\"><a href=\"#Tmux-Plugin-Manager-amp-amp-tmux-yank\" class=\"headerlink\" title=\"Tmux Plugin Manager &amp;&amp; tmux-yank\"></a>Tmux Plugin Manager &amp;&amp; tmux-yank</h3><p>tmux-yank可以将tmux的paste-buffer中的文字拷贝到系统剪贴板</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yumi xclip <span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm </span><br><span class=\"line\">vim .tmux.conf <span class=\"comment\"># 在最后添加下面几行，注意不是 .tmux.conf.local!!!</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># List of plugins</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -g @plugin <span class=\"string\">'tmux-plugins/tpm'</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -g @plugin <span class=\"string\">'tmux-plugins/tmux-yank'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)</span></span><br><span class=\"line\">run <span class=\"string\">'~/.tmux/plugins/tpm/tpm'</span></span><br></pre></td></tr></table></figure>\n<p>然后，重新加载tmux，按<prefix> + I 安装<code>tmux-yank</code>插件</prefix></p>\n<p>然后，并不能奏效，因为xclip需要有X服务。然而ssh客户端Centos只是纯命令行。需要开启<code>X11Forwarding</code></p>\n<h2 id=\"X11Forwarding\"><a href=\"#X11Forwarding\" class=\"headerlink\" title=\"X11Forwarding\"></a>X11Forwarding</h2><ol>\n<li><p>在远程Centos中的<code>/etc/ssh/ssh_config</code>文件中，添加<code>X11Forwarding yes</code></p>\n</li>\n<li><p>在远程Centos中安装认证软件：<code>yumi xorg-x11-xauth</code></p>\n</li>\n<li><p>在本地ssh连接命令添加<code>-Y</code>参数</p>\n<p>启用x11转发之后就可以在Centos中启动x11程序了，可以安装轻量级的xfce4-terminal方便操作。</p>\n</li>\n</ol>\n<h2 id=\"Prezto\"><a href=\"#Prezto\" class=\"headerlink\" title=\"Prezto\"></a>Prezto</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  git <span class=\"built_in\">clone</span> --recursive https://github.com/sorin-ionescu/prezto.git <span class=\"string\">\"<span class=\"variable\">$&#123;ZDOTDIR:-$HOME&#125;</span>/.zprezto\"</span></span><br><span class=\"line\">rm -rf .zshrc .zpreztorc .zlogin .zlogout .zprofile .zshenv .zhistory .zcompdump</span><br><span class=\"line\"><span class=\"built_in\">setopt</span> EXTENDED_GLOB</span><br><span class=\"line\"><span class=\"keyword\">for</span> rcfile <span class=\"keyword\">in</span> <span class=\"string\">\"<span class=\"variable\">$&#123;ZDOTDIR:-$HOME&#125;</span>\"</span>/.zprezto/runcoms/^README.md(.N); <span class=\"keyword\">do</span></span><br><span class=\"line\">  ln -s <span class=\"string\">\"<span class=\"variable\">$rcfile</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;ZDOTDIR:-$HOME&#125;</span>/.<span class=\"variable\">$&#123;rcfile:t&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 主题列表</span></span><br><span class=\"line\">prompt -l</span><br><span class=\"line\"><span class=\"comment\"># 预览主题</span></span><br><span class=\"line\">prompt -p NAME</span><br><span class=\"line\"><span class=\"comment\"># 做个备份</span></span><br><span class=\"line\">mv .zpreztorc .zpreztorc.tmp</span><br><span class=\"line\"><span class=\"comment\"># 添加常用插件(不要第二次运行，而是手动修改.zpreztorc文件)</span></span><br><span class=\"line\">awk -v s=<span class=\"string\">\"syntax-highlighting git command-not-found yum history-substring-search autosuggestions\"</span> \\</span><br><span class=\"line\"><span class=\"string\">'BEGIN&#123;n=split(s,m)&#125;/'</span>\\<span class=\"string\">''</span>utility<span class=\"string\">'\\'</span><span class=\"string\">'\\s+\\\\/&#123;for(i=1;i&lt;=n;i++)printf(\"  '</span>\\<span class=\"string\">''</span>%s<span class=\"string\">'\\'</span><span class=\"string\">' \\\\\\n\",m[i])&#125;&#123;print&#125;'</span> .zpreztorc.tmp &gt; .zpreztorc</span><br><span class=\"line\"><span class=\"comment\"># 修改默认主题（推荐 skwp）</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s/\\(zstyle.*theme\\s\\).*/\\1'skwp'/\"</span> .zpreztorc</span><br></pre></td></tr></table></figure>\n<h2 id=\"Yum-Aliases\"><a href=\"#Yum-Aliases\" class=\"headerlink\" title=\"Yum Aliases\"></a>Yum Aliases</h2><ul>\n<li><code>yumc</code> removes package(s) and leaves.</li>\n<li><code>yumi</code> installs package(s).</li>\n<li><code>yumh</code> displays history.</li>\n<li><code>yuml</code> lists packages.</li>\n<li><code>yumL</code> lists installed packages.</li>\n<li><code>yumq</code> displays package information.</li>\n<li><code>yumr</code> removes package(s).</li>\n<li><code>yums</code> searches for a package.</li>\n<li><code>yumu</code> updates packages.</li>\n<li><code>yumU</code> upgrades packages.</li>\n</ul>\n<h2 id=\"spf13-Vim\"><a href=\"#spf13-Vim\" class=\"headerlink\" title=\"spf13 Vim\"></a>spf13 Vim</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://j.mp/spf13-vim3 -L &gt; spf13-vim.sh &amp;&amp; sh spf13-vim.sh</span><br></pre></td></tr></table></figure>"},{"title":"Centos初始化","date":"2017-01-03T08:21:43.000Z","_content":"\n\n\n## 换源\n\n### 备份\n\n```bash\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\n```\n\n### 写入国内源(centos 7)\n\nustc： https://lug.ustc.edu.cn/wiki/mirrors/help/centos\n\n<!-- more -->\n\n163：\n\n``` \n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n[base]\nname=CentOS-$releasever - Base - 163.com\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os\nbaseurl=http://mirrors.163.com/centos/$releasever/os/$basearch/\ngpgcheck=1\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n\n#released updates\n[updates]\nname=CentOS-$releasever - Updates - 163.com\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates\nbaseurl=http://mirrors.163.com/centos/$releasever/updates/$basearch/\ngpgcheck=1\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras - 163.com\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras\nbaseurl=http://mirrors.163.com/centos/$releasever/extras/$basearch/\ngpgcheck=1\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus - 163.com\nbaseurl=http://mirrors.163.com/centos/$releasever/centosplus/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n```\n\n\n\n### 更新\n\n```bash\nyum clean all\nyum makecache\n```\n\n\n\n## 设置代理\n\n```bash\n#! /bin/bash\n# Author: Kevin Tan\n# Update-Date: 2017-1-14\nURL=$1\nACTION=('\\nSet' '\\nDel')\nmode=1\nif [ -z $URL ]; then\n    echo '[Warning]: URL parameter is empty, default action change to remove'\n    mode=2\nfi\nset_proxy(){\n  file=$1;prefix=$2;value=\"$2=$3\";\n  echo \"Set \\\"$value\\\" to \\\"$file\\\"\"\n  if [ -e \"$file\" ]; then\n    if grep -q \"^\\s*$prefix\" \"$file\"; then\n        sed -i \"s#^\\s*$prefix=.*#$value#g\" $file\n    else\n        echo $value >> $file\n    fi\n  fi\n}\n\ndel_proxy(){\n    file=$1;prefix=$2\n    echo \"Del \\\"$prefix\\\" from \\\"$file\\\"\"\n    if [ -e \"$file\" ]; then\n        sed -i \"/^\\s*$prefix=.*/d\" $file\n    fi\n    eval $prefix=\"\"\n}\n\nSHELL_NAME=`ps -p $$ | awk 'NR==2 {print $4}'`\necho 'Current shell is '$SHELL_NAME\nsource_file(){\n    ## bash\n    if [ \"$SHELL_NAME\" = \"bash\" ]; then\n        source $HOME'/.bashrc'\n    fi\n    ## zsh\n    if [ \"$SHELL_NAME\" = \"zsh\" ]; then\n        source $HOME'/.zshrc'\n    fi\n}\n\n# yum\necho -n ${ACTION[$mode]}' the yum? (y/n/r) ';read F\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    set_proxy '/etc/yum.conf' 'proxy' $URL\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    del_proxy '/etc/yum.conf' 'proxy'\nfi\n\n# environment\necho -n ${ACTION[$mode]}' the environment var?(y/n/r) ';read F\nshell_names=(zsh bash)\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    for name in ${shell_names[@]}; do\n        set_proxy \"$HOME/.${name}rc\" \"export http_proxy\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export https_proxy\" $URL\n    done\n    source_file\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    for name in ${shell_names[@]}; do\n        del_proxy \"$HOME/.${name}rc\" \"export http_proxy\"\n        del_proxy \"$HOME/.${name}rc\" \"export https_proxy\"\n    done\nfi\n\n#curl\necho -n ${ACTION[$mode]}' the curl proxy alias?(y/n/r) ';read F\nshell_names=(zsh bash)\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    for name in ${shell_names[@]}; do\n    \tset_proxy \"$HOME/.${name}rc\" \"alias curl\" \"\\\"curl -x $URL\\\"\"   \n    done\n    source_file\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    for name in ${shell_names[@]}; do\n        del_proxy \"$HOME/.${name}rc\" \"alias curl\"\n        unalias curl\n    done\nfi\n\n# kubernetes\necho -n ${ACTION[$mode]}' kube environment var?(y/n/r) ';read F\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    for name in ${shell_names[@]}; do\n        set_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTP_PROXY\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTPS_PROXY\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTPS_PROXY\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTP_PROXY\" $URL\n    done\n    source_file\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    for name in ${shell_names[@]}; do\n        del_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTP_PROXY\"\n        del_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTPS_PROXY\"\n        del_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTPS_PROXY\"\n        del_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTP_PROXY\"\n    done\nfi\n\n# docker\necho -n ${ACTION[$mode]}' the docker?(y/n/r) ';read F\nif type \"docker\" &>/dev/null && ([ $F = 'y' ] || [ $F = 'r' ]); then\n        DOCKER_CONF_DIR='/etc/systemd/system/docker.service.d'\n        DOCKER_CONF=$DOCKER_CONF_DIR'/http-proxy.conf'\n        REGISTRY=\"87129800.m.daodocker.io\"\n        sudo mkdir -p \"$DOCKER_CONF_DIR\"\n        sudo rm -rf $DOCKER_CONF\n        if [ $F = 'y' ] && [ $mode -eq 1 ]; then\n            printf \"[Service]\\nEnvironment=\" | sudo tee $DOCKER_CONF > /dev/null\n            printf \"\\\"HTTP_PROXY=%s\\\" \" $URL | sudo tee -a $DOCKER_CONF > /dev/null\n            printf \"\\\"HTTPS_PROXY=%s\\\" \" $URL | sudo tee -a $DOCKER_CONF > /dev/null\n            printf \"\\\"NO_PROXY=localhost,%s\\\"\" $REGISTRY | sudo tee -a $DOCKER_CONF > /dev/null\n        fi\n        sudo systemctl daemon-reload\n        sudo systemctl restart docker\n        echo \"Daemon reloaded\"\n        systemctl show --property=Environment docker \nfi\n```\n\n将上面脚本保持为setproxy，然后执行,注意，如果当前环境下已经有了http_proxy等变量。则需要我们手动reset\n\n```bash\nchmod u+x setproxy\nsource setproxy http://10.100.100.136:4411\n```\n\n\n\n## 基础建设\n\n### git && gcc\n\n```bash\nyum install git gcc\n```\n\n### pip\n\n```bash\ncurl \"https://bootstrap.pypa.io/get-pip.py\" | python\n```\n\nEPEL\n\n```bash\nrpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm \n```\n\n\n\n## ZSH\n\n### 安装 & 激活\n\n```bash\nyum install zsh\nchsh -s /bin/zsh\n```\n\n\n","source":"_posts/CentOS1@1-3.md","raw":"---\ntitle: Centos初始化\ndate: 2017-1-3 16:21:43\ntags: \n  - centos\ncategories:\n  - Linux\n---\n\n\n\n## 换源\n\n### 备份\n\n```bash\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\n```\n\n### 写入国内源(centos 7)\n\nustc： https://lug.ustc.edu.cn/wiki/mirrors/help/centos\n\n<!-- more -->\n\n163：\n\n``` \n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n[base]\nname=CentOS-$releasever - Base - 163.com\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os\nbaseurl=http://mirrors.163.com/centos/$releasever/os/$basearch/\ngpgcheck=1\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n\n#released updates\n[updates]\nname=CentOS-$releasever - Updates - 163.com\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates\nbaseurl=http://mirrors.163.com/centos/$releasever/updates/$basearch/\ngpgcheck=1\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras - 163.com\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras\nbaseurl=http://mirrors.163.com/centos/$releasever/extras/$basearch/\ngpgcheck=1\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus - 163.com\nbaseurl=http://mirrors.163.com/centos/$releasever/centosplus/$basearch/\ngpgcheck=1\nenabled=0\ngpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7\n```\n\n\n\n### 更新\n\n```bash\nyum clean all\nyum makecache\n```\n\n\n\n## 设置代理\n\n```bash\n#! /bin/bash\n# Author: Kevin Tan\n# Update-Date: 2017-1-14\nURL=$1\nACTION=('\\nSet' '\\nDel')\nmode=1\nif [ -z $URL ]; then\n    echo '[Warning]: URL parameter is empty, default action change to remove'\n    mode=2\nfi\nset_proxy(){\n  file=$1;prefix=$2;value=\"$2=$3\";\n  echo \"Set \\\"$value\\\" to \\\"$file\\\"\"\n  if [ -e \"$file\" ]; then\n    if grep -q \"^\\s*$prefix\" \"$file\"; then\n        sed -i \"s#^\\s*$prefix=.*#$value#g\" $file\n    else\n        echo $value >> $file\n    fi\n  fi\n}\n\ndel_proxy(){\n    file=$1;prefix=$2\n    echo \"Del \\\"$prefix\\\" from \\\"$file\\\"\"\n    if [ -e \"$file\" ]; then\n        sed -i \"/^\\s*$prefix=.*/d\" $file\n    fi\n    eval $prefix=\"\"\n}\n\nSHELL_NAME=`ps -p $$ | awk 'NR==2 {print $4}'`\necho 'Current shell is '$SHELL_NAME\nsource_file(){\n    ## bash\n    if [ \"$SHELL_NAME\" = \"bash\" ]; then\n        source $HOME'/.bashrc'\n    fi\n    ## zsh\n    if [ \"$SHELL_NAME\" = \"zsh\" ]; then\n        source $HOME'/.zshrc'\n    fi\n}\n\n# yum\necho -n ${ACTION[$mode]}' the yum? (y/n/r) ';read F\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    set_proxy '/etc/yum.conf' 'proxy' $URL\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    del_proxy '/etc/yum.conf' 'proxy'\nfi\n\n# environment\necho -n ${ACTION[$mode]}' the environment var?(y/n/r) ';read F\nshell_names=(zsh bash)\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    for name in ${shell_names[@]}; do\n        set_proxy \"$HOME/.${name}rc\" \"export http_proxy\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export https_proxy\" $URL\n    done\n    source_file\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    for name in ${shell_names[@]}; do\n        del_proxy \"$HOME/.${name}rc\" \"export http_proxy\"\n        del_proxy \"$HOME/.${name}rc\" \"export https_proxy\"\n    done\nfi\n\n#curl\necho -n ${ACTION[$mode]}' the curl proxy alias?(y/n/r) ';read F\nshell_names=(zsh bash)\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    for name in ${shell_names[@]}; do\n    \tset_proxy \"$HOME/.${name}rc\" \"alias curl\" \"\\\"curl -x $URL\\\"\"   \n    done\n    source_file\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    for name in ${shell_names[@]}; do\n        del_proxy \"$HOME/.${name}rc\" \"alias curl\"\n        unalias curl\n    done\nfi\n\n# kubernetes\necho -n ${ACTION[$mode]}' kube environment var?(y/n/r) ';read F\nif [ $F = 'y' ] && [ $mode -eq 1 ]; then\n    for name in ${shell_names[@]}; do\n        set_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTP_PROXY\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTPS_PROXY\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTPS_PROXY\" $URL\n        set_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTP_PROXY\" $URL\n    done\n    source_file\nelif [ $F = 'r' ] || ([ $F = 'y' ] && [ $mode -eq 2 ]); then\n    for name in ${shell_names[@]}; do\n        del_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTP_PROXY\"\n        del_proxy \"$HOME/.${name}rc\" \"export KUBERNETES_HTTPS_PROXY\"\n        del_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTPS_PROXY\"\n        del_proxy \"$HOME/.${name}rc\" \"export KUBE_BUILD_HTTP_PROXY\"\n    done\nfi\n\n# docker\necho -n ${ACTION[$mode]}' the docker?(y/n/r) ';read F\nif type \"docker\" &>/dev/null && ([ $F = 'y' ] || [ $F = 'r' ]); then\n        DOCKER_CONF_DIR='/etc/systemd/system/docker.service.d'\n        DOCKER_CONF=$DOCKER_CONF_DIR'/http-proxy.conf'\n        REGISTRY=\"87129800.m.daodocker.io\"\n        sudo mkdir -p \"$DOCKER_CONF_DIR\"\n        sudo rm -rf $DOCKER_CONF\n        if [ $F = 'y' ] && [ $mode -eq 1 ]; then\n            printf \"[Service]\\nEnvironment=\" | sudo tee $DOCKER_CONF > /dev/null\n            printf \"\\\"HTTP_PROXY=%s\\\" \" $URL | sudo tee -a $DOCKER_CONF > /dev/null\n            printf \"\\\"HTTPS_PROXY=%s\\\" \" $URL | sudo tee -a $DOCKER_CONF > /dev/null\n            printf \"\\\"NO_PROXY=localhost,%s\\\"\" $REGISTRY | sudo tee -a $DOCKER_CONF > /dev/null\n        fi\n        sudo systemctl daemon-reload\n        sudo systemctl restart docker\n        echo \"Daemon reloaded\"\n        systemctl show --property=Environment docker \nfi\n```\n\n将上面脚本保持为setproxy，然后执行,注意，如果当前环境下已经有了http_proxy等变量。则需要我们手动reset\n\n```bash\nchmod u+x setproxy\nsource setproxy http://10.100.100.136:4411\n```\n\n\n\n## 基础建设\n\n### git && gcc\n\n```bash\nyum install git gcc\n```\n\n### pip\n\n```bash\ncurl \"https://bootstrap.pypa.io/get-pip.py\" | python\n```\n\nEPEL\n\n```bash\nrpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm \n```\n\n\n\n## ZSH\n\n### 安装 & 激活\n\n```bash\nyum install zsh\nchsh -s /bin/zsh\n```\n\n\n","slug":"CentOS1@1-3","published":1,"updated":"2019-10-11T05:50:15.631Z","_id":"ciz5e9kzt00075rgx4dode31m","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"换源\"><a href=\"#换源\" class=\"headerlink\" title=\"换源\"></a>换源</h2><h3 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>\n<h3 id=\"写入国内源-centos-7\"><a href=\"#写入国内源-centos-7\" class=\"headerlink\" title=\"写入国内源(centos 7)\"></a>写入国内源(centos 7)</h3><p>ustc： <a href=\"https://lug.ustc.edu.cn/wiki/mirrors/help/centos\" target=\"_blank\" rel=\"noopener\">https://lug.ustc.edu.cn/wiki/mirrors/help/centos</a></p>\n<a id=\"more\"></a>\n<p>163：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CentOS-Base.repo</span><br><span class=\"line\">#</span><br><span class=\"line\"># The mirror system uses the connecting IP address of the client and the</span><br><span class=\"line\"># update status of each mirror to pick mirrors that are updated to and</span><br><span class=\"line\"># geographically close to the client.  You should use this for CentOS updates</span><br><span class=\"line\"># unless you are manually picking other mirrors.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class=\"line\"># remarked out baseurl= line instead.</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">[base]</span><br><span class=\"line\">name=CentOS-$releasever - Base - 163.com</span><br><span class=\"line\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/os/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\">#released updates</span><br><span class=\"line\">[updates]</span><br><span class=\"line\">name=CentOS-$releasever - Updates - 163.com</span><br><span class=\"line\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/updates/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\">#additional packages that may be useful</span><br><span class=\"line\">[extras]</span><br><span class=\"line\">name=CentOS-$releasever - Extras - 163.com</span><br><span class=\"line\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/extras/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\">#additional packages that extend functionality of existing packages</span><br><span class=\"line\">[centosplus]</span><br><span class=\"line\">name=CentOS-$releasever - Plus - 163.com</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/centosplus/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>\n<h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置代理\"><a href=\"#设置代理\" class=\"headerlink\" title=\"设置代理\"></a>设置代理</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># Author: Kevin Tan</span></span><br><span class=\"line\"><span class=\"comment\"># Update-Date: 2017-1-14</span></span><br><span class=\"line\">URL=<span class=\"variable\">$1</span></span><br><span class=\"line\">ACTION=(<span class=\"string\">'\\nSet'</span> <span class=\"string\">'\\nDel'</span>)</span><br><span class=\"line\">mode=1</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"variable\">$URL</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">'[Warning]: URL parameter is empty, default action change to remove'</span></span><br><span class=\"line\">    mode=2</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">set_proxy</span></span>()&#123;</span><br><span class=\"line\">  file=<span class=\"variable\">$1</span>;prefix=<span class=\"variable\">$2</span>;value=<span class=\"string\">\"<span class=\"variable\">$2</span>=<span class=\"variable\">$3</span>\"</span>;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Set \\\"<span class=\"variable\">$value</span>\\\" to \\\"<span class=\"variable\">$file</span>\\\"\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -e <span class=\"string\">\"<span class=\"variable\">$file</span>\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> grep -q <span class=\"string\">\"^\\s*<span class=\"variable\">$prefix</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$file</span>\"</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">        sed -i <span class=\"string\">\"s#^\\s*<span class=\"variable\">$prefix</span>=.*#<span class=\"variable\">$value</span>#g\"</span> <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"variable\">$value</span> &gt;&gt; <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">del_proxy</span></span>()&#123;</span><br><span class=\"line\">    file=<span class=\"variable\">$1</span>;prefix=<span class=\"variable\">$2</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Del \\\"<span class=\"variable\">$prefix</span>\\\" from \\\"<span class=\"variable\">$file</span>\\\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -e <span class=\"string\">\"<span class=\"variable\">$file</span>\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        sed -i <span class=\"string\">\"/^\\s*<span class=\"variable\">$prefix</span>=.*/d\"</span> <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"built_in\">eval</span> <span class=\"variable\">$prefix</span>=<span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SHELL_NAME=`ps -p $$ | awk <span class=\"string\">'NR==2 &#123;print $4&#125;'</span>`</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'Current shell is '</span><span class=\"variable\">$SHELL_NAME</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">source_file</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"comment\">## bash</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$SHELL_NAME</span>\"</span> = <span class=\"string\">\"bash\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">source</span> <span class=\"variable\">$HOME</span><span class=\"string\">'/.bashrc'</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"comment\">## zsh</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$SHELL_NAME</span>\"</span> = <span class=\"string\">\"zsh\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">source</span> <span class=\"variable\">$HOME</span><span class=\"string\">'/.zshrc'</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># yum</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the yum? (y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    set_proxy <span class=\"string\">'/etc/yum.conf'</span> <span class=\"string\">'proxy'</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    del_proxy <span class=\"string\">'/etc/yum.conf'</span> <span class=\"string\">'proxy'</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># environment</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the environment var?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\">shell_names=(zsh bash)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export http_proxy\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export https_proxy\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">    source_file</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export http_proxy\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export https_proxy\"</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#curl</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the curl proxy alias?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\">shell_names=(zsh bash)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">    \tset_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"alias curl\"</span> <span class=\"string\">\"\\\"curl -x <span class=\"variable\">$URL</span>\\\"\"</span>   </span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">    source_file</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"alias curl\"</span></span><br><span class=\"line\">        <span class=\"built_in\">unalias</span> curl</span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kubernetes</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' kube environment var?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTP_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTPS_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTPS_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTP_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">    source_file</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTP_PROXY\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTPS_PROXY\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTPS_PROXY\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTP_PROXY\"</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the docker?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">type</span> <span class=\"string\">\"docker\"</span> &amp;&gt;/dev/null &amp;&amp; ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] || [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">        DOCKER_CONF_DIR=<span class=\"string\">'/etc/systemd/system/docker.service.d'</span></span><br><span class=\"line\">        DOCKER_CONF=<span class=\"variable\">$DOCKER_CONF_DIR</span><span class=\"string\">'/http-proxy.conf'</span></span><br><span class=\"line\">        REGISTRY=<span class=\"string\">\"87129800.m.daodocker.io\"</span></span><br><span class=\"line\">        sudo mkdir -p <span class=\"string\">\"<span class=\"variable\">$DOCKER_CONF_DIR</span>\"</span></span><br><span class=\"line\">        sudo rm -rf <span class=\"variable\">$DOCKER_CONF</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"[Service]\\nEnvironment=\"</span> | sudo tee <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"\\\"HTTP_PROXY=%s\\\" \"</span> <span class=\"variable\">$URL</span> | sudo tee -a <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"\\\"HTTPS_PROXY=%s\\\" \"</span> <span class=\"variable\">$URL</span> | sudo tee -a <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"\\\"NO_PROXY=localhost,%s\\\"\"</span> <span class=\"variable\">$REGISTRY</span> | sudo tee -a <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">        <span class=\"keyword\">fi</span></span><br><span class=\"line\">        sudo systemctl daemon-reload</span><br><span class=\"line\">        sudo systemctl restart docker</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">\"Daemon reloaded\"</span></span><br><span class=\"line\">        systemctl show --property=Environment docker </span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<p>将上面脚本保持为setproxy，然后执行,注意，如果当前环境下已经有了http_proxy等变量。则需要我们手动reset</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod u+x setproxy</span><br><span class=\"line\"><span class=\"built_in\">source</span> setproxy http://10.100.100.136:4411</span><br></pre></td></tr></table></figure>\n<h2 id=\"基础建设\"><a href=\"#基础建设\" class=\"headerlink\" title=\"基础建设\"></a>基础建设</h2><h3 id=\"git-amp-amp-gcc\"><a href=\"#git-amp-amp-gcc\" class=\"headerlink\" title=\"git &amp;&amp; gcc\"></a>git &amp;&amp; gcc</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git gcc</span><br></pre></td></tr></table></figure>\n<h3 id=\"pip\"><a href=\"#pip\" class=\"headerlink\" title=\"pip\"></a>pip</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl <span class=\"string\">\"https://bootstrap.pypa.io/get-pip.py\"</span> | python</span><br></pre></td></tr></table></figure>\n<p>EPEL</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br></pre></td></tr></table></figure>\n<h2 id=\"ZSH\"><a href=\"#ZSH\" class=\"headerlink\" title=\"ZSH\"></a>ZSH</h2><h3 id=\"安装-amp-激活\"><a href=\"#安装-amp-激活\" class=\"headerlink\" title=\"安装 &amp; 激活\"></a>安装 &amp; 激活</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install zsh</span><br><span class=\"line\">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"换源\"><a href=\"#换源\" class=\"headerlink\" title=\"换源\"></a>换源</h2><h3 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>\n<h3 id=\"写入国内源-centos-7\"><a href=\"#写入国内源-centos-7\" class=\"headerlink\" title=\"写入国内源(centos 7)\"></a>写入国内源(centos 7)</h3><p>ustc： <a href=\"https://lug.ustc.edu.cn/wiki/mirrors/help/centos\" target=\"_blank\" rel=\"noopener\">https://lug.ustc.edu.cn/wiki/mirrors/help/centos</a></p>","more":"<p>163：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CentOS-Base.repo</span><br><span class=\"line\">#</span><br><span class=\"line\"># The mirror system uses the connecting IP address of the client and the</span><br><span class=\"line\"># update status of each mirror to pick mirrors that are updated to and</span><br><span class=\"line\"># geographically close to the client.  You should use this for CentOS updates</span><br><span class=\"line\"># unless you are manually picking other mirrors.</span><br><span class=\"line\">#</span><br><span class=\"line\"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class=\"line\"># remarked out baseurl= line instead.</span><br><span class=\"line\">#</span><br><span class=\"line\">#</span><br><span class=\"line\">[base]</span><br><span class=\"line\">name=CentOS-$releasever - Base - 163.com</span><br><span class=\"line\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/os/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\">#released updates</span><br><span class=\"line\">[updates]</span><br><span class=\"line\">name=CentOS-$releasever - Updates - 163.com</span><br><span class=\"line\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/updates/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\">#additional packages that may be useful</span><br><span class=\"line\">[extras]</span><br><span class=\"line\">name=CentOS-$releasever - Extras - 163.com</span><br><span class=\"line\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/extras/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\"></span><br><span class=\"line\">#additional packages that extend functionality of existing packages</span><br><span class=\"line\">[centosplus]</span><br><span class=\"line\">name=CentOS-$releasever - Plus - 163.com</span><br><span class=\"line\">baseurl=http://mirrors.163.com/centos/$releasever/centosplus/$basearch/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\">gpgkey=http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>\n<h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置代理\"><a href=\"#设置代理\" class=\"headerlink\" title=\"设置代理\"></a>设置代理</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># Author: Kevin Tan</span></span><br><span class=\"line\"><span class=\"comment\"># Update-Date: 2017-1-14</span></span><br><span class=\"line\">URL=<span class=\"variable\">$1</span></span><br><span class=\"line\">ACTION=(<span class=\"string\">'\\nSet'</span> <span class=\"string\">'\\nDel'</span>)</span><br><span class=\"line\">mode=1</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"variable\">$URL</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">'[Warning]: URL parameter is empty, default action change to remove'</span></span><br><span class=\"line\">    mode=2</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">set_proxy</span></span>()&#123;</span><br><span class=\"line\">  file=<span class=\"variable\">$1</span>;prefix=<span class=\"variable\">$2</span>;value=<span class=\"string\">\"<span class=\"variable\">$2</span>=<span class=\"variable\">$3</span>\"</span>;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Set \\\"<span class=\"variable\">$value</span>\\\" to \\\"<span class=\"variable\">$file</span>\\\"\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -e <span class=\"string\">\"<span class=\"variable\">$file</span>\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> grep -q <span class=\"string\">\"^\\s*<span class=\"variable\">$prefix</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$file</span>\"</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">        sed -i <span class=\"string\">\"s#^\\s*<span class=\"variable\">$prefix</span>=.*#<span class=\"variable\">$value</span>#g\"</span> <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"variable\">$value</span> &gt;&gt; <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">del_proxy</span></span>()&#123;</span><br><span class=\"line\">    file=<span class=\"variable\">$1</span>;prefix=<span class=\"variable\">$2</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Del \\\"<span class=\"variable\">$prefix</span>\\\" from \\\"<span class=\"variable\">$file</span>\\\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -e <span class=\"string\">\"<span class=\"variable\">$file</span>\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        sed -i <span class=\"string\">\"/^\\s*<span class=\"variable\">$prefix</span>=.*/d\"</span> <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"built_in\">eval</span> <span class=\"variable\">$prefix</span>=<span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SHELL_NAME=`ps -p $$ | awk <span class=\"string\">'NR==2 &#123;print $4&#125;'</span>`</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'Current shell is '</span><span class=\"variable\">$SHELL_NAME</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">source_file</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"comment\">## bash</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$SHELL_NAME</span>\"</span> = <span class=\"string\">\"bash\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">source</span> <span class=\"variable\">$HOME</span><span class=\"string\">'/.bashrc'</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"comment\">## zsh</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$SHELL_NAME</span>\"</span> = <span class=\"string\">\"zsh\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">source</span> <span class=\"variable\">$HOME</span><span class=\"string\">'/.zshrc'</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># yum</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the yum? (y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    set_proxy <span class=\"string\">'/etc/yum.conf'</span> <span class=\"string\">'proxy'</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    del_proxy <span class=\"string\">'/etc/yum.conf'</span> <span class=\"string\">'proxy'</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># environment</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the environment var?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\">shell_names=(zsh bash)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export http_proxy\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export https_proxy\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">    source_file</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export http_proxy\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export https_proxy\"</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#curl</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the curl proxy alias?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\">shell_names=(zsh bash)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">    \tset_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"alias curl\"</span> <span class=\"string\">\"\\\"curl -x <span class=\"variable\">$URL</span>\\\"\"</span>   </span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">    source_file</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"alias curl\"</span></span><br><span class=\"line\">        <span class=\"built_in\">unalias</span> curl</span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kubernetes</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' kube environment var?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTP_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTPS_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTPS_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">        set_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTP_PROXY\"</span> <span class=\"variable\">$URL</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">    source_file</span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ] || ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 2 ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;shell_names[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTP_PROXY\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBERNETES_HTTPS_PROXY\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTPS_PROXY\"</span></span><br><span class=\"line\">        del_proxy <span class=\"string\">\"<span class=\"variable\">$HOME</span>/.<span class=\"variable\">$&#123;name&#125;</span>rc\"</span> <span class=\"string\">\"export KUBE_BUILD_HTTP_PROXY\"</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"variable\">$&#123;ACTION[$mode]&#125;</span><span class=\"string\">' the docker?(y/n/r) '</span>;<span class=\"built_in\">read</span> F</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">type</span> <span class=\"string\">\"docker\"</span> &amp;&gt;/dev/null &amp;&amp; ([ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] || [ <span class=\"variable\">$F</span> = <span class=\"string\">'r'</span> ]); <span class=\"keyword\">then</span></span><br><span class=\"line\">        DOCKER_CONF_DIR=<span class=\"string\">'/etc/systemd/system/docker.service.d'</span></span><br><span class=\"line\">        DOCKER_CONF=<span class=\"variable\">$DOCKER_CONF_DIR</span><span class=\"string\">'/http-proxy.conf'</span></span><br><span class=\"line\">        REGISTRY=<span class=\"string\">\"87129800.m.daodocker.io\"</span></span><br><span class=\"line\">        sudo mkdir -p <span class=\"string\">\"<span class=\"variable\">$DOCKER_CONF_DIR</span>\"</span></span><br><span class=\"line\">        sudo rm -rf <span class=\"variable\">$DOCKER_CONF</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"variable\">$F</span> = <span class=\"string\">'y'</span> ] &amp;&amp; [ <span class=\"variable\">$mode</span> -eq 1 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"[Service]\\nEnvironment=\"</span> | sudo tee <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"\\\"HTTP_PROXY=%s\\\" \"</span> <span class=\"variable\">$URL</span> | sudo tee -a <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"\\\"HTTPS_PROXY=%s\\\" \"</span> <span class=\"variable\">$URL</span> | sudo tee -a <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">            <span class=\"built_in\">printf</span> <span class=\"string\">\"\\\"NO_PROXY=localhost,%s\\\"\"</span> <span class=\"variable\">$REGISTRY</span> | sudo tee -a <span class=\"variable\">$DOCKER_CONF</span> &gt; /dev/null</span><br><span class=\"line\">        <span class=\"keyword\">fi</span></span><br><span class=\"line\">        sudo systemctl daemon-reload</span><br><span class=\"line\">        sudo systemctl restart docker</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">\"Daemon reloaded\"</span></span><br><span class=\"line\">        systemctl show --property=Environment docker </span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<p>将上面脚本保持为setproxy，然后执行,注意，如果当前环境下已经有了http_proxy等变量。则需要我们手动reset</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod u+x setproxy</span><br><span class=\"line\"><span class=\"built_in\">source</span> setproxy http://10.100.100.136:4411</span><br></pre></td></tr></table></figure>\n<h2 id=\"基础建设\"><a href=\"#基础建设\" class=\"headerlink\" title=\"基础建设\"></a>基础建设</h2><h3 id=\"git-amp-amp-gcc\"><a href=\"#git-amp-amp-gcc\" class=\"headerlink\" title=\"git &amp;&amp; gcc\"></a>git &amp;&amp; gcc</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install git gcc</span><br></pre></td></tr></table></figure>\n<h3 id=\"pip\"><a href=\"#pip\" class=\"headerlink\" title=\"pip\"></a>pip</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl <span class=\"string\">\"https://bootstrap.pypa.io/get-pip.py\"</span> | python</span><br></pre></td></tr></table></figure>\n<p>EPEL</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br></pre></td></tr></table></figure>\n<h2 id=\"ZSH\"><a href=\"#ZSH\" class=\"headerlink\" title=\"ZSH\"></a>ZSH</h2><h3 id=\"安装-amp-激活\"><a href=\"#安装-amp-激活\" class=\"headerlink\" title=\"安装 &amp; 激活\"></a>安装 &amp; 激活</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install zsh</span><br><span class=\"line\">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure>"},{"title":"Deepin初始化","date":"2017-01-11T16:00:00.000Z","_content":"\n\n\n## Infinality and Harfbuzz\n\n会发生冲突，这是今天Archlinux无法启动输入法界面的元凶。重新安装freetype2\\fontconfig\\cairo以替换infinality-bundle。\n\n\n\n## 添加PPA出现GPG问题\n\n#### 问题：\n\n```bash\ngpg: keybox '/tmp/tmpyiw6jvck/pubring.gpg' created\ngpg: /tmp/tmpyiw6jvck/trustdb.gpg：建立了信任度数据库\ngpg: 密钥 531EE72F4C9D234C：公钥“Launchpad webupd8”已导入\ngpg: 合计被处理的数量：1\ngpg:           已导入：1\ngpg: 找不到有效的 OpenPGP 数据。\n```\n<!-- more -->\n\n\n#### 可能原因：\n\nkeyserver.ubuntu.com使用非标准的11371端口，而一般公司的防火墙都屏蔽掉了该端口，而允许标准的80端口。\n\n#### 解决方法：\n\n```bash\nsudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 531EE72F4C9D234C\n# 或者\nsudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E985B27B\n```\n\n\n\n## Telnet\n\n需要安装server的\n\n```bash\n# ubuntu\nsudo apt install telnetd\nsudo systemctl start inetd\nsudo systemctl enable inetd\n# arch\nsudo systemctl start telnet.socket\nsudo systemctl enable telnet.socket\n```\n\n使用telnet测试端口是否打开：\n\n```bash\ntelnet localhost 33171\n```\n\n\n\n## Github Online File Tree View Plugin\n\n[Octotree](https://github.com/buunguyen/octotree)\n\n\n\n","source":"_posts/Kubernetes-&-Deepin-Settings@1-12.md","raw":"---\ntitle: Deepin初始化\ndate: 2017-1-12\ntags:\n  - deepin\n  - ppa\n  - octotree\n  - infinality fonts\ncategories:\n  - Linux\n---\n\n\n\n## Infinality and Harfbuzz\n\n会发生冲突，这是今天Archlinux无法启动输入法界面的元凶。重新安装freetype2\\fontconfig\\cairo以替换infinality-bundle。\n\n\n\n## 添加PPA出现GPG问题\n\n#### 问题：\n\n```bash\ngpg: keybox '/tmp/tmpyiw6jvck/pubring.gpg' created\ngpg: /tmp/tmpyiw6jvck/trustdb.gpg：建立了信任度数据库\ngpg: 密钥 531EE72F4C9D234C：公钥“Launchpad webupd8”已导入\ngpg: 合计被处理的数量：1\ngpg:           已导入：1\ngpg: 找不到有效的 OpenPGP 数据。\n```\n<!-- more -->\n\n\n#### 可能原因：\n\nkeyserver.ubuntu.com使用非标准的11371端口，而一般公司的防火墙都屏蔽掉了该端口，而允许标准的80端口。\n\n#### 解决方法：\n\n```bash\nsudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 531EE72F4C9D234C\n# 或者\nsudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E985B27B\n```\n\n\n\n## Telnet\n\n需要安装server的\n\n```bash\n# ubuntu\nsudo apt install telnetd\nsudo systemctl start inetd\nsudo systemctl enable inetd\n# arch\nsudo systemctl start telnet.socket\nsudo systemctl enable telnet.socket\n```\n\n使用telnet测试端口是否打开：\n\n```bash\ntelnet localhost 33171\n```\n\n\n\n## Github Online File Tree View Plugin\n\n[Octotree](https://github.com/buunguyen/octotree)\n\n\n\n","slug":"Kubernetes-&-Deepin-Settings@1-12","published":1,"updated":"2019-10-11T05:50:15.641Z","_id":"ciz5e9kzx000b5rgxrqv52hhc","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Infinality-and-Harfbuzz\"><a href=\"#Infinality-and-Harfbuzz\" class=\"headerlink\" title=\"Infinality and Harfbuzz\"></a>Infinality and Harfbuzz</h2><p>会发生冲突，这是今天Archlinux无法启动输入法界面的元凶。重新安装freetype2\\fontconfig\\cairo以替换infinality-bundle。</p>\n<h2 id=\"添加PPA出现GPG问题\"><a href=\"#添加PPA出现GPG问题\" class=\"headerlink\" title=\"添加PPA出现GPG问题\"></a>添加PPA出现GPG问题</h2><h4 id=\"问题：\"><a href=\"#问题：\" class=\"headerlink\" title=\"问题：\"></a>问题：</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gpg: keybox <span class=\"string\">'/tmp/tmpyiw6jvck/pubring.gpg'</span> created</span><br><span class=\"line\">gpg: /tmp/tmpyiw6jvck/trustdb.gpg：建立了信任度数据库</span><br><span class=\"line\">gpg: 密钥 531EE72F4C9D234C：公钥“Launchpad webupd8”已导入</span><br><span class=\"line\">gpg: 合计被处理的数量：1</span><br><span class=\"line\">gpg:           已导入：1</span><br><span class=\"line\">gpg: 找不到有效的 OpenPGP 数据。</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h4 id=\"可能原因：\"><a href=\"#可能原因：\" class=\"headerlink\" title=\"可能原因：\"></a>可能原因：</h4><p>keyserver.ubuntu.com使用非标准的11371端口，而一般公司的防火墙都屏蔽掉了该端口，而允许标准的80端口。</p>\n<h4 id=\"解决方法：\"><a href=\"#解决方法：\" class=\"headerlink\" title=\"解决方法：\"></a>解决方法：</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 531EE72F4C9D234C</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E985B27B</span><br></pre></td></tr></table></figure>\n<h2 id=\"Telnet\"><a href=\"#Telnet\" class=\"headerlink\" title=\"Telnet\"></a>Telnet</h2><p>需要安装server的</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ubuntu</span></span><br><span class=\"line\">sudo apt install telnetd</span><br><span class=\"line\">sudo systemctl start inetd</span><br><span class=\"line\">sudo systemctl <span class=\"built_in\">enable</span> inetd</span><br><span class=\"line\"><span class=\"comment\"># arch</span></span><br><span class=\"line\">sudo systemctl start telnet.socket</span><br><span class=\"line\">sudo systemctl <span class=\"built_in\">enable</span> telnet.socket</span><br></pre></td></tr></table></figure>\n<p>使用telnet测试端口是否打开：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">telnet localhost 33171</span><br></pre></td></tr></table></figure>\n<h2 id=\"Github-Online-File-Tree-View-Plugin\"><a href=\"#Github-Online-File-Tree-View-Plugin\" class=\"headerlink\" title=\"Github Online File Tree View Plugin\"></a>Github Online File Tree View Plugin</h2><p><a href=\"https://github.com/buunguyen/octotree\" target=\"_blank\" rel=\"noopener\">Octotree</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Infinality-and-Harfbuzz\"><a href=\"#Infinality-and-Harfbuzz\" class=\"headerlink\" title=\"Infinality and Harfbuzz\"></a>Infinality and Harfbuzz</h2><p>会发生冲突，这是今天Archlinux无法启动输入法界面的元凶。重新安装freetype2\\fontconfig\\cairo以替换infinality-bundle。</p>\n<h2 id=\"添加PPA出现GPG问题\"><a href=\"#添加PPA出现GPG问题\" class=\"headerlink\" title=\"添加PPA出现GPG问题\"></a>添加PPA出现GPG问题</h2><h4 id=\"问题：\"><a href=\"#问题：\" class=\"headerlink\" title=\"问题：\"></a>问题：</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gpg: keybox <span class=\"string\">'/tmp/tmpyiw6jvck/pubring.gpg'</span> created</span><br><span class=\"line\">gpg: /tmp/tmpyiw6jvck/trustdb.gpg：建立了信任度数据库</span><br><span class=\"line\">gpg: 密钥 531EE72F4C9D234C：公钥“Launchpad webupd8”已导入</span><br><span class=\"line\">gpg: 合计被处理的数量：1</span><br><span class=\"line\">gpg:           已导入：1</span><br><span class=\"line\">gpg: 找不到有效的 OpenPGP 数据。</span><br></pre></td></tr></table></figure>","more":"<h4 id=\"可能原因：\"><a href=\"#可能原因：\" class=\"headerlink\" title=\"可能原因：\"></a>可能原因：</h4><p>keyserver.ubuntu.com使用非标准的11371端口，而一般公司的防火墙都屏蔽掉了该端口，而允许标准的80端口。</p>\n<h4 id=\"解决方法：\"><a href=\"#解决方法：\" class=\"headerlink\" title=\"解决方法：\"></a>解决方法：</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 531EE72F4C9D234C</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E985B27B</span><br></pre></td></tr></table></figure>\n<h2 id=\"Telnet\"><a href=\"#Telnet\" class=\"headerlink\" title=\"Telnet\"></a>Telnet</h2><p>需要安装server的</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ubuntu</span></span><br><span class=\"line\">sudo apt install telnetd</span><br><span class=\"line\">sudo systemctl start inetd</span><br><span class=\"line\">sudo systemctl <span class=\"built_in\">enable</span> inetd</span><br><span class=\"line\"><span class=\"comment\"># arch</span></span><br><span class=\"line\">sudo systemctl start telnet.socket</span><br><span class=\"line\">sudo systemctl <span class=\"built_in\">enable</span> telnet.socket</span><br></pre></td></tr></table></figure>\n<p>使用telnet测试端口是否打开：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">telnet localhost 33171</span><br></pre></td></tr></table></figure>\n<h2 id=\"Github-Online-File-Tree-View-Plugin\"><a href=\"#Github-Online-File-Tree-View-Plugin\" class=\"headerlink\" title=\"Github Online File Tree View Plugin\"></a>Github Online File Tree View Plugin</h2><p><a href=\"https://github.com/buunguyen/octotree\" target=\"_blank\" rel=\"noopener\">Octotree</a></p>"},{"title":"Tech Daily@1-20","date":"2017-01-19T16:00:00.000Z","_content":"\n小米路由器mini（Xiaomi mini R1CM）刷Openwrt\n\n```bash\nscp /path/to/PandoraBox-xxxx.bin root@192.168.1.1:/tmp/PandoraBox.bin\nmtd -r write /tmp/PandoraBox.bin firmware\n```\n\n\n\n> 從爬文中得知，小米路由器Mini 官方韌體是雙系統，由於 ROM 有16MB，官方韌體都小於8MB，所以會有一份備援系統（8MB+8MB），因此如果刷了大於 8MB 的第三方韌體的話，會覆蓋掉第二個分區的系統，導致未來刷回官方韌體時會有掉 SN 的問題，而且再也無法刷入 SSH，從此以後就只能乖乖用官方韌體，再也不能玩刷機，目前新版的 PandoraBox 韌體大約都在 10MB 左右，所以刷機還真要有點決心，除非完整備份小米路由器Mini 中所有分區的資料，才能在日後完整刷回官方韌體，當然，如果已經完全放棄官方韌體的話，這些問題都是不用考慮的。from -  http://blog.icece.tw/MiWiFi-Mini-Flash-uboot\n\n\n\n## Disable middle button of mouse\n\nExecute those commands:\n\n```bash\nxinput list\n⎡ Virtual core pointer                    \tid=2\t[master pointer  (3)]\n⎜   ↳ Virtual core XTEST pointer              \tid=4\t[slave  pointer  (2)]\n⎜   ↳ MI Dongle MI Wireless Mouse             \tid=11\t[slave  pointer  (2)]\n⎜   ↳ MI Dongle MI Wireless Mouse             \tid=12\t[slave  pointer  (2)]\n⎜   ↳ DLL0704:01 06CB:76AE Touchpad           \tid=14\t[slave  pointer  (2)]\n⎜   ↳ PS/2 Synaptics TouchPad                 \tid=17\t[slave  pointer  (2)]\n⎜   ↳ MiMouse                                 \tid=21\t[slave  pointer  (2)]\n\nxinput set-button-map 21 1 0 3\n```\n<!--more-->\n### **Explaination** \n\nThe first number is the id of the pointer (you'll often only have one, in this case there were two, 9 and 10).\n\nThe next numbers are what you do with the first, second, and third (ie, left, middle, right) mouse buttons. The \"1 0 3\" tells it that the left button should do a left click (action 1), the middle button should do nothing, and the right button should do a right click (action 3). If you want to make the middle button also do a left click you could use \"1 1 3\". If you wanted to switch the right and left actions you could use \"3 0 1\". See [https://wiki.ubuntu.com/X/Config/Input](https://wiki.ubuntu.com/X/Config/Input) for more info.\n\n\n\n## git merge\n\n```bash\ngit merge <特性分支> # 将特性分支合并到当前分支中，形成一个新的提交\n```\n\n\n\n## git rebase\n\n```bash\ngit rebase <主分支> [<特性分支>] # 在主分支的基础上重演特性分支的修改，修改特性分支的历史（变基）\ngit rebase --onto master server client # 取出client分支，将client和server的共同祖先之后的变化在master上重演一遍\n```\n\n> [git-scm reference](https://git-scm.com/book/zh/v1/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E8%A1%8D%E5%90%88)\n\n\n\n## Vscode Go\t\n\n设置GOPATH（为~/go-workspace）\n\n```bash\ncat > ~/.zshrc <<\"EOF\"\n# Set Go Path\nexport GOPATH=$HOME/go-workspace\n# Customize to your needs...\nexport PATH=$PATH:$GOPATH\nEOF\n```\n\n在vscode中设置：打开用户设置，设置`go.gopath`\n\n安装插件：`Go`\n\n安装依赖：(事先设置好`http_proxy`和`https_proxy`)\n```bash\ngo get -u -v github.com/nsf/gocode\ngo get -u -v github.com/rogpeppe/godef\ngo get -u -v github.com/golang/lint/golint\ngo get -u -v github.com/lukehoban/go-find-references\ngo get -u -v github.com/lukehoban/go-outline\ngo get -u -v sourcegraph.com/sqs/goreturns\ngo get -u -v golang.org/x/tools/cmd/gorename\n```\n\n","source":"_posts/Xiaomi-Openwrt-&&-Git.md","raw":"---\ntitle: Tech Daily@1-20\ndate: 2017-1-20\ntags:\n - openwrt\n - git\n - go\ncategories:\n - Tech Daily\n---\n\n小米路由器mini（Xiaomi mini R1CM）刷Openwrt\n\n```bash\nscp /path/to/PandoraBox-xxxx.bin root@192.168.1.1:/tmp/PandoraBox.bin\nmtd -r write /tmp/PandoraBox.bin firmware\n```\n\n\n\n> 從爬文中得知，小米路由器Mini 官方韌體是雙系統，由於 ROM 有16MB，官方韌體都小於8MB，所以會有一份備援系統（8MB+8MB），因此如果刷了大於 8MB 的第三方韌體的話，會覆蓋掉第二個分區的系統，導致未來刷回官方韌體時會有掉 SN 的問題，而且再也無法刷入 SSH，從此以後就只能乖乖用官方韌體，再也不能玩刷機，目前新版的 PandoraBox 韌體大約都在 10MB 左右，所以刷機還真要有點決心，除非完整備份小米路由器Mini 中所有分區的資料，才能在日後完整刷回官方韌體，當然，如果已經完全放棄官方韌體的話，這些問題都是不用考慮的。from -  http://blog.icece.tw/MiWiFi-Mini-Flash-uboot\n\n\n\n## Disable middle button of mouse\n\nExecute those commands:\n\n```bash\nxinput list\n⎡ Virtual core pointer                    \tid=2\t[master pointer  (3)]\n⎜   ↳ Virtual core XTEST pointer              \tid=4\t[slave  pointer  (2)]\n⎜   ↳ MI Dongle MI Wireless Mouse             \tid=11\t[slave  pointer  (2)]\n⎜   ↳ MI Dongle MI Wireless Mouse             \tid=12\t[slave  pointer  (2)]\n⎜   ↳ DLL0704:01 06CB:76AE Touchpad           \tid=14\t[slave  pointer  (2)]\n⎜   ↳ PS/2 Synaptics TouchPad                 \tid=17\t[slave  pointer  (2)]\n⎜   ↳ MiMouse                                 \tid=21\t[slave  pointer  (2)]\n\nxinput set-button-map 21 1 0 3\n```\n<!--more-->\n### **Explaination** \n\nThe first number is the id of the pointer (you'll often only have one, in this case there were two, 9 and 10).\n\nThe next numbers are what you do with the first, second, and third (ie, left, middle, right) mouse buttons. The \"1 0 3\" tells it that the left button should do a left click (action 1), the middle button should do nothing, and the right button should do a right click (action 3). If you want to make the middle button also do a left click you could use \"1 1 3\". If you wanted to switch the right and left actions you could use \"3 0 1\". See [https://wiki.ubuntu.com/X/Config/Input](https://wiki.ubuntu.com/X/Config/Input) for more info.\n\n\n\n## git merge\n\n```bash\ngit merge <特性分支> # 将特性分支合并到当前分支中，形成一个新的提交\n```\n\n\n\n## git rebase\n\n```bash\ngit rebase <主分支> [<特性分支>] # 在主分支的基础上重演特性分支的修改，修改特性分支的历史（变基）\ngit rebase --onto master server client # 取出client分支，将client和server的共同祖先之后的变化在master上重演一遍\n```\n\n> [git-scm reference](https://git-scm.com/book/zh/v1/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E8%A1%8D%E5%90%88)\n\n\n\n## Vscode Go\t\n\n设置GOPATH（为~/go-workspace）\n\n```bash\ncat > ~/.zshrc <<\"EOF\"\n# Set Go Path\nexport GOPATH=$HOME/go-workspace\n# Customize to your needs...\nexport PATH=$PATH:$GOPATH\nEOF\n```\n\n在vscode中设置：打开用户设置，设置`go.gopath`\n\n安装插件：`Go`\n\n安装依赖：(事先设置好`http_proxy`和`https_proxy`)\n```bash\ngo get -u -v github.com/nsf/gocode\ngo get -u -v github.com/rogpeppe/godef\ngo get -u -v github.com/golang/lint/golint\ngo get -u -v github.com/lukehoban/go-find-references\ngo get -u -v github.com/lukehoban/go-outline\ngo get -u -v sourcegraph.com/sqs/goreturns\ngo get -u -v golang.org/x/tools/cmd/gorename\n```\n\n","slug":"Xiaomi-Openwrt-&&-Git","published":1,"updated":"2019-10-11T05:50:15.647Z","_id":"ciz5e9kzz000d5rgxvzuy4rvc","comments":1,"layout":"post","photos":[],"link":"","content":"<p>小米路由器mini（Xiaomi mini R1CM）刷Openwrt</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /path/to/PandoraBox-xxxx.bin root@192.168.1.1:/tmp/PandoraBox.bin</span><br><span class=\"line\">mtd -r write /tmp/PandoraBox.bin firmware</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>從爬文中得知，小米路由器Mini 官方韌體是雙系統，由於 ROM 有16MB，官方韌體都小於8MB，所以會有一份備援系統（8MB+8MB），因此如果刷了大於 8MB 的第三方韌體的話，會覆蓋掉第二個分區的系統，導致未來刷回官方韌體時會有掉 SN 的問題，而且再也無法刷入 SSH，從此以後就只能乖乖用官方韌體，再也不能玩刷機，目前新版的 PandoraBox 韌體大約都在 10MB 左右，所以刷機還真要有點決心，除非完整備份小米路由器Mini 中所有分區的資料，才能在日後完整刷回官方韌體，當然，如果已經完全放棄官方韌體的話，這些問題都是不用考慮的。from -  <a href=\"http://blog.icece.tw/MiWiFi-Mini-Flash-uboot\" target=\"_blank\" rel=\"noopener\">http://blog.icece.tw/MiWiFi-Mini-Flash-uboot</a></p>\n</blockquote>\n<h2 id=\"Disable-middle-button-of-mouse\"><a href=\"#Disable-middle-button-of-mouse\" class=\"headerlink\" title=\"Disable middle button of mouse\"></a>Disable middle button of mouse</h2><p>Execute those commands:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xinput list</span><br><span class=\"line\">⎡ Virtual core pointer                    \tid=2\t[master pointer  (3)]</span><br><span class=\"line\">⎜   ↳ Virtual core XTEST pointer              \tid=4\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ MI Dongle MI Wireless Mouse             \tid=11\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ MI Dongle MI Wireless Mouse             \tid=12\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ DLL0704:01 06CB:76AE Touchpad           \tid=14\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ PS/2 Synaptics TouchPad                 \tid=17\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ MiMouse                                 \tid=21\t[slave  pointer  (2)]</span><br><span class=\"line\"></span><br><span class=\"line\">xinput <span class=\"built_in\">set</span>-button-map 21 1 0 3</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h3 id=\"Explaination\"><a href=\"#Explaination\" class=\"headerlink\" title=\"Explaination\"></a><strong>Explaination</strong></h3><p>The first number is the id of the pointer (you’ll often only have one, in this case there were two, 9 and 10).</p>\n<p>The next numbers are what you do with the first, second, and third (ie, left, middle, right) mouse buttons. The “1 0 3” tells it that the left button should do a left click (action 1), the middle button should do nothing, and the right button should do a right click (action 3). If you want to make the middle button also do a left click you could use “1 1 3”. If you wanted to switch the right and left actions you could use “3 0 1”. See <a href=\"https://wiki.ubuntu.com/X/Config/Input\" target=\"_blank\" rel=\"noopener\">https://wiki.ubuntu.com/X/Config/Input</a> for more info.</p>\n<h2 id=\"git-merge\"><a href=\"#git-merge\" class=\"headerlink\" title=\"git merge\"></a>git merge</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge &lt;特性分支&gt; <span class=\"comment\"># 将特性分支合并到当前分支中，形成一个新的提交</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"git-rebase\"><a href=\"#git-rebase\" class=\"headerlink\" title=\"git rebase\"></a>git rebase</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase &lt;主分支&gt; [&lt;特性分支&gt;] <span class=\"comment\"># 在主分支的基础上重演特性分支的修改，修改特性分支的历史（变基）</span></span><br><span class=\"line\">git rebase --onto master server client <span class=\"comment\"># 取出client分支，将client和server的共同祖先之后的变化在master上重演一遍</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"https://git-scm.com/book/zh/v1/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E8%A1%8D%E5%90%88\" target=\"_blank\" rel=\"noopener\">git-scm reference</a></p>\n</blockquote>\n<h2 id=\"Vscode-Go\"><a href=\"#Vscode-Go\" class=\"headerlink\" title=\"Vscode Go\"></a>Vscode Go</h2><p>设置GOPATH（为~/go-workspace）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; ~/.zshrc &lt;&lt;<span class=\"string\">\"EOF\"</span></span><br><span class=\"line\"><span class=\"comment\"># Set Go Path</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> GOPATH=<span class=\"variable\">$HOME</span>/go-workspace</span><br><span class=\"line\"><span class=\"comment\"># Customize to your needs...</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$GOPATH</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<p>在vscode中设置：打开用户设置，设置<code>go.gopath</code></p>\n<p>安装插件：<code>Go</code></p>\n<p>安装依赖：(事先设置好<code>http_proxy</code>和<code>https_proxy</code>)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v github.com/nsf/gocode</span><br><span class=\"line\">go get -u -v github.com/rogpeppe/godef</span><br><span class=\"line\">go get -u -v github.com/golang/lint/golint</span><br><span class=\"line\">go get -u -v github.com/lukehoban/go-find-references</span><br><span class=\"line\">go get -u -v github.com/lukehoban/go-outline</span><br><span class=\"line\">go get -u -v sourcegraph.com/sqs/goreturns</span><br><span class=\"line\">go get -u -v golang.org/x/tools/cmd/gorename</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<p>小米路由器mini（Xiaomi mini R1CM）刷Openwrt</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /path/to/PandoraBox-xxxx.bin root@192.168.1.1:/tmp/PandoraBox.bin</span><br><span class=\"line\">mtd -r write /tmp/PandoraBox.bin firmware</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>從爬文中得知，小米路由器Mini 官方韌體是雙系統，由於 ROM 有16MB，官方韌體都小於8MB，所以會有一份備援系統（8MB+8MB），因此如果刷了大於 8MB 的第三方韌體的話，會覆蓋掉第二個分區的系統，導致未來刷回官方韌體時會有掉 SN 的問題，而且再也無法刷入 SSH，從此以後就只能乖乖用官方韌體，再也不能玩刷機，目前新版的 PandoraBox 韌體大約都在 10MB 左右，所以刷機還真要有點決心，除非完整備份小米路由器Mini 中所有分區的資料，才能在日後完整刷回官方韌體，當然，如果已經完全放棄官方韌體的話，這些問題都是不用考慮的。from -  <a href=\"http://blog.icece.tw/MiWiFi-Mini-Flash-uboot\" target=\"_blank\" rel=\"noopener\">http://blog.icece.tw/MiWiFi-Mini-Flash-uboot</a></p>\n</blockquote>\n<h2 id=\"Disable-middle-button-of-mouse\"><a href=\"#Disable-middle-button-of-mouse\" class=\"headerlink\" title=\"Disable middle button of mouse\"></a>Disable middle button of mouse</h2><p>Execute those commands:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xinput list</span><br><span class=\"line\">⎡ Virtual core pointer                    \tid=2\t[master pointer  (3)]</span><br><span class=\"line\">⎜   ↳ Virtual core XTEST pointer              \tid=4\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ MI Dongle MI Wireless Mouse             \tid=11\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ MI Dongle MI Wireless Mouse             \tid=12\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ DLL0704:01 06CB:76AE Touchpad           \tid=14\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ PS/2 Synaptics TouchPad                 \tid=17\t[slave  pointer  (2)]</span><br><span class=\"line\">⎜   ↳ MiMouse                                 \tid=21\t[slave  pointer  (2)]</span><br><span class=\"line\"></span><br><span class=\"line\">xinput <span class=\"built_in\">set</span>-button-map 21 1 0 3</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"Explaination\"><a href=\"#Explaination\" class=\"headerlink\" title=\"Explaination\"></a><strong>Explaination</strong></h3><p>The first number is the id of the pointer (you’ll often only have one, in this case there were two, 9 and 10).</p>\n<p>The next numbers are what you do with the first, second, and third (ie, left, middle, right) mouse buttons. The “1 0 3” tells it that the left button should do a left click (action 1), the middle button should do nothing, and the right button should do a right click (action 3). If you want to make the middle button also do a left click you could use “1 1 3”. If you wanted to switch the right and left actions you could use “3 0 1”. See <a href=\"https://wiki.ubuntu.com/X/Config/Input\" target=\"_blank\" rel=\"noopener\">https://wiki.ubuntu.com/X/Config/Input</a> for more info.</p>\n<h2 id=\"git-merge\"><a href=\"#git-merge\" class=\"headerlink\" title=\"git merge\"></a>git merge</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge &lt;特性分支&gt; <span class=\"comment\"># 将特性分支合并到当前分支中，形成一个新的提交</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"git-rebase\"><a href=\"#git-rebase\" class=\"headerlink\" title=\"git rebase\"></a>git rebase</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git rebase &lt;主分支&gt; [&lt;特性分支&gt;] <span class=\"comment\"># 在主分支的基础上重演特性分支的修改，修改特性分支的历史（变基）</span></span><br><span class=\"line\">git rebase --onto master server client <span class=\"comment\"># 取出client分支，将client和server的共同祖先之后的变化在master上重演一遍</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><a href=\"https://git-scm.com/book/zh/v1/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E8%A1%8D%E5%90%88\" target=\"_blank\" rel=\"noopener\">git-scm reference</a></p>\n</blockquote>\n<h2 id=\"Vscode-Go\"><a href=\"#Vscode-Go\" class=\"headerlink\" title=\"Vscode Go\"></a>Vscode Go</h2><p>设置GOPATH（为~/go-workspace）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; ~/.zshrc &lt;&lt;<span class=\"string\">\"EOF\"</span></span><br><span class=\"line\"><span class=\"comment\"># Set Go Path</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> GOPATH=<span class=\"variable\">$HOME</span>/go-workspace</span><br><span class=\"line\"><span class=\"comment\"># Customize to your needs...</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$GOPATH</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<p>在vscode中设置：打开用户设置，设置<code>go.gopath</code></p>\n<p>安装插件：<code>Go</code></p>\n<p>安装依赖：(事先设置好<code>http_proxy</code>和<code>https_proxy</code>)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v github.com/nsf/gocode</span><br><span class=\"line\">go get -u -v github.com/rogpeppe/godef</span><br><span class=\"line\">go get -u -v github.com/golang/lint/golint</span><br><span class=\"line\">go get -u -v github.com/lukehoban/go-find-references</span><br><span class=\"line\">go get -u -v github.com/lukehoban/go-outline</span><br><span class=\"line\">go get -u -v sourcegraph.com/sqs/goreturns</span><br><span class=\"line\">go get -u -v golang.org/x/tools/cmd/gorename</span><br></pre></td></tr></table></figure></p>"},{"title":"Kubernetes部署","date":"2017-01-03T16:00:00.000Z","_content":"\n\n\n## MEOW\n\n安装\n\n```bash\ncurl -L git.io/meowproxy | bash\n# 建议安装目录 /usr/bin/\n```\n\n复制自己的配置文件\n\n```bash\n# in local computer\nxclip -sel clipboard < ~/.meow/rc\n# in CentOS server\nmv ~/.meow/rc ~/.meow/rc.bak\nxclip -o -sel clipboard > ~/.meow/rc\n```\n\n<!-- more -->\n\n运行\n\n```\nMEOW\n```\n\n\n\n## Hostname\n\n执行下面脚本。**不要执行多次** 如果出错则手动修改\n\n```bash\nsed -i s/localhost\\.localdomain/NAME/g /etc/hosts /etc/hostname \nhostname=\"10-10-103-144.node\"\nrm -rf /etc/hostname\necho $hostname > /etc/hostname \nsed -i \"s/\\slocalhost\\s/ localhost $hostname /g\" /etc/hosts\nsysctl kernel.hostname=$hostname\n```\n\n## Screenfetch\n\n```bash\ncurl -L https://raw.githubusercontent.com/KittyKatt/screenFetch/master/screenfetch-dev -o /usr/bin/screenfetch\n```\n\n## AWK简述\n\n```bash\nawk -v var1=xxx BEGIN{[something]} [ifstatments or regex]{something match the condition}{[always run]}END{[something]}\n# 支持if else,for,i++\n# 支持数组（支持for in遍历，但是顺序会打乱）\n# 最好的批量初始化的方式： \narr[\"\"]=0 # 批量设为0\nstr=\"a b c\"; split(str,arr[,\" \"]);# [\"a\",\"b\",\"c\"]\n```\n\n\n\n## 加Kubernetes源\n\n```Bash\ncat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\nEOF\n```\n\n## 安装Kubernetes\n\n```bash\nyum install docker kubelet kubeadm kubectl kubernetes-cni\n```\n\n## 启动进程&关闭防火墙\n\n```bash\nsystemctl start docker\nsystemctl start kubelet\nsystemctl enable docker \nsystemctl enable kubelet \nsystemctl stop firewalld\nsystemctl disable firewalld\n```\n\n\n\n## Tear Down(当kubeadm init失败时执行) \n\n```bash\nkubeadm reset && systemctl start kubelet\n```\n\n\n\n## Pull Docker Images\n\n**此方式十分艰难。后面可以通过代理直接安装。见Tech Log@1-12**\n\n```bash\n#! /bin/bash\ndeclare -a images=(\n    'dnsmasq-metrics-amd64:1.0'\n    'etcd-amd64:3.0.14-kubeadm'\n    'exechealthz-amd64:v1.2.0'\n    'kube-apiserver-amd64:v1.5.1'\n    'kube-controller-manager-amd64:v1.5.1'\n    'kube-discovery-amd64:1.0'\n    'kube-dnsmasq-amd64:1.4'\n    'kube-proxy-amd64:v1.5.1'\n    'kube-scheduler-amd64:v1.5.1'\n    'kubedns-amd64:1.9'\n    'kubernetes-dashboard-amd64:v1.5.0'\n    'pause-amd64:3.0'\n#   'weave-kube:1.8.1'\n#   'weave-npc:1.8.1'\n)\nfor imageName in ${images[@]}; do\n    docker pull stkevintan/$imageName\n    docker tag stkevintan/$imageName gcr.io/google_containers/$imageName\n    docker rmi stkevintan/$imageName\ndone\n```\n\n```bash\nxclip -o -sel clipboard > pull_docker\nchmod +x pull_docker\n./pull_docker\n```\n\n\n\n## 初始化（Master）\n\n```bash\n# 首先需要使用@17-1-3的脚本设置代理。\n# Del environment\n# Set curl\n# Set kube env\n# Set docker\n# 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io\nroot@10-10-103-144 ~ $ kubeadm init\n[kubeadm] WARNING: kubeadm is in alpha, please do not use it for production clusters.\n[preflight] Running pre-flight checks\n[init] Using Kubernetes version: v1.5.2\n[tokens] Generated token: \"c30875.954dc1dda4d0184b\"\n[certificates] Generated Certificate Authority key and certificate.\n[certificates] Generated API Server key and certificate\n[certificates] Generated Service Account signing keys\n[certificates] Created keys and certificates in \"/etc/kubernetes/pki\"\n[kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/kubelet.conf\"\n[kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/admin.conf\"\n[apiclient] Created API client, waiting for the control plane to become ready\n[apiclient] All control plane components are healthy after 16.391731 seconds\n[apiclient] Waiting for at least one node to register and become ready\n[apiclient] First node is ready after 0.509209 seconds\n[apiclient] Creating a test deployment\n[apiclient] Test deployment succeeded\n[token-discovery] Created the kube-discovery deployment, waiting for it to become ready\n[token-discovery] kube-discovery is ready after 3.505676 seconds\n[addons] Created essential addon: kube-proxy\n[addons] Created essential addon: kube-dns\n\nYour Kubernetes master has initialized successfully!\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n    http://kubernetes.io/docs/admin/addons/\n\nYou can now join any number of machines by running the following on each node:\n\nkubeadm join --token=c30875.954dc1dda4d0184b 10.10.103.144\n```\n\n\n\n\n\n## 初始化（Node）\n\n```bash\n# 需要在子节点上安装kubelet kubectl kubernetes-cni kubeadm\n# 需要使用@17-1-3的脚本设置代理。\n# Del environment\n# Set curl\n# Set kube env\n# Set docker\n# 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io\nsystemctl enable kubelet\nsystemctl start kubelet\n\nkubeadm join --token=ace10c.73fcdec44f7a4045 10.10.103.146\n```\n\n可以在master节点上看到该子节点：\n\n```bash\nroot@master ~ $ kubectl get node\nNAME      STATUS         AGE\nmaster    Ready,master   5d\nnode1     Ready          1m\n```\n\n\n\n## Weave Network\n\n```bash\n# download config file\ncurl -L https://git.io/weave-kube -o weave-kube.yaml\n# pull docker image\ndocker pull stkevintan/weave-kube:1.8.1\ndocker tag stkevintan/weave-kube:1.8.1 weaveworks/weave-kube:1.8.1\ndocker rmi stkevintan/weave-kube:1.8.1\n# create\nkubectl create -f weave-kube.yaml\n# 或者\nkubectl create -f https://git.io/weave-kube\n```\n\n可以看到结果：\n\n```bash\nroot@master ~ $ kubectl get pod --namespace=kube-system\nNAME                              READY     STATUS              RESTARTS   AGE\ndummy-2088944543-bv5gj            1/1       Running             0          5d\netcd-master                       1/1       Running             0          5d\nkube-apiserver-master             1/1       Running             27         5d\nkube-controller-manager-master    1/1       Running             0          5d\nkube-discovery-1769846148-xbm2h   1/1       Running             0          5d\nkube-dns-2924299975-phn03         0/4       ContainerCreating   0          5d\nkube-proxy-081gt                  1/1       Running             0          5d\nkube-proxy-qc40l                  1/1       Running             0          1h\nkube-scheduler-master             1/1       Running             1          5d\nweave-net-4wvkm                   0/2       ContainerCreating   0          30s\nweave-net-l7dh0                   0/2       ContainerCreating   0          30s\n```\n\n\n\n## Dashboard\n\n```bash\n curl -L https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml -o kubernetes-dashboard.yaml\n \n sed -i 's/v1.5.1/v1.5.0/g' kubernetes-dashboard.yaml # 注意此时gcr上面并没有v1.5.1\n sed -i 's/Alaways/IfNotPresent/g' kubernetes-dashboard.yaml\n \n kubectl create -f kubernetes-dashboard.yaml\n \n kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml\n```\n\n\n\n## Delete Pod\n\n```bash\nkubectl delete -f xxx.yaml\n```\n\n","source":"_posts/Kubernetes部署@1-5.md","raw":"---\ntitle: Kubernetes部署\ndate: 2017-1-4\ntags:\n  - meow\n  - docker\n  - kubernetes\ncategories:\n  - Cloud Computing\n---\n\n\n\n## MEOW\n\n安装\n\n```bash\ncurl -L git.io/meowproxy | bash\n# 建议安装目录 /usr/bin/\n```\n\n复制自己的配置文件\n\n```bash\n# in local computer\nxclip -sel clipboard < ~/.meow/rc\n# in CentOS server\nmv ~/.meow/rc ~/.meow/rc.bak\nxclip -o -sel clipboard > ~/.meow/rc\n```\n\n<!-- more -->\n\n运行\n\n```\nMEOW\n```\n\n\n\n## Hostname\n\n执行下面脚本。**不要执行多次** 如果出错则手动修改\n\n```bash\nsed -i s/localhost\\.localdomain/NAME/g /etc/hosts /etc/hostname \nhostname=\"10-10-103-144.node\"\nrm -rf /etc/hostname\necho $hostname > /etc/hostname \nsed -i \"s/\\slocalhost\\s/ localhost $hostname /g\" /etc/hosts\nsysctl kernel.hostname=$hostname\n```\n\n## Screenfetch\n\n```bash\ncurl -L https://raw.githubusercontent.com/KittyKatt/screenFetch/master/screenfetch-dev -o /usr/bin/screenfetch\n```\n\n## AWK简述\n\n```bash\nawk -v var1=xxx BEGIN{[something]} [ifstatments or regex]{something match the condition}{[always run]}END{[something]}\n# 支持if else,for,i++\n# 支持数组（支持for in遍历，但是顺序会打乱）\n# 最好的批量初始化的方式： \narr[\"\"]=0 # 批量设为0\nstr=\"a b c\"; split(str,arr[,\" \"]);# [\"a\",\"b\",\"c\"]\n```\n\n\n\n## 加Kubernetes源\n\n```Bash\ncat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\nEOF\n```\n\n## 安装Kubernetes\n\n```bash\nyum install docker kubelet kubeadm kubectl kubernetes-cni\n```\n\n## 启动进程&关闭防火墙\n\n```bash\nsystemctl start docker\nsystemctl start kubelet\nsystemctl enable docker \nsystemctl enable kubelet \nsystemctl stop firewalld\nsystemctl disable firewalld\n```\n\n\n\n## Tear Down(当kubeadm init失败时执行) \n\n```bash\nkubeadm reset && systemctl start kubelet\n```\n\n\n\n## Pull Docker Images\n\n**此方式十分艰难。后面可以通过代理直接安装。见Tech Log@1-12**\n\n```bash\n#! /bin/bash\ndeclare -a images=(\n    'dnsmasq-metrics-amd64:1.0'\n    'etcd-amd64:3.0.14-kubeadm'\n    'exechealthz-amd64:v1.2.0'\n    'kube-apiserver-amd64:v1.5.1'\n    'kube-controller-manager-amd64:v1.5.1'\n    'kube-discovery-amd64:1.0'\n    'kube-dnsmasq-amd64:1.4'\n    'kube-proxy-amd64:v1.5.1'\n    'kube-scheduler-amd64:v1.5.1'\n    'kubedns-amd64:1.9'\n    'kubernetes-dashboard-amd64:v1.5.0'\n    'pause-amd64:3.0'\n#   'weave-kube:1.8.1'\n#   'weave-npc:1.8.1'\n)\nfor imageName in ${images[@]}; do\n    docker pull stkevintan/$imageName\n    docker tag stkevintan/$imageName gcr.io/google_containers/$imageName\n    docker rmi stkevintan/$imageName\ndone\n```\n\n```bash\nxclip -o -sel clipboard > pull_docker\nchmod +x pull_docker\n./pull_docker\n```\n\n\n\n## 初始化（Master）\n\n```bash\n# 首先需要使用@17-1-3的脚本设置代理。\n# Del environment\n# Set curl\n# Set kube env\n# Set docker\n# 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io\nroot@10-10-103-144 ~ $ kubeadm init\n[kubeadm] WARNING: kubeadm is in alpha, please do not use it for production clusters.\n[preflight] Running pre-flight checks\n[init] Using Kubernetes version: v1.5.2\n[tokens] Generated token: \"c30875.954dc1dda4d0184b\"\n[certificates] Generated Certificate Authority key and certificate.\n[certificates] Generated API Server key and certificate\n[certificates] Generated Service Account signing keys\n[certificates] Created keys and certificates in \"/etc/kubernetes/pki\"\n[kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/kubelet.conf\"\n[kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/admin.conf\"\n[apiclient] Created API client, waiting for the control plane to become ready\n[apiclient] All control plane components are healthy after 16.391731 seconds\n[apiclient] Waiting for at least one node to register and become ready\n[apiclient] First node is ready after 0.509209 seconds\n[apiclient] Creating a test deployment\n[apiclient] Test deployment succeeded\n[token-discovery] Created the kube-discovery deployment, waiting for it to become ready\n[token-discovery] kube-discovery is ready after 3.505676 seconds\n[addons] Created essential addon: kube-proxy\n[addons] Created essential addon: kube-dns\n\nYour Kubernetes master has initialized successfully!\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n    http://kubernetes.io/docs/admin/addons/\n\nYou can now join any number of machines by running the following on each node:\n\nkubeadm join --token=c30875.954dc1dda4d0184b 10.10.103.144\n```\n\n\n\n\n\n## 初始化（Node）\n\n```bash\n# 需要在子节点上安装kubelet kubectl kubernetes-cni kubeadm\n# 需要使用@17-1-3的脚本设置代理。\n# Del environment\n# Set curl\n# Set kube env\n# Set docker\n# 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io\nsystemctl enable kubelet\nsystemctl start kubelet\n\nkubeadm join --token=ace10c.73fcdec44f7a4045 10.10.103.146\n```\n\n可以在master节点上看到该子节点：\n\n```bash\nroot@master ~ $ kubectl get node\nNAME      STATUS         AGE\nmaster    Ready,master   5d\nnode1     Ready          1m\n```\n\n\n\n## Weave Network\n\n```bash\n# download config file\ncurl -L https://git.io/weave-kube -o weave-kube.yaml\n# pull docker image\ndocker pull stkevintan/weave-kube:1.8.1\ndocker tag stkevintan/weave-kube:1.8.1 weaveworks/weave-kube:1.8.1\ndocker rmi stkevintan/weave-kube:1.8.1\n# create\nkubectl create -f weave-kube.yaml\n# 或者\nkubectl create -f https://git.io/weave-kube\n```\n\n可以看到结果：\n\n```bash\nroot@master ~ $ kubectl get pod --namespace=kube-system\nNAME                              READY     STATUS              RESTARTS   AGE\ndummy-2088944543-bv5gj            1/1       Running             0          5d\netcd-master                       1/1       Running             0          5d\nkube-apiserver-master             1/1       Running             27         5d\nkube-controller-manager-master    1/1       Running             0          5d\nkube-discovery-1769846148-xbm2h   1/1       Running             0          5d\nkube-dns-2924299975-phn03         0/4       ContainerCreating   0          5d\nkube-proxy-081gt                  1/1       Running             0          5d\nkube-proxy-qc40l                  1/1       Running             0          1h\nkube-scheduler-master             1/1       Running             1          5d\nweave-net-4wvkm                   0/2       ContainerCreating   0          30s\nweave-net-l7dh0                   0/2       ContainerCreating   0          30s\n```\n\n\n\n## Dashboard\n\n```bash\n curl -L https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml -o kubernetes-dashboard.yaml\n \n sed -i 's/v1.5.1/v1.5.0/g' kubernetes-dashboard.yaml # 注意此时gcr上面并没有v1.5.1\n sed -i 's/Alaways/IfNotPresent/g' kubernetes-dashboard.yaml\n \n kubectl create -f kubernetes-dashboard.yaml\n \n kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml\n```\n\n\n\n## Delete Pod\n\n```bash\nkubectl delete -f xxx.yaml\n```\n\n","slug":"Kubernetes部署@1-5","published":1,"updated":"2019-10-11T05:50:15.643Z","_id":"ciz5e9l04000g5rgxsv7kvyd5","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"MEOW\"><a href=\"#MEOW\" class=\"headerlink\" title=\"MEOW\"></a>MEOW</h2><p>安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L git.io/meowproxy | bash</span><br><span class=\"line\"><span class=\"comment\"># 建议安装目录 /usr/bin/</span></span><br></pre></td></tr></table></figure>\n<p>复制自己的配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># in local computer</span></span><br><span class=\"line\">xclip -sel clipboard &lt; ~/.meow/rc</span><br><span class=\"line\"><span class=\"comment\"># in CentOS server</span></span><br><span class=\"line\">mv ~/.meow/rc ~/.meow/rc.bak</span><br><span class=\"line\">xclip -o -sel clipboard &gt; ~/.meow/rc</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MEOW</span><br></pre></td></tr></table></figure>\n<h2 id=\"Hostname\"><a href=\"#Hostname\" class=\"headerlink\" title=\"Hostname\"></a>Hostname</h2><p>执行下面脚本。<strong>不要执行多次</strong> 如果出错则手动修改</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i s/localhost\\.localdomain/NAME/g /etc/hosts /etc/hostname </span><br><span class=\"line\">hostname=<span class=\"string\">\"10-10-103-144.node\"</span></span><br><span class=\"line\">rm -rf /etc/hostname</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$hostname</span> &gt; /etc/hostname </span><br><span class=\"line\">sed -i <span class=\"string\">\"s/\\slocalhost\\s/ localhost <span class=\"variable\">$hostname</span> /g\"</span> /etc/hosts</span><br><span class=\"line\">sysctl kernel.hostname=<span class=\"variable\">$hostname</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Screenfetch\"><a href=\"#Screenfetch\" class=\"headerlink\" title=\"Screenfetch\"></a>Screenfetch</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https://raw.githubusercontent.com/KittyKatt/screenFetch/master/screenfetch-dev -o /usr/bin/screenfetch</span><br></pre></td></tr></table></figure>\n<h2 id=\"AWK简述\"><a href=\"#AWK简述\" class=\"headerlink\" title=\"AWK简述\"></a>AWK简述</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -v var1=xxx BEGIN&#123;[something]&#125; [ifstatments or regex]&#123;something match the condition&#125;&#123;[always run]&#125;END&#123;[something]&#125;</span><br><span class=\"line\"><span class=\"comment\"># 支持if else,for,i++</span></span><br><span class=\"line\"><span class=\"comment\"># 支持数组（支持for in遍历，但是顺序会打乱）</span></span><br><span class=\"line\"><span class=\"comment\"># 最好的批量初始化的方式： </span></span><br><span class=\"line\">arr[<span class=\"string\">\"\"</span>]=0 <span class=\"comment\"># 批量设为0</span></span><br><span class=\"line\">str=<span class=\"string\">\"a b c\"</span>; split(str,arr[,<span class=\"string\">\" \"</span>]);<span class=\"comment\"># [\"a\",\"b\",\"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"加Kubernetes源\"><a href=\"#加Kubernetes源\" class=\"headerlink\" title=\"加Kubernetes源\"></a>加Kubernetes源</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class=\"line\">[kubernetes]</span><br><span class=\"line\">name=Kubernetes</span><br><span class=\"line\">baseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">repo_gpgcheck=0</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装Kubernetes\"><a href=\"#安装Kubernetes\" class=\"headerlink\" title=\"安装Kubernetes\"></a>安装Kubernetes</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install docker kubelet kubeadm kubectl kubernetes-cni</span><br></pre></td></tr></table></figure>\n<h2 id=\"启动进程-amp-关闭防火墙\"><a href=\"#启动进程-amp-关闭防火墙\" class=\"headerlink\" title=\"启动进程&amp;关闭防火墙\"></a>启动进程&amp;关闭防火墙</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br><span class=\"line\">systemctl start kubelet</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> docker </span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> kubelet </span><br><span class=\"line\">systemctl stop firewalld</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld</span><br></pre></td></tr></table></figure>\n<h2 id=\"Tear-Down-当kubeadm-init失败时执行\"><a href=\"#Tear-Down-当kubeadm-init失败时执行\" class=\"headerlink\" title=\"Tear Down(当kubeadm init失败时执行)\"></a>Tear Down(当kubeadm init失败时执行)</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm reset &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pull-Docker-Images\"><a href=\"#Pull-Docker-Images\" class=\"headerlink\" title=\"Pull Docker Images\"></a>Pull Docker Images</h2><p><strong>此方式十分艰难。后面可以通过代理直接安装。见Tech Log@1-12</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">declare</span> -a images=(</span><br><span class=\"line\">    <span class=\"string\">'dnsmasq-metrics-amd64:1.0'</span></span><br><span class=\"line\">    <span class=\"string\">'etcd-amd64:3.0.14-kubeadm'</span></span><br><span class=\"line\">    <span class=\"string\">'exechealthz-amd64:v1.2.0'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-apiserver-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-controller-manager-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-discovery-amd64:1.0'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-dnsmasq-amd64:1.4'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-proxy-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-scheduler-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kubedns-amd64:1.9'</span></span><br><span class=\"line\">    <span class=\"string\">'kubernetes-dashboard-amd64:v1.5.0'</span></span><br><span class=\"line\">    <span class=\"string\">'pause-amd64:3.0'</span></span><br><span class=\"line\"><span class=\"comment\">#   'weave-kube:1.8.1'</span></span><br><span class=\"line\"><span class=\"comment\">#   'weave-npc:1.8.1'</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">for</span> imageName <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;images[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">    docker pull stkevintan/<span class=\"variable\">$imageName</span></span><br><span class=\"line\">    docker tag stkevintan/<span class=\"variable\">$imageName</span> gcr.io/google_containers/<span class=\"variable\">$imageName</span></span><br><span class=\"line\">    docker rmi stkevintan/<span class=\"variable\">$imageName</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xclip -o -sel clipboard &gt; pull_docker</span><br><span class=\"line\">chmod +x pull_docker</span><br><span class=\"line\">./pull_docker</span><br></pre></td></tr></table></figure>\n<h2 id=\"初始化（Master）\"><a href=\"#初始化（Master）\" class=\"headerlink\" title=\"初始化（Master）\"></a>初始化（Master）</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先需要使用@17-1-3的脚本设置代理。</span></span><br><span class=\"line\"><span class=\"comment\"># Del environment</span></span><br><span class=\"line\"><span class=\"comment\"># Set curl</span></span><br><span class=\"line\"><span class=\"comment\"># Set kube env</span></span><br><span class=\"line\"><span class=\"comment\"># Set docker</span></span><br><span class=\"line\"><span class=\"comment\"># 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io</span></span><br><span class=\"line\">root@10-10-103-144 ~ $ kubeadm init</span><br><span class=\"line\">[kubeadm] WARNING: kubeadm is <span class=\"keyword\">in</span> alpha, please <span class=\"keyword\">do</span> not use it <span class=\"keyword\">for</span> production clusters.</span><br><span class=\"line\">[preflight] Running pre-flight checks</span><br><span class=\"line\">[init] Using Kubernetes version: v1.5.2</span><br><span class=\"line\">[tokens] Generated token: <span class=\"string\">\"c30875.954dc1dda4d0184b\"</span></span><br><span class=\"line\">[certificates] Generated Certificate Authority key and certificate.</span><br><span class=\"line\">[certificates] Generated API Server key and certificate</span><br><span class=\"line\">[certificates] Generated Service Account signing keys</span><br><span class=\"line\">[certificates] Created keys and certificates <span class=\"keyword\">in</span> <span class=\"string\">\"/etc/kubernetes/pki\"</span></span><br><span class=\"line\">[kubeconfig] Wrote KubeConfig file to disk: <span class=\"string\">\"/etc/kubernetes/kubelet.conf\"</span></span><br><span class=\"line\">[kubeconfig] Wrote KubeConfig file to disk: <span class=\"string\">\"/etc/kubernetes/admin.conf\"</span></span><br><span class=\"line\">[apiclient] Created API client, waiting <span class=\"keyword\">for</span> the control plane to become ready</span><br><span class=\"line\">[apiclient] All control plane components are healthy after 16.391731 seconds</span><br><span class=\"line\">[apiclient] Waiting <span class=\"keyword\">for</span> at least one node to register and become ready</span><br><span class=\"line\">[apiclient] First node is ready after 0.509209 seconds</span><br><span class=\"line\">[apiclient] Creating a <span class=\"built_in\">test</span> deployment</span><br><span class=\"line\">[apiclient] Test deployment succeeded</span><br><span class=\"line\">[token-discovery] Created the kube-discovery deployment, waiting <span class=\"keyword\">for</span> it to become ready</span><br><span class=\"line\">[token-discovery] kube-discovery is ready after 3.505676 seconds</span><br><span class=\"line\">[addons] Created essential addon: kube-proxy</span><br><span class=\"line\">[addons] Created essential addon: kube-dns</span><br><span class=\"line\"></span><br><span class=\"line\">Your Kubernetes master has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run <span class=\"string\">\"kubectl apply -f [podnetwork].yaml\"</span> with one of the options listed at:</span><br><span class=\"line\">    http://kubernetes.io/docs/admin/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">You can now join any number of machines by running the following on each node:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join --token=c30875.954dc1dda4d0184b 10.10.103.144</span><br></pre></td></tr></table></figure>\n<h2 id=\"初始化（Node）\"><a href=\"#初始化（Node）\" class=\"headerlink\" title=\"初始化（Node）\"></a>初始化（Node）</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 需要在子节点上安装kubelet kubectl kubernetes-cni kubeadm</span></span><br><span class=\"line\"><span class=\"comment\"># 需要使用@17-1-3的脚本设置代理。</span></span><br><span class=\"line\"><span class=\"comment\"># Del environment</span></span><br><span class=\"line\"><span class=\"comment\"># Set curl</span></span><br><span class=\"line\"><span class=\"comment\"># Set kube env</span></span><br><span class=\"line\"><span class=\"comment\"># Set docker</span></span><br><span class=\"line\"><span class=\"comment\"># 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> kubelet</span><br><span class=\"line\">systemctl start kubelet</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join --token=ace10c.73fcdec44f7a4045 10.10.103.146</span><br></pre></td></tr></table></figure>\n<p>可以在master节点上看到该子节点：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@master ~ $ kubectl get node</span><br><span class=\"line\">NAME      STATUS         AGE</span><br><span class=\"line\">master    Ready,master   5d</span><br><span class=\"line\">node1     Ready          1m</span><br></pre></td></tr></table></figure>\n<h2 id=\"Weave-Network\"><a href=\"#Weave-Network\" class=\"headerlink\" title=\"Weave Network\"></a>Weave Network</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># download config file</span></span><br><span class=\"line\">curl -L https://git.io/weave-kube -o weave-kube.yaml</span><br><span class=\"line\"><span class=\"comment\"># pull docker image</span></span><br><span class=\"line\">docker pull stkevintan/weave-kube:1.8.1</span><br><span class=\"line\">docker tag stkevintan/weave-kube:1.8.1 weaveworks/weave-kube:1.8.1</span><br><span class=\"line\">docker rmi stkevintan/weave-kube:1.8.1</span><br><span class=\"line\"><span class=\"comment\"># create</span></span><br><span class=\"line\">kubectl create -f weave-kube.yaml</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">kubectl create -f https://git.io/weave-kube</span><br></pre></td></tr></table></figure>\n<p>可以看到结果：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@master ~ $ kubectl get pod --namespace=kube-system</span><br><span class=\"line\">NAME                              READY     STATUS              RESTARTS   AGE</span><br><span class=\"line\">dummy-2088944543-bv5gj            1/1       Running             0          5d</span><br><span class=\"line\">etcd-master                       1/1       Running             0          5d</span><br><span class=\"line\">kube-apiserver-master             1/1       Running             27         5d</span><br><span class=\"line\">kube-controller-manager-master    1/1       Running             0          5d</span><br><span class=\"line\">kube-discovery-1769846148-xbm2h   1/1       Running             0          5d</span><br><span class=\"line\">kube-dns-2924299975-phn03         0/4       ContainerCreating   0          5d</span><br><span class=\"line\">kube-proxy-081gt                  1/1       Running             0          5d</span><br><span class=\"line\">kube-proxy-qc40l                  1/1       Running             0          1h</span><br><span class=\"line\">kube-scheduler-master             1/1       Running             1          5d</span><br><span class=\"line\">weave-net-4wvkm                   0/2       ContainerCreating   0          30s</span><br><span class=\"line\">weave-net-l7dh0                   0/2       ContainerCreating   0          30s</span><br></pre></td></tr></table></figure>\n<h2 id=\"Dashboard\"><a href=\"#Dashboard\" class=\"headerlink\" title=\"Dashboard\"></a>Dashboard</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml -o kubernetes-dashboard.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">'s/v1.5.1/v1.5.0/g'</span> kubernetes-dashboard.yaml <span class=\"comment\"># 注意此时gcr上面并没有v1.5.1</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/Alaways/IfNotPresent/g'</span> kubernetes-dashboard.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl create -f kubernetes-dashboard.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"Delete-Pod\"><a href=\"#Delete-Pod\" class=\"headerlink\" title=\"Delete Pod\"></a>Delete Pod</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f xxx.yaml</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"MEOW\"><a href=\"#MEOW\" class=\"headerlink\" title=\"MEOW\"></a>MEOW</h2><p>安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L git.io/meowproxy | bash</span><br><span class=\"line\"><span class=\"comment\"># 建议安装目录 /usr/bin/</span></span><br></pre></td></tr></table></figure>\n<p>复制自己的配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># in local computer</span></span><br><span class=\"line\">xclip -sel clipboard &lt; ~/.meow/rc</span><br><span class=\"line\"><span class=\"comment\"># in CentOS server</span></span><br><span class=\"line\">mv ~/.meow/rc ~/.meow/rc.bak</span><br><span class=\"line\">xclip -o -sel clipboard &gt; ~/.meow/rc</span><br></pre></td></tr></table></figure>","more":"<p>运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MEOW</span><br></pre></td></tr></table></figure>\n<h2 id=\"Hostname\"><a href=\"#Hostname\" class=\"headerlink\" title=\"Hostname\"></a>Hostname</h2><p>执行下面脚本。<strong>不要执行多次</strong> 如果出错则手动修改</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i s/localhost\\.localdomain/NAME/g /etc/hosts /etc/hostname </span><br><span class=\"line\">hostname=<span class=\"string\">\"10-10-103-144.node\"</span></span><br><span class=\"line\">rm -rf /etc/hostname</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$hostname</span> &gt; /etc/hostname </span><br><span class=\"line\">sed -i <span class=\"string\">\"s/\\slocalhost\\s/ localhost <span class=\"variable\">$hostname</span> /g\"</span> /etc/hosts</span><br><span class=\"line\">sysctl kernel.hostname=<span class=\"variable\">$hostname</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Screenfetch\"><a href=\"#Screenfetch\" class=\"headerlink\" title=\"Screenfetch\"></a>Screenfetch</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https://raw.githubusercontent.com/KittyKatt/screenFetch/master/screenfetch-dev -o /usr/bin/screenfetch</span><br></pre></td></tr></table></figure>\n<h2 id=\"AWK简述\"><a href=\"#AWK简述\" class=\"headerlink\" title=\"AWK简述\"></a>AWK简述</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -v var1=xxx BEGIN&#123;[something]&#125; [ifstatments or regex]&#123;something match the condition&#125;&#123;[always run]&#125;END&#123;[something]&#125;</span><br><span class=\"line\"><span class=\"comment\"># 支持if else,for,i++</span></span><br><span class=\"line\"><span class=\"comment\"># 支持数组（支持for in遍历，但是顺序会打乱）</span></span><br><span class=\"line\"><span class=\"comment\"># 最好的批量初始化的方式： </span></span><br><span class=\"line\">arr[<span class=\"string\">\"\"</span>]=0 <span class=\"comment\"># 批量设为0</span></span><br><span class=\"line\">str=<span class=\"string\">\"a b c\"</span>; split(str,arr[,<span class=\"string\">\" \"</span>]);<span class=\"comment\"># [\"a\",\"b\",\"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"加Kubernetes源\"><a href=\"#加Kubernetes源\" class=\"headerlink\" title=\"加Kubernetes源\"></a>加Kubernetes源</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class=\"line\">[kubernetes]</span><br><span class=\"line\">name=Kubernetes</span><br><span class=\"line\">baseurl=http://yum.kubernetes.io/repos/kubernetes-el7-x86_64</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">repo_gpgcheck=0</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装Kubernetes\"><a href=\"#安装Kubernetes\" class=\"headerlink\" title=\"安装Kubernetes\"></a>安装Kubernetes</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install docker kubelet kubeadm kubectl kubernetes-cni</span><br></pre></td></tr></table></figure>\n<h2 id=\"启动进程-amp-关闭防火墙\"><a href=\"#启动进程-amp-关闭防火墙\" class=\"headerlink\" title=\"启动进程&amp;关闭防火墙\"></a>启动进程&amp;关闭防火墙</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br><span class=\"line\">systemctl start kubelet</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> docker </span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> kubelet </span><br><span class=\"line\">systemctl stop firewalld</span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld</span><br></pre></td></tr></table></figure>\n<h2 id=\"Tear-Down-当kubeadm-init失败时执行\"><a href=\"#Tear-Down-当kubeadm-init失败时执行\" class=\"headerlink\" title=\"Tear Down(当kubeadm init失败时执行)\"></a>Tear Down(当kubeadm init失败时执行)</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm reset &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pull-Docker-Images\"><a href=\"#Pull-Docker-Images\" class=\"headerlink\" title=\"Pull Docker Images\"></a>Pull Docker Images</h2><p><strong>此方式十分艰难。后面可以通过代理直接安装。见Tech Log@1-12</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">declare</span> -a images=(</span><br><span class=\"line\">    <span class=\"string\">'dnsmasq-metrics-amd64:1.0'</span></span><br><span class=\"line\">    <span class=\"string\">'etcd-amd64:3.0.14-kubeadm'</span></span><br><span class=\"line\">    <span class=\"string\">'exechealthz-amd64:v1.2.0'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-apiserver-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-controller-manager-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-discovery-amd64:1.0'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-dnsmasq-amd64:1.4'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-proxy-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kube-scheduler-amd64:v1.5.1'</span></span><br><span class=\"line\">    <span class=\"string\">'kubedns-amd64:1.9'</span></span><br><span class=\"line\">    <span class=\"string\">'kubernetes-dashboard-amd64:v1.5.0'</span></span><br><span class=\"line\">    <span class=\"string\">'pause-amd64:3.0'</span></span><br><span class=\"line\"><span class=\"comment\">#   'weave-kube:1.8.1'</span></span><br><span class=\"line\"><span class=\"comment\">#   'weave-npc:1.8.1'</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">for</span> imageName <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;images[@]&#125;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">    docker pull stkevintan/<span class=\"variable\">$imageName</span></span><br><span class=\"line\">    docker tag stkevintan/<span class=\"variable\">$imageName</span> gcr.io/google_containers/<span class=\"variable\">$imageName</span></span><br><span class=\"line\">    docker rmi stkevintan/<span class=\"variable\">$imageName</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xclip -o -sel clipboard &gt; pull_docker</span><br><span class=\"line\">chmod +x pull_docker</span><br><span class=\"line\">./pull_docker</span><br></pre></td></tr></table></figure>\n<h2 id=\"初始化（Master）\"><a href=\"#初始化（Master）\" class=\"headerlink\" title=\"初始化（Master）\"></a>初始化（Master）</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 首先需要使用@17-1-3的脚本设置代理。</span></span><br><span class=\"line\"><span class=\"comment\"># Del environment</span></span><br><span class=\"line\"><span class=\"comment\"># Set curl</span></span><br><span class=\"line\"><span class=\"comment\"># Set kube env</span></span><br><span class=\"line\"><span class=\"comment\"># Set docker</span></span><br><span class=\"line\"><span class=\"comment\"># 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io</span></span><br><span class=\"line\">root@10-10-103-144 ~ $ kubeadm init</span><br><span class=\"line\">[kubeadm] WARNING: kubeadm is <span class=\"keyword\">in</span> alpha, please <span class=\"keyword\">do</span> not use it <span class=\"keyword\">for</span> production clusters.</span><br><span class=\"line\">[preflight] Running pre-flight checks</span><br><span class=\"line\">[init] Using Kubernetes version: v1.5.2</span><br><span class=\"line\">[tokens] Generated token: <span class=\"string\">\"c30875.954dc1dda4d0184b\"</span></span><br><span class=\"line\">[certificates] Generated Certificate Authority key and certificate.</span><br><span class=\"line\">[certificates] Generated API Server key and certificate</span><br><span class=\"line\">[certificates] Generated Service Account signing keys</span><br><span class=\"line\">[certificates] Created keys and certificates <span class=\"keyword\">in</span> <span class=\"string\">\"/etc/kubernetes/pki\"</span></span><br><span class=\"line\">[kubeconfig] Wrote KubeConfig file to disk: <span class=\"string\">\"/etc/kubernetes/kubelet.conf\"</span></span><br><span class=\"line\">[kubeconfig] Wrote KubeConfig file to disk: <span class=\"string\">\"/etc/kubernetes/admin.conf\"</span></span><br><span class=\"line\">[apiclient] Created API client, waiting <span class=\"keyword\">for</span> the control plane to become ready</span><br><span class=\"line\">[apiclient] All control plane components are healthy after 16.391731 seconds</span><br><span class=\"line\">[apiclient] Waiting <span class=\"keyword\">for</span> at least one node to register and become ready</span><br><span class=\"line\">[apiclient] First node is ready after 0.509209 seconds</span><br><span class=\"line\">[apiclient] Creating a <span class=\"built_in\">test</span> deployment</span><br><span class=\"line\">[apiclient] Test deployment succeeded</span><br><span class=\"line\">[token-discovery] Created the kube-discovery deployment, waiting <span class=\"keyword\">for</span> it to become ready</span><br><span class=\"line\">[token-discovery] kube-discovery is ready after 3.505676 seconds</span><br><span class=\"line\">[addons] Created essential addon: kube-proxy</span><br><span class=\"line\">[addons] Created essential addon: kube-dns</span><br><span class=\"line\"></span><br><span class=\"line\">Your Kubernetes master has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run <span class=\"string\">\"kubectl apply -f [podnetwork].yaml\"</span> with one of the options listed at:</span><br><span class=\"line\">    http://kubernetes.io/docs/admin/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">You can now join any number of machines by running the following on each node:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join --token=c30875.954dc1dda4d0184b 10.10.103.144</span><br></pre></td></tr></table></figure>\n<h2 id=\"初始化（Node）\"><a href=\"#初始化（Node）\" class=\"headerlink\" title=\"初始化（Node）\"></a>初始化（Node）</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 需要在子节点上安装kubelet kubectl kubernetes-cni kubeadm</span></span><br><span class=\"line\"><span class=\"comment\"># 需要使用@17-1-3的脚本设置代理。</span></span><br><span class=\"line\"><span class=\"comment\"># Del environment</span></span><br><span class=\"line\"><span class=\"comment\"># Set curl</span></span><br><span class=\"line\"><span class=\"comment\"># Set kube env</span></span><br><span class=\"line\"><span class=\"comment\"># Set docker</span></span><br><span class=\"line\"><span class=\"comment\"># 在/etc/default/docker的DOCKER_OPTS中加入:--insecure-registry gcr.io</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> kubelet</span><br><span class=\"line\">systemctl start kubelet</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join --token=ace10c.73fcdec44f7a4045 10.10.103.146</span><br></pre></td></tr></table></figure>\n<p>可以在master节点上看到该子节点：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@master ~ $ kubectl get node</span><br><span class=\"line\">NAME      STATUS         AGE</span><br><span class=\"line\">master    Ready,master   5d</span><br><span class=\"line\">node1     Ready          1m</span><br></pre></td></tr></table></figure>\n<h2 id=\"Weave-Network\"><a href=\"#Weave-Network\" class=\"headerlink\" title=\"Weave Network\"></a>Weave Network</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># download config file</span></span><br><span class=\"line\">curl -L https://git.io/weave-kube -o weave-kube.yaml</span><br><span class=\"line\"><span class=\"comment\"># pull docker image</span></span><br><span class=\"line\">docker pull stkevintan/weave-kube:1.8.1</span><br><span class=\"line\">docker tag stkevintan/weave-kube:1.8.1 weaveworks/weave-kube:1.8.1</span><br><span class=\"line\">docker rmi stkevintan/weave-kube:1.8.1</span><br><span class=\"line\"><span class=\"comment\"># create</span></span><br><span class=\"line\">kubectl create -f weave-kube.yaml</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">kubectl create -f https://git.io/weave-kube</span><br></pre></td></tr></table></figure>\n<p>可以看到结果：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@master ~ $ kubectl get pod --namespace=kube-system</span><br><span class=\"line\">NAME                              READY     STATUS              RESTARTS   AGE</span><br><span class=\"line\">dummy-2088944543-bv5gj            1/1       Running             0          5d</span><br><span class=\"line\">etcd-master                       1/1       Running             0          5d</span><br><span class=\"line\">kube-apiserver-master             1/1       Running             27         5d</span><br><span class=\"line\">kube-controller-manager-master    1/1       Running             0          5d</span><br><span class=\"line\">kube-discovery-1769846148-xbm2h   1/1       Running             0          5d</span><br><span class=\"line\">kube-dns-2924299975-phn03         0/4       ContainerCreating   0          5d</span><br><span class=\"line\">kube-proxy-081gt                  1/1       Running             0          5d</span><br><span class=\"line\">kube-proxy-qc40l                  1/1       Running             0          1h</span><br><span class=\"line\">kube-scheduler-master             1/1       Running             1          5d</span><br><span class=\"line\">weave-net-4wvkm                   0/2       ContainerCreating   0          30s</span><br><span class=\"line\">weave-net-l7dh0                   0/2       ContainerCreating   0          30s</span><br></pre></td></tr></table></figure>\n<h2 id=\"Dashboard\"><a href=\"#Dashboard\" class=\"headerlink\" title=\"Dashboard\"></a>Dashboard</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml -o kubernetes-dashboard.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">'s/v1.5.1/v1.5.0/g'</span> kubernetes-dashboard.yaml <span class=\"comment\"># 注意此时gcr上面并没有v1.5.1</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/Alaways/IfNotPresent/g'</span> kubernetes-dashboard.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl create -f kubernetes-dashboard.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"Delete-Pod\"><a href=\"#Delete-Pod\" class=\"headerlink\" title=\"Delete Pod\"></a>Delete Pod</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f xxx.yaml</span><br></pre></td></tr></table></figure>"},{"title":"Pandorabox之透明代理","date":"2017-02-06T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n![enter description here][1]\n先修改Lan接口，避免在无线中继的时候发生本地Lan接口与wwan接口发生冲突导致无法登陆路由器。\n\n`网络 -> Lan -> IPv4地址， 设置为 192.168.33.1`更改之后需要重新连接一下网络。\n\n透明代理使用`shadowsocks-libev`和`ChinDNS`实现。使用ssh登陆路由器，安装所需软件。\n\n```bash\nssh root@192.168.33.1\nopkg update\nopkg install shadowsocks-libev luci-app-shadowsocks ChinaDNS luci-app-chinadns --force-checksum\n```\n\n这个版本的软件源有点问题，所以直接`opkg install`基本上都过不了`sha256sum`检测，所以需要加上`--force-checksum`参数强制忽略。两个luci界面都有zh-cn汉化包，为了节省路由器空间，就不装了。\n<!--more-->\n默认的chnroute表很老了，需要更新：\n\n```bash\nmv /etc/chnroute.txt /etc/chnroute.txt.bak\nwget -O- 'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest' | awk -F\\| '/CN\\|ipv4/ { printf(\"%s/%d\\n\", $4, 32-log($5)/log(2)) }' > /etc/chnroute.txt\n# 如果没有问题\nrm -rf /etc/chnroute.txt.bak\n```\n\n然后我们需要对其进行启用。\n\nshadowsocks需要启动`ss-redir`来实现透明代理和`ss-tunnel`来实现UDP转发保证国外DNS查询不被污染。下面是具体需要注意的配置。\n\n### SS-tunnel\n\n```json\n{\n  \"UDP Local Port\": 1153,\n  \"Forwarding Tunnel\": 8.8.8.8:53\n}\n```\n\n### ChinaDNS\n\n```javascript\n{\n  \"Enable DNS compression pointer\": true,\n  \"Local Port\": 1053, //不能与ss-tunnel冲突 \n  \"CHNRoute File\": \"/etc/chnroute.txt\",\n  \"Upstream Servers\": \"223.5.5.5,127.0.0.1:1153\" //第一个是国内阿里DNS服务器，第二个是进过ss-tunnel转发后的Google DNS服务器\n}\n```\n\n## DHCP/DNS\n\n最后需要在`网络->DHCP/DNS->服务器设置`修改默认的DNS配置\n\n```javascript\n{\n  \"本地服务器\": \"127.0.0.1#1053\", //ChinaDNS处理后的DNS服务器，可以根据ip分流。\n  \"忽略解析文件\": true\n}\n```\n\n总的来说，GoogleDNS(8.8.8.8:53)首先进过ss-tunnel转发到本地的`127.0.0.1:1153`上，然后通过ChinaDNS与国内DNS服务器融合成新的`127.0.0.1:1053` 实现了国内外分流。\n\n## Update\n由于实用过程中还是经常不稳定，决定采用DNS-Forwarder方案。\n然而，官方并没有我的小米Mini路由架构的二进制包，只能自己动手丰衣足食了。\n\n### OpenWrt SDK\n首先明确小米路由器Mini的架构是ramips/mt7620a而现在运行的Pandorabox 16.10基于Openwrt Barrier Breaker。\n\n### 依赖\n```bash\nsudo apt-get install git-core build-essential libssl-dev libncurses5-dev unzip gawk zlib1g-dev subversion mercurial\n```\n### 下载&编译\n```bash \ncurl https://downloads.openwrt.org/barrier_breaker/14.07/ramips/mt7620a/OpenWrt-SDK-ramips-for-linux-x86_64-gcc-4.8-linaro_uClibc-0.9.33.2.tar.bz2 | tar -xjf \ncd OpenWrt-SDK-*\ngit clone https://github.com/aa65535/openwrt-dns-forwarder.git package/dns-forwarder # 获取Makefile\nmake menuconfig # 选择要编译的包： Network -> dns-forwarder\nmake package/dns-forwarder/compile V=99\n```\n然而，愿景很好，但是在我的Deepin上`make menuconfig`这步就出错，想想`barrier_breaker`也是很久之前的版本了，出错大概是`ldxxxx`，感觉应该是GCC版本不兼容的缘故，然而Deepin上GCC只有6.2.0没有官方要求的4.8，怎么办呢？当时暂时想到下面几条解决方案\n1. 在自己电脑上重新编译一份GCC4.8： 太麻烦，而且还不能保证一定能成功。\n2. 用虚拟机装老版本的Ubuntu： 太浪费时间了，本身电脑BIOS就没有开启虚拟化支持。\n3. docker? 不错可以试一下。\n\ndocker运行老版本ubuntu镜像不用太简单，一条命令搞定：\n```bash\n sudo docker run -t -i ubuntu:12.04.5 /bin/bash\n```\n\n然而docker版本的ubuntu太过于精简了,需要配置一下：\n```bash\n# 安装缺失依赖\napt-get install ccache curl\n# openwrt-sdk 编译不能以root用户进行，需要新建一个普通用户\nuseradd kevin\nsu kevin\n# 继续之前的编译步骤\n```\n\n好了，终于编译成功了，然而还是高兴的太早，仍然报错：\n```bash\n* pkg_hash_fetch_best_installation_candidate: Packages for helloworld found, but incompatible with the architectures configured\n```\n还是求助于Google，然后发现了这篇博客：[小米路由器mini折腾之配置opkg篇](https://blog.phpgao.com/xiaomi_router_opkg.html)，于是我的路由器就成砖了。hhhhhhhhh\n\n未完待续。。。。。。。。。。。。。。\n\n## 2017-8-15 update\n拿去店里救砖成功。刷了不死breed，但是现在反而没有什么折腾劲了。\n\n  [1]: https://ol1kreips.qnssl.com/PandoraBox.png \"PandoraBox.png\"\n","source":"_posts/Pandorabox-transparent-proxy.md","raw":"---\ntitle: Pandorabox之透明代理 \ndate: 2017-2-7\ncategories: [Openwrt]\ntags: [路由器,科学上网,Shadowsocks,ChinaDNS]\ngrammar_cjkRuby: true\n---\n\n![enter description here][1]\n先修改Lan接口，避免在无线中继的时候发生本地Lan接口与wwan接口发生冲突导致无法登陆路由器。\n\n`网络 -> Lan -> IPv4地址， 设置为 192.168.33.1`更改之后需要重新连接一下网络。\n\n透明代理使用`shadowsocks-libev`和`ChinDNS`实现。使用ssh登陆路由器，安装所需软件。\n\n```bash\nssh root@192.168.33.1\nopkg update\nopkg install shadowsocks-libev luci-app-shadowsocks ChinaDNS luci-app-chinadns --force-checksum\n```\n\n这个版本的软件源有点问题，所以直接`opkg install`基本上都过不了`sha256sum`检测，所以需要加上`--force-checksum`参数强制忽略。两个luci界面都有zh-cn汉化包，为了节省路由器空间，就不装了。\n<!--more-->\n默认的chnroute表很老了，需要更新：\n\n```bash\nmv /etc/chnroute.txt /etc/chnroute.txt.bak\nwget -O- 'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest' | awk -F\\| '/CN\\|ipv4/ { printf(\"%s/%d\\n\", $4, 32-log($5)/log(2)) }' > /etc/chnroute.txt\n# 如果没有问题\nrm -rf /etc/chnroute.txt.bak\n```\n\n然后我们需要对其进行启用。\n\nshadowsocks需要启动`ss-redir`来实现透明代理和`ss-tunnel`来实现UDP转发保证国外DNS查询不被污染。下面是具体需要注意的配置。\n\n### SS-tunnel\n\n```json\n{\n  \"UDP Local Port\": 1153,\n  \"Forwarding Tunnel\": 8.8.8.8:53\n}\n```\n\n### ChinaDNS\n\n```javascript\n{\n  \"Enable DNS compression pointer\": true,\n  \"Local Port\": 1053, //不能与ss-tunnel冲突 \n  \"CHNRoute File\": \"/etc/chnroute.txt\",\n  \"Upstream Servers\": \"223.5.5.5,127.0.0.1:1153\" //第一个是国内阿里DNS服务器，第二个是进过ss-tunnel转发后的Google DNS服务器\n}\n```\n\n## DHCP/DNS\n\n最后需要在`网络->DHCP/DNS->服务器设置`修改默认的DNS配置\n\n```javascript\n{\n  \"本地服务器\": \"127.0.0.1#1053\", //ChinaDNS处理后的DNS服务器，可以根据ip分流。\n  \"忽略解析文件\": true\n}\n```\n\n总的来说，GoogleDNS(8.8.8.8:53)首先进过ss-tunnel转发到本地的`127.0.0.1:1153`上，然后通过ChinaDNS与国内DNS服务器融合成新的`127.0.0.1:1053` 实现了国内外分流。\n\n## Update\n由于实用过程中还是经常不稳定，决定采用DNS-Forwarder方案。\n然而，官方并没有我的小米Mini路由架构的二进制包，只能自己动手丰衣足食了。\n\n### OpenWrt SDK\n首先明确小米路由器Mini的架构是ramips/mt7620a而现在运行的Pandorabox 16.10基于Openwrt Barrier Breaker。\n\n### 依赖\n```bash\nsudo apt-get install git-core build-essential libssl-dev libncurses5-dev unzip gawk zlib1g-dev subversion mercurial\n```\n### 下载&编译\n```bash \ncurl https://downloads.openwrt.org/barrier_breaker/14.07/ramips/mt7620a/OpenWrt-SDK-ramips-for-linux-x86_64-gcc-4.8-linaro_uClibc-0.9.33.2.tar.bz2 | tar -xjf \ncd OpenWrt-SDK-*\ngit clone https://github.com/aa65535/openwrt-dns-forwarder.git package/dns-forwarder # 获取Makefile\nmake menuconfig # 选择要编译的包： Network -> dns-forwarder\nmake package/dns-forwarder/compile V=99\n```\n然而，愿景很好，但是在我的Deepin上`make menuconfig`这步就出错，想想`barrier_breaker`也是很久之前的版本了，出错大概是`ldxxxx`，感觉应该是GCC版本不兼容的缘故，然而Deepin上GCC只有6.2.0没有官方要求的4.8，怎么办呢？当时暂时想到下面几条解决方案\n1. 在自己电脑上重新编译一份GCC4.8： 太麻烦，而且还不能保证一定能成功。\n2. 用虚拟机装老版本的Ubuntu： 太浪费时间了，本身电脑BIOS就没有开启虚拟化支持。\n3. docker? 不错可以试一下。\n\ndocker运行老版本ubuntu镜像不用太简单，一条命令搞定：\n```bash\n sudo docker run -t -i ubuntu:12.04.5 /bin/bash\n```\n\n然而docker版本的ubuntu太过于精简了,需要配置一下：\n```bash\n# 安装缺失依赖\napt-get install ccache curl\n# openwrt-sdk 编译不能以root用户进行，需要新建一个普通用户\nuseradd kevin\nsu kevin\n# 继续之前的编译步骤\n```\n\n好了，终于编译成功了，然而还是高兴的太早，仍然报错：\n```bash\n* pkg_hash_fetch_best_installation_candidate: Packages for helloworld found, but incompatible with the architectures configured\n```\n还是求助于Google，然后发现了这篇博客：[小米路由器mini折腾之配置opkg篇](https://blog.phpgao.com/xiaomi_router_opkg.html)，于是我的路由器就成砖了。hhhhhhhhh\n\n未完待续。。。。。。。。。。。。。。\n\n## 2017-8-15 update\n拿去店里救砖成功。刷了不死breed，但是现在反而没有什么折腾劲了。\n\n  [1]: https://ol1kreips.qnssl.com/PandoraBox.png \"PandoraBox.png\"\n","slug":"Pandorabox-transparent-proxy","published":1,"updated":"2019-10-11T05:50:15.645Z","_id":"ciz5e9l05000h5rgx0f0d2u3l","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"https://ol1kreips.qnssl.com/PandoraBox.png\" alt=\"enter description here\" title=\"PandoraBox.png\"><br>先修改Lan接口，避免在无线中继的时候发生本地Lan接口与wwan接口发生冲突导致无法登陆路由器。</p>\n<p><code>网络 -&gt; Lan -&gt; IPv4地址， 设置为 192.168.33.1</code>更改之后需要重新连接一下网络。</p>\n<p>透明代理使用<code>shadowsocks-libev</code>和<code>ChinDNS</code>实现。使用ssh登陆路由器，安装所需软件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh root@192.168.33.1</span><br><span class=\"line\">opkg update</span><br><span class=\"line\">opkg install shadowsocks-libev luci-app-shadowsocks ChinaDNS luci-app-chinadns --force-checksum</span><br></pre></td></tr></table></figure>\n<p>这个版本的软件源有点问题，所以直接<code>opkg install</code>基本上都过不了<code>sha256sum</code>检测，所以需要加上<code>--force-checksum</code>参数强制忽略。两个luci界面都有zh-cn汉化包，为了节省路由器空间，就不装了。<br><a id=\"more\"></a><br>默认的chnroute表很老了，需要更新：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /etc/chnroute.txt /etc/chnroute.txt.bak</span><br><span class=\"line\">wget -O- <span class=\"string\">'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest'</span> | awk -F\\| <span class=\"string\">'/CN\\|ipv4/ &#123; printf(\"%s/%d\\n\", $4, 32-log($5)/log(2)) &#125;'</span> &gt; /etc/chnroute.txt</span><br><span class=\"line\"><span class=\"comment\"># 如果没有问题</span></span><br><span class=\"line\">rm -rf /etc/chnroute.txt.bak</span><br></pre></td></tr></table></figure>\n<p>然后我们需要对其进行启用。</p>\n<p>shadowsocks需要启动<code>ss-redir</code>来实现透明代理和<code>ss-tunnel</code>来实现UDP转发保证国外DNS查询不被污染。下面是具体需要注意的配置。</p>\n<h3 id=\"SS-tunnel\"><a href=\"#SS-tunnel\" class=\"headerlink\" title=\"SS-tunnel\"></a>SS-tunnel</h3><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"UDP Local Port\"</span>: <span class=\"number\">1153</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"Forwarding Tunnel\"</span>: <span class=\"number\">8.8</span><span class=\"number\">.8</span><span class=\"number\">.8</span>:<span class=\"number\">53</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ChinaDNS\"><a href=\"#ChinaDNS\" class=\"headerlink\" title=\"ChinaDNS\"></a>ChinaDNS</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"Enable DNS compression pointer\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">\"Local Port\"</span>: <span class=\"number\">1053</span>, <span class=\"comment\">//不能与ss-tunnel冲突 </span></span><br><span class=\"line\">  <span class=\"string\">\"CHNRoute File\"</span>: <span class=\"string\">\"/etc/chnroute.txt\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"Upstream Servers\"</span>: <span class=\"string\">\"223.5.5.5,127.0.0.1:1153\"</span> <span class=\"comment\">//第一个是国内阿里DNS服务器，第二个是进过ss-tunnel转发后的Google DNS服务器</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"DHCP-DNS\"><a href=\"#DHCP-DNS\" class=\"headerlink\" title=\"DHCP/DNS\"></a>DHCP/DNS</h2><p>最后需要在<code>网络-&gt;DHCP/DNS-&gt;服务器设置</code>修改默认的DNS配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"本地服务器\"</span>: <span class=\"string\">\"127.0.0.1#1053\"</span>, <span class=\"comment\">//ChinaDNS处理后的DNS服务器，可以根据ip分流。</span></span><br><span class=\"line\">  <span class=\"string\">\"忽略解析文件\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>总的来说，GoogleDNS(8.8.8.8:53)首先进过ss-tunnel转发到本地的<code>127.0.0.1:1153</code>上，然后通过ChinaDNS与国内DNS服务器融合成新的<code>127.0.0.1:1053</code> 实现了国内外分流。</p>\n<h2 id=\"Update\"><a href=\"#Update\" class=\"headerlink\" title=\"Update\"></a>Update</h2><p>由于实用过程中还是经常不稳定，决定采用DNS-Forwarder方案。<br>然而，官方并没有我的小米Mini路由架构的二进制包，只能自己动手丰衣足食了。</p>\n<h3 id=\"OpenWrt-SDK\"><a href=\"#OpenWrt-SDK\" class=\"headerlink\" title=\"OpenWrt SDK\"></a>OpenWrt SDK</h3><p>首先明确小米路由器Mini的架构是ramips/mt7620a而现在运行的Pandorabox 16.10基于Openwrt Barrier Breaker。</p>\n<h3 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install git-core build-essential libssl-dev libncurses5-dev unzip gawk zlib1g-dev subversion mercurial</span><br></pre></td></tr></table></figure>\n<h3 id=\"下载-amp-编译\"><a href=\"#下载-amp-编译\" class=\"headerlink\" title=\"下载&amp;编译\"></a>下载&amp;编译</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://downloads.openwrt.org/barrier_breaker/14.07/ramips/mt7620a/OpenWrt-SDK-ramips-for-linux-x86_64-gcc-4.8-linaro_uClibc-0.9.33.2.tar.bz2 | tar -xjf </span><br><span class=\"line\"><span class=\"built_in\">cd</span> OpenWrt-SDK-*</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/aa65535/openwrt-dns-forwarder.git package/dns-forwarder <span class=\"comment\"># 获取Makefile</span></span><br><span class=\"line\">make menuconfig <span class=\"comment\"># 选择要编译的包： Network -&gt; dns-forwarder</span></span><br><span class=\"line\">make package/dns-forwarder/compile V=99</span><br></pre></td></tr></table></figure>\n<p>然而，愿景很好，但是在我的Deepin上<code>make menuconfig</code>这步就出错，想想<code>barrier_breaker</code>也是很久之前的版本了，出错大概是<code>ldxxxx</code>，感觉应该是GCC版本不兼容的缘故，然而Deepin上GCC只有6.2.0没有官方要求的4.8，怎么办呢？当时暂时想到下面几条解决方案</p>\n<ol>\n<li>在自己电脑上重新编译一份GCC4.8： 太麻烦，而且还不能保证一定能成功。</li>\n<li>用虚拟机装老版本的Ubuntu： 太浪费时间了，本身电脑BIOS就没有开启虚拟化支持。</li>\n<li>docker? 不错可以试一下。</li>\n</ol>\n<p>docker运行老版本ubuntu镜像不用太简单，一条命令搞定：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -t -i ubuntu:12.04.5 /bin/bash</span><br></pre></td></tr></table></figure></p>\n<p>然而docker版本的ubuntu太过于精简了,需要配置一下：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装缺失依赖</span></span><br><span class=\"line\">apt-get install ccache curl</span><br><span class=\"line\"><span class=\"comment\"># openwrt-sdk 编译不能以root用户进行，需要新建一个普通用户</span></span><br><span class=\"line\">useradd kevin</span><br><span class=\"line\">su kevin</span><br><span class=\"line\"><span class=\"comment\"># 继续之前的编译步骤</span></span><br></pre></td></tr></table></figure></p>\n<p>好了，终于编译成功了，然而还是高兴的太早，仍然报错：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* pkg_hash_fetch_best_installation_candidate: Packages <span class=\"keyword\">for</span> helloworld found, but incompatible with the architectures configured</span><br></pre></td></tr></table></figure></p>\n<p>还是求助于Google，然后发现了这篇博客：<a href=\"https://blog.phpgao.com/xiaomi_router_opkg.html\" target=\"_blank\" rel=\"noopener\">小米路由器mini折腾之配置opkg篇</a>，于是我的路由器就成砖了。hhhhhhhhh</p>\n<p>未完待续。。。。。。。。。。。。。。</p>\n<h2 id=\"2017-8-15-update\"><a href=\"#2017-8-15-update\" class=\"headerlink\" title=\"2017-8-15 update\"></a>2017-8-15 update</h2><p>拿去店里救砖成功。刷了不死breed，但是现在反而没有什么折腾劲了。</p>\n","site":{"data":{}},"excerpt":"<p><img src=\"https://ol1kreips.qnssl.com/PandoraBox.png\" alt=\"enter description here\" title=\"PandoraBox.png\"><br>先修改Lan接口，避免在无线中继的时候发生本地Lan接口与wwan接口发生冲突导致无法登陆路由器。</p>\n<p><code>网络 -&gt; Lan -&gt; IPv4地址， 设置为 192.168.33.1</code>更改之后需要重新连接一下网络。</p>\n<p>透明代理使用<code>shadowsocks-libev</code>和<code>ChinDNS</code>实现。使用ssh登陆路由器，安装所需软件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh root@192.168.33.1</span><br><span class=\"line\">opkg update</span><br><span class=\"line\">opkg install shadowsocks-libev luci-app-shadowsocks ChinaDNS luci-app-chinadns --force-checksum</span><br></pre></td></tr></table></figure>\n<p>这个版本的软件源有点问题，所以直接<code>opkg install</code>基本上都过不了<code>sha256sum</code>检测，所以需要加上<code>--force-checksum</code>参数强制忽略。两个luci界面都有zh-cn汉化包，为了节省路由器空间，就不装了。<br>","more":"<br>默认的chnroute表很老了，需要更新：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /etc/chnroute.txt /etc/chnroute.txt.bak</span><br><span class=\"line\">wget -O- <span class=\"string\">'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest'</span> | awk -F\\| <span class=\"string\">'/CN\\|ipv4/ &#123; printf(\"%s/%d\\n\", $4, 32-log($5)/log(2)) &#125;'</span> &gt; /etc/chnroute.txt</span><br><span class=\"line\"><span class=\"comment\"># 如果没有问题</span></span><br><span class=\"line\">rm -rf /etc/chnroute.txt.bak</span><br></pre></td></tr></table></figure>\n<p>然后我们需要对其进行启用。</p>\n<p>shadowsocks需要启动<code>ss-redir</code>来实现透明代理和<code>ss-tunnel</code>来实现UDP转发保证国外DNS查询不被污染。下面是具体需要注意的配置。</p>\n<h3 id=\"SS-tunnel\"><a href=\"#SS-tunnel\" class=\"headerlink\" title=\"SS-tunnel\"></a>SS-tunnel</h3><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"UDP Local Port\"</span>: <span class=\"number\">1153</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"Forwarding Tunnel\"</span>: <span class=\"number\">8.8</span><span class=\"number\">.8</span><span class=\"number\">.8</span>:<span class=\"number\">53</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ChinaDNS\"><a href=\"#ChinaDNS\" class=\"headerlink\" title=\"ChinaDNS\"></a>ChinaDNS</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"Enable DNS compression pointer\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">\"Local Port\"</span>: <span class=\"number\">1053</span>, <span class=\"comment\">//不能与ss-tunnel冲突 </span></span><br><span class=\"line\">  <span class=\"string\">\"CHNRoute File\"</span>: <span class=\"string\">\"/etc/chnroute.txt\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"Upstream Servers\"</span>: <span class=\"string\">\"223.5.5.5,127.0.0.1:1153\"</span> <span class=\"comment\">//第一个是国内阿里DNS服务器，第二个是进过ss-tunnel转发后的Google DNS服务器</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"DHCP-DNS\"><a href=\"#DHCP-DNS\" class=\"headerlink\" title=\"DHCP/DNS\"></a>DHCP/DNS</h2><p>最后需要在<code>网络-&gt;DHCP/DNS-&gt;服务器设置</code>修改默认的DNS配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"本地服务器\"</span>: <span class=\"string\">\"127.0.0.1#1053\"</span>, <span class=\"comment\">//ChinaDNS处理后的DNS服务器，可以根据ip分流。</span></span><br><span class=\"line\">  <span class=\"string\">\"忽略解析文件\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>总的来说，GoogleDNS(8.8.8.8:53)首先进过ss-tunnel转发到本地的<code>127.0.0.1:1153</code>上，然后通过ChinaDNS与国内DNS服务器融合成新的<code>127.0.0.1:1053</code> 实现了国内外分流。</p>\n<h2 id=\"Update\"><a href=\"#Update\" class=\"headerlink\" title=\"Update\"></a>Update</h2><p>由于实用过程中还是经常不稳定，决定采用DNS-Forwarder方案。<br>然而，官方并没有我的小米Mini路由架构的二进制包，只能自己动手丰衣足食了。</p>\n<h3 id=\"OpenWrt-SDK\"><a href=\"#OpenWrt-SDK\" class=\"headerlink\" title=\"OpenWrt SDK\"></a>OpenWrt SDK</h3><p>首先明确小米路由器Mini的架构是ramips/mt7620a而现在运行的Pandorabox 16.10基于Openwrt Barrier Breaker。</p>\n<h3 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install git-core build-essential libssl-dev libncurses5-dev unzip gawk zlib1g-dev subversion mercurial</span><br></pre></td></tr></table></figure>\n<h3 id=\"下载-amp-编译\"><a href=\"#下载-amp-编译\" class=\"headerlink\" title=\"下载&amp;编译\"></a>下载&amp;编译</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://downloads.openwrt.org/barrier_breaker/14.07/ramips/mt7620a/OpenWrt-SDK-ramips-for-linux-x86_64-gcc-4.8-linaro_uClibc-0.9.33.2.tar.bz2 | tar -xjf </span><br><span class=\"line\"><span class=\"built_in\">cd</span> OpenWrt-SDK-*</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/aa65535/openwrt-dns-forwarder.git package/dns-forwarder <span class=\"comment\"># 获取Makefile</span></span><br><span class=\"line\">make menuconfig <span class=\"comment\"># 选择要编译的包： Network -&gt; dns-forwarder</span></span><br><span class=\"line\">make package/dns-forwarder/compile V=99</span><br></pre></td></tr></table></figure>\n<p>然而，愿景很好，但是在我的Deepin上<code>make menuconfig</code>这步就出错，想想<code>barrier_breaker</code>也是很久之前的版本了，出错大概是<code>ldxxxx</code>，感觉应该是GCC版本不兼容的缘故，然而Deepin上GCC只有6.2.0没有官方要求的4.8，怎么办呢？当时暂时想到下面几条解决方案</p>\n<ol>\n<li>在自己电脑上重新编译一份GCC4.8： 太麻烦，而且还不能保证一定能成功。</li>\n<li>用虚拟机装老版本的Ubuntu： 太浪费时间了，本身电脑BIOS就没有开启虚拟化支持。</li>\n<li>docker? 不错可以试一下。</li>\n</ol>\n<p>docker运行老版本ubuntu镜像不用太简单，一条命令搞定：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -t -i ubuntu:12.04.5 /bin/bash</span><br></pre></td></tr></table></figure></p>\n<p>然而docker版本的ubuntu太过于精简了,需要配置一下：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装缺失依赖</span></span><br><span class=\"line\">apt-get install ccache curl</span><br><span class=\"line\"><span class=\"comment\"># openwrt-sdk 编译不能以root用户进行，需要新建一个普通用户</span></span><br><span class=\"line\">useradd kevin</span><br><span class=\"line\">su kevin</span><br><span class=\"line\"><span class=\"comment\"># 继续之前的编译步骤</span></span><br></pre></td></tr></table></figure></p>\n<p>好了，终于编译成功了，然而还是高兴的太早，仍然报错：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* pkg_hash_fetch_best_installation_candidate: Packages <span class=\"keyword\">for</span> helloworld found, but incompatible with the architectures configured</span><br></pre></td></tr></table></figure></p>\n<p>还是求助于Google，然后发现了这篇博客：<a href=\"https://blog.phpgao.com/xiaomi_router_opkg.html\" target=\"_blank\" rel=\"noopener\">小米路由器mini折腾之配置opkg篇</a>，于是我的路由器就成砖了。hhhhhhhhh</p>\n<p>未完待续。。。。。。。。。。。。。。</p>\n<h2 id=\"2017-8-15-update\"><a href=\"#2017-8-15-update\" class=\"headerlink\" title=\"2017-8-15 update\"></a>2017-8-15 update</h2><p>拿去店里救砖成功。刷了不死breed，但是现在反而没有什么折腾劲了。</p>"},{"title":"ACM International Collegiate Programming Contest Asia Regional Contest, Tokyo Problem D Space Golf","date":"2014-10-19T13:20:03.000Z","_content":"原题pdf：[click here](http://judge.u-aizu.ac.jp/onlinejudge/contest/ICPCOOC2014/D.pdf)\n<br/>\n\n- - -\n\n日本的亚洲区域赛真心简单啊。两个小时就刷了5题有余了。排名第一的队伍才做出7道。\n\n题目真心长的可以了，看了半个小时才明白。。\n\n题意其实也就是太空中向前方抛小球，问小球能够穿过N个障碍物后到达制定地点的最小初始速度是多少。非常暴力的模拟题。离散化后直接枚举弹跳的次数再取最小值即可。注意45°方向能成功的话，那还是45°最优。\n<!--more-->\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set::iterator\n#define VI(x) vector::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set::reverse_iterator\n#define VRI(x) vector::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define eps 1e-8\n/*start*/\nint d, n, b;\nPR ob[20];\nvector&lt;pair&lt;double, double&gt; &gt; vt;\npair&lt;double, double&gt; dpr;\ndouble a[2][2], e[2];\npair&lt;double, double&gt; Cramer(pair&lt;double, double&gt; dpr) {\n\tpair&lt;double, double&gt; res;\n\ta[1][0] = dpr.F * dpr.F;\n\ta[1][1] = dpr.F;\n\te[1] = dpr.S;\n\tdouble div = a[0][0] * a[1][1] - a[1][0] * a[0][1];\n\tres.F = (e[0] * a[1][1] - e[1] * a[0][1]) / div;\n\tres.S = (e[1] * a[0][0] - e[0] * a[1][0]) / div;\n\treturn res;\n}\nint main(int argc, char **argv) {\n\twhile (~scanf(\"%d%d%d\", &amp;d, &amp;n, &amp;b)) {\n\t\tfor (int i = 0; i &lt; n; i++) {\n\t\t\tscanf(\"%d%d\", &amp;ob[i].F, &amp;ob[i].S);\n\t\t}\n\t\tdouble ans = inf;\n\t\tfor (int c = 0; c &lt;= b; c++) {//enumerate the times bullet bounces the surface\n\t\t\tdouble dist = 1.0 * d / (c + 1);\n\t\t\tint f = 1;\n\t\t\ta[0][0] = dist * dist;\n\t\t\ta[0][1] = dist;\n\t\t\te[0] = 0;\n\t\t\tvt.clear();\n\t\t\tfor (int i = 0; i &lt; n; i++) {\n\t\t\t\tdpr = ob[i];\n\t\t\t\twhile (dpr.F + eps &gt;= dist) {\n\t\t\t\t\tdpr.F -= dist;\n\t\t\t\t}\n\t\t\t\tif (dpr.F &lt;= eps) {\n\t\t\t\t\tf = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tvt.push_back(dpr);\n\t\t\t}\n\t\t\tif (f == 0) continue;\n\t\t\tpair&lt;double, double&gt; res;   \n\t\t\tfor (int i = 0; i &lt; Sz(vt); i++) {\n\t\t\t\tdpr = vt[i];\n\t\t\t\tif (i == 0) {\n\t\t\t\t\tres = Cramer(dpr);\n\t\t\t\t} else {\n\t\t\t\t\tdouble tmph = dpr.F * dpr.F * res.F + dpr.F * res.S;\n\t\t\t\t\tif (tmph + eps &lt; dpr.S) {\n\t\t\t\t\t\tres = Cramer(dpr);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tres.F = -1.0 / (2 * res.F);\n\t\t\tres.S = res.F * res.S * res.S;\n\t\t\tans = min(ans, sqrt(res.F + res.S));\n                        //if the vector's angle is less than 45\n\t\t\tif (res.S + eps &lt; res.F) ans = min(ans, sqrt(dist));\n\t\t}\n\t\tprintf(\"%.5f\\n\", ans);\n\t}\n}\n```\n","source":"_posts/acm-international-collegiate-programming-contest-asia-regional-contest-tokyo-problem-d-space-golf.md","raw":"title: \"ACM International Collegiate Programming Contest Asia Regional Contest, Tokyo Problem D Space Golf\"\ncategories:\n  - ACM\ndate: 2014-10-19 21:20:03\ntags: 暴力\n---\n原题pdf：[click here](http://judge.u-aizu.ac.jp/onlinejudge/contest/ICPCOOC2014/D.pdf)\n<br/>\n\n- - -\n\n日本的亚洲区域赛真心简单啊。两个小时就刷了5题有余了。排名第一的队伍才做出7道。\n\n题目真心长的可以了，看了半个小时才明白。。\n\n题意其实也就是太空中向前方抛小球，问小球能够穿过N个障碍物后到达制定地点的最小初始速度是多少。非常暴力的模拟题。离散化后直接枚举弹跳的次数再取最小值即可。注意45°方向能成功的话，那还是45°最优。\n<!--more-->\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set::iterator\n#define VI(x) vector::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set::reverse_iterator\n#define VRI(x) vector::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define eps 1e-8\n/*start*/\nint d, n, b;\nPR ob[20];\nvector&lt;pair&lt;double, double&gt; &gt; vt;\npair&lt;double, double&gt; dpr;\ndouble a[2][2], e[2];\npair&lt;double, double&gt; Cramer(pair&lt;double, double&gt; dpr) {\n\tpair&lt;double, double&gt; res;\n\ta[1][0] = dpr.F * dpr.F;\n\ta[1][1] = dpr.F;\n\te[1] = dpr.S;\n\tdouble div = a[0][0] * a[1][1] - a[1][0] * a[0][1];\n\tres.F = (e[0] * a[1][1] - e[1] * a[0][1]) / div;\n\tres.S = (e[1] * a[0][0] - e[0] * a[1][0]) / div;\n\treturn res;\n}\nint main(int argc, char **argv) {\n\twhile (~scanf(\"%d%d%d\", &amp;d, &amp;n, &amp;b)) {\n\t\tfor (int i = 0; i &lt; n; i++) {\n\t\t\tscanf(\"%d%d\", &amp;ob[i].F, &amp;ob[i].S);\n\t\t}\n\t\tdouble ans = inf;\n\t\tfor (int c = 0; c &lt;= b; c++) {//enumerate the times bullet bounces the surface\n\t\t\tdouble dist = 1.0 * d / (c + 1);\n\t\t\tint f = 1;\n\t\t\ta[0][0] = dist * dist;\n\t\t\ta[0][1] = dist;\n\t\t\te[0] = 0;\n\t\t\tvt.clear();\n\t\t\tfor (int i = 0; i &lt; n; i++) {\n\t\t\t\tdpr = ob[i];\n\t\t\t\twhile (dpr.F + eps &gt;= dist) {\n\t\t\t\t\tdpr.F -= dist;\n\t\t\t\t}\n\t\t\t\tif (dpr.F &lt;= eps) {\n\t\t\t\t\tf = 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tvt.push_back(dpr);\n\t\t\t}\n\t\t\tif (f == 0) continue;\n\t\t\tpair&lt;double, double&gt; res;   \n\t\t\tfor (int i = 0; i &lt; Sz(vt); i++) {\n\t\t\t\tdpr = vt[i];\n\t\t\t\tif (i == 0) {\n\t\t\t\t\tres = Cramer(dpr);\n\t\t\t\t} else {\n\t\t\t\t\tdouble tmph = dpr.F * dpr.F * res.F + dpr.F * res.S;\n\t\t\t\t\tif (tmph + eps &lt; dpr.S) {\n\t\t\t\t\t\tres = Cramer(dpr);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tres.F = -1.0 / (2 * res.F);\n\t\t\tres.S = res.F * res.S * res.S;\n\t\t\tans = min(ans, sqrt(res.F + res.S));\n                        //if the vector's angle is less than 45\n\t\t\tif (res.S + eps &lt; res.F) ans = min(ans, sqrt(dist));\n\t\t}\n\t\tprintf(\"%.5f\\n\", ans);\n\t}\n}\n```\n","slug":"acm-international-collegiate-programming-contest-asia-regional-contest-tokyo-problem-d-space-golf","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l07000l5rgxzo0le3mq","content":"<p>原题pdf：<a href=\"http://judge.u-aizu.ac.jp/onlinejudge/contest/ICPCOOC2014/D.pdf\" target=\"_blank\" rel=\"external\">click here</a><br><br></p>\n<hr>\n<p>日本的亚洲区域赛真心简单啊。两个小时就刷了5题有余了。排名第一的队伍才做出7道。</p>\n<p>题目真心长的可以了，看了半个小时才明白。。</p>\n<p>题意其实也就是太空中向前方抛小球，问小球能够穿过N个障碍物后到达制定地点的最小初始速度是多少。非常暴力的模拟题。离散化后直接枚举弹跳的次数再取最小值即可。注意45°方向能成功的话，那还是45°最优。<br><a id=\"more\"></a><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> eps 1e-8</span></div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"keyword\">int</span> d, n, b;</div><div class=\"line\">PR ob[<span class=\"number\">20</span>];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; &amp;gt; vt;</div><div class=\"line\">pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; dpr;</div><div class=\"line\"><span class=\"keyword\">double</span> a[<span class=\"number\">2</span>][<span class=\"number\">2</span>], e[<span class=\"number\">2</span>];</div><div class=\"line\">pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; Cramer(pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; dpr) &#123;</div><div class=\"line\">\tpair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; res;</div><div class=\"line\">\ta[<span class=\"number\">1</span>][<span class=\"number\">0</span>] = dpr.F * dpr.F;</div><div class=\"line\">\ta[<span class=\"number\">1</span>][<span class=\"number\">1</span>] = dpr.F;</div><div class=\"line\">\te[<span class=\"number\">1</span>] = dpr.S;</div><div class=\"line\">\t<span class=\"keyword\">double</span> div = a[<span class=\"number\">0</span>][<span class=\"number\">0</span>] * a[<span class=\"number\">1</span>][<span class=\"number\">1</span>] - a[<span class=\"number\">1</span>][<span class=\"number\">0</span>] * a[<span class=\"number\">0</span>][<span class=\"number\">1</span>];</div><div class=\"line\">\tres.F = (e[<span class=\"number\">0</span>] * a[<span class=\"number\">1</span>][<span class=\"number\">1</span>] - e[<span class=\"number\">1</span>] * a[<span class=\"number\">0</span>][<span class=\"number\">1</span>]) / div;</div><div class=\"line\">\tres.S = (e[<span class=\"number\">1</span>] * a[<span class=\"number\">0</span>][<span class=\"number\">0</span>] - e[<span class=\"number\">0</span>] * a[<span class=\"number\">1</span>][<span class=\"number\">0</span>]) / div;</div><div class=\"line\">\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;d, &amp;amp;n, &amp;amp;b)) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;ob[i].F, &amp;amp;ob[i].S);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">double</span> ans = inf;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> c = <span class=\"number\">0</span>; c &amp;lt;= b; c++) &#123;<span class=\"comment\">//enumerate the times bullet bounces the surface</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">double</span> dist = <span class=\"number\">1.0</span> * d / (c + <span class=\"number\">1</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">int</span> f = <span class=\"number\">1</span>;</div><div class=\"line\">\t\t\ta[<span class=\"number\">0</span>][<span class=\"number\">0</span>] = dist * dist;</div><div class=\"line\">\t\t\ta[<span class=\"number\">0</span>][<span class=\"number\">1</span>] = dist;</div><div class=\"line\">\t\t\te[<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t\tvt.clear();</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">\t\t\t\tdpr = ob[i];</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (dpr.F + eps &amp;gt;= dist) &#123;</div><div class=\"line\">\t\t\t\t\tdpr.F -= dist;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (dpr.F &amp;lt;= eps) &#123;</div><div class=\"line\">\t\t\t\t\tf = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tvt.push_back(dpr);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (f == <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t\tpair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; res;   </div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; Sz(vt); i++) &#123;</div><div class=\"line\">\t\t\t\tdpr = vt[i];</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (i == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\tres = Cramer(dpr);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">double</span> tmph = dpr.F * dpr.F * res.F + dpr.F * res.S;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (tmph + eps &amp;lt; dpr.S) &#123;</div><div class=\"line\">\t\t\t\t\t\tres = Cramer(dpr);</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tres.F = <span class=\"number\">-1.0</span> / (<span class=\"number\">2</span> * res.F);</div><div class=\"line\">\t\t\tres.S = res.F * res.S * res.S;</div><div class=\"line\">\t\t\tans = min(ans, <span class=\"built_in\">sqrt</span>(res.F + res.S));</div><div class=\"line\">                        <span class=\"comment\">//if the vector's angle is less than 45</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (res.S + eps &amp;lt; res.F) ans = min(ans, <span class=\"built_in\">sqrt</span>(dist));</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%.5f\\n\"</span>, ans);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p>原题pdf：<a href=\"http://judge.u-aizu.ac.jp/onlinejudge/contest/ICPCOOC2014/D.pdf\">click here</a><br><br/></p>\n<hr>\n<p>日本的亚洲区域赛真心简单啊。两个小时就刷了5题有余了。排名第一的队伍才做出7道。</p>\n<p>题目真心长的可以了，看了半个小时才明白。。</p>\n<p>题意其实也就是太空中向前方抛小球，问小球能够穿过N个障碍物后到达制定地点的最小初始速度是多少。非常暴力的模拟题。离散化后直接枚举弹跳的次数再取最小值即可。注意45°方向能成功的话，那还是45°最优。<br>","more":"<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> eps 1e-8</span></div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"keyword\">int</span> d, n, b;</div><div class=\"line\">PR ob[<span class=\"number\">20</span>];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; &amp;gt; vt;</div><div class=\"line\">pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; dpr;</div><div class=\"line\"><span class=\"keyword\">double</span> a[<span class=\"number\">2</span>][<span class=\"number\">2</span>], e[<span class=\"number\">2</span>];</div><div class=\"line\">pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; Cramer(pair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; dpr) &#123;</div><div class=\"line\">\tpair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; res;</div><div class=\"line\">\ta[<span class=\"number\">1</span>][<span class=\"number\">0</span>] = dpr.F * dpr.F;</div><div class=\"line\">\ta[<span class=\"number\">1</span>][<span class=\"number\">1</span>] = dpr.F;</div><div class=\"line\">\te[<span class=\"number\">1</span>] = dpr.S;</div><div class=\"line\">\t<span class=\"keyword\">double</span> div = a[<span class=\"number\">0</span>][<span class=\"number\">0</span>] * a[<span class=\"number\">1</span>][<span class=\"number\">1</span>] - a[<span class=\"number\">1</span>][<span class=\"number\">0</span>] * a[<span class=\"number\">0</span>][<span class=\"number\">1</span>];</div><div class=\"line\">\tres.F = (e[<span class=\"number\">0</span>] * a[<span class=\"number\">1</span>][<span class=\"number\">1</span>] - e[<span class=\"number\">1</span>] * a[<span class=\"number\">0</span>][<span class=\"number\">1</span>]) / div;</div><div class=\"line\">\tres.S = (e[<span class=\"number\">1</span>] * a[<span class=\"number\">0</span>][<span class=\"number\">0</span>] - e[<span class=\"number\">0</span>] * a[<span class=\"number\">1</span>][<span class=\"number\">0</span>]) / div;</div><div class=\"line\">\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;d, &amp;amp;n, &amp;amp;b)) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;ob[i].F, &amp;amp;ob[i].S);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">double</span> ans = inf;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> c = <span class=\"number\">0</span>; c &amp;lt;= b; c++) &#123;<span class=\"comment\">//enumerate the times bullet bounces the surface</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">double</span> dist = <span class=\"number\">1.0</span> * d / (c + <span class=\"number\">1</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">int</span> f = <span class=\"number\">1</span>;</div><div class=\"line\">\t\t\ta[<span class=\"number\">0</span>][<span class=\"number\">0</span>] = dist * dist;</div><div class=\"line\">\t\t\ta[<span class=\"number\">0</span>][<span class=\"number\">1</span>] = dist;</div><div class=\"line\">\t\t\te[<span class=\"number\">0</span>] = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t\tvt.clear();</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">\t\t\t\tdpr = ob[i];</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (dpr.F + eps &amp;gt;= dist) &#123;</div><div class=\"line\">\t\t\t\t\tdpr.F -= dist;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (dpr.F &amp;lt;= eps) &#123;</div><div class=\"line\">\t\t\t\t\tf = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tvt.push_back(dpr);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (f == <span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t\tpair&amp;lt;<span class=\"keyword\">double</span>, <span class=\"keyword\">double</span>&amp;gt; res;   </div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; Sz(vt); i++) &#123;</div><div class=\"line\">\t\t\t\tdpr = vt[i];</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (i == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\tres = Cramer(dpr);</div><div class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">double</span> tmph = dpr.F * dpr.F * res.F + dpr.F * res.S;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (tmph + eps &amp;lt; dpr.S) &#123;</div><div class=\"line\">\t\t\t\t\t\tres = Cramer(dpr);</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tres.F = <span class=\"number\">-1.0</span> / (<span class=\"number\">2</span> * res.F);</div><div class=\"line\">\t\t\tres.S = res.F * res.S * res.S;</div><div class=\"line\">\t\t\tans = min(ans, <span class=\"built_in\">sqrt</span>(res.F + res.S));</div><div class=\"line\">                        <span class=\"comment\">//if the vector's angle is less than 45</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (res.S + eps &amp;lt; res.F) ans = min(ans, <span class=\"built_in\">sqrt</span>(dist));</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%.5f\\n\"</span>, ans);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"JS DOM API分析","date":"2016-11-02T13:07:21.000Z","_content":"\n## Element.classList\n返回DOMTokenList,IE version>=10不完全支持。\n1. 不支持classList.contains的第二个参数(force)\n2. add和remove方法不支持多参数\n3. SVG,MathML结点没有classList属性\n\n<!-- more -->\n## Node种类\n### Node.nodeName\n|Interface|nodeName|\n|:---------|:--------|\n|Comment|#comment|\n|Document|#document|\n|DocumentFragment|#document-fragment|\n\n## Node的树遍历\nNode树遍历普遍要考虑空白文字结点。(whitespace textNode)。\n### Node.childNodes\n返回一个NodeList，表示该结点的所有子结点，包括文字结点和注释，该NodeList里面全部是object，并没有string。可以使用ParentNode.children来获得所有纯Element结点集合。\n### Node.firstChild\n返回结点的第一个子结点。可能是whitespace textNode。\n可以使用Element.firstElementChild来获得Element结点。\n### Node.lastChild\n返回结点的最后一个子结点。可能是whitespace textNode。\n可以使用Element.lastElementChild来获得Element结点。\n### Node.nextSibling\n返回下一个兄弟结点，可能是whitespace textNode。可以使用Element.nextElementSibling获得Element结点。\n### Node.previousSibling\n返回前一个兄弟结点，可能whitespace textNode。可以使用Element.previousElementSibling获得Element结点。\n\n## Node.innerText\n是一个非标准的属性，返回当前结点包括其子结点的所有文字。可以使用标准方法Node.textContent代替。\n## Node.textContent\n## Node.parentElement\n返回当前Node的父Element元素，如果没有父Element元素，返回null。\n## Node.parentNode\n一个元素的parentNode可能是另一个元素、Document或者DocumentFragment。\nDocument和DocumentFragment的parentNode是null，同样，一个刚刚创建的node，如果还没有加到dom树里面，它的parentNode同样是null。\n```javascript\n//移除某element：\nele.parentNode.removeChild(ele);\n```\n","source":"_posts/dom-compatibility-note.md","raw":"---\ntitle: JS DOM API分析\ndate: 2016-11-02 21:07:21\ncategories:\n- Web\ntags: [javascirpt,dom,html]\n---\n\n## Element.classList\n返回DOMTokenList,IE version>=10不完全支持。\n1. 不支持classList.contains的第二个参数(force)\n2. add和remove方法不支持多参数\n3. SVG,MathML结点没有classList属性\n\n<!-- more -->\n## Node种类\n### Node.nodeName\n|Interface|nodeName|\n|:---------|:--------|\n|Comment|#comment|\n|Document|#document|\n|DocumentFragment|#document-fragment|\n\n## Node的树遍历\nNode树遍历普遍要考虑空白文字结点。(whitespace textNode)。\n### Node.childNodes\n返回一个NodeList，表示该结点的所有子结点，包括文字结点和注释，该NodeList里面全部是object，并没有string。可以使用ParentNode.children来获得所有纯Element结点集合。\n### Node.firstChild\n返回结点的第一个子结点。可能是whitespace textNode。\n可以使用Element.firstElementChild来获得Element结点。\n### Node.lastChild\n返回结点的最后一个子结点。可能是whitespace textNode。\n可以使用Element.lastElementChild来获得Element结点。\n### Node.nextSibling\n返回下一个兄弟结点，可能是whitespace textNode。可以使用Element.nextElementSibling获得Element结点。\n### Node.previousSibling\n返回前一个兄弟结点，可能whitespace textNode。可以使用Element.previousElementSibling获得Element结点。\n\n## Node.innerText\n是一个非标准的属性，返回当前结点包括其子结点的所有文字。可以使用标准方法Node.textContent代替。\n## Node.textContent\n## Node.parentElement\n返回当前Node的父Element元素，如果没有父Element元素，返回null。\n## Node.parentNode\n一个元素的parentNode可能是另一个元素、Document或者DocumentFragment。\nDocument和DocumentFragment的parentNode是null，同样，一个刚刚创建的node，如果还没有加到dom树里面，它的parentNode同样是null。\n```javascript\n//移除某element：\nele.parentNode.removeChild(ele);\n```\n","slug":"dom-compatibility-note","published":1,"updated":"2019-10-11T05:50:15.656Z","_id":"ciz5e9l09000n5rgxxtie0sci","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Element-classList\"><a href=\"#Element-classList\" class=\"headerlink\" title=\"Element.classList\"></a>Element.classList</h2><p>返回DOMTokenList,IE version&gt;=10不完全支持。</p>\n<ol>\n<li>不支持classList.contains的第二个参数(force)</li>\n<li>add和remove方法不支持多参数</li>\n<li>SVG,MathML结点没有classList属性</li>\n</ol>\n<a id=\"more\"></a>\n<h2 id=\"Node种类\"><a href=\"#Node种类\" class=\"headerlink\" title=\"Node种类\"></a>Node种类</h2><h3 id=\"Node-nodeName\"><a href=\"#Node-nodeName\" class=\"headerlink\" title=\"Node.nodeName\"></a>Node.nodeName</h3><table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Interface</th>\n<th style=\"text-align:left\">nodeName</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Comment</td>\n<td style=\"text-align:left\">#comment</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Document</td>\n<td style=\"text-align:left\">#document</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">DocumentFragment</td>\n<td style=\"text-align:left\">#document-fragment</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Node的树遍历\"><a href=\"#Node的树遍历\" class=\"headerlink\" title=\"Node的树遍历\"></a>Node的树遍历</h2><p>Node树遍历普遍要考虑空白文字结点。(whitespace textNode)。</p>\n<h3 id=\"Node-childNodes\"><a href=\"#Node-childNodes\" class=\"headerlink\" title=\"Node.childNodes\"></a>Node.childNodes</h3><p>返回一个NodeList，表示该结点的所有子结点，包括文字结点和注释，该NodeList里面全部是object，并没有string。可以使用ParentNode.children来获得所有纯Element结点集合。</p>\n<h3 id=\"Node-firstChild\"><a href=\"#Node-firstChild\" class=\"headerlink\" title=\"Node.firstChild\"></a>Node.firstChild</h3><p>返回结点的第一个子结点。可能是whitespace textNode。<br>可以使用Element.firstElementChild来获得Element结点。</p>\n<h3 id=\"Node-lastChild\"><a href=\"#Node-lastChild\" class=\"headerlink\" title=\"Node.lastChild\"></a>Node.lastChild</h3><p>返回结点的最后一个子结点。可能是whitespace textNode。<br>可以使用Element.lastElementChild来获得Element结点。</p>\n<h3 id=\"Node-nextSibling\"><a href=\"#Node-nextSibling\" class=\"headerlink\" title=\"Node.nextSibling\"></a>Node.nextSibling</h3><p>返回下一个兄弟结点，可能是whitespace textNode。可以使用Element.nextElementSibling获得Element结点。</p>\n<h3 id=\"Node-previousSibling\"><a href=\"#Node-previousSibling\" class=\"headerlink\" title=\"Node.previousSibling\"></a>Node.previousSibling</h3><p>返回前一个兄弟结点，可能whitespace textNode。可以使用Element.previousElementSibling获得Element结点。</p>\n<h2 id=\"Node-innerText\"><a href=\"#Node-innerText\" class=\"headerlink\" title=\"Node.innerText\"></a>Node.innerText</h2><p>是一个非标准的属性，返回当前结点包括其子结点的所有文字。可以使用标准方法Node.textContent代替。</p>\n<h2 id=\"Node-textContent\"><a href=\"#Node-textContent\" class=\"headerlink\" title=\"Node.textContent\"></a>Node.textContent</h2><h2 id=\"Node-parentElement\"><a href=\"#Node-parentElement\" class=\"headerlink\" title=\"Node.parentElement\"></a>Node.parentElement</h2><p>返回当前Node的父Element元素，如果没有父Element元素，返回null。</p>\n<h2 id=\"Node-parentNode\"><a href=\"#Node-parentNode\" class=\"headerlink\" title=\"Node.parentNode\"></a>Node.parentNode</h2><p>一个元素的parentNode可能是另一个元素、Document或者DocumentFragment。<br>Document和DocumentFragment的parentNode是null，同样，一个刚刚创建的node，如果还没有加到dom树里面，它的parentNode同样是null。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//移除某element：</span></span><br><span class=\"line\">ele.parentNode.removeChild(ele);</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Element-classList\"><a href=\"#Element-classList\" class=\"headerlink\" title=\"Element.classList\"></a>Element.classList</h2><p>返回DOMTokenList,IE version&gt;=10不完全支持。</p>\n<ol>\n<li>不支持classList.contains的第二个参数(force)</li>\n<li>add和remove方法不支持多参数</li>\n<li>SVG,MathML结点没有classList属性</li>\n</ol>","more":"<h2 id=\"Node种类\"><a href=\"#Node种类\" class=\"headerlink\" title=\"Node种类\"></a>Node种类</h2><h3 id=\"Node-nodeName\"><a href=\"#Node-nodeName\" class=\"headerlink\" title=\"Node.nodeName\"></a>Node.nodeName</h3><table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Interface</th>\n<th style=\"text-align:left\">nodeName</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Comment</td>\n<td style=\"text-align:left\">#comment</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Document</td>\n<td style=\"text-align:left\">#document</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">DocumentFragment</td>\n<td style=\"text-align:left\">#document-fragment</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Node的树遍历\"><a href=\"#Node的树遍历\" class=\"headerlink\" title=\"Node的树遍历\"></a>Node的树遍历</h2><p>Node树遍历普遍要考虑空白文字结点。(whitespace textNode)。</p>\n<h3 id=\"Node-childNodes\"><a href=\"#Node-childNodes\" class=\"headerlink\" title=\"Node.childNodes\"></a>Node.childNodes</h3><p>返回一个NodeList，表示该结点的所有子结点，包括文字结点和注释，该NodeList里面全部是object，并没有string。可以使用ParentNode.children来获得所有纯Element结点集合。</p>\n<h3 id=\"Node-firstChild\"><a href=\"#Node-firstChild\" class=\"headerlink\" title=\"Node.firstChild\"></a>Node.firstChild</h3><p>返回结点的第一个子结点。可能是whitespace textNode。<br>可以使用Element.firstElementChild来获得Element结点。</p>\n<h3 id=\"Node-lastChild\"><a href=\"#Node-lastChild\" class=\"headerlink\" title=\"Node.lastChild\"></a>Node.lastChild</h3><p>返回结点的最后一个子结点。可能是whitespace textNode。<br>可以使用Element.lastElementChild来获得Element结点。</p>\n<h3 id=\"Node-nextSibling\"><a href=\"#Node-nextSibling\" class=\"headerlink\" title=\"Node.nextSibling\"></a>Node.nextSibling</h3><p>返回下一个兄弟结点，可能是whitespace textNode。可以使用Element.nextElementSibling获得Element结点。</p>\n<h3 id=\"Node-previousSibling\"><a href=\"#Node-previousSibling\" class=\"headerlink\" title=\"Node.previousSibling\"></a>Node.previousSibling</h3><p>返回前一个兄弟结点，可能whitespace textNode。可以使用Element.previousElementSibling获得Element结点。</p>\n<h2 id=\"Node-innerText\"><a href=\"#Node-innerText\" class=\"headerlink\" title=\"Node.innerText\"></a>Node.innerText</h2><p>是一个非标准的属性，返回当前结点包括其子结点的所有文字。可以使用标准方法Node.textContent代替。</p>\n<h2 id=\"Node-textContent\"><a href=\"#Node-textContent\" class=\"headerlink\" title=\"Node.textContent\"></a>Node.textContent</h2><h2 id=\"Node-parentElement\"><a href=\"#Node-parentElement\" class=\"headerlink\" title=\"Node.parentElement\"></a>Node.parentElement</h2><p>返回当前Node的父Element元素，如果没有父Element元素，返回null。</p>\n<h2 id=\"Node-parentNode\"><a href=\"#Node-parentNode\" class=\"headerlink\" title=\"Node.parentNode\"></a>Node.parentNode</h2><p>一个元素的parentNode可能是另一个元素、Document或者DocumentFragment。<br>Document和DocumentFragment的parentNode是null，同样，一个刚刚创建的node，如果还没有加到dom树里面，它的parentNode同样是null。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//移除某element：</span></span><br><span class=\"line\">ele.parentNode.removeChild(ele);</span><br></pre></td></tr></table></figure></p>"},{"title":"baylor 6622 Absurdistan Roads（ NWERC Contest）","id":"137","date":"2014-11-06T09:05:34.000Z","_content":"\n原题pdf：[click here](https://icpcarchive.ecs.baylor.edu/external/66/6622.pdf)\n##Description\nThe people of Absurdistan discovered how to build roads only last year. After the discovery, every city\ndecided to build their own road connecting their city with another city. Each newly built road can be\nused in both directions.\n\nAbsurdistan is full of surprising coincidences. It took all N cities precisely one year to build their\nroads. And even more surprisingly, in the end it was possible to travel from every city to every other\ncity using the newly built roads.\n\n<!--more-->\nYou bought a tourist guide which does not have a map of the country with the new roads. It only\ncontains a huge table with the shortest distances between all pairs of cities using the newly built roads.\n\nYou would like to know between which pairs of cities there are roads and how long they are, because\nyou want to reconstruct the map of the N newly built roads from the table of shortest distances.\n\nYou get a table of shortest distances between all pairs of cities in Absurdistan using the N roads\nbuilt last year. From this table, you must reconstruct the road network of Absurdistan. There might\nbe multiple road networks with N roads with that same table of shortest distances, but you are happy\nwith any one of those networks.\n\n##Input\nFor each test case:  \n\n• A line containing an integer N (2 ≤ N ≤ 2000) — the number of cities and roads.  \n\n• N lines with N numbers each. The j-th number of the i-th line is the shortest distance from city i to city j.\n\n• All distances between two distinct cities will be positive and at most 1 000 000. The\ndistance from i to i will always be 0 and the distance from i to j will be the same as the distance\nfrom j to i.\n\n##Output\nFor each test case:\n\n• Print N lines with three integers ‘a b c’ denoting that there is a road between cities 1 ≤ a ≤ N\nand 1 ≤ b ≤ N of length 1 ≤ c ≤ 1000000, where a ̸= b. If there are multiple solutions, you can\nprint any one and you can print the roads in any order. At least one solution is guaranteed to\nexist.\n\n• Print a blank line between every two test cases.\n##Sample Input\n4  \n0 1 2 1  \n1 0 2 1  \n2 2 0 1  \n1 1 1 0  \n4  \n0 1 1 1  \n1 0 2 2  \n1 2 0 2  \n1 2 2 0  \n3  \n0 4 1  \n4 0 3  \n1 3 0  \n##Sample Output\n2 1 1  \n4 1 1  \n4 2 1  \n4 3 1  \n2 1 1  \n3 1 1  \n4 1 1  \n2 1 1  \n3 1 1  \n2 1 4  \n3 2 3  \n<br/>\n- - -\n\nNWERC 题目还挺简单的。  \n题意就是一个N个顶点，N条边的无向图。告诉你两两点之间的最短路。让你重构这个图。(随意输出任意一张满足以上条件的图）  \n这题的突破口就是N条边。要想想如果只有N-1条边，那么这个图就是一个树了。所以，我们可以先构造最小生成树，再来考虑最后一条边。  \n可以先将构造好的树求一遍floyd，然后再跟题目的最短路相比较，如果两点u,v求出的最短路w\\`与题目给的最短路w不一致（可以断言：w\\`&gt;w），那么就将w作为最后一条边的边长加在u，v之间即可。这样的边可能会找到很多，事实上只需要加上任意一条就使所有的w\\`都等于w了。\n需要注意的是，可能整个树就已经满足题目了。这样的话，最后一条边只需要重复任意一条树边就好了。\n\n```C++\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<vector>\n#include<algorithm>\nusing namespace std;\nconst int N = 2010;\nconst int inf = 1 << 25;\nint p[N];\nint ufind(int x) {\n\treturn x == p[x] ? x : p[x] = ufind(p[x]);\n}\nbool Union(int x, int y) {\n\tint fx = ufind(x);\n\tint fy = ufind(y);\n\tif (fx == fy)\n\t\treturn false;\n\tp[fx] = fy;\n\treturn true;\n}\nint n;\nstruct Edge {\n\tint u, v, w;\n\tEdge(int u = 0, int v = 0, int w = 0) :\n\t\t\tu(u), v(v), w(w) {\n\t}\n\tbool operator<(const Edge& othr) const {\n\t\treturn w < othr.w;\n\t}\n};\nvector<Edge> vt;\nvector<Edge> res;\nint f[N][N];\nint main() {\n\tbool first = true;\n\twhile (~scanf(\"%d\", &n)) {\n\t\tvt.clear();\n\t\tres.clear();\n\t\tif (!first) printf(\"\\n\");\n\t\telse first = false;\n\t\tfor (int i = 1; i <= n; i++) {\n\t\t\tfor (int x, j = 1; j <= n; j++) {\n\t\t\t\tscanf(\"%d\", &x);\n\t\t\t\tif (j > i)\n\t\t\t\t\tvt.push_back(Edge(i, j, x));\n\t\t\t}\n\t\t}\n\t\tfor (int i = 0; i <= n; i++) p[i] = i;\n\t\tsort(vt.begin(), vt.end());\n\t\tfor(int i=1;i<=n;i++) fill(f[i]+1,f[i]+1+n,inf);\n\t\tfor (int cnt = 0, i = 0; i < (int) vt.size(); i++) {\n\t\t\tif (Union(vt[i].u, vt[i].v)) {\n\t\t\t\tf[vt[i].u][vt[i].v] = vt[i].w;\n\t\t\t\tf[vt[i].v][vt[i].u] = vt[i].w;\n\t\t\t\tcnt++;\n\t\t\t\tres.push_back(Edge(vt[i].u, vt[i].v, vt[i].w));\n\t\t\t\tif (cnt >= n - 1) break;\n\t\t\t}\n\t\t}\n\n\t\tfor (int k = 1; k <= n; k++) {\n\t\t\tfor (int i = 1; i <= n; i++) {\n\t\t\t\tfor (int j = 1; j <= n; j++) {\n\t\t\t\t\tif (f[i][k] == inf) break;\n\t\t\t\t\tif (f[i][j] > f[i][k] + f[k][j]) {\n\t\t\t\t\t\tf[i][j] = f[i][k] + f[k][j];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tint flag = true;\n\t\tfor (int i = 0; i < (int) vt.size(); i++) {\n\t\t\tEdge now = vt[i];\n\t\t\tif (f[now.u][now.v] != now.w) {\n\t\t\t\tres.push_back(Edge(now.u, now.v, now.w));\n\t\t\t\tflag = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (flag) res.push_back(res.back());\n\t\tfor (int i = 0; i < (int) res.size(); i++) {\n\t\t\tprintf(\"%d %d %d\\n\", res[i].u, res[i].v, res[i].w);\n\t\t}\n\t}\n}\n```","source":"_posts/baylor6622-absurdistan-roads.md","raw":"title: baylor 6622 Absurdistan Roads（ NWERC Contest）\ncategories:\n  - ACM\nid: 137\ndate: 2014-11-06 17:05:34\ntags: 图论\n---\n\n原题pdf：[click here](https://icpcarchive.ecs.baylor.edu/external/66/6622.pdf)\n##Description\nThe people of Absurdistan discovered how to build roads only last year. After the discovery, every city\ndecided to build their own road connecting their city with another city. Each newly built road can be\nused in both directions.\n\nAbsurdistan is full of surprising coincidences. It took all N cities precisely one year to build their\nroads. And even more surprisingly, in the end it was possible to travel from every city to every other\ncity using the newly built roads.\n\n<!--more-->\nYou bought a tourist guide which does not have a map of the country with the new roads. It only\ncontains a huge table with the shortest distances between all pairs of cities using the newly built roads.\n\nYou would like to know between which pairs of cities there are roads and how long they are, because\nyou want to reconstruct the map of the N newly built roads from the table of shortest distances.\n\nYou get a table of shortest distances between all pairs of cities in Absurdistan using the N roads\nbuilt last year. From this table, you must reconstruct the road network of Absurdistan. There might\nbe multiple road networks with N roads with that same table of shortest distances, but you are happy\nwith any one of those networks.\n\n##Input\nFor each test case:  \n\n• A line containing an integer N (2 ≤ N ≤ 2000) — the number of cities and roads.  \n\n• N lines with N numbers each. The j-th number of the i-th line is the shortest distance from city i to city j.\n\n• All distances between two distinct cities will be positive and at most 1 000 000. The\ndistance from i to i will always be 0 and the distance from i to j will be the same as the distance\nfrom j to i.\n\n##Output\nFor each test case:\n\n• Print N lines with three integers ‘a b c’ denoting that there is a road between cities 1 ≤ a ≤ N\nand 1 ≤ b ≤ N of length 1 ≤ c ≤ 1000000, where a ̸= b. If there are multiple solutions, you can\nprint any one and you can print the roads in any order. At least one solution is guaranteed to\nexist.\n\n• Print a blank line between every two test cases.\n##Sample Input\n4  \n0 1 2 1  \n1 0 2 1  \n2 2 0 1  \n1 1 1 0  \n4  \n0 1 1 1  \n1 0 2 2  \n1 2 0 2  \n1 2 2 0  \n3  \n0 4 1  \n4 0 3  \n1 3 0  \n##Sample Output\n2 1 1  \n4 1 1  \n4 2 1  \n4 3 1  \n2 1 1  \n3 1 1  \n4 1 1  \n2 1 1  \n3 1 1  \n2 1 4  \n3 2 3  \n<br/>\n- - -\n\nNWERC 题目还挺简单的。  \n题意就是一个N个顶点，N条边的无向图。告诉你两两点之间的最短路。让你重构这个图。(随意输出任意一张满足以上条件的图）  \n这题的突破口就是N条边。要想想如果只有N-1条边，那么这个图就是一个树了。所以，我们可以先构造最小生成树，再来考虑最后一条边。  \n可以先将构造好的树求一遍floyd，然后再跟题目的最短路相比较，如果两点u,v求出的最短路w\\`与题目给的最短路w不一致（可以断言：w\\`&gt;w），那么就将w作为最后一条边的边长加在u，v之间即可。这样的边可能会找到很多，事实上只需要加上任意一条就使所有的w\\`都等于w了。\n需要注意的是，可能整个树就已经满足题目了。这样的话，最后一条边只需要重复任意一条树边就好了。\n\n```C++\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<vector>\n#include<algorithm>\nusing namespace std;\nconst int N = 2010;\nconst int inf = 1 << 25;\nint p[N];\nint ufind(int x) {\n\treturn x == p[x] ? x : p[x] = ufind(p[x]);\n}\nbool Union(int x, int y) {\n\tint fx = ufind(x);\n\tint fy = ufind(y);\n\tif (fx == fy)\n\t\treturn false;\n\tp[fx] = fy;\n\treturn true;\n}\nint n;\nstruct Edge {\n\tint u, v, w;\n\tEdge(int u = 0, int v = 0, int w = 0) :\n\t\t\tu(u), v(v), w(w) {\n\t}\n\tbool operator<(const Edge& othr) const {\n\t\treturn w < othr.w;\n\t}\n};\nvector<Edge> vt;\nvector<Edge> res;\nint f[N][N];\nint main() {\n\tbool first = true;\n\twhile (~scanf(\"%d\", &n)) {\n\t\tvt.clear();\n\t\tres.clear();\n\t\tif (!first) printf(\"\\n\");\n\t\telse first = false;\n\t\tfor (int i = 1; i <= n; i++) {\n\t\t\tfor (int x, j = 1; j <= n; j++) {\n\t\t\t\tscanf(\"%d\", &x);\n\t\t\t\tif (j > i)\n\t\t\t\t\tvt.push_back(Edge(i, j, x));\n\t\t\t}\n\t\t}\n\t\tfor (int i = 0; i <= n; i++) p[i] = i;\n\t\tsort(vt.begin(), vt.end());\n\t\tfor(int i=1;i<=n;i++) fill(f[i]+1,f[i]+1+n,inf);\n\t\tfor (int cnt = 0, i = 0; i < (int) vt.size(); i++) {\n\t\t\tif (Union(vt[i].u, vt[i].v)) {\n\t\t\t\tf[vt[i].u][vt[i].v] = vt[i].w;\n\t\t\t\tf[vt[i].v][vt[i].u] = vt[i].w;\n\t\t\t\tcnt++;\n\t\t\t\tres.push_back(Edge(vt[i].u, vt[i].v, vt[i].w));\n\t\t\t\tif (cnt >= n - 1) break;\n\t\t\t}\n\t\t}\n\n\t\tfor (int k = 1; k <= n; k++) {\n\t\t\tfor (int i = 1; i <= n; i++) {\n\t\t\t\tfor (int j = 1; j <= n; j++) {\n\t\t\t\t\tif (f[i][k] == inf) break;\n\t\t\t\t\tif (f[i][j] > f[i][k] + f[k][j]) {\n\t\t\t\t\t\tf[i][j] = f[i][k] + f[k][j];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tint flag = true;\n\t\tfor (int i = 0; i < (int) vt.size(); i++) {\n\t\t\tEdge now = vt[i];\n\t\t\tif (f[now.u][now.v] != now.w) {\n\t\t\t\tres.push_back(Edge(now.u, now.v, now.w));\n\t\t\t\tflag = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (flag) res.push_back(res.back());\n\t\tfor (int i = 0; i < (int) res.size(); i++) {\n\t\t\tprintf(\"%d %d %d\\n\", res[i].u, res[i].v, res[i].w);\n\t\t}\n\t}\n}\n```","slug":"baylor6622-absurdistan-roads","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l0b000s5rgxvdm64ll5","content":"<p>原题pdf：<a href=\"https://icpcarchive.ecs.baylor.edu/external/66/6622.pdf\" target=\"_blank\" rel=\"external\">click here</a></p>\n<p>##Description<br>The people of Absurdistan discovered how to build roads only last year. After the discovery, every city<br>decided to build their own road connecting their city with another city. Each newly built road can be<br>used in both directions.</p>\n<p>Absurdistan is full of surprising coincidences. It took all N cities precisely one year to build their<br>roads. And even more surprisingly, in the end it was possible to travel from every city to every other<br>city using the newly built roads.</p>\n<a id=\"more\"></a>\n<p>You bought a tourist guide which does not have a map of the country with the new roads. It only<br>contains a huge table with the shortest distances between all pairs of cities using the newly built roads.</p>\n<p>You would like to know between which pairs of cities there are roads and how long they are, because<br>you want to reconstruct the map of the N newly built roads from the table of shortest distances.</p>\n<p>You get a table of shortest distances between all pairs of cities in Absurdistan using the N roads<br>built last year. From this table, you must reconstruct the road network of Absurdistan. There might<br>be multiple road networks with N roads with that same table of shortest distances, but you are happy<br>with any one of those networks.</p>\n<p>##Input<br>For each test case:  </p>\n<p>• A line containing an integer N (2 ≤ N ≤ 2000) — the number of cities and roads.  </p>\n<p>• N lines with N numbers each. The j-th number of the i-th line is the shortest distance from city i to city j.</p>\n<p>• All distances between two distinct cities will be positive and at most 1 000 000. The<br>distance from i to i will always be 0 and the distance from i to j will be the same as the distance<br>from j to i.</p>\n<p>##Output<br>For each test case:</p>\n<p>• Print N lines with three integers ‘a b c’ denoting that there is a road between cities 1 ≤ a ≤ N<br>and 1 ≤ b ≤ N of length 1 ≤ c ≤ 1000000, where a ̸= b. If there are multiple solutions, you can<br>print any one and you can print the roads in any order. At least one solution is guaranteed to<br>exist.</p>\n<p>• Print a blank line between every two test cases.</p>\n<p>##Sample Input<br>4<br>0 1 2 1<br>1 0 2 1<br>2 2 0 1<br>1 1 1 0<br>4<br>0 1 1 1<br>1 0 2 2<br>1 2 0 2<br>1 2 2 0<br>3<br>0 4 1<br>4 0 3<br>1 3 0  </p>\n<p>##Sample Output<br>2 1 1<br>4 1 1<br>4 2 1<br>4 3 1<br>2 1 1<br>3 1 1<br>4 1 1<br>2 1 1<br>3 1 1<br>2 1 4<br>3 2 3<br><br></p>\n<hr>\n<p>NWERC 题目还挺简单的。<br>题意就是一个N个顶点，N条边的无向图。告诉你两两点之间的最短路。让你重构这个图。(随意输出任意一张满足以上条件的图）<br>这题的突破口就是N条边。要想想如果只有N-1条边，那么这个图就是一个树了。所以，我们可以先构造最小生成树，再来考虑最后一条边。<br>可以先将构造好的树求一遍floyd，然后再跟题目的最短路相比较，如果两点u,v求出的最短路w`与题目给的最短路w不一致（可以断言：w`&gt;w），那么就将w作为最后一条边的边长加在u，v之间即可。这样的边可能会找到很多，事实上只需要加上任意一条就使所有的w`都等于w了。<br>需要注意的是，可能整个树就已经满足题目了。这样的话，最后一条边只需要重复任意一条树边就好了。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstring&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N = <span class=\"number\">2010</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">25</span>;</div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">ufind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> x == p[x] ? x : p[x] = ufind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">Union</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> fx = ufind(x);</div><div class=\"line\">\t<span class=\"keyword\">int</span> fy = ufind(y);</div><div class=\"line\">\t<span class=\"keyword\">if</span> (fx == fy)</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">\tp[fx] = fy;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> n;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">\tEdge(<span class=\"keyword\">int</span> u = <span class=\"number\">0</span>, <span class=\"keyword\">int</span> v = <span class=\"number\">0</span>, <span class=\"keyword\">int</span> w = <span class=\"number\">0</span>) :</div><div class=\"line\">\t\t\tu(u), v(v), w(w) &#123;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"keyword\">const</span> Edge&amp; othr) <span class=\"keyword\">const</span> &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> w &lt; othr.w;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"built_in\">vector</span>&lt;Edge&gt; vt;</div><div class=\"line\"><span class=\"built_in\">vector</span>&lt;Edge&gt; res;</div><div class=\"line\"><span class=\"keyword\">int</span> f[N][N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">bool</span> first = <span class=\"literal\">true</span>;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;n)) &#123;</div><div class=\"line\">\t\tvt.clear();</div><div class=\"line\">\t\tres.clear();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (!first) <span class=\"built_in\">printf</span>(<span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">else</span> first = <span class=\"literal\">false</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= n; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> x, j = <span class=\"number\">1</span>; j &lt;= n; j++) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;x);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (j &gt; i)</div><div class=\"line\">\t\t\t\t\tvt.push_back(Edge(i, j, x));</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt;= n; i++) p[i] = i;</div><div class=\"line\">\t\tsort(vt.begin(), vt.end());</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) fill(f[i]+<span class=\"number\">1</span>,f[i]+<span class=\"number\">1</span>+n,inf);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>, i = <span class=\"number\">0</span>; i &lt; (<span class=\"keyword\">int</span>) vt.size(); i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (Union(vt[i].u, vt[i].v)) &#123;</div><div class=\"line\">\t\t\t\tf[vt[i].u][vt[i].v] = vt[i].w;</div><div class=\"line\">\t\t\t\tf[vt[i].v][vt[i].u] = vt[i].w;</div><div class=\"line\">\t\t\t\tcnt++;</div><div class=\"line\">\t\t\t\tres.push_back(Edge(vt[i].u, vt[i].v, vt[i].w));</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (cnt &gt;= n - <span class=\"number\">1</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">1</span>; k &lt;= n; k++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= n; i++) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &lt;= n; j++) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (f[i][k] == inf) <span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (f[i][j] &gt; f[i][k] + f[k][j]) &#123;</div><div class=\"line\">\t\t\t\t\t\tf[i][j] = f[i][k] + f[k][j];</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> flag = <span class=\"literal\">true</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; (<span class=\"keyword\">int</span>) vt.size(); i++) &#123;</div><div class=\"line\">\t\t\tEdge now = vt[i];</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (f[now.u][now.v] != now.w) &#123;</div><div class=\"line\">\t\t\t\tres.push_back(Edge(now.u, now.v, now.w));</div><div class=\"line\">\t\t\t\tflag = <span class=\"literal\">false</span>;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (flag) res.push_back(res.back());</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; (<span class=\"keyword\">int</span>) res.size(); i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%d %d %d\\n\"</span>, res[i].u, res[i].v, res[i].w);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","excerpt":"<p>原题pdf：<a href=\"https://icpcarchive.ecs.baylor.edu/external/66/6622.pdf\">click here</a></p>\n<p>##Description<br>The people of Absurdistan discovered how to build roads only last year. After the discovery, every city<br>decided to build their own road connecting their city with another city. Each newly built road can be<br>used in both directions.</p>\n<p>Absurdistan is full of surprising coincidences. It took all N cities precisely one year to build their<br>roads. And even more surprisingly, in the end it was possible to travel from every city to every other<br>city using the newly built roads.</p>","more":"<p>You bought a tourist guide which does not have a map of the country with the new roads. It only<br>contains a huge table with the shortest distances between all pairs of cities using the newly built roads.</p>\n<p>You would like to know between which pairs of cities there are roads and how long they are, because<br>you want to reconstruct the map of the N newly built roads from the table of shortest distances.</p>\n<p>You get a table of shortest distances between all pairs of cities in Absurdistan using the N roads<br>built last year. From this table, you must reconstruct the road network of Absurdistan. There might<br>be multiple road networks with N roads with that same table of shortest distances, but you are happy<br>with any one of those networks.</p>\n<p>##Input<br>For each test case:  </p>\n<p>• A line containing an integer N (2 ≤ N ≤ 2000) — the number of cities and roads.  </p>\n<p>• N lines with N numbers each. The j-th number of the i-th line is the shortest distance from city i to city j.</p>\n<p>• All distances between two distinct cities will be positive and at most 1 000 000. The<br>distance from i to i will always be 0 and the distance from i to j will be the same as the distance<br>from j to i.</p>\n<p>##Output<br>For each test case:</p>\n<p>• Print N lines with three integers ‘a b c’ denoting that there is a road between cities 1 ≤ a ≤ N<br>and 1 ≤ b ≤ N of length 1 ≤ c ≤ 1000000, where a ̸= b. If there are multiple solutions, you can<br>print any one and you can print the roads in any order. At least one solution is guaranteed to<br>exist.</p>\n<p>• Print a blank line between every two test cases.</p>\n<p>##Sample Input<br>4<br>0 1 2 1<br>1 0 2 1<br>2 2 0 1<br>1 1 1 0<br>4<br>0 1 1 1<br>1 0 2 2<br>1 2 0 2<br>1 2 2 0<br>3<br>0 4 1<br>4 0 3<br>1 3 0  </p>\n<p>##Sample Output<br>2 1 1<br>4 1 1<br>4 2 1<br>4 3 1<br>2 1 1<br>3 1 1<br>4 1 1<br>2 1 1<br>3 1 1<br>2 1 4<br>3 2 3<br><br/></p>\n<hr>\n<p>NWERC 题目还挺简单的。<br>题意就是一个N个顶点，N条边的无向图。告诉你两两点之间的最短路。让你重构这个图。(随意输出任意一张满足以上条件的图）<br>这题的突破口就是N条边。要想想如果只有N-1条边，那么这个图就是一个树了。所以，我们可以先构造最小生成树，再来考虑最后一条边。<br>可以先将构造好的树求一遍floyd，然后再跟题目的最短路相比较，如果两点u,v求出的最短路w`与题目给的最短路w不一致（可以断言：w`&gt;w），那么就将w作为最后一条边的边长加在u，v之间即可。这样的边可能会找到很多，事实上只需要加上任意一条就使所有的w`都等于w了。<br>需要注意的是，可能整个树就已经满足题目了。这样的话，最后一条边只需要重复任意一条树边就好了。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstring&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N = <span class=\"number\">2010</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">25</span>;</div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">ufind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> x == p[x] ? x : p[x] = ufind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">Union</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> fx = ufind(x);</div><div class=\"line\">\t<span class=\"keyword\">int</span> fy = ufind(y);</div><div class=\"line\">\t<span class=\"keyword\">if</span> (fx == fy)</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">\tp[fx] = fy;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> n;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">\tEdge(<span class=\"keyword\">int</span> u = <span class=\"number\">0</span>, <span class=\"keyword\">int</span> v = <span class=\"number\">0</span>, <span class=\"keyword\">int</span> w = <span class=\"number\">0</span>) :</div><div class=\"line\">\t\t\tu(u), v(v), w(w) &#123;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(<span class=\"keyword\">const</span> Edge&amp; othr) <span class=\"keyword\">const</span> &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> w &lt; othr.w;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"built_in\">vector</span>&lt;Edge&gt; vt;</div><div class=\"line\"><span class=\"built_in\">vector</span>&lt;Edge&gt; res;</div><div class=\"line\"><span class=\"keyword\">int</span> f[N][N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">bool</span> first = <span class=\"literal\">true</span>;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;n)) &#123;</div><div class=\"line\">\t\tvt.clear();</div><div class=\"line\">\t\tres.clear();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (!first) <span class=\"built_in\">printf</span>(<span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">else</span> first = <span class=\"literal\">false</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= n; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> x, j = <span class=\"number\">1</span>; j &lt;= n; j++) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;x);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (j &gt; i)</div><div class=\"line\">\t\t\t\t\tvt.push_back(Edge(i, j, x));</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt;= n; i++) p[i] = i;</div><div class=\"line\">\t\tsort(vt.begin(), vt.end());</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;i++) fill(f[i]+<span class=\"number\">1</span>,f[i]+<span class=\"number\">1</span>+n,inf);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>, i = <span class=\"number\">0</span>; i &lt; (<span class=\"keyword\">int</span>) vt.size(); i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (Union(vt[i].u, vt[i].v)) &#123;</div><div class=\"line\">\t\t\t\tf[vt[i].u][vt[i].v] = vt[i].w;</div><div class=\"line\">\t\t\t\tf[vt[i].v][vt[i].u] = vt[i].w;</div><div class=\"line\">\t\t\t\tcnt++;</div><div class=\"line\">\t\t\t\tres.push_back(Edge(vt[i].u, vt[i].v, vt[i].w));</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (cnt &gt;= n - <span class=\"number\">1</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">1</span>; k &lt;= n; k++) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= n; i++) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &lt;= n; j++) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (f[i][k] == inf) <span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (f[i][j] &gt; f[i][k] + f[k][j]) &#123;</div><div class=\"line\">\t\t\t\t\t\tf[i][j] = f[i][k] + f[k][j];</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> flag = <span class=\"literal\">true</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; (<span class=\"keyword\">int</span>) vt.size(); i++) &#123;</div><div class=\"line\">\t\t\tEdge now = vt[i];</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (f[now.u][now.v] != now.w) &#123;</div><div class=\"line\">\t\t\t\tres.push_back(Edge(now.u, now.v, now.w));</div><div class=\"line\">\t\t\t\tflag = <span class=\"literal\">false</span>;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (flag) res.push_back(res.back());</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; (<span class=\"keyword\">int</span>) res.size(); i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%d %d %d\\n\"</span>, res[i].u, res[i].v, res[i].w);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"FFT求快速卷积的思考","date":"2014-11-06T12:15:54.000Z","_content":"\n离散型卷积的定义是：$$y(n)=\\sum_{m=0}^{n} x(m)h(n-m)$$\n\n注意，h函数是反转的。\n\n在Chipher Messages一题中，b串需要反转再与a串匹配。\n\n比如说：\n\na串： 110110110，则：\n\nb\\`串：1011&lt;------这里才是原来b串的头。但是向上对应到a串时，已经是m-1这个位置了。所以说，小于m-1的卷积是没有意义的。\n\n于是，base=m。整体匹配。\n<!--more-->\n\n同样的，比如杭电1402用FFT求A×B那一题。\n\n可以把A串看成卷积中的x函数，而把B串的**每一个字符**看成h函数。那么卷积就可以看成是一个模拟乘法的过程。\n\n因为h函数是要求逆序的，但是此时的h函数只有**一个字符**所以反转操作无意义。这时候的base=1。单个匹配。\n\n估计FFT就这两种情况了。因为如果1&lt;base&lt;m，那么就应该直接将b串分解成若干base长度的串了。","source":"_posts/fft-thoughts.md","raw":"title: FFT求快速卷积的思考\ncategories: ACM\ndate: 2014-11-06 20:15:54\ntags: [数论,只言片语]\n---\n\n离散型卷积的定义是：$$y(n)=\\sum_{m=0}^{n} x(m)h(n-m)$$\n\n注意，h函数是反转的。\n\n在Chipher Messages一题中，b串需要反转再与a串匹配。\n\n比如说：\n\na串： 110110110，则：\n\nb\\`串：1011&lt;------这里才是原来b串的头。但是向上对应到a串时，已经是m-1这个位置了。所以说，小于m-1的卷积是没有意义的。\n\n于是，base=m。整体匹配。\n<!--more-->\n\n同样的，比如杭电1402用FFT求A×B那一题。\n\n可以把A串看成卷积中的x函数，而把B串的**每一个字符**看成h函数。那么卷积就可以看成是一个模拟乘法的过程。\n\n因为h函数是要求逆序的，但是此时的h函数只有**一个字符**所以反转操作无意义。这时候的base=1。单个匹配。\n\n估计FFT就这两种情况了。因为如果1&lt;base&lt;m，那么就应该直接将b串分解成若干base长度的串了。","slug":"fft-thoughts","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l0c000u5rgx0sf30szz","content":"<p>离散型卷积的定义是：$$y(n)=\\sum_{m=0}^{n} x(m)h(n-m)$$</p>\n<p>注意，h函数是反转的。</p>\n<p>在Chipher Messages一题中，b串需要反转再与a串匹配。</p>\n<p>比如说：</p>\n<p>a串： 110110110，则：</p>\n<p>b`串：1011&lt;——这里才是原来b串的头。但是向上对应到a串时，已经是m-1这个位置了。所以说，小于m-1的卷积是没有意义的。</p>\n<p>于是，base=m。整体匹配。<br><a id=\"more\"></a></p>\n<p>同样的，比如杭电1402用FFT求A×B那一题。</p>\n<p>可以把A串看成卷积中的x函数，而把B串的<strong>每一个字符</strong>看成h函数。那么卷积就可以看成是一个模拟乘法的过程。</p>\n<p>因为h函数是要求逆序的，但是此时的h函数只有<strong>一个字符</strong>所以反转操作无意义。这时候的base=1。单个匹配。</p>\n<p>估计FFT就这两种情况了。因为如果1&lt;base&lt;m，那么就应该直接将b串分解成若干base长度的串了。</p>\n","excerpt":"<p>离散型卷积的定义是：$$y(n)=\\sum_{m=0}^{n} x(m)h(n-m)$$</p>\n<p>注意，h函数是反转的。</p>\n<p>在Chipher Messages一题中，b串需要反转再与a串匹配。</p>\n<p>比如说：</p>\n<p>a串： 110110110，则：</p>\n<p>b`串：1011&lt;——这里才是原来b串的头。但是向上对应到a串时，已经是m-1这个位置了。所以说，小于m-1的卷积是没有意义的。</p>\n<p>于是，base=m。整体匹配。<br>","more":"</p>\n<p>同样的，比如杭电1402用FFT求A×B那一题。</p>\n<p>可以把A串看成卷积中的x函数，而把B串的<strong>每一个字符</strong>看成h函数。那么卷积就可以看成是一个模拟乘法的过程。</p>\n<p>因为h函数是要求逆序的，但是此时的h函数只有<strong>一个字符</strong>所以反转操作无意义。这时候的base=1。单个匹配。</p>\n<p>估计FFT就这两种情况了。因为如果1&lt;base&lt;m，那么就应该直接将b串分解成若干base长度的串了。</p>"},{"title":"github使用札记","date":"2014-08-10T05:01:03.000Z","_content":"\n1. 生成ssh key:\n\t\tssh-keygen -t rsa -C \"stkevintan@foxmail.com\"\n\n\t输入合适的密码。然后将生成的pub公钥粘贴到github上：[click here](https://github.com/settings/ssh)\n2. 版本推送命令：<!--more-->\n        ### Create a new repository on the command line\n\n            touch README.md\n            git init\n            git add README.md\n            git commit -m \"first commit\"\n            git remote add origin <span class=\"js-live-clone-url\">https://github.com/stkevintan/资源名.git</span>\n            <span class=\"js-selectable-text\">git push -u origin master</span>`</pre>\n\n            ### Push an existing repository from the command line\n\n            <pre>`git remote add origin <span class=\"js-live-clone-url\">https://github.com/stkevintan/资源名.git</span>\n            <span class=\"js-selectable-text\">git push -u origin master</span>\n3. 修改或删除passphrase。([Details](https://help.github.com/articles/working-with-ssh-key-passphrases/))\n\t\tssh-keygen -p","source":"_posts/github-tips.md","raw":"title: github使用札记\ntags:\n  - github\ncategories:\n  - Git\ndate: 2014-08-10 13:01:03\n---\n\n1. 生成ssh key:\n\t\tssh-keygen -t rsa -C \"stkevintan@foxmail.com\"\n\n\t输入合适的密码。然后将生成的pub公钥粘贴到github上：[click here](https://github.com/settings/ssh)\n2. 版本推送命令：<!--more-->\n        ### Create a new repository on the command line\n\n            touch README.md\n            git init\n            git add README.md\n            git commit -m \"first commit\"\n            git remote add origin <span class=\"js-live-clone-url\">https://github.com/stkevintan/资源名.git</span>\n            <span class=\"js-selectable-text\">git push -u origin master</span>`</pre>\n\n            ### Push an existing repository from the command line\n\n            <pre>`git remote add origin <span class=\"js-live-clone-url\">https://github.com/stkevintan/资源名.git</span>\n            <span class=\"js-selectable-text\">git push -u origin master</span>\n3. 修改或删除passphrase。([Details](https://help.github.com/articles/working-with-ssh-key-passphrases/))\n\t\tssh-keygen -p","slug":"github-tips","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l0d000y5rgxd1jr5dm2","content":"<ol>\n<li><p>生成ssh key:</p>\n<pre><code>ssh-keygen -t rsa -C &quot;stkevintan@foxmail.com&quot;\n</code></pre><p> 输入合适的密码。然后将生成的pub公钥粘贴到github上：<a href=\"https://github.com/settings/ssh\" target=\"_blank\" rel=\"external\">click here</a></p>\n</li>\n<li><p>版本推送命令：<a id=\"more\"></a></p>\n<pre><code>### Create a new repository on the command line\n\n    touch README.md\n    git init\n    git add README.md\n    git commit -m &quot;first commit&quot;\n    git remote add origin &lt;span class=&quot;js-live-clone-url&quot;&gt;https://github.com/stkevintan/资源名.git&lt;/span&gt;\n    &lt;span class=&quot;js-selectable-text&quot;&gt;git push -u origin master&lt;/span&gt;`&lt;/pre&gt;\n\n    ### Push an existing repository from the command line\n\n    &lt;pre&gt;`git remote add origin &lt;span class=&quot;js-live-clone-url&quot;&gt;https://github.com/stkevintan/资源名.git&lt;/span&gt;\n    &lt;span class=&quot;js-selectable-text&quot;&gt;git push -u origin master&lt;/span&gt;\n</code></pre></li>\n<li>修改或删除passphrase。(<a href=\"https://help.github.com/articles/working-with-ssh-key-passphrases/\" target=\"_blank\" rel=\"external\">Details</a>)<pre><code>ssh-keygen -p\n</code></pre></li>\n</ol>\n","excerpt":"<ol>\n<li><p>生成ssh key:</p>\n<pre><code>ssh-keygen -t rsa -C &quot;stkevintan@foxmail.com&quot;\n</code></pre><p> 输入合适的密码。然后将生成的pub公钥粘贴到github上：<a href=\"https://github.com/settings/ssh\">click here</a></p>\n</li>\n<li><p>版本推送命令：","more":"</p>\n<pre><code>### Create a new repository on the command line\n\n    touch README.md\n    git init\n    git add README.md\n    git commit -m &quot;first commit&quot;\n    git remote add origin &lt;span class=&quot;js-live-clone-url&quot;&gt;https://github.com/stkevintan/资源名.git&lt;/span&gt;\n    &lt;span class=&quot;js-selectable-text&quot;&gt;git push -u origin master&lt;/span&gt;`&lt;/pre&gt;\n\n    ### Push an existing repository from the command line\n\n    &lt;pre&gt;`git remote add origin &lt;span class=&quot;js-live-clone-url&quot;&gt;https://github.com/stkevintan/资源名.git&lt;/span&gt;\n    &lt;span class=&quot;js-selectable-text&quot;&gt;git push -u origin master&lt;/span&gt;\n</code></pre></li>\n<li>修改或删除passphrase。(<a href=\"https://help.github.com/articles/working-with-ssh-key-passphrases/\">Details</a>)<pre><code>ssh-keygen -p\n</code></pre></li>\n</ol>"},{"title":"HDU 4952 Number Transformation","id":"93","date":"2014-08-15T09:22:13.000Z","_content":"\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)\nTotal Submission(s): 612    Accepted Submission(s): 310\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">Teacher Mai has an integer x.\n\nHe does the following operations k times. In the i-th operation, x becomes the least integer no less than x, which is the multiple of i.\n\nHe wants to know what is the number x now.</div>\n<div class=\"panel_bottom\"></div>\n<!--more-->\n&nbsp;\n\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">There are multiple test cases, terminated by a line \"0 0\".\n\nFor each test case, the only one line contains two integers x,k(1&lt;=x&lt;=10^10, 1&lt;=k&lt;=10^10).</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each test case, output one line \"Case #k: x\", where k is the case number counting from 1.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">2520 10 2520 20 0 0</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 2520 Case #2: 2600</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 8 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Recommend</div>\n<div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  [4955](http://acm.hdu.edu.cn/showproblem.php?pid=4955) [4954](http://acm.hdu.edu.cn/showproblem.php?pid=4954) [4953](http://acm.hdu.edu.cn/showproblem.php?pid=4953) [4951](http://acm.hdu.edu.cn/showproblem.php?pid=4951) [4950](http://acm.hdu.edu.cn/showproblem.php?pid=4950)</div>\n<br/>\n\n- - -\n\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\nint __;\n#define type LL\ninline type getint() {\n    type ret=0;bool ok=0;\n    for(;;) {\n        int c=getchar();\n        if(c&gt;='0'&amp;&amp;c&lt;='9')ret=(ret&lt;&lt;3)+ret+ret+c-'0',ok=1;\n        else if(ok)return ret;\n    }\n}\n#undef type\nint main(int argc, char **argv) {\n    LL x, k;\n    while (1) {\n        x=getint();\n        k=getint();\n        if (x == 0 &amp;&amp; k == 0) break;\n        for(int i=1;i&lt;k;i++){\n            if(x&lt;i+1)break;\n            x-=x/(i+1);\n        }\n        printf(\"Case #%d: \"LLS\"\\n\",++__,x*k);\n    }\n}\n```","source":"_posts/hdu-4952-number-transformation.md","raw":"title: HDU 4952 Number Transformation\ncategories:\n  - ACM\nid: 93\ndate: 2014-08-15 17:22:13\ntags: [数论,暴力]\n---\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)\nTotal Submission(s): 612    Accepted Submission(s): 310\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">Teacher Mai has an integer x.\n\nHe does the following operations k times. In the i-th operation, x becomes the least integer no less than x, which is the multiple of i.\n\nHe wants to know what is the number x now.</div>\n<div class=\"panel_bottom\"></div>\n<!--more-->\n&nbsp;\n\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">There are multiple test cases, terminated by a line \"0 0\".\n\nFor each test case, the only one line contains two integers x,k(1&lt;=x&lt;=10^10, 1&lt;=k&lt;=10^10).</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each test case, output one line \"Case #k: x\", where k is the case number counting from 1.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">2520 10 2520 20 0 0</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 2520 Case #2: 2600</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 8 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Recommend</div>\n<div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  [4955](http://acm.hdu.edu.cn/showproblem.php?pid=4955) [4954](http://acm.hdu.edu.cn/showproblem.php?pid=4954) [4953](http://acm.hdu.edu.cn/showproblem.php?pid=4953) [4951](http://acm.hdu.edu.cn/showproblem.php?pid=4951) [4950](http://acm.hdu.edu.cn/showproblem.php?pid=4950)</div>\n<br/>\n\n- - -\n\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\nint __;\n#define type LL\ninline type getint() {\n    type ret=0;bool ok=0;\n    for(;;) {\n        int c=getchar();\n        if(c&gt;='0'&amp;&amp;c&lt;='9')ret=(ret&lt;&lt;3)+ret+ret+c-'0',ok=1;\n        else if(ok)return ret;\n    }\n}\n#undef type\nint main(int argc, char **argv) {\n    LL x, k;\n    while (1) {\n        x=getint();\n        k=getint();\n        if (x == 0 &amp;&amp; k == 0) break;\n        for(int i=1;i&lt;k;i++){\n            if(x&lt;i+1)break;\n            x-=x/(i+1);\n        }\n        printf(\"Case #%d: \"LLS\"\\n\",++__,x*k);\n    }\n}\n```","slug":"hdu-4952-number-transformation","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l17002v5rgxops3py9w","content":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)<br>Total Submission(s): 612    Accepted Submission(s): 310<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">Teacher Mai has an integer x.</div></p>\n<p>He does the following operations k times. In the i-th operation, x becomes the least integer no less than x, which is the multiple of i.</p>\n<p>He wants to know what is the number x now.</p>\n<p><div class=\"panel_bottom\"></div><br><a id=\"more\"></a><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">There are multiple test cases, terminated by a line “0 0”.</div></p>\n<p>For each test case, the only one line contains two integers x,k(1&lt;=x&lt;=10^10, 1&lt;=k&lt;=10^10).</p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each test case, output one line “Case #k: x”, where k is the case number counting from 1.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">2520 10 2520 20 0 0</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 2520 Case #2: 2600</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> 2014 Multi-University Training Contest 8 </a></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Recommend</div></p>\n<p><div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4955\" target=\"_blank\" rel=\"external\">4955</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4954\" target=\"_blank\" rel=\"external\">4954</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4953\" target=\"_blank\" rel=\"external\">4953</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4951\" target=\"_blank\" rel=\"external\">4951</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4950\" target=\"_blank\" rel=\"external\">4950</a></div><br><br></p>\n<hr>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"keyword\">int</span> __;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> type LL</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> type <span class=\"title\">getint</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    type ret=<span class=\"number\">0</span>;<span class=\"keyword\">bool</span> ok=<span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span>(;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> c=getchar();</div><div class=\"line\">        <span class=\"keyword\">if</span>(c&amp;gt;=<span class=\"string\">'0'</span>&amp;amp;&amp;amp;c&amp;lt;=<span class=\"string\">'9'</span>)ret=(ret&amp;lt;&amp;lt;<span class=\"number\">3</span>)+ret+ret+c-<span class=\"string\">'0'</span>,ok=<span class=\"number\">1</span>;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(ok)<span class=\"keyword\">return</span> ret;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">undef</span> type</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    LL x, k;</div><div class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</div><div class=\"line\">        x=getint();</div><div class=\"line\">        k=getint();</div><div class=\"line\">        <span class=\"keyword\">if</span> (x == <span class=\"number\">0</span> &amp;amp;&amp;amp; k == <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;k;i++)&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span>(x&amp;lt;i+<span class=\"number\">1</span>)<span class=\"keyword\">break</span>;</div><div class=\"line\">            x-=x/(i+<span class=\"number\">1</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"Case #%d: \"</span>LLS<span class=\"string\">\"\\n\"</span>,++__,x*k);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","excerpt":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)<br>Total Submission(s): 612    Accepted Submission(s): 310<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">Teacher Mai has an integer x.</p>\n<p>He does the following operations k times. In the i-th operation, x becomes the least integer no less than x, which is the multiple of i.</p>\n<p>He wants to know what is the number x now.</div></p>\n<p><div class=\"panel_bottom\"></div><br>","more":"<br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">There are multiple test cases, terminated by a line “0 0”.</p>\n<p>For each test case, the only one line contains two integers x,k(1&lt;=x&lt;=10^10, 1&lt;=k&lt;=10^10).</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each test case, output one line “Case #k: x”, where k is the case number counting from 1.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">2520 10 2520 20 0 0</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 2520 Case #2: 2600</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source\"> 2014 Multi-University Training Contest 8 </a></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Recommend</div></p>\n<p><div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4955\">4955</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4954\">4954</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4953\">4953</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4951\">4951</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4950\">4950</a></div><br><br/></p>\n<hr>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"keyword\">int</span> __;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> type LL</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> type <span class=\"title\">getint</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    type ret=<span class=\"number\">0</span>;<span class=\"keyword\">bool</span> ok=<span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span>(;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> c=getchar();</div><div class=\"line\">        <span class=\"keyword\">if</span>(c&amp;gt;=<span class=\"string\">'0'</span>&amp;amp;&amp;amp;c&amp;lt;=<span class=\"string\">'9'</span>)ret=(ret&amp;lt;&amp;lt;<span class=\"number\">3</span>)+ret+ret+c-<span class=\"string\">'0'</span>,ok=<span class=\"number\">1</span>;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(ok)<span class=\"keyword\">return</span> ret;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">undef</span> type</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    LL x, k;</div><div class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</div><div class=\"line\">        x=getint();</div><div class=\"line\">        k=getint();</div><div class=\"line\">        <span class=\"keyword\">if</span> (x == <span class=\"number\">0</span> &amp;amp;&amp;amp; k == <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;k;i++)&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span>(x&amp;lt;i+<span class=\"number\">1</span>)<span class=\"keyword\">break</span>;</div><div class=\"line\">            x-=x/(i+<span class=\"number\">1</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"Case #%d: \"</span>LLS<span class=\"string\">\"\\n\"</span>,++__,x*k);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"HDU 2874 Connections between cities","date":"2014-08-13T14:00:34.000Z","_content":"\n# Connections between cities\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 32768/32768 K (Java/Others)\nTotal Submission(s): 4759    Accepted Submission(s): 1341\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">After World War X, a lot of cities have been seriously damaged, and we need to rebuild those cities. However, some materials needed can only be produced in certain places. So we need to transport these materials from city to city. For most of roads had been totally destroyed during the war, there might be no path between two cities, no circle exists as well.\nNow, your task comes. After giving you the condition of the roads, we want to know if there exists a path between any two cities. If the answer is yes, output the shortest path between them.</div>\n<!--more-->\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">Input consists of multiple problem instances.For each instance, first line contains three integers n, m and c, 2&lt;=n&lt;=10000, 0&lt;=m&lt;10000, 1&lt;=c&lt;=1000000\\. n represents the number of cities numbered from 1 to n. Following m lines, each line has three integers i, j and k, represent a road between city i and city j, with length k. Last c lines, two integers i, j each line, indicates a query of city i and city j.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each problem instance, one line for each query. If no path between two cities, output “Not connected”, otherwise output the length of the shortest path between them.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">5 3 2 1 3 2 2 4 3 5 2 3 1 4 4 5</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Not connected 6\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nHint Huge input, scanf recommended.</div>\n_ _</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2009 Multi-University Training Contest 8 - Host by BJNU ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2009%20Multi-University%20Training%20Contest%208%20-%20Host%20by%20BJNU&amp;source=1&amp;searchmode=source)</div>\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define N 10004\n#define M 10005\nint n, m, c;\nstruct Edge {\n    int v, w, nxt;\n} e[M &lt;&lt; 1];\nint head[N], ecnt;\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    ecnt = 0;\n}\nvoid add(int u, int v, int w) {\n    e[ecnt].v = v;\n    e[ecnt].w = w;\n    e[ecnt].nxt = head[u];\n    head[u] = ecnt++;\n}\n//RMQ\nint dpM[20][N &lt;&lt; 1];\nint lg2[N &lt;&lt; 1];\n#define getL(R,L) (R-(L)+1)\nvoid initRMQ(int n) {\n    lg2[0] = -1;\n    int m;\n    for (int i = 1; i &lt;= n; i++)\n        lg2[i] = i &amp; (i - 1) ? lg2[i - 1] : lg2[i - 1] + 1;\n    for (int i = 1; i &lt;= lg2[n]; i++) {\n        m = getL(n, 1 &lt;&lt; i);\n        for (int j = 1; j &lt;= m; j++) {\n            dpM[i][j] = min(dpM[i - 1][j], dpM[i - 1][j + (1 &lt;&lt; (i - 1))]);\n        }\n    }\n}\nint getRMQ(int a, int b) {\n    if (a &gt; b) swap(a, b);\n    int s = lg2[b - a + 1];\n    return min(dpM[s][a], dpM[s][getL(b, 1 &lt;&lt; s)]);\n}\n//LCA\nint E[N];\nint T[N];\nint H[N];\nint depth, cnt;\nint belong[N], bcnt;\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (belong[i] == 0) return i;\n    }\n    return -1;\n}\nvoid getEuler(int u, int fa = -1) {\n    int tmp = dpM[0][H[u] = ++cnt] = ++depth;\n    E[tmp] = u;\n    belong[u] = bcnt;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        if (v == fa) continue;\n        T[v] = T[u] + e[i].w;\n        getEuler(v, u);\n        dpM[0][++cnt] = tmp;\n    }\n}\nvoid initLCA() {\n\n    memset(T, 0, sizeof(T));\n    memset(belong, 0, sizeof(belong));\n    bcnt = cnt = depth = 0;\n    int root;\n    while ((root = findRoot()) != -1) {\n        ++bcnt;\n        getEuler(root);\n    }\n    initRMQ(cnt);\n}\nint getLCA(int u, int v) {\n    if (belong[u] != belong[v]) return -1;\n    if (H[u] &gt; H[v]) swap(u, v);\n    return E[getRMQ(H[u], H[v])];\n}\nint main(int argc, char **argv) {\n    while (~scanf(\"%d%d%d\", &amp;n, &amp;m, &amp;c)) {\n        initEdge();\n        int u, v, w;\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n            add(u, v, w);\n            add(v, u, w);\n        }\n        initLCA();\n        while (c--) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            int r = getLCA(u, v);\n            if (r == -1) puts(\"Not connected\");\n            else {\n                printf(\"%d\\n\", T[u] + T[v] - 2 * T[r]);\n            }\n        }\n    }\n}\n```\n\n</pre>","source":"_posts/hdu-2874-connections-between-cities.md","raw":"title: HDU 2874 Connections between cities\ncategories:\n  - ACM\ndate: 2014-08-13 22:00:34\ntags: 图论\n---\n\n# Connections between cities\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 32768/32768 K (Java/Others)\nTotal Submission(s): 4759    Accepted Submission(s): 1341\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">After World War X, a lot of cities have been seriously damaged, and we need to rebuild those cities. However, some materials needed can only be produced in certain places. So we need to transport these materials from city to city. For most of roads had been totally destroyed during the war, there might be no path between two cities, no circle exists as well.\nNow, your task comes. After giving you the condition of the roads, we want to know if there exists a path between any two cities. If the answer is yes, output the shortest path between them.</div>\n<!--more-->\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">Input consists of multiple problem instances.For each instance, first line contains three integers n, m and c, 2&lt;=n&lt;=10000, 0&lt;=m&lt;10000, 1&lt;=c&lt;=1000000\\. n represents the number of cities numbered from 1 to n. Following m lines, each line has three integers i, j and k, represent a road between city i and city j, with length k. Last c lines, two integers i, j each line, indicates a query of city i and city j.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each problem instance, one line for each query. If no path between two cities, output “Not connected”, otherwise output the length of the shortest path between them.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">5 3 2 1 3 2 2 4 3 5 2 3 1 4 4 5</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Not connected 6\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nHint Huge input, scanf recommended.</div>\n_ _</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2009 Multi-University Training Contest 8 - Host by BJNU ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2009%20Multi-University%20Training%20Contest%208%20-%20Host%20by%20BJNU&amp;source=1&amp;searchmode=source)</div>\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define N 10004\n#define M 10005\nint n, m, c;\nstruct Edge {\n    int v, w, nxt;\n} e[M &lt;&lt; 1];\nint head[N], ecnt;\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    ecnt = 0;\n}\nvoid add(int u, int v, int w) {\n    e[ecnt].v = v;\n    e[ecnt].w = w;\n    e[ecnt].nxt = head[u];\n    head[u] = ecnt++;\n}\n//RMQ\nint dpM[20][N &lt;&lt; 1];\nint lg2[N &lt;&lt; 1];\n#define getL(R,L) (R-(L)+1)\nvoid initRMQ(int n) {\n    lg2[0] = -1;\n    int m;\n    for (int i = 1; i &lt;= n; i++)\n        lg2[i] = i &amp; (i - 1) ? lg2[i - 1] : lg2[i - 1] + 1;\n    for (int i = 1; i &lt;= lg2[n]; i++) {\n        m = getL(n, 1 &lt;&lt; i);\n        for (int j = 1; j &lt;= m; j++) {\n            dpM[i][j] = min(dpM[i - 1][j], dpM[i - 1][j + (1 &lt;&lt; (i - 1))]);\n        }\n    }\n}\nint getRMQ(int a, int b) {\n    if (a &gt; b) swap(a, b);\n    int s = lg2[b - a + 1];\n    return min(dpM[s][a], dpM[s][getL(b, 1 &lt;&lt; s)]);\n}\n//LCA\nint E[N];\nint T[N];\nint H[N];\nint depth, cnt;\nint belong[N], bcnt;\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (belong[i] == 0) return i;\n    }\n    return -1;\n}\nvoid getEuler(int u, int fa = -1) {\n    int tmp = dpM[0][H[u] = ++cnt] = ++depth;\n    E[tmp] = u;\n    belong[u] = bcnt;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        if (v == fa) continue;\n        T[v] = T[u] + e[i].w;\n        getEuler(v, u);\n        dpM[0][++cnt] = tmp;\n    }\n}\nvoid initLCA() {\n\n    memset(T, 0, sizeof(T));\n    memset(belong, 0, sizeof(belong));\n    bcnt = cnt = depth = 0;\n    int root;\n    while ((root = findRoot()) != -1) {\n        ++bcnt;\n        getEuler(root);\n    }\n    initRMQ(cnt);\n}\nint getLCA(int u, int v) {\n    if (belong[u] != belong[v]) return -1;\n    if (H[u] &gt; H[v]) swap(u, v);\n    return E[getRMQ(H[u], H[v])];\n}\nint main(int argc, char **argv) {\n    while (~scanf(\"%d%d%d\", &amp;n, &amp;m, &amp;c)) {\n        initEdge();\n        int u, v, w;\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n            add(u, v, w);\n            add(v, u, w);\n        }\n        initLCA();\n        while (c--) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            int r = getLCA(u, v);\n            if (r == -1) puts(\"Not connected\");\n            else {\n                printf(\"%d\\n\", T[u] + T[v] - 2 * T[r]);\n            }\n        }\n    }\n}\n```\n\n</pre>","slug":"hdu-2874-connections-between-cities","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l19002w5rgx79vzuwrs","content":"<h1 id=\"Connections-between-cities\"><a href=\"#Connections-between-cities\" class=\"headerlink\" title=\"Connections between cities\"></a>Connections between cities</h1><p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 32768/32768 K (Java/Others)<br>Total Submission(s): 4759    Accepted Submission(s): 1341<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">After World War X, a lot of cities have been seriously damaged, and we need to rebuild those cities. However, some materials needed can only be produced in certain places. So we need to transport these materials from city to city. For most of roads had been totally destroyed during the war, there might be no path between two cities, no circle exists as well.<br>Now, your task comes. After giving you the condition of the roads, we want to know if there exists a path between any two cities. If the answer is yes, output the shortest path between them.</div><br><a id=\"more\"></a></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">Input consists of multiple problem instances.For each instance, first line contains three integers n, m and c, 2&lt;=n&lt;=10000, 0&lt;=m&lt;10000, 1&lt;=c&lt;=1000000. n represents the number of cities numbered from 1 to n. Following m lines, each line has three integers i, j and k, represent a road between city i and city j, with length k. Last c lines, two integers i, j each line, indicates a query of city i and city j.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each problem instance, one line for each query. If no path between two cities, output “Not connected”, otherwise output the length of the shortest path between them.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">5 3 2 1 3 2 2 4 3 5 2 3 1 4 4 5</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Not connected 6</div></p>\n<p><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"></div></p>\n<p><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>Hint Huge input, scanf recommended.<br><em> </em><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2009%20Multi-University%20Training%20Contest%208%20-%20Host%20by%20BJNU&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> 2009 Multi-University Training Contest 8 - Host by BJNU </a></div><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 10004</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 10005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m, c;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, w, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> head[N], ecnt;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    ecnt = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v, <span class=\"keyword\">int</span> w)</span> </span>&#123;</div><div class=\"line\">    e[ecnt].v = v;</div><div class=\"line\">    e[ecnt].w = w;</div><div class=\"line\">    e[ecnt].nxt = head[u];</div><div class=\"line\">    head[u] = ecnt++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//RMQ</span></div><div class=\"line\"><span class=\"keyword\">int</span> dpM[<span class=\"number\">20</span>][N &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> lg2[N &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> getL(R,L) (R-(L)+1)</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initRMQ</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</div><div class=\"line\">    lg2[<span class=\"number\">0</span>] = <span class=\"number\">-1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> m;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        lg2[i] = i &amp;amp; (i - <span class=\"number\">1</span>) ? lg2[i - <span class=\"number\">1</span>] : lg2[i - <span class=\"number\">1</span>] + <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= lg2[n]; i++) &#123;</div><div class=\"line\">        m = getL(n, <span class=\"number\">1</span> &amp;lt;&amp;lt; i);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= m; j++) &#123;</div><div class=\"line\">            dpM[i][j] = min(dpM[i - <span class=\"number\">1</span>][j], dpM[i - <span class=\"number\">1</span>][j + (<span class=\"number\">1</span> &amp;lt;&amp;lt; (i - <span class=\"number\">1</span>))]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getRMQ</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (a &amp;gt; b) swap(a, b);</div><div class=\"line\">    <span class=\"keyword\">int</span> s = lg2[b - a + <span class=\"number\">1</span>];</div><div class=\"line\">    <span class=\"keyword\">return</span> min(dpM[s][a], dpM[s][getL(b, <span class=\"number\">1</span> &amp;lt;&amp;lt; s)]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//LCA</span></div><div class=\"line\"><span class=\"keyword\">int</span> E[N];</div><div class=\"line\"><span class=\"keyword\">int</span> T[N];</div><div class=\"line\"><span class=\"keyword\">int</span> H[N];</div><div class=\"line\"><span class=\"keyword\">int</span> depth, cnt;</div><div class=\"line\"><span class=\"keyword\">int</span> belong[N], bcnt;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (belong[i] == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getEuler</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa = <span class=\"number\">-1</span>)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> tmp = dpM[<span class=\"number\">0</span>][H[u] = ++cnt] = ++depth;</div><div class=\"line\">    E[tmp] = u;</div><div class=\"line\">    belong[u] = bcnt;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        <span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        T[v] = T[u] + e[i].w;</div><div class=\"line\">        getEuler(v, u);</div><div class=\"line\">        dpM[<span class=\"number\">0</span>][++cnt] = tmp;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initLCA</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">memset</span>(T, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(T));</div><div class=\"line\">    <span class=\"built_in\">memset</span>(belong, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(belong));</div><div class=\"line\">    bcnt = cnt = depth = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> root;</div><div class=\"line\">    <span class=\"keyword\">while</span> ((root = findRoot()) != <span class=\"number\">-1</span>) &#123;</div><div class=\"line\">        ++bcnt;</div><div class=\"line\">        getEuler(root);</div><div class=\"line\">    &#125;</div><div class=\"line\">    initRMQ(cnt);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getLCA</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (belong[u] != belong[v]) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</div><div class=\"line\">    <span class=\"keyword\">if</span> (H[u] &amp;gt; H[v]) swap(u, v);</div><div class=\"line\">    <span class=\"keyword\">return</span> E[getRMQ(H[u], H[v])];</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;n, &amp;amp;m, &amp;amp;c)) &#123;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w);</div><div class=\"line\">            add(u, v, w);</div><div class=\"line\">            add(v, u, w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        <span class=\"keyword\">while</span> (c--) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            <span class=\"keyword\">int</span> r = getLCA(u, v);</div><div class=\"line\">            <span class=\"keyword\">if</span> (r == <span class=\"number\">-1</span>) <span class=\"built_in\">puts</span>(<span class=\"string\">\"Not connected\"</span>);</div><div class=\"line\">            <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, T[u] + T[v] - <span class=\"number\">2</span> * T[r]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></p>\n","excerpt":"<h1 id=\"Connections-between-cities\"><a href=\"#Connections-between-cities\" class=\"headerlink\" title=\"Connections between cities\"></a>Connections between cities</h1><p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 32768/32768 K (Java/Others)<br>Total Submission(s): 4759    Accepted Submission(s): 1341<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">After World War X, a lot of cities have been seriously damaged, and we need to rebuild those cities. However, some materials needed can only be produced in certain places. So we need to transport these materials from city to city. For most of roads had been totally destroyed during the war, there might be no path between two cities, no circle exists as well.<br>Now, your task comes. After giving you the condition of the roads, we want to know if there exists a path between any two cities. If the answer is yes, output the shortest path between them.</div><br>","more":"</p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">Input consists of multiple problem instances.For each instance, first line contains three integers n, m and c, 2&lt;=n&lt;=10000, 0&lt;=m&lt;10000, 1&lt;=c&lt;=1000000. n represents the number of cities numbered from 1 to n. Following m lines, each line has three integers i, j and k, represent a road between city i and city j, with length k. Last c lines, two integers i, j each line, indicates a query of city i and city j.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each problem instance, one line for each query. If no path between two cities, output “Not connected”, otherwise output the length of the shortest path between them.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">5 3 2 1 3 2 2 4 3 5 2 3 1 4 4 5</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Not connected 6</p>\n<p><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"></p>\n<p><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>Hint Huge input, scanf recommended.</div><br><em> </em></div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2009%20Multi-University%20Training%20Contest%208%20-%20Host%20by%20BJNU&amp;source=1&amp;searchmode=source\"> 2009 Multi-University Training Contest 8 - Host by BJNU </a></div><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 10004</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 10005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m, c;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, w, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> head[N], ecnt;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    ecnt = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v, <span class=\"keyword\">int</span> w)</span> </span>&#123;</div><div class=\"line\">    e[ecnt].v = v;</div><div class=\"line\">    e[ecnt].w = w;</div><div class=\"line\">    e[ecnt].nxt = head[u];</div><div class=\"line\">    head[u] = ecnt++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//RMQ</span></div><div class=\"line\"><span class=\"keyword\">int</span> dpM[<span class=\"number\">20</span>][N &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> lg2[N &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> getL(R,L) (R-(L)+1)</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initRMQ</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</div><div class=\"line\">    lg2[<span class=\"number\">0</span>] = <span class=\"number\">-1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> m;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        lg2[i] = i &amp;amp; (i - <span class=\"number\">1</span>) ? lg2[i - <span class=\"number\">1</span>] : lg2[i - <span class=\"number\">1</span>] + <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= lg2[n]; i++) &#123;</div><div class=\"line\">        m = getL(n, <span class=\"number\">1</span> &amp;lt;&amp;lt; i);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= m; j++) &#123;</div><div class=\"line\">            dpM[i][j] = min(dpM[i - <span class=\"number\">1</span>][j], dpM[i - <span class=\"number\">1</span>][j + (<span class=\"number\">1</span> &amp;lt;&amp;lt; (i - <span class=\"number\">1</span>))]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getRMQ</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (a &amp;gt; b) swap(a, b);</div><div class=\"line\">    <span class=\"keyword\">int</span> s = lg2[b - a + <span class=\"number\">1</span>];</div><div class=\"line\">    <span class=\"keyword\">return</span> min(dpM[s][a], dpM[s][getL(b, <span class=\"number\">1</span> &amp;lt;&amp;lt; s)]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//LCA</span></div><div class=\"line\"><span class=\"keyword\">int</span> E[N];</div><div class=\"line\"><span class=\"keyword\">int</span> T[N];</div><div class=\"line\"><span class=\"keyword\">int</span> H[N];</div><div class=\"line\"><span class=\"keyword\">int</span> depth, cnt;</div><div class=\"line\"><span class=\"keyword\">int</span> belong[N], bcnt;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (belong[i] == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getEuler</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa = <span class=\"number\">-1</span>)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> tmp = dpM[<span class=\"number\">0</span>][H[u] = ++cnt] = ++depth;</div><div class=\"line\">    E[tmp] = u;</div><div class=\"line\">    belong[u] = bcnt;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        <span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        T[v] = T[u] + e[i].w;</div><div class=\"line\">        getEuler(v, u);</div><div class=\"line\">        dpM[<span class=\"number\">0</span>][++cnt] = tmp;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initLCA</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">memset</span>(T, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(T));</div><div class=\"line\">    <span class=\"built_in\">memset</span>(belong, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(belong));</div><div class=\"line\">    bcnt = cnt = depth = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> root;</div><div class=\"line\">    <span class=\"keyword\">while</span> ((root = findRoot()) != <span class=\"number\">-1</span>) &#123;</div><div class=\"line\">        ++bcnt;</div><div class=\"line\">        getEuler(root);</div><div class=\"line\">    &#125;</div><div class=\"line\">    initRMQ(cnt);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">getLCA</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (belong[u] != belong[v]) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</div><div class=\"line\">    <span class=\"keyword\">if</span> (H[u] &amp;gt; H[v]) swap(u, v);</div><div class=\"line\">    <span class=\"keyword\">return</span> E[getRMQ(H[u], H[v])];</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;n, &amp;amp;m, &amp;amp;c)) &#123;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w);</div><div class=\"line\">            add(u, v, w);</div><div class=\"line\">            add(v, u, w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        <span class=\"keyword\">while</span> (c--) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            <span class=\"keyword\">int</span> r = getLCA(u, v);</div><div class=\"line\">            <span class=\"keyword\">if</span> (r == <span class=\"number\">-1</span>) <span class=\"built_in\">puts</span>(<span class=\"string\">\"Not connected\"</span>);</div><div class=\"line\">            <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, T[u] + T[v] - <span class=\"number\">2</span> * T[r]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></pre></p>"},{"title":"HDU 4945 2048","id":"91","date":"2014-08-15T08:56:19.000Z","_content":"\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 3000/1500 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)\nTotal Submission(s): 590    Accepted Submission(s): 136\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">\n\nTeacher Mai is addicted to game 2048\\. But finally he finds it's too hard to get 2048\\. So he wants to change the rule:\n\nYou are given some numbers. Every time you can choose two numbers of the same value from them and merge these two numbers into their sum. And these two numbers disappear meanwhile.\n\nIf we can get 2048 from a set of numbers with this operation, Teacher Mai think this multiset is good.\n\nYou have n numbers, A<sub>1</sub>,...,A<sub>n</sub>. Teacher Mai ask you how many subsequences of A are good.\n\nThe number can be very large, just output the number modulo 998244353.\n<!--more-->\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">\n\nThere are multiple test cases, terminated by a line \"0\".\n\nFor each test case, the first line contains an integer n (1&lt;=n&lt;=10^5), the next line contains n integers a<sub>i</sub> (0&lt;=a<sub>i</sub>&lt;=2048).\n\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each test case, output one line \"Case #k: ans\", where k is the case number counting from 1, ans is the number module 998244353.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">4 1024 512 256 256 4 1024 1024 1024 1024 5 1024 512 512 512 1 0</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">\n\nCase #1: 1 Case #2: 11 Case #3: 8\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nIn the first case, we should choose all the numbers. In the second case, all the subsequences which contain more than one number are good.\n\n</div>\n&nbsp;\n\n</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 8 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Recommend</div>\n<div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  [4955](http://acm.hdu.edu.cn/showproblem.php?pid=4955) [4954](http://acm.hdu.edu.cn/showproblem.php?pid=4954) [4953](http://acm.hdu.edu.cn/showproblem.php?pid=4953) [4952](http://acm.hdu.edu.cn/showproblem.php?pid=4952) [4951](http://acm.hdu.edu.cn/showproblem.php?pid=4951)</div>\n<br/>\n- - -\n\n\n<div class=\"panel_content\">貌似这几天第一次做的DP题啊。想象一下二进制就能明白——当子序列的2次幂数字之和大于等于2048时这个序列就是good序列了。正面dp要dp出2048~100000肯定要超时，而反面dp只需要dp出0~2047就够了。复杂度大大降低O（11＊2048*2048）。</div>\n<div class=\"panel_content\">标程写的很厉害！尤其是逆元的处理！</div>\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define MOD 998244353\nint cnt[3010];\nLL f[101000], g[101000];\nint pn, n, __;\nint dp[13][1025]; //表示取了2^0、2^1、2^2、……、2^i种元素，总和加起来等于j*2^(i+1)的所有情况\ninline int getint() {\n    int ret = 0;\n    bool ok = 0;\n    for (;;) {\n        int c = getchar();\n        if (c &gt;= '0' &amp;&amp; c &lt;= '9') ret = (ret &lt;&lt; 3) + ret + ret + c - '0', ok = 1;\n        else if (ok) return ret;\n    }\n}\ninline LL powmod(LL b, int x) {\n    LL res = 1;\n    for (b %= MOD; x; x &gt;&gt;= 1) {\n        if (x &amp; 1) res = res * b % MOD;\n        b = b * b % MOD;\n    }\n    return res;\n}\nint main(int argc, char **argv) {\n    f[0] = 1;\n    for (int i = 1; i &lt;= 100000; i++)\n        f[i] = f[i - 1] * i % MOD;\n    g[100000] = powmod(f[100000], MOD - 2);\n    for (int i = 99999; i &gt;= 0; i--)\n        g[i] = g[i + 1] * (i + 1) % MOD;\n\n    while (1) {\n        n = getint();\n        if (n == 0) break;\n        for (int k = 1; k &lt;= 2048; k &lt;&lt;= 1)\n            cnt[k] = 0;\n        for (int i = 0; i &lt; n; i++) {\n            cnt[getint()]++;\n        }\n        pn = 0;\n        for (int k = 1; k &lt;= 2048; k &lt;&lt;= 1)\n            pn += cnt[k];\n        for (int i = 0, m = 1024; i &lt;= 11; i++, m &gt;&gt;= 1) {\n            for (int j = 0; j &lt;= m; j++) {\n                dp[i][j] = 0;\n            }\n        }\n        int ct = cnt[1];\n        LL cof = f[ct];\n        for (int i = 0; i &lt;= ct &amp;&amp; i &lt; 2048; i++) {\n            dp[0][i &gt;&gt; 1] += g[ct - i] * g[i] % MOD;\n            if (dp[0][i &gt;&gt; 1] &gt; MOD) dp[0][i &gt;&gt; 1] -= MOD;\n        }\n\n        for (int i = 1, m = 1024; i &lt;= 11; i++, m &gt;&gt;= 1) {\n            ct = cnt[1 &lt;&lt; i];\n            cof = cof * f[ct] % MOD;\n            for (int j = 0; j &lt; m; j++) { \n                if (dp[i - 1][j]) {\n                    for (int k = 0; k &lt;= ct &amp;&amp; j + k &lt; m; k++) {//不要把满足good的序列转移上去。\n                        dp[i][(j + k) &gt;&gt; 1] += dp[i - 1][j] * g[k] % MOD * g[ct - k] % MOD;\n                        if (dp[i][(j + k) &gt;&gt; 1] &gt; MOD) dp[i][(j + k) &gt;&gt; 1] -= MOD;\n                    }\n                }\n            }\n        }\n\n        int ans = (powmod(2, pn) - dp[11][0] * cof) % MOD\n                * powmod(2, n - pn)%MOD;\n        if (ans &lt; 0) ans += MOD;\n        printf(\"Case #%d: %d\\n\", ++__, ans);\n    }\n}\n```","source":"_posts/hdu-4945-2048.md","raw":"title: HDU 4945 2048\ncategories:\n  - ACM\nid: 91\ndate: 2014-08-15 16:56:19\ntags: DP\n---\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 3000/1500 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)\nTotal Submission(s): 590    Accepted Submission(s): 136\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">\n\nTeacher Mai is addicted to game 2048\\. But finally he finds it's too hard to get 2048\\. So he wants to change the rule:\n\nYou are given some numbers. Every time you can choose two numbers of the same value from them and merge these two numbers into their sum. And these two numbers disappear meanwhile.\n\nIf we can get 2048 from a set of numbers with this operation, Teacher Mai think this multiset is good.\n\nYou have n numbers, A<sub>1</sub>,...,A<sub>n</sub>. Teacher Mai ask you how many subsequences of A are good.\n\nThe number can be very large, just output the number modulo 998244353.\n<!--more-->\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">\n\nThere are multiple test cases, terminated by a line \"0\".\n\nFor each test case, the first line contains an integer n (1&lt;=n&lt;=10^5), the next line contains n integers a<sub>i</sub> (0&lt;=a<sub>i</sub>&lt;=2048).\n\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each test case, output one line \"Case #k: ans\", where k is the case number counting from 1, ans is the number module 998244353.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">4 1024 512 256 256 4 1024 1024 1024 1024 5 1024 512 512 512 1 0</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">\n\nCase #1: 1 Case #2: 11 Case #3: 8\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nIn the first case, we should choose all the numbers. In the second case, all the subsequences which contain more than one number are good.\n\n</div>\n&nbsp;\n\n</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 8 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Recommend</div>\n<div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  [4955](http://acm.hdu.edu.cn/showproblem.php?pid=4955) [4954](http://acm.hdu.edu.cn/showproblem.php?pid=4954) [4953](http://acm.hdu.edu.cn/showproblem.php?pid=4953) [4952](http://acm.hdu.edu.cn/showproblem.php?pid=4952) [4951](http://acm.hdu.edu.cn/showproblem.php?pid=4951)</div>\n<br/>\n- - -\n\n\n<div class=\"panel_content\">貌似这几天第一次做的DP题啊。想象一下二进制就能明白——当子序列的2次幂数字之和大于等于2048时这个序列就是good序列了。正面dp要dp出2048~100000肯定要超时，而反面dp只需要dp出0~2047就够了。复杂度大大降低O（11＊2048*2048）。</div>\n<div class=\"panel_content\">标程写的很厉害！尤其是逆元的处理！</div>\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define MOD 998244353\nint cnt[3010];\nLL f[101000], g[101000];\nint pn, n, __;\nint dp[13][1025]; //表示取了2^0、2^1、2^2、……、2^i种元素，总和加起来等于j*2^(i+1)的所有情况\ninline int getint() {\n    int ret = 0;\n    bool ok = 0;\n    for (;;) {\n        int c = getchar();\n        if (c &gt;= '0' &amp;&amp; c &lt;= '9') ret = (ret &lt;&lt; 3) + ret + ret + c - '0', ok = 1;\n        else if (ok) return ret;\n    }\n}\ninline LL powmod(LL b, int x) {\n    LL res = 1;\n    for (b %= MOD; x; x &gt;&gt;= 1) {\n        if (x &amp; 1) res = res * b % MOD;\n        b = b * b % MOD;\n    }\n    return res;\n}\nint main(int argc, char **argv) {\n    f[0] = 1;\n    for (int i = 1; i &lt;= 100000; i++)\n        f[i] = f[i - 1] * i % MOD;\n    g[100000] = powmod(f[100000], MOD - 2);\n    for (int i = 99999; i &gt;= 0; i--)\n        g[i] = g[i + 1] * (i + 1) % MOD;\n\n    while (1) {\n        n = getint();\n        if (n == 0) break;\n        for (int k = 1; k &lt;= 2048; k &lt;&lt;= 1)\n            cnt[k] = 0;\n        for (int i = 0; i &lt; n; i++) {\n            cnt[getint()]++;\n        }\n        pn = 0;\n        for (int k = 1; k &lt;= 2048; k &lt;&lt;= 1)\n            pn += cnt[k];\n        for (int i = 0, m = 1024; i &lt;= 11; i++, m &gt;&gt;= 1) {\n            for (int j = 0; j &lt;= m; j++) {\n                dp[i][j] = 0;\n            }\n        }\n        int ct = cnt[1];\n        LL cof = f[ct];\n        for (int i = 0; i &lt;= ct &amp;&amp; i &lt; 2048; i++) {\n            dp[0][i &gt;&gt; 1] += g[ct - i] * g[i] % MOD;\n            if (dp[0][i &gt;&gt; 1] &gt; MOD) dp[0][i &gt;&gt; 1] -= MOD;\n        }\n\n        for (int i = 1, m = 1024; i &lt;= 11; i++, m &gt;&gt;= 1) {\n            ct = cnt[1 &lt;&lt; i];\n            cof = cof * f[ct] % MOD;\n            for (int j = 0; j &lt; m; j++) { \n                if (dp[i - 1][j]) {\n                    for (int k = 0; k &lt;= ct &amp;&amp; j + k &lt; m; k++) {//不要把满足good的序列转移上去。\n                        dp[i][(j + k) &gt;&gt; 1] += dp[i - 1][j] * g[k] % MOD * g[ct - k] % MOD;\n                        if (dp[i][(j + k) &gt;&gt; 1] &gt; MOD) dp[i][(j + k) &gt;&gt; 1] -= MOD;\n                    }\n                }\n            }\n        }\n\n        int ans = (powmod(2, pn) - dp[11][0] * cof) % MOD\n                * powmod(2, n - pn)%MOD;\n        if (ans &lt; 0) ans += MOD;\n        printf(\"Case #%d: %d\\n\", ++__, ans);\n    }\n}\n```","slug":"hdu-4945-2048","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1a002y5rgxyc60cllz","content":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 3000/1500 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)<br>Total Submission(s): 590    Accepted Submission(s): 136<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<div class=\"panel_content\">\n\n<p>Teacher Mai is addicted to game 2048. But finally he finds it’s too hard to get 2048. So he wants to change the rule:</p>\n<p>You are given some numbers. Every time you can choose two numbers of the same value from them and merge these two numbers into their sum. And these two numbers disappear meanwhile.</p>\n<p>If we can get 2048 from a set of numbers with this operation, Teacher Mai think this multiset is good.</p>\n<p>You have n numbers, A<sub>1</sub>,…,A<sub>n</sub>. Teacher Mai ask you how many subsequences of A are good.</p>\n<p>The number can be very large, just output the number modulo 998244353.<br><a id=\"more\"></a><br></p></div><p></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<div class=\"panel_content\">\n\n<p>There are multiple test cases, terminated by a line “0”.</p>\n<p>For each test case, the first line contains an integer n (1&lt;=n&lt;=10^5), the next line contains n integers a<sub>i</sub> (0&lt;=a<sub>i</sub>&lt;=2048).</p>\n<p></p></div><p></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each test case, output one line “Case #k: ans”, where k is the case number counting from 1, ans is the number module 998244353.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">4 1024 512 256 256 4 1024 1024 1024 1024 5 1024 512 512 512 1 0</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<div style=\"font-family: Courier New,Courier,monospace;\">\n\n<p>Case #1: 1 Case #2: 11 Case #3: 8</p>\n<p><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"></div></p>\n<p><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>In the first case, we should choose all the numbers. In the second case, all the subsequences which contain more than one number are good.</p>\n<p></p></div><br>&nbsp;<p></p>\n<p><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> 2014 Multi-University Training Contest 8 </a></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Recommend</div></p>\n<p><div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4955\" target=\"_blank\" rel=\"external\">4955</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4954\" target=\"_blank\" rel=\"external\">4954</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4953\" target=\"_blank\" rel=\"external\">4953</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4952\" target=\"_blank\" rel=\"external\">4952</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4951\" target=\"_blank\" rel=\"external\">4951</a></div><br><br></p>\n<hr>\n<p><div class=\"panel_content\">貌似这几天第一次做的DP题啊。想象一下二进制就能明白——当子序列的2次幂数字之和大于等于2048时这个序列就是good序列了。正面dp要dp出2048~100000肯定要超时，而反面dp只需要dp出0~2047就够了。复杂度大大降低O（11＊2048*2048）。</div></p>\n<p><div class=\"panel_content\">标程写的很厉害！尤其是逆元的处理！</div><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOD 998244353</span></div><div class=\"line\"><span class=\"keyword\">int</span> cnt[<span class=\"number\">3010</span>];</div><div class=\"line\">LL f[<span class=\"number\">101000</span>], g[<span class=\"number\">101000</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> pn, n, __;</div><div class=\"line\"><span class=\"keyword\">int</span> dp[<span class=\"number\">13</span>][<span class=\"number\">1025</span>]; <span class=\"comment\">//表示取了2^0、2^1、2^2、……、2^i种元素，总和加起来等于j*2^(i+1)的所有情况</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">getint</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> ret = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">bool</span> ok = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> c = getchar();</div><div class=\"line\">        <span class=\"keyword\">if</span> (c &amp;gt;= <span class=\"string\">'0'</span> &amp;amp;&amp;amp; c &amp;lt;= <span class=\"string\">'9'</span>) ret = (ret &amp;lt;&amp;lt; <span class=\"number\">3</span>) + ret + ret + c - <span class=\"string\">'0'</span>, ok = <span class=\"number\">1</span>;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ok) <span class=\"keyword\">return</span> ret;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> LL <span class=\"title\">powmod</span><span class=\"params\">(LL b, <span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    LL res = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (b %= MOD; x; x &amp;gt;&amp;gt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (x &amp;amp; <span class=\"number\">1</span>) res = res * b % MOD;</div><div class=\"line\">        b = b * b % MOD;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    f[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= <span class=\"number\">100000</span>; i++)</div><div class=\"line\">        f[i] = f[i - <span class=\"number\">1</span>] * i % MOD;</div><div class=\"line\">    g[<span class=\"number\">100000</span>] = powmod(f[<span class=\"number\">100000</span>], MOD - <span class=\"number\">2</span>);</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">99999</span>; i &amp;gt;= <span class=\"number\">0</span>; i--)</div><div class=\"line\">        g[i] = g[i + <span class=\"number\">1</span>] * (i + <span class=\"number\">1</span>) % MOD;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</div><div class=\"line\">        n = getint();</div><div class=\"line\">        <span class=\"keyword\">if</span> (n == <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">1</span>; k &amp;lt;= <span class=\"number\">2048</span>; k &amp;lt;&amp;lt;= <span class=\"number\">1</span>)</div><div class=\"line\">            cnt[k] = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            cnt[getint()]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        pn = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">1</span>; k &amp;lt;= <span class=\"number\">2048</span>; k &amp;lt;&amp;lt;= <span class=\"number\">1</span>)</div><div class=\"line\">            pn += cnt[k];</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>, m = <span class=\"number\">1024</span>; i &amp;lt;= <span class=\"number\">11</span>; i++, m &amp;gt;&amp;gt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt;= m; j++) &#123;</div><div class=\"line\">                dp[i][j] = <span class=\"number\">0</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> ct = cnt[<span class=\"number\">1</span>];</div><div class=\"line\">        LL cof = f[ct];</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= ct &amp;amp;&amp;amp; i &amp;lt; <span class=\"number\">2048</span>; i++) &#123;</div><div class=\"line\">            dp[<span class=\"number\">0</span>][i &amp;gt;&amp;gt; <span class=\"number\">1</span>] += g[ct - i] * g[i] % MOD;</div><div class=\"line\">            <span class=\"keyword\">if</span> (dp[<span class=\"number\">0</span>][i &amp;gt;&amp;gt; <span class=\"number\">1</span>] &amp;gt; MOD) dp[<span class=\"number\">0</span>][i &amp;gt;&amp;gt; <span class=\"number\">1</span>] -= MOD;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>, m = <span class=\"number\">1024</span>; i &amp;lt;= <span class=\"number\">11</span>; i++, m &amp;gt;&amp;gt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">            ct = cnt[<span class=\"number\">1</span> &amp;lt;&amp;lt; i];</div><div class=\"line\">            cof = cof * f[ct] % MOD;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt; m; j++) &#123; </div><div class=\"line\">                <span class=\"keyword\">if</span> (dp[i - <span class=\"number\">1</span>][j]) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">0</span>; k &amp;lt;= ct &amp;amp;&amp;amp; j + k &amp;lt; m; k++) &#123;<span class=\"comment\">//不要把满足good的序列转移上去。</span></div><div class=\"line\">                        dp[i][(j + k) &amp;gt;&amp;gt; <span class=\"number\">1</span>] += dp[i - <span class=\"number\">1</span>][j] * g[k] % MOD * g[ct - k] % MOD;</div><div class=\"line\">                        <span class=\"keyword\">if</span> (dp[i][(j + k) &amp;gt;&amp;gt; <span class=\"number\">1</span>] &amp;gt; MOD) dp[i][(j + k) &amp;gt;&amp;gt; <span class=\"number\">1</span>] -= MOD;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> ans = (powmod(<span class=\"number\">2</span>, pn) - dp[<span class=\"number\">11</span>][<span class=\"number\">0</span>] * cof) % MOD</div><div class=\"line\">                * powmod(<span class=\"number\">2</span>, n - pn)%MOD;</div><div class=\"line\">        <span class=\"keyword\">if</span> (ans &amp;lt; <span class=\"number\">0</span>) ans += MOD;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"Case #%d: %d\\n\"</span>, ++__, ans);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 3000/1500 MS (Java/Others)    Memory Limit: 65536/65536 K (Java/Others)<br>Total Submission(s): 590    Accepted Submission(s): 136<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<div class=\"panel_content\">\n\n<p>Teacher Mai is addicted to game 2048. But finally he finds it’s too hard to get 2048. So he wants to change the rule:</p>\n<p>You are given some numbers. Every time you can choose two numbers of the same value from them and merge these two numbers into their sum. And these two numbers disappear meanwhile.</p>\n<p>If we can get 2048 from a set of numbers with this operation, Teacher Mai think this multiset is good.</p>\n<p>You have n numbers, A<sub>1</sub>,…,A<sub>n</sub>. Teacher Mai ask you how many subsequences of A are good.</p>\n<p>The number can be very large, just output the number modulo 998244353.<br>","more":"<br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<div class=\"panel_content\">\n\n<p>There are multiple test cases, terminated by a line “0”.</p>\n<p>For each test case, the first line contains an integer n (1&lt;=n&lt;=10^5), the next line contains n integers a<sub>i</sub> (0&lt;=a<sub>i</sub>&lt;=2048).</p>\n<p></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each test case, output one line “Case #k: ans”, where k is the case number counting from 1, ans is the number module 998244353.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">4 1024 512 256 256 4 1024 1024 1024 1024 5 1024 512 512 512 1 0</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<div style=\"font-family: Courier New,Courier,monospace;\">\n\n<p>Case #1: 1 Case #2: 11 Case #3: 8</p>\n<p><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"></p>\n<p><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>In the first case, we should choose all the numbers. In the second case, all the subsequences which contain more than one number are good.</p>\n<p></div><br>&nbsp;</p>\n<p></div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%208&amp;source=1&amp;searchmode=source\"> 2014 Multi-University Training Contest 8 </a></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Recommend</div></p>\n<p><div class=\"panel_content\">hujie   |   We have carefully selected several similar problems for you:  <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4955\">4955</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4954\">4954</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4953\">4953</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4952\">4952</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4951\">4951</a></div><br><br/></p>\n<hr>\n<p><div class=\"panel_content\">貌似这几天第一次做的DP题啊。想象一下二进制就能明白——当子序列的2次幂数字之和大于等于2048时这个序列就是good序列了。正面dp要dp出2048~100000肯定要超时，而反面dp只需要dp出0~2047就够了。复杂度大大降低O（11＊2048*2048）。</div></p>\n<p><div class=\"panel_content\">标程写的很厉害！尤其是逆元的处理！</div><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MOD 998244353</span></div><div class=\"line\"><span class=\"keyword\">int</span> cnt[<span class=\"number\">3010</span>];</div><div class=\"line\">LL f[<span class=\"number\">101000</span>], g[<span class=\"number\">101000</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> pn, n, __;</div><div class=\"line\"><span class=\"keyword\">int</span> dp[<span class=\"number\">13</span>][<span class=\"number\">1025</span>]; <span class=\"comment\">//表示取了2^0、2^1、2^2、……、2^i种元素，总和加起来等于j*2^(i+1)的所有情况</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">getint</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> ret = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">bool</span> ok = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> c = getchar();</div><div class=\"line\">        <span class=\"keyword\">if</span> (c &amp;gt;= <span class=\"string\">'0'</span> &amp;amp;&amp;amp; c &amp;lt;= <span class=\"string\">'9'</span>) ret = (ret &amp;lt;&amp;lt; <span class=\"number\">3</span>) + ret + ret + c - <span class=\"string\">'0'</span>, ok = <span class=\"number\">1</span>;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ok) <span class=\"keyword\">return</span> ret;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> LL <span class=\"title\">powmod</span><span class=\"params\">(LL b, <span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    LL res = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (b %= MOD; x; x &amp;gt;&amp;gt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (x &amp;amp; <span class=\"number\">1</span>) res = res * b % MOD;</div><div class=\"line\">        b = b * b % MOD;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    f[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= <span class=\"number\">100000</span>; i++)</div><div class=\"line\">        f[i] = f[i - <span class=\"number\">1</span>] * i % MOD;</div><div class=\"line\">    g[<span class=\"number\">100000</span>] = powmod(f[<span class=\"number\">100000</span>], MOD - <span class=\"number\">2</span>);</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">99999</span>; i &amp;gt;= <span class=\"number\">0</span>; i--)</div><div class=\"line\">        g[i] = g[i + <span class=\"number\">1</span>] * (i + <span class=\"number\">1</span>) % MOD;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</div><div class=\"line\">        n = getint();</div><div class=\"line\">        <span class=\"keyword\">if</span> (n == <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">1</span>; k &amp;lt;= <span class=\"number\">2048</span>; k &amp;lt;&amp;lt;= <span class=\"number\">1</span>)</div><div class=\"line\">            cnt[k] = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            cnt[getint()]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        pn = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">1</span>; k &amp;lt;= <span class=\"number\">2048</span>; k &amp;lt;&amp;lt;= <span class=\"number\">1</span>)</div><div class=\"line\">            pn += cnt[k];</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>, m = <span class=\"number\">1024</span>; i &amp;lt;= <span class=\"number\">11</span>; i++, m &amp;gt;&amp;gt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt;= m; j++) &#123;</div><div class=\"line\">                dp[i][j] = <span class=\"number\">0</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> ct = cnt[<span class=\"number\">1</span>];</div><div class=\"line\">        LL cof = f[ct];</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= ct &amp;amp;&amp;amp; i &amp;lt; <span class=\"number\">2048</span>; i++) &#123;</div><div class=\"line\">            dp[<span class=\"number\">0</span>][i &amp;gt;&amp;gt; <span class=\"number\">1</span>] += g[ct - i] * g[i] % MOD;</div><div class=\"line\">            <span class=\"keyword\">if</span> (dp[<span class=\"number\">0</span>][i &amp;gt;&amp;gt; <span class=\"number\">1</span>] &amp;gt; MOD) dp[<span class=\"number\">0</span>][i &amp;gt;&amp;gt; <span class=\"number\">1</span>] -= MOD;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>, m = <span class=\"number\">1024</span>; i &amp;lt;= <span class=\"number\">11</span>; i++, m &amp;gt;&amp;gt;= <span class=\"number\">1</span>) &#123;</div><div class=\"line\">            ct = cnt[<span class=\"number\">1</span> &amp;lt;&amp;lt; i];</div><div class=\"line\">            cof = cof * f[ct] % MOD;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt; m; j++) &#123; </div><div class=\"line\">                <span class=\"keyword\">if</span> (dp[i - <span class=\"number\">1</span>][j]) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">0</span>; k &amp;lt;= ct &amp;amp;&amp;amp; j + k &amp;lt; m; k++) &#123;<span class=\"comment\">//不要把满足good的序列转移上去。</span></div><div class=\"line\">                        dp[i][(j + k) &amp;gt;&amp;gt; <span class=\"number\">1</span>] += dp[i - <span class=\"number\">1</span>][j] * g[k] % MOD * g[ct - k] % MOD;</div><div class=\"line\">                        <span class=\"keyword\">if</span> (dp[i][(j + k) &amp;gt;&amp;gt; <span class=\"number\">1</span>] &amp;gt; MOD) dp[i][(j + k) &amp;gt;&amp;gt; <span class=\"number\">1</span>] -= MOD;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> ans = (powmod(<span class=\"number\">2</span>, pn) - dp[<span class=\"number\">11</span>][<span class=\"number\">0</span>] * cof) % MOD</div><div class=\"line\">                * powmod(<span class=\"number\">2</span>, n - pn)%MOD;</div><div class=\"line\">        <span class=\"keyword\">if</span> (ans &amp;lt; <span class=\"number\">0</span>) ans += MOD;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"Case #%d: %d\\n\"</span>, ++__, ans);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"HDU4612 Warm up","id":"29","date":"2014-07-30T11:37:32.000Z","_content":"\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 65535/65535 K (Java/Others)\nTotal Submission(s): 3532    Accepted Submission(s): 813</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">　 　N planets are connected by M bidirectional channels that allow instant transportation. It's always possible to travel between any two planets through these channels.\nIf we can isolate some planets from others by breaking only one channel , the channel is called a bridge of the transportation system.\nPeople don't like to be isolated. So they ask what's the minimal number of bridges they can have if they decide to build a new channel.\nNote that there could be more than one channel between two planets.</div>\n<!--more-->\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">　　The input contains multiple cases.\nEach case starts with two positive integers N and M , indicating the number of planets and the number of channels.\n(2&lt;=N&lt;=200000, 1&lt;=M&lt;=1000000)\nNext M lines each contains two positive integers A and B, indicating a channel between planet A and B in the system. Planets are numbered by 1..N.\nA line with two integers '0' terminates the input.</div>\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">　　For each case, output the minimal number of bridges after building a new channel in a line.</div>\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">4 4 1 2 1 3 1 4 2 3 0 0</div>\n</div>\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">0</div>\n</div>\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2013 Multi-University Training Contest 2 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2013%20Multi-University%20Training%20Contest%202&amp;source=1&amp;searchmode=source)</div>\n<br/>\n\n- - -\n\n\n```C++\n#pragma comment(linker, \"/STACK:1024000000,1024000000\")//C++加栈\n#include\n#include\n#include\n#include\n#include\n#include\n#include\n#include<map>\n#include\n#include\n#include\nusing namespace std;\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\n#define N 200005\n#define M 1000005\nint n, m;\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\nstruct edge {\n\tint v, nxt;\n} e[M &lt;&lt; 1];\nstruct bridge {\n\tint u, v;\n\tbridge(int u, int v) {\n\t\tthis-&gt;u = u;\n\t\tthis-&gt;v = v;\n\t}\n};\nint pos, head[N];\nint top, stk[N];\nint pre[N], dfs_clock, belong[N], bcnt;\nvector brg;\nvoid InitEdge() {\n\tmemset(head, -1, sizeof(head));\n\tpos = 0;\n}\nvoid add(int u, int v) {\n\te[pos].v = v;\n\te[pos].nxt = head[u];\n\thead[u] = pos++;\n}\nint dfs(int u, int fa) {\n\tint lowu = pre[u] = ++dfs_clock;\n\tstk[top++] = u;\n\tbool vis = true;\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif (v == fa &amp;&amp; vis) {\n\t\t\tvis = false; //u-v的反向边一定是v-u邻接表里的第一条边。\n\t\t\tcontinue;\n\t\t}\n\t\tif (!pre[v]) {\n\t\t\tint lowv = dfs(v, u);\n\t\t\tlowu = min(lowu, lowv);\n\t\t\tif (lowv &gt; pre[u]) { //u-v为桥\n\t\t\t\tbrg.push_back(bridge(u, v));\n\t\t\t}\n\t\t} else lowu = min(lowu, pre[v]);\n\t}\n\tif (pre[u] == lowu) {\n\t\tbcnt++;\n\t\tdo {\n\t\t\tbelong[stk[--top]] = bcnt;\n\t\t} while (stk[top] != u);\n\t}\n\treturn lowu;\n}\nvoid tarjan() {\n\ttop = bcnt = dfs_clock = 0;\n\tmemset(pre, 0, sizeof(pre));\n\tmemset(belong, 0, sizeof(belong));\n\tbrg.clear();\n\tfor (int i = 1; i &lt;= n; i++) {\n\t\tif (!pre[i]) dfs(i, -1);\n\t}\n}\nvoid rebuild() { //根据桥来缩点重构图\n\tInitEdge();\n\tfor (int i = 0; i &lt; (int) brg.size(); i++) {\n\t\tint u = belong[brg[i].u];\n\t\tint v = belong[brg[i].v];\n\t\tadd(u, v);\n\t\tadd(v, u);\n\t}\n}\nint diameter = 0;\nint findR(int u, int fa) {\n\tint h1 = 0, h2 = 0; // 以u为根，h1最高的儿子，h2次高儿子。放在dfs里面两者不会重合。\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif (v == fa) continue;\n\t\tint h = findR(v, u) + 1; //若路径有权重，则把1改为u-v的权重\n\t\tif (h &gt; h1) h2 = h1, h1 = h;\n\t\telse h2 = max(h, h2);\n\t}\n\tdiameter = max(diameter, h1 + h2);\n\treturn h1;\n}\nvoid tree_diameter() {\n\tdiameter = 0;\n\tfindR(1, -1);\n}\nint main() {\n\twhile (scanf(\"%d%d\", &amp;n, &amp;m), n || m) {\n\t\tint u, v;\n\t\tInitEdge();\n\t\tfor (int i = 0; i &lt; m; i++) {\n\t\t\tscanf(\"%d%d\", &amp;u, &amp;v);\n\t\t\tadd(u, v);\n\t\t\tadd(v, u);\n\t\t}\n\t\ttarjan();\n\t\trebuild();\n\t\ttree_diameter();\n\t\tprintf(\"%d\\n\", bcnt - diameter - 1);\n\t}\n}\n```","source":"_posts/hdu4612-warm-up.md","raw":"title: HDU4612 Warm up\ntags:\n  - tarjan\n  - 图论\n  - 树的直径\ncategories:\n  - ACM\nid: 29\ndate: 2014-07-30 19:37:32\n---\n\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 65535/65535 K (Java/Others)\nTotal Submission(s): 3532    Accepted Submission(s): 813</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">　 　N planets are connected by M bidirectional channels that allow instant transportation. It's always possible to travel between any two planets through these channels.\nIf we can isolate some planets from others by breaking only one channel , the channel is called a bridge of the transportation system.\nPeople don't like to be isolated. So they ask what's the minimal number of bridges they can have if they decide to build a new channel.\nNote that there could be more than one channel between two planets.</div>\n<!--more-->\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">　　The input contains multiple cases.\nEach case starts with two positive integers N and M , indicating the number of planets and the number of channels.\n(2&lt;=N&lt;=200000, 1&lt;=M&lt;=1000000)\nNext M lines each contains two positive integers A and B, indicating a channel between planet A and B in the system. Planets are numbered by 1..N.\nA line with two integers '0' terminates the input.</div>\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">　　For each case, output the minimal number of bridges after building a new channel in a line.</div>\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">4 4 1 2 1 3 1 4 2 3 0 0</div>\n</div>\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">0</div>\n</div>\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2013 Multi-University Training Contest 2 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2013%20Multi-University%20Training%20Contest%202&amp;source=1&amp;searchmode=source)</div>\n<br/>\n\n- - -\n\n\n```C++\n#pragma comment(linker, \"/STACK:1024000000,1024000000\")//C++加栈\n#include\n#include\n#include\n#include\n#include\n#include\n#include\n#include<map>\n#include\n#include\n#include\nusing namespace std;\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\n#define N 200005\n#define M 1000005\nint n, m;\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\nstruct edge {\n\tint v, nxt;\n} e[M &lt;&lt; 1];\nstruct bridge {\n\tint u, v;\n\tbridge(int u, int v) {\n\t\tthis-&gt;u = u;\n\t\tthis-&gt;v = v;\n\t}\n};\nint pos, head[N];\nint top, stk[N];\nint pre[N], dfs_clock, belong[N], bcnt;\nvector brg;\nvoid InitEdge() {\n\tmemset(head, -1, sizeof(head));\n\tpos = 0;\n}\nvoid add(int u, int v) {\n\te[pos].v = v;\n\te[pos].nxt = head[u];\n\thead[u] = pos++;\n}\nint dfs(int u, int fa) {\n\tint lowu = pre[u] = ++dfs_clock;\n\tstk[top++] = u;\n\tbool vis = true;\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif (v == fa &amp;&amp; vis) {\n\t\t\tvis = false; //u-v的反向边一定是v-u邻接表里的第一条边。\n\t\t\tcontinue;\n\t\t}\n\t\tif (!pre[v]) {\n\t\t\tint lowv = dfs(v, u);\n\t\t\tlowu = min(lowu, lowv);\n\t\t\tif (lowv &gt; pre[u]) { //u-v为桥\n\t\t\t\tbrg.push_back(bridge(u, v));\n\t\t\t}\n\t\t} else lowu = min(lowu, pre[v]);\n\t}\n\tif (pre[u] == lowu) {\n\t\tbcnt++;\n\t\tdo {\n\t\t\tbelong[stk[--top]] = bcnt;\n\t\t} while (stk[top] != u);\n\t}\n\treturn lowu;\n}\nvoid tarjan() {\n\ttop = bcnt = dfs_clock = 0;\n\tmemset(pre, 0, sizeof(pre));\n\tmemset(belong, 0, sizeof(belong));\n\tbrg.clear();\n\tfor (int i = 1; i &lt;= n; i++) {\n\t\tif (!pre[i]) dfs(i, -1);\n\t}\n}\nvoid rebuild() { //根据桥来缩点重构图\n\tInitEdge();\n\tfor (int i = 0; i &lt; (int) brg.size(); i++) {\n\t\tint u = belong[brg[i].u];\n\t\tint v = belong[brg[i].v];\n\t\tadd(u, v);\n\t\tadd(v, u);\n\t}\n}\nint diameter = 0;\nint findR(int u, int fa) {\n\tint h1 = 0, h2 = 0; // 以u为根，h1最高的儿子，h2次高儿子。放在dfs里面两者不会重合。\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif (v == fa) continue;\n\t\tint h = findR(v, u) + 1; //若路径有权重，则把1改为u-v的权重\n\t\tif (h &gt; h1) h2 = h1, h1 = h;\n\t\telse h2 = max(h, h2);\n\t}\n\tdiameter = max(diameter, h1 + h2);\n\treturn h1;\n}\nvoid tree_diameter() {\n\tdiameter = 0;\n\tfindR(1, -1);\n}\nint main() {\n\twhile (scanf(\"%d%d\", &amp;n, &amp;m), n || m) {\n\t\tint u, v;\n\t\tInitEdge();\n\t\tfor (int i = 0; i &lt; m; i++) {\n\t\t\tscanf(\"%d%d\", &amp;u, &amp;v);\n\t\t\tadd(u, v);\n\t\t\tadd(v, u);\n\t\t}\n\t\ttarjan();\n\t\trebuild();\n\t\ttree_diameter();\n\t\tprintf(\"%d\\n\", bcnt - diameter - 1);\n\t}\n}\n```","slug":"hdu4612-warm-up","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1c00315rgxhcf5vj43","content":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 65535/65535 K (Java/Others)<br>Total Submission(s): 3532    Accepted Submission(s): 813</span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">　 　N planets are connected by M bidirectional channels that allow instant transportation. It’s always possible to travel between any two planets through these channels.<br>If we can isolate some planets from others by breaking only one channel , the channel is called a bridge of the transportation system.<br>People don’t like to be isolated. So they ask what’s the minimal number of bridges they can have if they decide to build a new channel.<br>Note that there could be more than one channel between two planets.</div><br><a id=\"more\"></a></p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">　　The input contains multiple cases.<br>Each case starts with two positive integers N and M , indicating the number of planets and the number of channels.<br>(2&lt;=N&lt;=200000, 1&lt;=M&lt;=1000000)<br>Next M lines each contains two positive integers A and B, indicating a channel between planet A and B in the system. Planets are numbered by 1..N.<br>A line with two integers ‘0’ terminates the input.</div></p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">　　For each case, output the minimal number of bridges after building a new channel in a line.</div></p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">4 4 1 2 1 3 1 4 2 3 0 0</div><br></p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">0</div><br></p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2013%20Multi-University%20Training%20Contest%202&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> 2013 Multi-University Training Contest 2 </a></div><br><br></p>\n<hr>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> comment(linker, <span class=\"meta-string\">\"/STACK:1024000000,1024000000\"</span>)<span class=\"comment\">//C++加栈</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;map&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 200005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 1000005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">struct</span> edge &#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> v, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">struct</span> bridge &#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> u, v;</div><div class=\"line\">\tbridge(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>-&amp;gt;u = u;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>-&amp;gt;v = v;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">int</span> pos, head[N];</div><div class=\"line\"><span class=\"keyword\">int</span> top, stk[N];</div><div class=\"line\"><span class=\"keyword\">int</span> pre[N], dfs_clock, belong[N], bcnt;</div><div class=\"line\"><span class=\"built_in\">vector</span> brg;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">InitEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">\tpos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">\te[pos].v = v;</div><div class=\"line\">\te[pos].nxt = head[u];</div><div class=\"line\">\thead[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> lowu = pre[u] = ++dfs_clock;</div><div class=\"line\">\tstk[top++] = u;</div><div class=\"line\">\t<span class=\"keyword\">bool</span> vis = <span class=\"literal\">true</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (v == fa &amp;amp;&amp;amp; vis) &#123;</div><div class=\"line\">\t\t\tvis = <span class=\"literal\">false</span>; <span class=\"comment\">//u-v的反向边一定是v-u邻接表里的第一条边。</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (!pre[v]) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">int</span> lowv = dfs(v, u);</div><div class=\"line\">\t\t\tlowu = min(lowu, lowv);</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (lowv &amp;gt; pre[u]) &#123; <span class=\"comment\">//u-v为桥</span></div><div class=\"line\">\t\t\t\tbrg.push_back(bridge(u, v));</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> lowu = min(lowu, pre[v]);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (pre[u] == lowu) &#123;</div><div class=\"line\">\t\tbcnt++;</div><div class=\"line\">\t\t<span class=\"keyword\">do</span> &#123;</div><div class=\"line\">\t\t\tbelong[stk[--top]] = bcnt;</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">while</span> (stk[top] != u);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> lowu;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\ttop = bcnt = dfs_clock = <span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"built_in\">memset</span>(pre, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(pre));</div><div class=\"line\">\t<span class=\"built_in\">memset</span>(belong, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(belong));</div><div class=\"line\">\tbrg.clear();</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (!pre[i]) dfs(i, <span class=\"number\">-1</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">rebuild</span><span class=\"params\">()</span> </span>&#123; <span class=\"comment\">//根据桥来缩点重构图</span></div><div class=\"line\">\tInitEdge();</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) brg.size(); i++) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> u = belong[brg[i].u];</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> v = belong[brg[i].v];</div><div class=\"line\">\t\tadd(u, v);</div><div class=\"line\">\t\tadd(v, u);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> diameter = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findR</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> h1 = <span class=\"number\">0</span>, h2 = <span class=\"number\">0</span>; <span class=\"comment\">// 以u为根，h1最高的儿子，h2次高儿子。放在dfs里面两者不会重合。</span></div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> h = findR(v, u) + <span class=\"number\">1</span>; <span class=\"comment\">//若路径有权重，则把1改为u-v的权重</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (h &amp;gt; h1) h2 = h1, h1 = h;</div><div class=\"line\">\t\t<span class=\"keyword\">else</span> h2 = max(h, h2);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tdiameter = max(diameter, h1 + h2);</div><div class=\"line\">\t<span class=\"keyword\">return</span> h1;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tree_diameter</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tdiameter = <span class=\"number\">0</span>;</div><div class=\"line\">\tfindR(<span class=\"number\">1</span>, <span class=\"number\">-1</span>);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m), n || m) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> u, v;</div><div class=\"line\">\t\tInitEdge();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; m; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">\t\t\tadd(u, v);</div><div class=\"line\">\t\t\tadd(v, u);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\ttarjan();</div><div class=\"line\">\t\trebuild();</div><div class=\"line\">\t\ttree_diameter();</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, bcnt - diameter - <span class=\"number\">1</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","excerpt":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 10000/5000 MS (Java/Others)    Memory Limit: 65535/65535 K (Java/Others)<br>Total Submission(s): 3532    Accepted Submission(s): 813</span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">　 　N planets are connected by M bidirectional channels that allow instant transportation. It’s always possible to travel between any two planets through these channels.<br>If we can isolate some planets from others by breaking only one channel , the channel is called a bridge of the transportation system.<br>People don’t like to be isolated. So they ask what’s the minimal number of bridges they can have if they decide to build a new channel.<br>Note that there could be more than one channel between two planets.</div><br>","more":"</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">　　The input contains multiple cases.<br>Each case starts with two positive integers N and M , indicating the number of planets and the number of channels.<br>(2&lt;=N&lt;=200000, 1&lt;=M&lt;=1000000)<br>Next M lines each contains two positive integers A and B, indicating a channel between planet A and B in the system. Planets are numbered by 1..N.<br>A line with two integers ‘0’ terminates the input.</div></p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">　　For each case, output the minimal number of bridges after building a new channel in a line.</div></p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">4 4 1 2 1 3 1 4 2 3 0 0</div><br></div></p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">0</div><br></div></p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2013%20Multi-University%20Training%20Contest%202&amp;source=1&amp;searchmode=source\"> 2013 Multi-University Training Contest 2 </a></div><br><br/></p>\n<hr>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> comment(linker, <span class=\"meta-string\">\"/STACK:1024000000,1024000000\"</span>)<span class=\"comment\">//C++加栈</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;map&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 200005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 1000005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">struct</span> edge &#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> v, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">struct</span> bridge &#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> u, v;</div><div class=\"line\">\tbridge(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>-&amp;gt;u = u;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>-&amp;gt;v = v;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">int</span> pos, head[N];</div><div class=\"line\"><span class=\"keyword\">int</span> top, stk[N];</div><div class=\"line\"><span class=\"keyword\">int</span> pre[N], dfs_clock, belong[N], bcnt;</div><div class=\"line\"><span class=\"built_in\">vector</span> brg;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">InitEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">\tpos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">\te[pos].v = v;</div><div class=\"line\">\te[pos].nxt = head[u];</div><div class=\"line\">\thead[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> lowu = pre[u] = ++dfs_clock;</div><div class=\"line\">\tstk[top++] = u;</div><div class=\"line\">\t<span class=\"keyword\">bool</span> vis = <span class=\"literal\">true</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (v == fa &amp;amp;&amp;amp; vis) &#123;</div><div class=\"line\">\t\t\tvis = <span class=\"literal\">false</span>; <span class=\"comment\">//u-v的反向边一定是v-u邻接表里的第一条边。</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (!pre[v]) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">int</span> lowv = dfs(v, u);</div><div class=\"line\">\t\t\tlowu = min(lowu, lowv);</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (lowv &amp;gt; pre[u]) &#123; <span class=\"comment\">//u-v为桥</span></div><div class=\"line\">\t\t\t\tbrg.push_back(bridge(u, v));</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> lowu = min(lowu, pre[v]);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (pre[u] == lowu) &#123;</div><div class=\"line\">\t\tbcnt++;</div><div class=\"line\">\t\t<span class=\"keyword\">do</span> &#123;</div><div class=\"line\">\t\t\tbelong[stk[--top]] = bcnt;</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">while</span> (stk[top] != u);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> lowu;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\ttop = bcnt = dfs_clock = <span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"built_in\">memset</span>(pre, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(pre));</div><div class=\"line\">\t<span class=\"built_in\">memset</span>(belong, <span class=\"number\">0</span>, <span class=\"keyword\">sizeof</span>(belong));</div><div class=\"line\">\tbrg.clear();</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (!pre[i]) dfs(i, <span class=\"number\">-1</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">rebuild</span><span class=\"params\">()</span> </span>&#123; <span class=\"comment\">//根据桥来缩点重构图</span></div><div class=\"line\">\tInitEdge();</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) brg.size(); i++) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> u = belong[brg[i].u];</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> v = belong[brg[i].v];</div><div class=\"line\">\t\tadd(u, v);</div><div class=\"line\">\t\tadd(v, u);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> diameter = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findR</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> h1 = <span class=\"number\">0</span>, h2 = <span class=\"number\">0</span>; <span class=\"comment\">// 以u为根，h1最高的儿子，h2次高儿子。放在dfs里面两者不会重合。</span></div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> h = findR(v, u) + <span class=\"number\">1</span>; <span class=\"comment\">//若路径有权重，则把1改为u-v的权重</span></div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (h &amp;gt; h1) h2 = h1, h1 = h;</div><div class=\"line\">\t\t<span class=\"keyword\">else</span> h2 = max(h, h2);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tdiameter = max(diameter, h1 + h2);</div><div class=\"line\">\t<span class=\"keyword\">return</span> h1;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tree_diameter</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tdiameter = <span class=\"number\">0</span>;</div><div class=\"line\">\tfindR(<span class=\"number\">1</span>, <span class=\"number\">-1</span>);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m), n || m) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> u, v;</div><div class=\"line\">\t\tInitEdge();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; m; i++) &#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">\t\t\tadd(u, v);</div><div class=\"line\">\t\t\tadd(v, u);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\ttarjan();</div><div class=\"line\">\t\trebuild();</div><div class=\"line\">\t\ttree_diameter();</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, bcnt - diameter - <span class=\"number\">1</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"HDU4005 The war","date":"2014-07-30T11:50:40.000Z","_content":"\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65768/65768 K (Java/Others)\nTotal Submission(s): 1992    Accepted Submission(s): 440\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">In the war, the intelligence about the enemy is very important. Now, our troop has mastered the situation of the enemy's war zones, and known that these war zones can communicate to each other directly or indirectly through the network. We also know the enemy is going to build a new communication line to strengthen their communication network. Our task is to destroy their communication network, so that some of their war zones can't communicate. Each line has its \"cost of destroy\". If we want to destroy a line, we must spend the \"cost of destroy\" of this line. We want to finish this task using the least cost, but our enemy is very clever. Now, we know the network they have already built, but we know nothing about the new line which our enemy is going to build. In this condition, your task is to find the minimum cost that no matter where our enemy builds the new line, you can destroy it using the fixed money. Please give the minimum cost. For efficiency, we can only destroy one communication line.</div>\n<!--more-->\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">The input contains several cases. For each cases, the first line contains two positive integers n, m (1&lt;=n&lt;=10000, 0&lt;=m&lt;=100000) standing for the number of the enemy's war zones (numbered from 1 to n), and the number of lines that our enemy has already build. Then m lines follow. For each line there are three positive integer a, b, c (1&lt;=a, b&lt;=n, 1&lt;=c&lt;=100000), meaning between war zone A and war zone B there is a communication line with the \"cost of destroy \" c.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each case, if the task can be finished output the minimum cost, or output ‐1.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">3 2 1 2 1 2 3 2 4 3 1 2 1 1 3 2 1 4 3</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">-1 3\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nFor the second sample input: our enemy may build line 2 to 3, 2 to 4, 3 to 4\\. If they build line 2 to 3, we will destroy line 1 to 4, cost 3\\. If they build line 2 to 4, we will destroy line 1 to 3, cost 2\\. If they build line 3 to 4, we will destroy line 1 to 2, cost 1\\. So, if we want to make sure that we can destroy successfully, the minimum cost is 3.\n\n</div>\n&nbsp;\n\n</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ The 36th ACM/ICPC Asia Regional Dalian Site —— Online Contest ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=The%2036th%20ACM/ICPC%20Asia%20Regional%20Dalian%20Site%20%E2%80%94%E2%80%94%20Online%20Contest&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_content\"></div>\n<div class=\"panel_content\"></div>\n<div class=\"panel_content\">求无向图边双连通分量缩点，然后DP求第二长边。</div>\n<div class=\"panel_content\">\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"null\">//#pragma comment(linker, \"/STACK:1024000000,1024000000\")//C++加栈\n#include\n#include\n#include\n#include\n#include\n#include\n#include\n#include<map>\n#include\n#include\n#include\nusing namespace std;\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\n#define N 10005\n#define M 100005\nint n, m;\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\nstruct edge {\n\tint v, w, nxt;\n\tbool mark;\n} e[M &lt;&lt; 1];\nstruct bridge {\n\tint u, v, w;\n\tbridge(int u, int v, int w) {\n\t\tthis-&gt;u = u;\n\t\tthis-&gt;w = w;\n\t\tthis-&gt;v = v;\n\t}\n};\nint pos, head[N];\nint top, stk[N];\nint pre[N], dfs_clock, belong[N], bcnt;\nvector brg;\nvoid InitEdge() {\n\tmemset(head, -1, sizeof(head));\n\tpos = 0;\n}\nvoid add(int u, int v, int w) {\n\te[pos].v = v;\n\te[pos].w = w;\n\te[pos].nxt = head[u];\n\thead[u] = pos++;\n}\nint dfs(int u,int fa) {\n\tint lowu = pre[u] = ++dfs_clock;\n\tstk[top++] = u;\n\tbool vis=true;\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif(v==fa &amp;&amp; vis){\n\t\t\tvis=false;//重边\n\t\t\tcontinue;\n\t\t}\n\t\tif (!pre[v]) {\n\t\t\tint lowv = dfs(v,u);\n\t\t\tlowu = min(lowu, lowv);\n\t\t\tif (lowv &gt; pre[u]) { //u-v为桥\n\t\t\t\tbrg.push_back(bridge(u, v, e[i].w));\n\t\t\t}\n\t\t} else lowu = min(lowu, pre[v]);\n\t}\n\tif (pre[u] == lowu) {\n\t\tbcnt++;\n\t\tdo {\n\t\t\tbelong[stk[--top]] = bcnt;\n\t\t} while (stk[top] != u);\n\t}\n\treturn lowu;\n}\nvoid tarjan() {\n\ttop = bcnt = dfs_clock = 0;\n\tmemset(pre, 0, sizeof(pre));\n\tmemset(belong, 0, sizeof(belong));\n\tbrg.clear();\n\tfor (int i = 1; i &lt;= n; i++) {\n\t\tif (!pre[i])dfs(i,-1);\n\t}\n}\nvoid rebuild() { //根据桥来缩点重构图\n\tInitEdge();\n\tfor (int i = 0; i &lt; (int) brg.size(); i++) {\n\t\tint u = belong[brg[i].u];\n\t\tint v = belong[brg[i].v];\n\t\tint w = brg[i].w;\n\t\tadd(u, v, w);\n\t\tadd(v, u, w);\n\t}\n}\nint res;\nint DP(int u, int fa) {\n\tint Min = inf;\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif (v == fa)continue;\n\t\tint w = DP(v, u);\n\t\tw = min(w, e[i].w);\n\t\tif (Min &gt; w) {\n\t\t\tres = min(res, Min);\n\t\t\tMin = w;\n\t\t} else res = min(res, w);\n\t}\n\treturn Min;\n}\nint main() {\n\twhile (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n\t\tint u, v, w;\n\t\tInitEdge();\n\t\tfor (int i = 0; i &lt; m; i++) {\n\t\t\tscanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n\t\t\tadd(u, v, w);\n\t\t\tadd(v, u, w);\n\t\t}\n\t\ttarjan();\n\t\trebuild();\n\t\tbridge minbrg(-1, -1, inf);\n\t\tfor (int i = 0; i &lt; (int) brg.size(); i++) {\n\t\t\tif (brg[i].w &lt; minbrg.w) {\n\t\t\t\tminbrg = brg[i];\n\t\t\t}\n\t\t}\n\t\tres = inf;\n\t\tDP(belong[minbrg.u], belong[minbrg.v]);\n\t\tDP(belong[minbrg.v], belong[minbrg.u]);\n\t\tif(res==inf)res=-1;\n\t\tprintf(\"%d\\n\", res);\n\t}\n}\n</pre>\n</div>","source":"_posts/hdu4005-the-war.md","raw":"title: HDU4005 The war\ntags:\n  - tarjan\n  - 树形DP\n  - 图论\ncategories: ACM\ndate: 2014-07-30 19:50:40\n---\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65768/65768 K (Java/Others)\nTotal Submission(s): 1992    Accepted Submission(s): 440\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">In the war, the intelligence about the enemy is very important. Now, our troop has mastered the situation of the enemy's war zones, and known that these war zones can communicate to each other directly or indirectly through the network. We also know the enemy is going to build a new communication line to strengthen their communication network. Our task is to destroy their communication network, so that some of their war zones can't communicate. Each line has its \"cost of destroy\". If we want to destroy a line, we must spend the \"cost of destroy\" of this line. We want to finish this task using the least cost, but our enemy is very clever. Now, we know the network they have already built, but we know nothing about the new line which our enemy is going to build. In this condition, your task is to find the minimum cost that no matter where our enemy builds the new line, you can destroy it using the fixed money. Please give the minimum cost. For efficiency, we can only destroy one communication line.</div>\n<!--more-->\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">The input contains several cases. For each cases, the first line contains two positive integers n, m (1&lt;=n&lt;=10000, 0&lt;=m&lt;=100000) standing for the number of the enemy's war zones (numbered from 1 to n), and the number of lines that our enemy has already build. Then m lines follow. For each line there are three positive integer a, b, c (1&lt;=a, b&lt;=n, 1&lt;=c&lt;=100000), meaning between war zone A and war zone B there is a communication line with the \"cost of destroy \" c.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each case, if the task can be finished output the minimum cost, or output ‐1.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">3 2 1 2 1 2 3 2 4 3 1 2 1 1 3 2 1 4 3</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">-1 3\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nFor the second sample input: our enemy may build line 2 to 3, 2 to 4, 3 to 4\\. If they build line 2 to 3, we will destroy line 1 to 4, cost 3\\. If they build line 2 to 4, we will destroy line 1 to 3, cost 2\\. If they build line 3 to 4, we will destroy line 1 to 2, cost 1\\. So, if we want to make sure that we can destroy successfully, the minimum cost is 3.\n\n</div>\n&nbsp;\n\n</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ The 36th ACM/ICPC Asia Regional Dalian Site —— Online Contest ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=The%2036th%20ACM/ICPC%20Asia%20Regional%20Dalian%20Site%20%E2%80%94%E2%80%94%20Online%20Contest&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_content\"></div>\n<div class=\"panel_content\"></div>\n<div class=\"panel_content\">求无向图边双连通分量缩点，然后DP求第二长边。</div>\n<div class=\"panel_content\">\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"null\">//#pragma comment(linker, \"/STACK:1024000000,1024000000\")//C++加栈\n#include\n#include\n#include\n#include\n#include\n#include\n#include\n#include<map>\n#include\n#include\n#include\nusing namespace std;\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\n#define N 10005\n#define M 100005\nint n, m;\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\nstruct edge {\n\tint v, w, nxt;\n\tbool mark;\n} e[M &lt;&lt; 1];\nstruct bridge {\n\tint u, v, w;\n\tbridge(int u, int v, int w) {\n\t\tthis-&gt;u = u;\n\t\tthis-&gt;w = w;\n\t\tthis-&gt;v = v;\n\t}\n};\nint pos, head[N];\nint top, stk[N];\nint pre[N], dfs_clock, belong[N], bcnt;\nvector brg;\nvoid InitEdge() {\n\tmemset(head, -1, sizeof(head));\n\tpos = 0;\n}\nvoid add(int u, int v, int w) {\n\te[pos].v = v;\n\te[pos].w = w;\n\te[pos].nxt = head[u];\n\thead[u] = pos++;\n}\nint dfs(int u,int fa) {\n\tint lowu = pre[u] = ++dfs_clock;\n\tstk[top++] = u;\n\tbool vis=true;\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif(v==fa &amp;&amp; vis){\n\t\t\tvis=false;//重边\n\t\t\tcontinue;\n\t\t}\n\t\tif (!pre[v]) {\n\t\t\tint lowv = dfs(v,u);\n\t\t\tlowu = min(lowu, lowv);\n\t\t\tif (lowv &gt; pre[u]) { //u-v为桥\n\t\t\t\tbrg.push_back(bridge(u, v, e[i].w));\n\t\t\t}\n\t\t} else lowu = min(lowu, pre[v]);\n\t}\n\tif (pre[u] == lowu) {\n\t\tbcnt++;\n\t\tdo {\n\t\t\tbelong[stk[--top]] = bcnt;\n\t\t} while (stk[top] != u);\n\t}\n\treturn lowu;\n}\nvoid tarjan() {\n\ttop = bcnt = dfs_clock = 0;\n\tmemset(pre, 0, sizeof(pre));\n\tmemset(belong, 0, sizeof(belong));\n\tbrg.clear();\n\tfor (int i = 1; i &lt;= n; i++) {\n\t\tif (!pre[i])dfs(i,-1);\n\t}\n}\nvoid rebuild() { //根据桥来缩点重构图\n\tInitEdge();\n\tfor (int i = 0; i &lt; (int) brg.size(); i++) {\n\t\tint u = belong[brg[i].u];\n\t\tint v = belong[brg[i].v];\n\t\tint w = brg[i].w;\n\t\tadd(u, v, w);\n\t\tadd(v, u, w);\n\t}\n}\nint res;\nint DP(int u, int fa) {\n\tint Min = inf;\n\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\tint v = e[i].v;\n\t\tif (v == fa)continue;\n\t\tint w = DP(v, u);\n\t\tw = min(w, e[i].w);\n\t\tif (Min &gt; w) {\n\t\t\tres = min(res, Min);\n\t\t\tMin = w;\n\t\t} else res = min(res, w);\n\t}\n\treturn Min;\n}\nint main() {\n\twhile (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n\t\tint u, v, w;\n\t\tInitEdge();\n\t\tfor (int i = 0; i &lt; m; i++) {\n\t\t\tscanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n\t\t\tadd(u, v, w);\n\t\t\tadd(v, u, w);\n\t\t}\n\t\ttarjan();\n\t\trebuild();\n\t\tbridge minbrg(-1, -1, inf);\n\t\tfor (int i = 0; i &lt; (int) brg.size(); i++) {\n\t\t\tif (brg[i].w &lt; minbrg.w) {\n\t\t\t\tminbrg = brg[i];\n\t\t\t}\n\t\t}\n\t\tres = inf;\n\t\tDP(belong[minbrg.u], belong[minbrg.v]);\n\t\tDP(belong[minbrg.v], belong[minbrg.u]);\n\t\tif(res==inf)res=-1;\n\t\tprintf(\"%d\\n\", res);\n\t}\n}\n</pre>\n</div>","slug":"hdu4005-the-war","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1d00355rgxh9f3w4oh","content":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65768/65768 K (Java/Others)<br>Total Submission(s): 1992    Accepted Submission(s): 440<br></span></strong></p>\n<div class=\"panel_title\" align=\"left\">Problem Description</div><br><div class=\"panel_content\">In the war, the intelligence about the enemy is very important. Now, our troop has mastered the situation of the enemy’s war zones, and known that these war zones can communicate to each other directly or indirectly through the network. We also know the enemy is going to build a new communication line to strengthen their communication network. Our task is to destroy their communication network, so that some of their war zones can’t communicate. Each line has its “cost of destroy”. If we want to destroy a line, we must spend the “cost of destroy” of this line. We want to finish this task using the least cost, but our enemy is very clever. Now, we know the network they have already built, but we know nothing about the new line which our enemy is going to build. In this condition, your task is to find the minimum cost that no matter where our enemy builds the new line, you can destroy it using the fixed money. Please give the minimum cost. For efficiency, we can only destroy one communication line.</div><br><a id=\"more\"></a><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Input</div><br><div class=\"panel_content\">The input contains several cases. For each cases, the first line contains two positive integers n, m (1&lt;=n&lt;=10000, 0&lt;=m&lt;=100000) standing for the number of the enemy’s war zones (numbered from 1 to n), and the number of lines that our enemy has already build. Then m lines follow. For each line there are three positive integer a, b, c (1&lt;=a, b&lt;=n, 1&lt;=c&lt;=100000), meaning between war zone A and war zone B there is a communication line with the “cost of destroy “ c.</div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Output</div><br><div class=\"panel_content\">For each case, if the task can be finished output the minimum cost, or output ‐1.</div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Sample Input</div><br><div class=\"panel_content\"><br><div style=\"font-family: Courier New,Courier,monospace;\">3 2 1 2 1 2 3 2 4 3 1 2 1 1 3 2 1 4 3</div><br></div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Sample Output</div><br><div class=\"panel_content\"><br><div style=\"font-family: Courier New,Courier,monospace;\">-1 3<br><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"><br><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>For the second sample input: our enemy may build line 2 to 3, 2 to 4, 3 to 4. If they build line 2 to 3, we will destroy line 1 to 4, cost 3. If they build line 2 to 4, we will destroy line 1 to 3, cost 2. If they build line 3 to 4, we will destroy line 1 to 2, cost 1. So, if we want to make sure that we can destroy successfully, the minimum cost is 3.<br><br></div><br>&nbsp;<br><br></div><br></div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Source</div><br><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=The%2036th%20ACM/ICPC%20Asia%20Regional%20Dalian%20Site%20%E2%80%94%E2%80%94%20Online%20Contest&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> The 36th ACM/ICPC Asia Regional Dalian Site —— Online Contest </a></div><br><div class=\"panel_content\"></div><br><div class=\"panel_content\"></div><br><div class=\"panel_content\">求无向图边双连通分量缩点，然后DP求第二长边。</div><br><div class=\"panel_content\"><br><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"null\">//#pragma comment(linker, “/STACK:1024000000,1024000000”)//C++加栈<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<map><br>#include<br>#include<br>#include<br>using namespace std;<br>#if defined (_WIN32) || defined (<strong>WIN32) || defined (WIN32) || defined (</strong>WIN32<strong>)<br>#define LL </strong>int64<br>#define LLS “%” “I” “6” “4” “d”<br>#define LLU “%” “I” “6” “4” “u”<br>#define LL_MAX _I64_MAX<br><br>#else<br>#define LL long long<br>#define LLS “%” “l” “l” “d”<br>#define LLU “%” “l” “l” “u”<br>#define LL_MAX _I64_MAX<br>#endif<br>#define N 10005<br>#define M 100005<br>int n, m;<br>const int inf = ~0u &gt;&gt; 1;<br>const LL lnf = ~0ull &gt;&gt; 1;<br>struct edge {<br>    int v, w, nxt;<br>    bool mark;<br>} e[M &lt;&lt; 1];<br>struct bridge {<br>    int u, v, w;<br>    bridge(int u, int v, int w) {<br>        this-&gt;u = u;<br>        this-&gt;w = w;<br>        this-&gt;v = v;<br>    }<br>};<br>int pos, head[N];<br>int top, stk[N];<br>int pre[N], dfs_clock, belong[N], bcnt;<br>vector brg;<br>void InitEdge() {<br>    memset(head, -1, sizeof(head));<br>    pos = 0;<br>}<br>void add(int u, int v, int w) {<br>    e[pos].v = v;<br>    e[pos].w = w;<br>    e[pos].nxt = head[u];<br>    head[u] = pos++;<br>}<br>int dfs(int u,int fa) {<br>    int lowu = pre[u] = ++dfs_clock;<br>    stk[top++] = u;<br>    bool vis=true;<br>    for (int i = head[u]; ~i; i = e[i].nxt) {<br>        int v = e[i].v;<br>        if(v==fa &amp;&amp; vis){<br>            vis=false;//重边<br>            continue;<br>        }<br>        if (!pre[v]) {<br>            int lowv = dfs(v,u);<br>            lowu = min(lowu, lowv);<br>            if (lowv &gt; pre[u]) { //u-v为桥<br>                brg.push_back(bridge(u, v, e[i].w));<br>            }<br>        } else lowu = min(lowu, pre[v]);<br>    }<br>    if (pre[u] == lowu) {<br>        bcnt++;<br>        do {<br>            belong[stk[–top]] = bcnt;<br>        } while (stk[top] != u);<br>    }<br>    return lowu;<br>}<br>void tarjan() {<br>    top = bcnt = dfs_clock = 0;<br>    memset(pre, 0, sizeof(pre));<br>    memset(belong, 0, sizeof(belong));<br>    brg.clear();<br>    for (int i = 1; i &lt;= n; i++) {<br>        if (!pre[i])dfs(i,-1);<br>    }<br>}<br>void rebuild() { //根据桥来缩点重构图<br>    InitEdge();<br>    for (int i = 0; i &lt; (int) brg.size(); i++) {<br>        int u = belong[brg[i].u];<br>        int v = belong[brg[i].v];<br>        int w = brg[i].w;<br>        add(u, v, w);<br>        add(v, u, w);<br>    }<br>}<br>int res;<br>int DP(int u, int fa) {<br>    int Min = inf;<br>    for (int i = head[u]; ~i; i = e[i].nxt) {<br>        int v = e[i].v;<br>        if (v == fa)continue;<br>        int w = DP(v, u);<br>        w = min(w, e[i].w);<br>        if (Min &gt; w) {<br>            res = min(res, Min);<br>            Min = w;<br>        } else res = min(res, w);<br>    }<br>    return Min;<br>}<br>int main() {<br>    while (~scanf(“%d%d”, &amp;n, &amp;m)) {<br>        int u, v, w;<br>        InitEdge();<br>        for (int i = 0; i &lt; m; i++) {<br>            scanf(“%d%d%d”, &amp;u, &amp;v, &amp;w);<br>            add(u, v, w);<br>            add(v, u, w);<br>        }<br>        tarjan();<br>        rebuild();<br>        bridge minbrg(-1, -1, inf);<br>        for (int i = 0; i &lt; (int) brg.size(); i++) {<br>            if (brg[i].w &lt; minbrg.w) {<br>                minbrg = brg[i];<br>            }<br>        }<br>        res = inf;<br>        DP(belong[minbrg.u], belong[minbrg.v]);<br>        DP(belong[minbrg.v], belong[minbrg.u]);<br>        if(res==inf)res=-1;<br>        printf(“%d\\n”, res);<br>    }<br>}<br></map></pre><br></div>","excerpt":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65768/65768 K (Java/Others)<br>Total Submission(s): 1992    Accepted Submission(s): 440<br></span></strong></p>\n<div class=\"panel_title\" align=\"left\">Problem Description</div><br><div class=\"panel_content\">In the war, the intelligence about the enemy is very important. Now, our troop has mastered the situation of the enemy’s war zones, and known that these war zones can communicate to each other directly or indirectly through the network. We also know the enemy is going to build a new communication line to strengthen their communication network. Our task is to destroy their communication network, so that some of their war zones can’t communicate. Each line has its “cost of destroy”. If we want to destroy a line, we must spend the “cost of destroy” of this line. We want to finish this task using the least cost, but our enemy is very clever. Now, we know the network they have already built, but we know nothing about the new line which our enemy is going to build. In this condition, your task is to find the minimum cost that no matter where our enemy builds the new line, you can destroy it using the fixed money. Please give the minimum cost. For efficiency, we can only destroy one communication line.</div><br>","more":"<br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Input</div><br><div class=\"panel_content\">The input contains several cases. For each cases, the first line contains two positive integers n, m (1&lt;=n&lt;=10000, 0&lt;=m&lt;=100000) standing for the number of the enemy’s war zones (numbered from 1 to n), and the number of lines that our enemy has already build. Then m lines follow. For each line there are three positive integer a, b, c (1&lt;=a, b&lt;=n, 1&lt;=c&lt;=100000), meaning between war zone A and war zone B there is a communication line with the “cost of destroy “ c.</div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Output</div><br><div class=\"panel_content\">For each case, if the task can be finished output the minimum cost, or output ‐1.</div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Sample Input</div><br><div class=\"panel_content\"><br><div style=\"font-family: Courier New,Courier,monospace;\">3 2 1 2 1 2 3 2 4 3 1 2 1 1 3 2 1 4 3</div><br></div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Sample Output</div><br><div class=\"panel_content\"><br><div style=\"font-family: Courier New,Courier,monospace;\">-1 3<br><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"><br><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>For the second sample input: our enemy may build line 2 to 3, 2 to 4, 3 to 4. If they build line 2 to 3, we will destroy line 1 to 4, cost 3. If they build line 2 to 4, we will destroy line 1 to 3, cost 2. If they build line 3 to 4, we will destroy line 1 to 2, cost 1. So, if we want to make sure that we can destroy successfully, the minimum cost is 3.<br><br></div><br>&nbsp;<br><br></div><br></div><br><div class=\"panel_bottom\"></div><br>&nbsp;<br><div class=\"panel_title\" align=\"left\">Source</div><br><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=The%2036th%20ACM/ICPC%20Asia%20Regional%20Dalian%20Site%20%E2%80%94%E2%80%94%20Online%20Contest&amp;source=1&amp;searchmode=source\"> The 36th ACM/ICPC Asia Regional Dalian Site —— Online Contest </a></div><br><div class=\"panel_content\"></div><br><div class=\"panel_content\"></div><br><div class=\"panel_content\">求无向图边双连通分量缩点，然后DP求第二长边。</div><br><div class=\"panel_content\"><br><pre class=\"EnlighterJSRAW\" data-enlighter-language=\"null\">//#pragma comment(linker, “/STACK:1024000000,1024000000”)//C++加栈<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<map><br>#include<br>#include<br>#include<br>using namespace std;<br>#if defined (_WIN32) || defined (<strong>WIN32) || defined (WIN32) || defined (</strong>WIN32<strong>)<br>#define LL </strong>int64<br>#define LLS “%” “I” “6” “4” “d”<br>#define LLU “%” “I” “6” “4” “u”<br>#define LL_MAX _I64_MAX<br><br>#else<br>#define LL long long<br>#define LLS “%” “l” “l” “d”<br>#define LLU “%” “l” “l” “u”<br>#define LL_MAX _I64_MAX<br>#endif<br>#define N 10005<br>#define M 100005<br>int n, m;<br>const int inf = ~0u &gt;&gt; 1;<br>const LL lnf = ~0ull &gt;&gt; 1;<br>struct edge {<br>    int v, w, nxt;<br>    bool mark;<br>} e[M &lt;&lt; 1];<br>struct bridge {<br>    int u, v, w;<br>    bridge(int u, int v, int w) {<br>        this-&gt;u = u;<br>        this-&gt;w = w;<br>        this-&gt;v = v;<br>    }<br>};<br>int pos, head[N];<br>int top, stk[N];<br>int pre[N], dfs_clock, belong[N], bcnt;<br>vector brg;<br>void InitEdge() {<br>    memset(head, -1, sizeof(head));<br>    pos = 0;<br>}<br>void add(int u, int v, int w) {<br>    e[pos].v = v;<br>    e[pos].w = w;<br>    e[pos].nxt = head[u];<br>    head[u] = pos++;<br>}<br>int dfs(int u,int fa) {<br>    int lowu = pre[u] = ++dfs_clock;<br>    stk[top++] = u;<br>    bool vis=true;<br>    for (int i = head[u]; ~i; i = e[i].nxt) {<br>        int v = e[i].v;<br>        if(v==fa &amp;&amp; vis){<br>            vis=false;//重边<br>            continue;<br>        }<br>        if (!pre[v]) {<br>            int lowv = dfs(v,u);<br>            lowu = min(lowu, lowv);<br>            if (lowv &gt; pre[u]) { //u-v为桥<br>                brg.push_back(bridge(u, v, e[i].w));<br>            }<br>        } else lowu = min(lowu, pre[v]);<br>    }<br>    if (pre[u] == lowu) {<br>        bcnt++;<br>        do {<br>            belong[stk[–top]] = bcnt;<br>        } while (stk[top] != u);<br>    }<br>    return lowu;<br>}<br>void tarjan() {<br>    top = bcnt = dfs_clock = 0;<br>    memset(pre, 0, sizeof(pre));<br>    memset(belong, 0, sizeof(belong));<br>    brg.clear();<br>    for (int i = 1; i &lt;= n; i++) {<br>        if (!pre[i])dfs(i,-1);<br>    }<br>}<br>void rebuild() { //根据桥来缩点重构图<br>    InitEdge();<br>    for (int i = 0; i &lt; (int) brg.size(); i++) {<br>        int u = belong[brg[i].u];<br>        int v = belong[brg[i].v];<br>        int w = brg[i].w;<br>        add(u, v, w);<br>        add(v, u, w);<br>    }<br>}<br>int res;<br>int DP(int u, int fa) {<br>    int Min = inf;<br>    for (int i = head[u]; ~i; i = e[i].nxt) {<br>        int v = e[i].v;<br>        if (v == fa)continue;<br>        int w = DP(v, u);<br>        w = min(w, e[i].w);<br>        if (Min &gt; w) {<br>            res = min(res, Min);<br>            Min = w;<br>        } else res = min(res, w);<br>    }<br>    return Min;<br>}<br>int main() {<br>    while (~scanf(“%d%d”, &amp;n, &amp;m)) {<br>        int u, v, w;<br>        InitEdge();<br>        for (int i = 0; i &lt; m; i++) {<br>            scanf(“%d%d%d”, &amp;u, &amp;v, &amp;w);<br>            add(u, v, w);<br>            add(v, u, w);<br>        }<br>        tarjan();<br>        rebuild();<br>        bridge minbrg(-1, -1, inf);<br>        for (int i = 0; i &lt; (int) brg.size(); i++) {<br>            if (brg[i].w &lt; minbrg.w) {<br>                minbrg = brg[i];<br>            }<br>        }<br>        res = inf;<br>        DP(belong[minbrg.u], belong[minbrg.v]);<br>        DP(belong[minbrg.v], belong[minbrg.u]);<br>        if(res==inf)res=-1;<br>        printf(“%d\\n”, res);<br>    }<br>}<br></pre><br></div>"},{"title":"HDU 4965 Fast Matrix Calculation","id":"99","date":"2014-08-19T12:37:28.000Z","_content":"**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)\nTotal Submission(s): 206    Accepted Submission(s): 116\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">\n\nOne day, Alice and Bob felt bored again, Bob knows Alice is a girl who loves math and is just learning something about matrix, so he decided to make a crazy problem for her.\n\nBob has a six-faced dice which has numbers 0, 1, 2, 3, 4 and 5 on each face. At first, he will choose a number N (4 &lt;= N &lt;= 1000), and for N times, he keeps throwing his dice for K times (2 &lt;=K &lt;= 6) and writes down its number on the top face to make an N*K matrix A, in which each element is not less than 0 and not greater than 5\\. Then he does similar thing again with a bit difference: he keeps throwing his dice for N times and each time repeat it for K times to write down a K*N matrix B, in which each element is not less than 0 and not greater than 5\\. With the two matrix A and B formed, Alice’s task is to perform the following 4-step calculation.\n<!--more-->\nStep 1: Calculate a new N*N matrix C = A*B.\nStep 2: Calculate M = C^(N*N).\nStep 3: For each element x in M, calculate x % 6\\. All the remainders form a new matrix M’.\nStep 4: Calculate the sum of all the elements in M’.\n\nBob just made this problem for kidding but he sees Alice taking it serious, so he also wonders what the answer is. And then Bob turn to you for help because he is not good at math.\n\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">\n\nThe input contains several test cases. Each test case starts with two integer N and K, indicating the numbers N and K described above. Then N lines follow, and each line has K integers between 0 and 5, representing matrix A. Then K lines follow, and each line has N integers between 0 and 5, representing matrix B.\n\nThe end of input is indicated by N = K = 0.\n\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each case, output the sum of all the elements in M’ in a line.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">4 2 5 5 4 4 5 4 0 0 4 2 5 5 1 3 1 5 6 3 1 2 3 0 3 0 2 3 4 4 3 2 2 5 5 0 5 0 3 4 5 1 1 0 5 3 2 3 3 2 3 1 5 4 5 2 0 0</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">14 56</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 9 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%209&amp;source=1&amp;searchmode=source)</div>\n<br/>\n\n- - -\n\n\n<div class=\"panel_content\">这题让我注意了矩阵模板的开销问题。1000X1000多次调用就会爆内存了。下面是用动态数组写的。效率非常慢，难以接受。</div>\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define MOD 6\nint n, k;\nstruct Matrix {\n    int n, m;\n    int** M;\n    Matrix(int n, int m) :n(n), m(m) {\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n    }\n\n    Matrix(int n, int m, int k) :\n            n(n), m(m) {\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n        Init(k);\n    }\n\n    ~Matrix() {\n        if (M) {\n            for (int i = 0; i &lt; n; i++) {\n                if (M[i]) {\n                    delete[] M[i];\n                    M[i] = NULL;\n                }\n            }\n            delete[] M;\n            M = NULL;\n        }\n    }\n\n    void Init(bool k) { //k=1 返回单位矩阵，k=0 返回零矩阵\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                M[i][j] = k * (i == j);\n    }\n\n    void out() {\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');\n    }\n\n    Matrix &amp; operator=(const Matrix&amp; othr) {\n        this-&gt;~Matrix();\n        n = othr.n;\n        m = othr.m;\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                M[i][j] = othr.M[i][j];\n            }\n        }\n        return *this;\n    }\n\n    Matrix(const Matrix &amp; othr) {\n        n = othr.n;\n        m = othr.m;\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                M[i][j] = othr.M[i][j];\n            }\n        }\n    }\n\n    bool operator==(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) return false;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                if (M[i][j] != othr.M[i][j]) return false;\n            }\n        }\n        return true;\n    }\n    Matrix operator *(const Matrix&amp; othr) const {\n        if (m - othr.n) exit(1); //异常退出\n        Matrix ans(n, othr.m, 0);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; othr.m; j++)\n                for (int k = 0; k &lt; m; k++) {\n                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;\n                    if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                    if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n                }\n        return ans;\n    }\n    Matrix operator *(const int&amp; x) const {\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                ans.M[i][j] = M[i][j] * x % MOD;\n        return ans;\n    }\n    Matrix operator +(const Matrix &amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] + othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator -(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] - othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator ^(int x) const {\n        if (n - m) exit(1);\n        Matrix ans(n, m, 1), base = *this;\n        while (x &gt; 0) {\n            if (x &amp; 1) ans = ans * base;\n            base = base * base;\n            x &gt;&gt;= 1;\n        }\n        return ans;\n    }\n};\n\nint main(int argc, char **argv) {\n    while (~scanf(\"%d%d\", &amp;n, &amp;k)) {\n        if (n == 0 &amp;&amp; k == 0) break;\n        Matrix A(n, k, 0), B(k, n, 0);\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; k; j++) {\n                scanf(\"%d\", &amp;A.M[i][j]);\n            }\n        }\n        for (int i = 0; i &lt; k; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                scanf(\"%d\", &amp;B.M[i][j]);\n            }\n        }\n        Matrix mat = B * A;\n        int r = n * n - 1;\n        Matrix res = A * (mat ^ r) * B;\n        int ans = 0;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                ans += res.M[i][j];\n            }\n        }\n        printf(\"%d\\n\", ans);\n    }\n}\n```\n\n然后又试了试vector，虽然简单不少，但是仍然很慢：\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define MOD 6\nint n, k;\nstruct Matrix {\n    int n, m;\n    vector&lt;vector&lt;int&gt; &gt;M;\n    Matrix(int n, int m) :n(n), m(m) {\n        alloc();\n    }\n\n    Matrix(int n, int m, int k) :\n            n(n), m(m) {\n        alloc();\n        Init(k);\n    }\n    void alloc(){\n        M.resize(n);\n        for (int i = 0; i &lt; n; i++)\n            M[i].resize(m);\n    }\n\n    void Init(bool k) { //k=1 返回单位矩阵，k=0 返回零矩阵\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                M[i][j] = k * (i == j);\n    }\n\n    void out() {\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');\n    }\n\n    bool operator==(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) return false;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                if (M[i][j] != othr.M[i][j]) return false;\n            }\n        }\n        return true;\n    }\n    Matrix operator *(const Matrix&amp; othr) const {\n        if (m - othr.n) exit(1); //异常退出\n        Matrix ans(n, othr.m, 0);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; othr.m; j++)\n                for (int k = 0; k &lt; m; k++) {\n                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;\n                    if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                    if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n                }\n        return ans;\n    }\n    Matrix operator *(const int&amp; x) const {\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                ans.M[i][j] = M[i][j] * x % MOD;\n        return ans;\n    }\n    Matrix operator +(const Matrix &amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] + othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator -(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] - othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator ^(int x) const {\n        if (n - m) exit(1);\n        Matrix ans(n, m, 1), base = *this;\n        while (x &gt; 0) {\n            if (x &amp; 1) ans = ans * base;\n            base = base * base;\n            x &gt;&gt;= 1;\n        }\n        return ans;\n    }\n};\n\nint main(int argc, char **argv) {\n    while (~scanf(\"%d%d\", &amp;n, &amp;k)) {\n        if (n == 0 &amp;&amp; k == 0) break;\n        Matrix A(n, k, 0), B(k, n, 0);\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; k; j++) {\n                scanf(\"%d\", &amp;A.M[i][j]);\n            }\n        }\n        for (int i = 0; i &lt; k; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                scanf(\"%d\", &amp;B.M[i][j]);\n            }\n        }\n        Matrix mat = B * A;\n        int r = n * n - 1;\n        Matrix res = A * (mat ^ r) * B;\n        int ans = 0;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                ans += res.M[i][j];\n            }\n        }\n        printf(\"%d\\n\", ans);\n    }\n}\n```\n感觉其他方法还比较麻烦。算了就这样吧~\n\n&nbsp;","source":"_posts/hdu-4965-fast-matrix-calculation.md","raw":"title: HDU 4965 Fast Matrix Calculation\ntags:\n  - [矩阵,暴力]\ncategories:\n  - ACM\nid: 99\ndate: 2014-08-19 20:37:28\n---\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)\nTotal Submission(s): 206    Accepted Submission(s): 116\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">\n\nOne day, Alice and Bob felt bored again, Bob knows Alice is a girl who loves math and is just learning something about matrix, so he decided to make a crazy problem for her.\n\nBob has a six-faced dice which has numbers 0, 1, 2, 3, 4 and 5 on each face. At first, he will choose a number N (4 &lt;= N &lt;= 1000), and for N times, he keeps throwing his dice for K times (2 &lt;=K &lt;= 6) and writes down its number on the top face to make an N*K matrix A, in which each element is not less than 0 and not greater than 5\\. Then he does similar thing again with a bit difference: he keeps throwing his dice for N times and each time repeat it for K times to write down a K*N matrix B, in which each element is not less than 0 and not greater than 5\\. With the two matrix A and B formed, Alice’s task is to perform the following 4-step calculation.\n<!--more-->\nStep 1: Calculate a new N*N matrix C = A*B.\nStep 2: Calculate M = C^(N*N).\nStep 3: For each element x in M, calculate x % 6\\. All the remainders form a new matrix M’.\nStep 4: Calculate the sum of all the elements in M’.\n\nBob just made this problem for kidding but he sees Alice taking it serious, so he also wonders what the answer is. And then Bob turn to you for help because he is not good at math.\n\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">\n\nThe input contains several test cases. Each test case starts with two integer N and K, indicating the numbers N and K described above. Then N lines follow, and each line has K integers between 0 and 5, representing matrix A. Then K lines follow, and each line has N integers between 0 and 5, representing matrix B.\n\nThe end of input is indicated by N = K = 0.\n\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each case, output the sum of all the elements in M’ in a line.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">4 2 5 5 4 4 5 4 0 0 4 2 5 5 1 3 1 5 6 3 1 2 3 0 3 0 2 3 4 4 3 2 2 5 5 0 5 0 3 4 5 1 1 0 5 3 2 3 3 2 3 1 5 4 5 2 0 0</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">14 56</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 9 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%209&amp;source=1&amp;searchmode=source)</div>\n<br/>\n\n- - -\n\n\n<div class=\"panel_content\">这题让我注意了矩阵模板的开销问题。1000X1000多次调用就会爆内存了。下面是用动态数组写的。效率非常慢，难以接受。</div>\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define MOD 6\nint n, k;\nstruct Matrix {\n    int n, m;\n    int** M;\n    Matrix(int n, int m) :n(n), m(m) {\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n    }\n\n    Matrix(int n, int m, int k) :\n            n(n), m(m) {\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n        Init(k);\n    }\n\n    ~Matrix() {\n        if (M) {\n            for (int i = 0; i &lt; n; i++) {\n                if (M[i]) {\n                    delete[] M[i];\n                    M[i] = NULL;\n                }\n            }\n            delete[] M;\n            M = NULL;\n        }\n    }\n\n    void Init(bool k) { //k=1 返回单位矩阵，k=0 返回零矩阵\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                M[i][j] = k * (i == j);\n    }\n\n    void out() {\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');\n    }\n\n    Matrix &amp; operator=(const Matrix&amp; othr) {\n        this-&gt;~Matrix();\n        n = othr.n;\n        m = othr.m;\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                M[i][j] = othr.M[i][j];\n            }\n        }\n        return *this;\n    }\n\n    Matrix(const Matrix &amp; othr) {\n        n = othr.n;\n        m = othr.m;\n        M = new int*[n];\n        for (int i = 0; i &lt; n; i++)\n            M[i] = new int[m];\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                M[i][j] = othr.M[i][j];\n            }\n        }\n    }\n\n    bool operator==(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) return false;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                if (M[i][j] != othr.M[i][j]) return false;\n            }\n        }\n        return true;\n    }\n    Matrix operator *(const Matrix&amp; othr) const {\n        if (m - othr.n) exit(1); //异常退出\n        Matrix ans(n, othr.m, 0);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; othr.m; j++)\n                for (int k = 0; k &lt; m; k++) {\n                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;\n                    if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                    if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n                }\n        return ans;\n    }\n    Matrix operator *(const int&amp; x) const {\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                ans.M[i][j] = M[i][j] * x % MOD;\n        return ans;\n    }\n    Matrix operator +(const Matrix &amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] + othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator -(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] - othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator ^(int x) const {\n        if (n - m) exit(1);\n        Matrix ans(n, m, 1), base = *this;\n        while (x &gt; 0) {\n            if (x &amp; 1) ans = ans * base;\n            base = base * base;\n            x &gt;&gt;= 1;\n        }\n        return ans;\n    }\n};\n\nint main(int argc, char **argv) {\n    while (~scanf(\"%d%d\", &amp;n, &amp;k)) {\n        if (n == 0 &amp;&amp; k == 0) break;\n        Matrix A(n, k, 0), B(k, n, 0);\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; k; j++) {\n                scanf(\"%d\", &amp;A.M[i][j]);\n            }\n        }\n        for (int i = 0; i &lt; k; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                scanf(\"%d\", &amp;B.M[i][j]);\n            }\n        }\n        Matrix mat = B * A;\n        int r = n * n - 1;\n        Matrix res = A * (mat ^ r) * B;\n        int ans = 0;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                ans += res.M[i][j];\n            }\n        }\n        printf(\"%d\\n\", ans);\n    }\n}\n```\n\n然后又试了试vector，虽然简单不少，但是仍然很慢：\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define MOD 6\nint n, k;\nstruct Matrix {\n    int n, m;\n    vector&lt;vector&lt;int&gt; &gt;M;\n    Matrix(int n, int m) :n(n), m(m) {\n        alloc();\n    }\n\n    Matrix(int n, int m, int k) :\n            n(n), m(m) {\n        alloc();\n        Init(k);\n    }\n    void alloc(){\n        M.resize(n);\n        for (int i = 0; i &lt; n; i++)\n            M[i].resize(m);\n    }\n\n    void Init(bool k) { //k=1 返回单位矩阵，k=0 返回零矩阵\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                M[i][j] = k * (i == j);\n    }\n\n    void out() {\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');\n    }\n\n    bool operator==(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) return false;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; m; j++) {\n                if (M[i][j] != othr.M[i][j]) return false;\n            }\n        }\n        return true;\n    }\n    Matrix operator *(const Matrix&amp; othr) const {\n        if (m - othr.n) exit(1); //异常退出\n        Matrix ans(n, othr.m, 0);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; othr.m; j++)\n                for (int k = 0; k &lt; m; k++) {\n                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;\n                    if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                    if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n                }\n        return ans;\n    }\n    Matrix operator *(const int&amp; x) const {\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++)\n                ans.M[i][j] = M[i][j] * x % MOD;\n        return ans;\n    }\n    Matrix operator +(const Matrix &amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] + othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator -(const Matrix&amp; othr) const {\n        if (n - othr.n || m - othr.m) exit(1);\n        Matrix ans(n, m);\n        for (int i = 0; i &lt; n; i++)\n            for (int j = 0; j &lt; m; j++) {\n                ans.M[i][j] = M[i][j] - othr.M[i][j];\n                if (ans.M[i][j] &gt;= MOD) ans.M[i][j] -= MOD;\n                if (ans.M[i][j] &lt; 0) ans.M[i][j] += MOD;\n            }\n        return ans;\n    }\n\n    Matrix operator ^(int x) const {\n        if (n - m) exit(1);\n        Matrix ans(n, m, 1), base = *this;\n        while (x &gt; 0) {\n            if (x &amp; 1) ans = ans * base;\n            base = base * base;\n            x &gt;&gt;= 1;\n        }\n        return ans;\n    }\n};\n\nint main(int argc, char **argv) {\n    while (~scanf(\"%d%d\", &amp;n, &amp;k)) {\n        if (n == 0 &amp;&amp; k == 0) break;\n        Matrix A(n, k, 0), B(k, n, 0);\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; k; j++) {\n                scanf(\"%d\", &amp;A.M[i][j]);\n            }\n        }\n        for (int i = 0; i &lt; k; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                scanf(\"%d\", &amp;B.M[i][j]);\n            }\n        }\n        Matrix mat = B * A;\n        int r = n * n - 1;\n        Matrix res = A * (mat ^ r) * B;\n        int ans = 0;\n        for (int i = 0; i &lt; n; i++) {\n            for (int j = 0; j &lt; n; j++) {\n                ans += res.M[i][j];\n            }\n        }\n        printf(\"%d\\n\", ans);\n    }\n}\n```\n感觉其他方法还比较麻烦。算了就这样吧~\n\n&nbsp;","slug":"hdu-4965-fast-matrix-calculation","published":1,"updated":"2017-01-16T01:58:03.965Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1e00375rgxqoju7e8i","content":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)<br>Total Submission(s): 206    Accepted Submission(s): 116<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<div class=\"panel_content\">\n\n<p>One day, Alice and Bob felt bored again, Bob knows Alice is a girl who loves math and is just learning something about matrix, so he decided to make a crazy problem for her.</p>\n<p>Bob has a six-faced dice which has numbers 0, 1, 2, 3, 4 and 5 on each face. At first, he will choose a number N (4 &lt;= N &lt;= 1000), and for N times, he keeps throwing his dice for K times (2 &lt;=K &lt;= 6) and writes down its number on the top face to make an N<em>K matrix A, in which each element is not less than 0 and not greater than 5. Then he does similar thing again with a bit difference: he keeps throwing his dice for N times and each time repeat it for K times to write down a K</em>N matrix B, in which each element is not less than 0 and not greater than 5. With the two matrix A and B formed, Alice’s task is to perform the following 4-step calculation.<br><a id=\"more\"></a><br>Step 1: Calculate a new N<em>N matrix C = A</em>B.<br>Step 2: Calculate M = C^(N*N).<br>Step 3: For each element x in M, calculate x % 6. All the remainders form a new matrix M’.<br>Step 4: Calculate the sum of all the elements in M’.</p>\n<p>Bob just made this problem for kidding but he sees Alice taking it serious, so he also wonders what the answer is. And then Bob turn to you for help because he is not good at math.</p>\n<p></p></div><p></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<div class=\"panel_content\">\n\n<p>The input contains several test cases. Each test case starts with two integer N and K, indicating the numbers N and K described above. Then N lines follow, and each line has K integers between 0 and 5, representing matrix A. Then K lines follow, and each line has N integers between 0 and 5, representing matrix B.</p>\n<p>The end of input is indicated by N = K = 0.</p>\n<p></p></div><p></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each case, output the sum of all the elements in M’ in a line.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">4 2 5 5 4 4 5 4 0 0 4 2 5 5 1 3 1 5 6 3 1 2 3 0 3 0 2 3 4 4 3 2 2 5 5 0 5 0 3 4 5 1 1 0 5 3 2 3 3 2 3 1 5 4 5 2 0 0</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">14 56</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%209&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> 2014 Multi-University Training Contest 9 </a></div><br><br></p>\n<hr>\n<p><div class=\"panel_content\">这题让我注意了矩阵模板的开销问题。1000X1000多次调用就会爆内存了。下面是用动态数组写的。效率非常慢，难以接受。</div><br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;cmath&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define PR pair&amp;lt;int,int&amp;gt;</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define Sz(x) (int)x.size()</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clr(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">/*start*/</div><div class=\"line\">#define MOD 6</div><div class=\"line\">int n, k;</div><div class=\"line\">struct Matrix &#123;</div><div class=\"line\">    int n, m;</div><div class=\"line\">    int** M;</div><div class=\"line\">    Matrix(int n, int m) :n(n), m(m) &#123;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix(int n, int m, int k) :</div><div class=\"line\">            n(n), m(m) &#123;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">        Init(k);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    ~Matrix() &#123;</div><div class=\"line\">        if (M) &#123;</div><div class=\"line\">            for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">                if (M[i]) &#123;</div><div class=\"line\">                    delete[] M[i];</div><div class=\"line\">                    M[i] = NULL;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            delete[] M;</div><div class=\"line\">            M = NULL;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void Init(bool k) &#123; //k=1 返回单位矩阵，k=0 返回零矩阵</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                M[i][j] = k * (i == j);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void out() &#123;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix &amp;amp; operator=(const Matrix&amp;amp; othr) &#123;</div><div class=\"line\">        this-&amp;gt;~Matrix();</div><div class=\"line\">        n = othr.n;</div><div class=\"line\">        m = othr.m;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                M[i][j] = othr.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return *this;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix(const Matrix &amp;amp; othr) &#123;</div><div class=\"line\">        n = othr.n;</div><div class=\"line\">        m = othr.m;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                M[i][j] = othr.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    bool operator==(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) return false;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                if (M[i][j] != othr.M[i][j]) return false;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return true;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (m - othr.n) exit(1); //异常退出</div><div class=\"line\">        Matrix ans(n, othr.m, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; othr.m; j++)</div><div class=\"line\">                for (int k = 0; k &amp;lt; m; k++) &#123;</div><div class=\"line\">                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">                &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const int&amp;amp; x) const &#123;</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                ans.M[i][j] = M[i][j] * x % MOD;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator +(const Matrix &amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] + othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator -(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] - othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator ^(int x) const &#123;</div><div class=\"line\">        if (n - m) exit(1);</div><div class=\"line\">        Matrix ans(n, m, 1), base = *this;</div><div class=\"line\">        while (x &amp;gt; 0) &#123;</div><div class=\"line\">            if (x &amp;amp; 1) ans = ans * base;</div><div class=\"line\">            base = base * base;</div><div class=\"line\">            x &amp;gt;&amp;gt;= 1;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\">int main(int argc, char **argv) &#123;</div><div class=\"line\">    while (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;k)) &#123;</div><div class=\"line\">        if (n == 0 &amp;amp;&amp;amp; k == 0) break;</div><div class=\"line\">        Matrix A(n, k, 0), B(k, n, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; k; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;A.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        for (int i = 0; i &amp;lt; k; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;B.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        Matrix mat = B * A;</div><div class=\"line\">        int r = n * n - 1;</div><div class=\"line\">        Matrix res = A * (mat ^ r) * B;</div><div class=\"line\">        int ans = 0;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                ans += res.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        printf(\"%d\\n\", ans);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>然后又试了试vector，虽然简单不少，但是仍然很慢：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;cmath&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define PR pair&amp;lt;int,int&amp;gt;</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define Sz(x) (int)x.size()</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clr(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">/*start*/</div><div class=\"line\">#define MOD 6</div><div class=\"line\">int n, k;</div><div class=\"line\">struct Matrix &#123;</div><div class=\"line\">    int n, m;</div><div class=\"line\">    vector&amp;lt;vector&amp;lt;int&amp;gt; &amp;gt;M;</div><div class=\"line\">    Matrix(int n, int m) :n(n), m(m) &#123;</div><div class=\"line\">        alloc();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix(int n, int m, int k) :</div><div class=\"line\">            n(n), m(m) &#123;</div><div class=\"line\">        alloc();</div><div class=\"line\">        Init(k);</div><div class=\"line\">    &#125;</div><div class=\"line\">    void alloc()&#123;</div><div class=\"line\">        M.resize(n);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i].resize(m);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void Init(bool k) &#123; //k=1 返回单位矩阵，k=0 返回零矩阵</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                M[i][j] = k * (i == j);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void out() &#123;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    bool operator==(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) return false;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                if (M[i][j] != othr.M[i][j]) return false;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return true;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (m - othr.n) exit(1); //异常退出</div><div class=\"line\">        Matrix ans(n, othr.m, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; othr.m; j++)</div><div class=\"line\">                for (int k = 0; k &amp;lt; m; k++) &#123;</div><div class=\"line\">                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">                &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const int&amp;amp; x) const &#123;</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                ans.M[i][j] = M[i][j] * x % MOD;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator +(const Matrix &amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] + othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator -(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] - othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator ^(int x) const &#123;</div><div class=\"line\">        if (n - m) exit(1);</div><div class=\"line\">        Matrix ans(n, m, 1), base = *this;</div><div class=\"line\">        while (x &amp;gt; 0) &#123;</div><div class=\"line\">            if (x &amp;amp; 1) ans = ans * base;</div><div class=\"line\">            base = base * base;</div><div class=\"line\">            x &amp;gt;&amp;gt;= 1;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\">int main(int argc, char **argv) &#123;</div><div class=\"line\">    while (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;k)) &#123;</div><div class=\"line\">        if (n == 0 &amp;amp;&amp;amp; k == 0) break;</div><div class=\"line\">        Matrix A(n, k, 0), B(k, n, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; k; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;A.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        for (int i = 0; i &amp;lt; k; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;B.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        Matrix mat = B * A;</div><div class=\"line\">        int r = n * n - 1;</div><div class=\"line\">        Matrix res = A * (mat ^ r) * B;</div><div class=\"line\">        int ans = 0;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                ans += res.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        printf(\"%d\\n\", ans);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>感觉其他方法还比较麻烦。算了就这样吧~</p>\n<p>&nbsp;</p>\n","excerpt":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)<br>Total Submission(s): 206    Accepted Submission(s): 116<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<div class=\"panel_content\">\n\n<p>One day, Alice and Bob felt bored again, Bob knows Alice is a girl who loves math and is just learning something about matrix, so he decided to make a crazy problem for her.</p>\n<p>Bob has a six-faced dice which has numbers 0, 1, 2, 3, 4 and 5 on each face. At first, he will choose a number N (4 &lt;= N &lt;= 1000), and for N times, he keeps throwing his dice for K times (2 &lt;=K &lt;= 6) and writes down its number on the top face to make an N<em>K matrix A, in which each element is not less than 0 and not greater than 5. Then he does similar thing again with a bit difference: he keeps throwing his dice for N times and each time repeat it for K times to write down a K</em>N matrix B, in which each element is not less than 0 and not greater than 5. With the two matrix A and B formed, Alice’s task is to perform the following 4-step calculation.<br>","more":"<br>Step 1: Calculate a new N<em>N matrix C = A</em>B.<br>Step 2: Calculate M = C^(N*N).<br>Step 3: For each element x in M, calculate x % 6. All the remainders form a new matrix M’.<br>Step 4: Calculate the sum of all the elements in M’.</p>\n<p>Bob just made this problem for kidding but he sees Alice taking it serious, so he also wonders what the answer is. And then Bob turn to you for help because he is not good at math.</p>\n<p></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<div class=\"panel_content\">\n\n<p>The input contains several test cases. Each test case starts with two integer N and K, indicating the numbers N and K described above. Then N lines follow, and each line has K integers between 0 and 5, representing matrix A. Then K lines follow, and each line has N integers between 0 and 5, representing matrix B.</p>\n<p>The end of input is indicated by N = K = 0.</p>\n<p></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each case, output the sum of all the elements in M’ in a line.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">4 2 5 5 4 4 5 4 0 0 4 2 5 5 1 3 1 5 6 3 1 2 3 0 3 0 2 3 4 4 3 2 2 5 5 0 5 0 3 4 5 1 1 0 5 3 2 3 3 2 3 1 5 4 5 2 0 0</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">14 56</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%209&amp;source=1&amp;searchmode=source\"> 2014 Multi-University Training Contest 9 </a></div><br><br/></p>\n<hr>\n<p><div class=\"panel_content\">这题让我注意了矩阵模板的开销问题。1000X1000多次调用就会爆内存了。下面是用动态数组写的。效率非常慢，难以接受。</div><br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;cmath&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define PR pair&amp;lt;int,int&amp;gt;</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define Sz(x) (int)x.size()</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clr(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">/*start*/</div><div class=\"line\">#define MOD 6</div><div class=\"line\">int n, k;</div><div class=\"line\">struct Matrix &#123;</div><div class=\"line\">    int n, m;</div><div class=\"line\">    int** M;</div><div class=\"line\">    Matrix(int n, int m) :n(n), m(m) &#123;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix(int n, int m, int k) :</div><div class=\"line\">            n(n), m(m) &#123;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">        Init(k);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    ~Matrix() &#123;</div><div class=\"line\">        if (M) &#123;</div><div class=\"line\">            for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">                if (M[i]) &#123;</div><div class=\"line\">                    delete[] M[i];</div><div class=\"line\">                    M[i] = NULL;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            delete[] M;</div><div class=\"line\">            M = NULL;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void Init(bool k) &#123; //k=1 返回单位矩阵，k=0 返回零矩阵</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                M[i][j] = k * (i == j);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void out() &#123;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix &amp;amp; operator=(const Matrix&amp;amp; othr) &#123;</div><div class=\"line\">        this-&amp;gt;~Matrix();</div><div class=\"line\">        n = othr.n;</div><div class=\"line\">        m = othr.m;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                M[i][j] = othr.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return *this;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix(const Matrix &amp;amp; othr) &#123;</div><div class=\"line\">        n = othr.n;</div><div class=\"line\">        m = othr.m;</div><div class=\"line\">        M = new int*[n];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i] = new int[m];</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                M[i][j] = othr.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    bool operator==(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) return false;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                if (M[i][j] != othr.M[i][j]) return false;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return true;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (m - othr.n) exit(1); //异常退出</div><div class=\"line\">        Matrix ans(n, othr.m, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; othr.m; j++)</div><div class=\"line\">                for (int k = 0; k &amp;lt; m; k++) &#123;</div><div class=\"line\">                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">                &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const int&amp;amp; x) const &#123;</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                ans.M[i][j] = M[i][j] * x % MOD;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator +(const Matrix &amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] + othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator -(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] - othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator ^(int x) const &#123;</div><div class=\"line\">        if (n - m) exit(1);</div><div class=\"line\">        Matrix ans(n, m, 1), base = *this;</div><div class=\"line\">        while (x &amp;gt; 0) &#123;</div><div class=\"line\">            if (x &amp;amp; 1) ans = ans * base;</div><div class=\"line\">            base = base * base;</div><div class=\"line\">            x &amp;gt;&amp;gt;= 1;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\">int main(int argc, char **argv) &#123;</div><div class=\"line\">    while (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;k)) &#123;</div><div class=\"line\">        if (n == 0 &amp;amp;&amp;amp; k == 0) break;</div><div class=\"line\">        Matrix A(n, k, 0), B(k, n, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; k; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;A.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        for (int i = 0; i &amp;lt; k; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;B.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        Matrix mat = B * A;</div><div class=\"line\">        int r = n * n - 1;</div><div class=\"line\">        Matrix res = A * (mat ^ r) * B;</div><div class=\"line\">        int ans = 0;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                ans += res.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        printf(\"%d\\n\", ans);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>然后又试了试vector，虽然简单不少，但是仍然很慢：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;cmath&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define PR pair&amp;lt;int,int&amp;gt;</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define Sz(x) (int)x.size()</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clr(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">/*start*/</div><div class=\"line\">#define MOD 6</div><div class=\"line\">int n, k;</div><div class=\"line\">struct Matrix &#123;</div><div class=\"line\">    int n, m;</div><div class=\"line\">    vector&amp;lt;vector&amp;lt;int&amp;gt; &amp;gt;M;</div><div class=\"line\">    Matrix(int n, int m) :n(n), m(m) &#123;</div><div class=\"line\">        alloc();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix(int n, int m, int k) :</div><div class=\"line\">            n(n), m(m) &#123;</div><div class=\"line\">        alloc();</div><div class=\"line\">        Init(k);</div><div class=\"line\">    &#125;</div><div class=\"line\">    void alloc()&#123;</div><div class=\"line\">        M.resize(n);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            M[i].resize(m);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void Init(bool k) &#123; //k=1 返回单位矩阵，k=0 返回零矩阵</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                M[i][j] = k * (i == j);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    void out() &#123;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                printf(\"%d%c\", M[i][j], j == m - 1 ? '\\n' : ' ');</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    bool operator==(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) return false;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                if (M[i][j] != othr.M[i][j]) return false;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return true;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (m - othr.n) exit(1); //异常退出</div><div class=\"line\">        Matrix ans(n, othr.m, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; othr.m; j++)</div><div class=\"line\">                for (int k = 0; k &amp;lt; m; k++) &#123;</div><div class=\"line\">                    ans.M[i][j] += M[i][k] * othr.M[k][j] % MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                    if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">                &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator *(const int&amp;amp; x) const &#123;</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++)</div><div class=\"line\">                ans.M[i][j] = M[i][j] * x % MOD;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">    Matrix operator +(const Matrix &amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] + othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator -(const Matrix&amp;amp; othr) const &#123;</div><div class=\"line\">        if (n - othr.n || m - othr.m) exit(1);</div><div class=\"line\">        Matrix ans(n, m);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">            for (int j = 0; j &amp;lt; m; j++) &#123;</div><div class=\"line\">                ans.M[i][j] = M[i][j] - othr.M[i][j];</div><div class=\"line\">                if (ans.M[i][j] &amp;gt;= MOD) ans.M[i][j] -= MOD;</div><div class=\"line\">                if (ans.M[i][j] &amp;lt; 0) ans.M[i][j] += MOD;</div><div class=\"line\">            &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    Matrix operator ^(int x) const &#123;</div><div class=\"line\">        if (n - m) exit(1);</div><div class=\"line\">        Matrix ans(n, m, 1), base = *this;</div><div class=\"line\">        while (x &amp;gt; 0) &#123;</div><div class=\"line\">            if (x &amp;amp; 1) ans = ans * base;</div><div class=\"line\">            base = base * base;</div><div class=\"line\">            x &amp;gt;&amp;gt;= 1;</div><div class=\"line\">        &#125;</div><div class=\"line\">        return ans;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\">int main(int argc, char **argv) &#123;</div><div class=\"line\">    while (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;k)) &#123;</div><div class=\"line\">        if (n == 0 &amp;amp;&amp;amp; k == 0) break;</div><div class=\"line\">        Matrix A(n, k, 0), B(k, n, 0);</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; k; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;A.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        for (int i = 0; i &amp;lt; k; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                scanf(\"%d\", &amp;amp;B.M[i][j]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        Matrix mat = B * A;</div><div class=\"line\">        int r = n * n - 1;</div><div class=\"line\">        Matrix res = A * (mat ^ r) * B;</div><div class=\"line\">        int ans = 0;</div><div class=\"line\">        for (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            for (int j = 0; j &amp;lt; n; j++) &#123;</div><div class=\"line\">                ans += res.M[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        printf(\"%d\\n\", ans);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>感觉其他方法还比较麻烦。算了就这样吧~</p>\n<p>&nbsp;</p>"},{"title":"HDU4888 Redraw Beautiful Drawings ","date":"2014-07-29T13:43:58.000Z","_content":"\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">Alice and Bob are playing together. Alice is crazy about art and she has visited many museums around the world. She has a good memory and she can remember all drawings she has seen.Today Alice designs a game using these drawings in her memory. First, she matches K+1 colors appears in the picture to K+1 different integers(from 0 to K). After that, she slices the drawing into grids and there are N rows and M columns. Each grid has an integer on it(from 0 to K) representing the color on the corresponding position in the original drawing. Alice wants to share the wonderful drawings with Bob and she tells Bob the size of the drawing, the number of different colors, and the sum of integers on each row and each column. Bob has to redraw the drawing with Alice's information. Unfortunately, somtimes, the information Alice offers is wrong because of Alice's poor math. And sometimes, Bob can work out multiple different drawings using the information Alice provides. Bob gets confused and he needs your help. You have to tell Bob if Alice's information is right and if her information is right you should also tell Bob whether he can get a unique drawing.</div>\n<div class=\"panel_bottom\"></div>\n<!--more-->\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">The input contains mutiple testcases.For each testcase, the first line contains three integers N(1 ≤ N ≤ 400) , M(1 ≤ M ≤ 400) and K(1 ≤ K ≤ 40).\nN integers are given in the second line representing the sum of N rows.\nM integers are given in the third line representing the sum of M columns.The input is terminated by EOF.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each testcase, if there is no solution for Bob, output \"Impossible\" in one line(without the quotation mark); if there is only one solution for Bob, output \"Unique\" in one line(without the quotation mark) and output an N * M matrix in the following N lines representing Bob's unique solution; if there are many ways for Bob to redraw the drawing, output \"Not Unique\" in one line(without the quotation mark).</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">2 2 4 4 2 4 2 4 2 2 2 2 5 0 5 4 1 4 3 9 1 2 3 3</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Not Unique Impossible Unique 1 2 3 3</div>\n</div>\n&nbsp;\n\n- - -\n\n\n第一步，考虑如何求是否有解。使用网络流求解，每一行和每一列分别对应一个点，加上源点和汇点一共有N+M+2个点。有三类边：\n\n\n\n1.  源点 -&gt; 每一行对应的点，流量限制为该行的和\n2.  每一行对应的点 -&gt; 每一列对应的点，流量限制为 K\n3.  每一列对应的点 -&gt; 汇点，流量限制为该列的和\n&nbsp;\n\n对上图做最大流，若源点出发的边和到达汇点的边全都满流，则有解，否则无解。若要求构造方案，则 (i,j) 对应的整数就是行 i–&gt; 列 j 的流量。\n\n第二步，考虑解是否唯一。显然，解唯一的充分必要条件是完成最大流后的残余网络没有长度大于 2 的环。所以，判断解的唯一性可使用dfs，注意遍历的时候不可以在走完一条边后马上走其反向边，加此限制检查是否有环即可判断解是否唯一。\n\n至此，全题已解决。\n```C++\n#include &lt;iostream&gt; \n#include &lt;cstring&gt; \n#include &lt;cstdio&gt; \n#include &lt;queue&gt; \n#include &lt;cstdlib&gt;\nusing namespace std;\n\nconst int maxn=500,maxm=maxn*maxn;\nint next[maxm*2],num[maxm*2],r[maxm*2],a[maxn*2],row_sum[maxn],col_sum[maxn],n,m,K,tt,T,d[maxn*2],st[maxn*2],cod[maxn][maxn];\nint h[maxn*2],vh[maxn*2];\nbool don[maxm*2],in[maxn*2];\n\nvoid insert(int x,int y,int rr)\n{\n\tnext[++tt]=a[x];num[tt]=y;r[tt]=rr;a[x]=tt;\n\tnext[++tt]=a[y];num[tt]=x;r[tt]=0;a[y]=tt;\n}\n\nvoid construct()\n{\n\ttt=1;T=n+m+1;\n\tfor (int i=0;i&lt;=T;i++) a[i]=0;\n\tfor (int i=1;i&lt;=n;i++) insert(0,i,row_sum[i]);\n\tfor (int i=1;i&lt;=m;i++) insert(i+n,T,col_sum[i]);\n\tfor (int i=1;i&lt;=n;i++)\n\t{\n\t\tfor (int j=1;j&lt;=m;j++)\n\t\t{\n\t\t\tinsert(i,j+n,K);\n\t\t\tcod[i][j]=tt;\n\t\t}\n\t}\n}\n\nint dfs(int x,int y)\n{\n\tif (x==T) return y;\n\tint sig=st[x],minh=T+1;\n\tdo\n\t{\n\t\tif (r[st[x]])\n\t\t{\n\t\t\tif (h[num[st[x]]]+1==h[x])\n\t\t\t{\n\t\t\t\tint k=dfs(num[st[x]],min(y,r[st[x]]));\n\t\t\t\tif (k)\n\t\t\t\t{\n\t\t\t\t\tr[st[x]]-=k;\n\t\t\t\t\tr[st[x]^1]+=k;\n\t\t\t\t\treturn k;\n\t\t\t\t}\n\t\t\t}\n\t\t\tminh=min(minh,h[num[st[x]]]+1);\n\t\t\tif (h[0]&gt;T) return 0;\n\t\t}\n\t\tst[x]=next[st[x]];\n\t\tif (st[x]==0) st[x]=a[x];\n\t}while (sig!=st[x]);\n\tif (vh[h[x]]--==0) h[0]=T+1;\n\tvh[h[x]=minh]++;\n\treturn 0;\n}\n\nint max_flow()\n{\n\tfor (int i=0;i&lt;=T;i++) h[i]=vh[i]=0;\n\tfor (int i=0;i&lt;=T;i++) st[i]=a[i];\n\tvh[0]=T+1;\n\tint ret=0;\n\twhile (h[0]&lt;=T) ret+=dfs(0,K+1);\n\treturn ret;\n}\n\n/*bool find_circle()\n{\n\tdeque  q;\n\tfor (int i=0;i&lt;=T;i++) d[i]=0;\n\tfor (int i=0;i&lt;=T;i++)\n\t{\n\t\tfor (int p=a[i];p;p=next[p])\n\t\t{\n\t\t\tif (r[p]) d[i]++;\n\t\t}\n\t\tif (d[i]==0) q.push_back(i);\n\t}\n\tint cnt=T+1;\n\twhile (!q.empty())\n\t{\n\t\tint x=q.front();\n\t\tcnt--;\n\t\tq.pop_front();\n\t\tfor (int p=a[x];p;p=next[p])\n\t\t{\n\t\t\tif (r[p^1]) \n\t\t\t{\n\t\t\t\td[num[p]]--;\n\t\t\t\tif (d[num[p]]==0) q.push_back(num[p]);\n\t\t\t}\n\t\t}\n\t}\n\treturn cnt;\n}*/\n\nbool visit(int x,int ed)\n{\n\tif (don[ed]) \n\t\treturn in[x];\n\tdon[ed]=true;\n\tin[x]=true;\n\tfor (int p=a[x];p;p=next[p])\n\t{\n\t\tif (r[p] &amp;&amp; (ed^p)!=1)\n\t\t\tif (visit(num[p],p)) return true;\n\t}\n\tin[x]=false;\n\treturn false;\n}\n\nbool find_circle()\n{\n\tfor (int i=0;i&lt;=T;i++) in[i]=false;\n\tfor (int i=1;i&lt;=tt;i++) don[i]=false;\n\tint col=0;\n\tfor (int i=2;i&lt;=tt;i++)\n\t{\n\t\tif (r[i] &amp;&amp; !don[i])\n\t\t{\n\t\t\tin[num[i^1]]=true;\n\t\t\tif (visit(num[i],i)) return true; \n\t\t\tin[num[i^1]]=false;\n\t\t}\n\t}\n\treturn false;\n}\n\nvoid print_scheme()\n{\n\tprintf(\"Unique\\n\");\n\tfor (int i=1;i&lt;=n;i++)\n\t{\n\t\tprintf(\"%d\",r[cod[i][1]]);\n\t\tfor (int j=2;j&lt;=m;j++) printf(\" %d\",r[cod[i][j]]);\n\t\tprintf(\"\\n\");\n\t}\n}\n\nint main()\n{\n\twhile (scanf(\"%d%d%d\",&amp;n,&amp;m,&amp;K)!=EOF)\n\t{\n\t\tint tmp=0;\n\t\tfor (int i=1;i&lt;=n;i++)\n\t\t{\n\t\t\tscanf(\"%d\",&amp;row_sum[i]);\n\t\t\ttmp+=row_sum[i];\n\t\t}\n\t\tint sum=tmp;\n\t\tfor (int i=1;i&lt;=m;i++)\n\t\t{\n\t\t\tscanf(\"%d\",&amp;col_sum[i]);\n\t\t\ttmp-=col_sum[i];\n\t\t}\n\t\tif (tmp) \n\t\t{\n\t\t\tprintf(\"Impossible\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tconstruct();\n\t\tif (max_flow()&lt;sum)\n\t\t{\n\t\t\tprintf(\"Impossible\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tif (find_circle())\n\t\t{\n\t\t\tprintf(\"Not Unique\\n\");\n\t\t}else print_scheme();\n\t}\n\n\treturn 0;\n}\n```","source":"_posts/hdu4888-redraw-beautiful-drawings.md","raw":"title: \"HDU4888 Redraw Beautiful Drawings \"\ncategories:\n  - ACM\ndate: 2014-07-29 21:43:58\ntags: 网络流\n---\n\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">Alice and Bob are playing together. Alice is crazy about art and she has visited many museums around the world. She has a good memory and she can remember all drawings she has seen.Today Alice designs a game using these drawings in her memory. First, she matches K+1 colors appears in the picture to K+1 different integers(from 0 to K). After that, she slices the drawing into grids and there are N rows and M columns. Each grid has an integer on it(from 0 to K) representing the color on the corresponding position in the original drawing. Alice wants to share the wonderful drawings with Bob and she tells Bob the size of the drawing, the number of different colors, and the sum of integers on each row and each column. Bob has to redraw the drawing with Alice's information. Unfortunately, somtimes, the information Alice offers is wrong because of Alice's poor math. And sometimes, Bob can work out multiple different drawings using the information Alice provides. Bob gets confused and he needs your help. You have to tell Bob if Alice's information is right and if her information is right you should also tell Bob whether he can get a unique drawing.</div>\n<div class=\"panel_bottom\"></div>\n<!--more-->\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">The input contains mutiple testcases.For each testcase, the first line contains three integers N(1 ≤ N ≤ 400) , M(1 ≤ M ≤ 400) and K(1 ≤ K ≤ 40).\nN integers are given in the second line representing the sum of N rows.\nM integers are given in the third line representing the sum of M columns.The input is terminated by EOF.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">For each testcase, if there is no solution for Bob, output \"Impossible\" in one line(without the quotation mark); if there is only one solution for Bob, output \"Unique\" in one line(without the quotation mark) and output an N * M matrix in the following N lines representing Bob's unique solution; if there are many ways for Bob to redraw the drawing, output \"Not Unique\" in one line(without the quotation mark).</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">2 2 4 4 2 4 2 4 2 2 2 2 5 0 5 4 1 4 3 9 1 2 3 3</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Not Unique Impossible Unique 1 2 3 3</div>\n</div>\n&nbsp;\n\n- - -\n\n\n第一步，考虑如何求是否有解。使用网络流求解，每一行和每一列分别对应一个点，加上源点和汇点一共有N+M+2个点。有三类边：\n\n\n\n1.  源点 -&gt; 每一行对应的点，流量限制为该行的和\n2.  每一行对应的点 -&gt; 每一列对应的点，流量限制为 K\n3.  每一列对应的点 -&gt; 汇点，流量限制为该列的和\n&nbsp;\n\n对上图做最大流，若源点出发的边和到达汇点的边全都满流，则有解，否则无解。若要求构造方案，则 (i,j) 对应的整数就是行 i–&gt; 列 j 的流量。\n\n第二步，考虑解是否唯一。显然，解唯一的充分必要条件是完成最大流后的残余网络没有长度大于 2 的环。所以，判断解的唯一性可使用dfs，注意遍历的时候不可以在走完一条边后马上走其反向边，加此限制检查是否有环即可判断解是否唯一。\n\n至此，全题已解决。\n```C++\n#include &lt;iostream&gt; \n#include &lt;cstring&gt; \n#include &lt;cstdio&gt; \n#include &lt;queue&gt; \n#include &lt;cstdlib&gt;\nusing namespace std;\n\nconst int maxn=500,maxm=maxn*maxn;\nint next[maxm*2],num[maxm*2],r[maxm*2],a[maxn*2],row_sum[maxn],col_sum[maxn],n,m,K,tt,T,d[maxn*2],st[maxn*2],cod[maxn][maxn];\nint h[maxn*2],vh[maxn*2];\nbool don[maxm*2],in[maxn*2];\n\nvoid insert(int x,int y,int rr)\n{\n\tnext[++tt]=a[x];num[tt]=y;r[tt]=rr;a[x]=tt;\n\tnext[++tt]=a[y];num[tt]=x;r[tt]=0;a[y]=tt;\n}\n\nvoid construct()\n{\n\ttt=1;T=n+m+1;\n\tfor (int i=0;i&lt;=T;i++) a[i]=0;\n\tfor (int i=1;i&lt;=n;i++) insert(0,i,row_sum[i]);\n\tfor (int i=1;i&lt;=m;i++) insert(i+n,T,col_sum[i]);\n\tfor (int i=1;i&lt;=n;i++)\n\t{\n\t\tfor (int j=1;j&lt;=m;j++)\n\t\t{\n\t\t\tinsert(i,j+n,K);\n\t\t\tcod[i][j]=tt;\n\t\t}\n\t}\n}\n\nint dfs(int x,int y)\n{\n\tif (x==T) return y;\n\tint sig=st[x],minh=T+1;\n\tdo\n\t{\n\t\tif (r[st[x]])\n\t\t{\n\t\t\tif (h[num[st[x]]]+1==h[x])\n\t\t\t{\n\t\t\t\tint k=dfs(num[st[x]],min(y,r[st[x]]));\n\t\t\t\tif (k)\n\t\t\t\t{\n\t\t\t\t\tr[st[x]]-=k;\n\t\t\t\t\tr[st[x]^1]+=k;\n\t\t\t\t\treturn k;\n\t\t\t\t}\n\t\t\t}\n\t\t\tminh=min(minh,h[num[st[x]]]+1);\n\t\t\tif (h[0]&gt;T) return 0;\n\t\t}\n\t\tst[x]=next[st[x]];\n\t\tif (st[x]==0) st[x]=a[x];\n\t}while (sig!=st[x]);\n\tif (vh[h[x]]--==0) h[0]=T+1;\n\tvh[h[x]=minh]++;\n\treturn 0;\n}\n\nint max_flow()\n{\n\tfor (int i=0;i&lt;=T;i++) h[i]=vh[i]=0;\n\tfor (int i=0;i&lt;=T;i++) st[i]=a[i];\n\tvh[0]=T+1;\n\tint ret=0;\n\twhile (h[0]&lt;=T) ret+=dfs(0,K+1);\n\treturn ret;\n}\n\n/*bool find_circle()\n{\n\tdeque  q;\n\tfor (int i=0;i&lt;=T;i++) d[i]=0;\n\tfor (int i=0;i&lt;=T;i++)\n\t{\n\t\tfor (int p=a[i];p;p=next[p])\n\t\t{\n\t\t\tif (r[p]) d[i]++;\n\t\t}\n\t\tif (d[i]==0) q.push_back(i);\n\t}\n\tint cnt=T+1;\n\twhile (!q.empty())\n\t{\n\t\tint x=q.front();\n\t\tcnt--;\n\t\tq.pop_front();\n\t\tfor (int p=a[x];p;p=next[p])\n\t\t{\n\t\t\tif (r[p^1]) \n\t\t\t{\n\t\t\t\td[num[p]]--;\n\t\t\t\tif (d[num[p]]==0) q.push_back(num[p]);\n\t\t\t}\n\t\t}\n\t}\n\treturn cnt;\n}*/\n\nbool visit(int x,int ed)\n{\n\tif (don[ed]) \n\t\treturn in[x];\n\tdon[ed]=true;\n\tin[x]=true;\n\tfor (int p=a[x];p;p=next[p])\n\t{\n\t\tif (r[p] &amp;&amp; (ed^p)!=1)\n\t\t\tif (visit(num[p],p)) return true;\n\t}\n\tin[x]=false;\n\treturn false;\n}\n\nbool find_circle()\n{\n\tfor (int i=0;i&lt;=T;i++) in[i]=false;\n\tfor (int i=1;i&lt;=tt;i++) don[i]=false;\n\tint col=0;\n\tfor (int i=2;i&lt;=tt;i++)\n\t{\n\t\tif (r[i] &amp;&amp; !don[i])\n\t\t{\n\t\t\tin[num[i^1]]=true;\n\t\t\tif (visit(num[i],i)) return true; \n\t\t\tin[num[i^1]]=false;\n\t\t}\n\t}\n\treturn false;\n}\n\nvoid print_scheme()\n{\n\tprintf(\"Unique\\n\");\n\tfor (int i=1;i&lt;=n;i++)\n\t{\n\t\tprintf(\"%d\",r[cod[i][1]]);\n\t\tfor (int j=2;j&lt;=m;j++) printf(\" %d\",r[cod[i][j]]);\n\t\tprintf(\"\\n\");\n\t}\n}\n\nint main()\n{\n\twhile (scanf(\"%d%d%d\",&amp;n,&amp;m,&amp;K)!=EOF)\n\t{\n\t\tint tmp=0;\n\t\tfor (int i=1;i&lt;=n;i++)\n\t\t{\n\t\t\tscanf(\"%d\",&amp;row_sum[i]);\n\t\t\ttmp+=row_sum[i];\n\t\t}\n\t\tint sum=tmp;\n\t\tfor (int i=1;i&lt;=m;i++)\n\t\t{\n\t\t\tscanf(\"%d\",&amp;col_sum[i]);\n\t\t\ttmp-=col_sum[i];\n\t\t}\n\t\tif (tmp) \n\t\t{\n\t\t\tprintf(\"Impossible\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tconstruct();\n\t\tif (max_flow()&lt;sum)\n\t\t{\n\t\t\tprintf(\"Impossible\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tif (find_circle())\n\t\t{\n\t\t\tprintf(\"Not Unique\\n\");\n\t\t}else print_scheme();\n\t}\n\n\treturn 0;\n}\n```","slug":"hdu4888-redraw-beautiful-drawings","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1f00395rgx5vxux2pl","content":"<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">Alice and Bob are playing together. Alice is crazy about art and she has visited many museums around the world. She has a good memory and she can remember all drawings she has seen.Today Alice designs a game using these drawings in her memory. First, she matches K+1 colors appears in the picture to K+1 different integers(from 0 to K). After that, she slices the drawing into grids and there are N rows and M columns. Each grid has an integer on it(from 0 to K) representing the color on the corresponding position in the original drawing. Alice wants to share the wonderful drawings with Bob and she tells Bob the size of the drawing, the number of different colors, and the sum of integers on each row and each column. Bob has to redraw the drawing with Alice’s information. Unfortunately, somtimes, the information Alice offers is wrong because of Alice’s poor math. And sometimes, Bob can work out multiple different drawings using the information Alice provides. Bob gets confused and he needs your help. You have to tell Bob if Alice’s information is right and if her information is right you should also tell Bob whether he can get a unique drawing.</div></p>\n<p><div class=\"panel_bottom\"></div><br><a id=\"more\"></a><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">The input contains mutiple testcases.For each testcase, the first line contains three integers N(1 ≤ N ≤ 400) , M(1 ≤ M ≤ 400) and K(1 ≤ K ≤ 40).<br>N integers are given in the second line representing the sum of N rows.<br>M integers are given in the third line representing the sum of M columns.The input is terminated by EOF.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each testcase, if there is no solution for Bob, output “Impossible” in one line(without the quotation mark); if there is only one solution for Bob, output “Unique” in one line(without the quotation mark) and output an N * M matrix in the following N lines representing Bob’s unique solution; if there are many ways for Bob to redraw the drawing, output “Not Unique” in one line(without the quotation mark).</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">2 2 4 4 2 4 2 4 2 2 2 2 5 0 5 4 1 4 3 9 1 2 3 3</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Not Unique Impossible Unique 1 2 3 3</div><br><br>&nbsp;</p>\n<hr>\n<p>第一步，考虑如何求是否有解。使用网络流求解，每一行和每一列分别对应一个点，加上源点和汇点一共有N+M+2个点。有三类边：</p>\n<ol>\n<li>源点 -&gt; 每一行对应的点，流量限制为该行的和</li>\n<li>每一行对应的点 -&gt; 每一列对应的点，流量限制为 K</li>\n<li>每一列对应的点 -&gt; 汇点，流量限制为该列的和<br>&nbsp;</li>\n</ol>\n<p>对上图做最大流，若源点出发的边和到达汇点的边全都满流，则有解，否则无解。若要求构造方案，则 (i,j) 对应的整数就是行 i–&gt; 列 j 的流量。</p>\n<p>第二步，考虑解是否唯一。显然，解唯一的充分必要条件是完成最大流后的残余网络没有长度大于 2 的环。所以，判断解的唯一性可使用dfs，注意遍历的时候不可以在走完一条边后马上走其反向边，加此限制检查是否有环即可判断解是否唯一。</p>\n<p>至此，全题已解决。<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;iostream&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;cstring&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;cstdio&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;queue&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;cstdlib&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> maxn=<span class=\"number\">500</span>,maxm=maxn*maxn;</div><div class=\"line\"><span class=\"keyword\">int</span> next[maxm*<span class=\"number\">2</span>],num[maxm*<span class=\"number\">2</span>],r[maxm*<span class=\"number\">2</span>],a[maxn*<span class=\"number\">2</span>],row_sum[maxn],col_sum[maxn],n,m,K,tt,T,d[maxn*<span class=\"number\">2</span>],st[maxn*<span class=\"number\">2</span>],cod[maxn][maxn];</div><div class=\"line\"><span class=\"keyword\">int</span> h[maxn*<span class=\"number\">2</span>],vh[maxn*<span class=\"number\">2</span>];</div><div class=\"line\"><span class=\"keyword\">bool</span> don[maxm*<span class=\"number\">2</span>],in[maxn*<span class=\"number\">2</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y,<span class=\"keyword\">int</span> rr)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\tnext[++tt]=a[x];num[tt]=y;r[tt]=rr;a[x]=tt;</div><div class=\"line\">\tnext[++tt]=a[y];num[tt]=x;r[tt]=<span class=\"number\">0</span>;a[y]=tt;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">construct</span><span class=\"params\">()</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\ttt=<span class=\"number\">1</span>;T=n+m+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) a[i]=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++) insert(<span class=\"number\">0</span>,i,row_sum[i]);</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=m;i++) insert(i+n,T,col_sum[i]);</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&amp;lt;=m;j++)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tinsert(i,j+n,K);</div><div class=\"line\">\t\t\tcod[i][j]=tt;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (x==T) <span class=\"keyword\">return</span> y;</div><div class=\"line\">\t<span class=\"keyword\">int</span> sig=st[x],minh=T+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">do</span></div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (r[st[x]])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (h[num[st[x]]]+<span class=\"number\">1</span>==h[x])</div><div class=\"line\">\t\t\t&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> k=dfs(num[st[x]],min(y,r[st[x]]));</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (k)</div><div class=\"line\">\t\t\t\t&#123;</div><div class=\"line\">\t\t\t\t\tr[st[x]]-=k;</div><div class=\"line\">\t\t\t\t\tr[st[x]^<span class=\"number\">1</span>]+=k;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> k;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tminh=min(minh,h[num[st[x]]]+<span class=\"number\">1</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (h[<span class=\"number\">0</span>]&amp;gt;T) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tst[x]=next[st[x]];</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (st[x]==<span class=\"number\">0</span>) st[x]=a[x];</div><div class=\"line\">\t&#125;<span class=\"keyword\">while</span> (sig!=st[x]);</div><div class=\"line\">\t<span class=\"keyword\">if</span> (vh[h[x]]--==<span class=\"number\">0</span>) h[<span class=\"number\">0</span>]=T+<span class=\"number\">1</span>;</div><div class=\"line\">\tvh[h[x]=minh]++;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">max_flow</span><span class=\"params\">()</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) h[i]=vh[i]=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) st[i]=a[i];</div><div class=\"line\">\tvh[<span class=\"number\">0</span>]=T+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">int</span> ret=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (h[<span class=\"number\">0</span>]&amp;lt;=T) ret+=dfs(<span class=\"number\">0</span>,K+<span class=\"number\">1</span>);</div><div class=\"line\">\t<span class=\"keyword\">return</span> ret;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/*bool find_circle()</span></div><div class=\"line\">&#123;</div><div class=\"line\">\tdeque  q;</div><div class=\"line\">\tfor (int i=0;i&amp;lt;=T;i++) d[i]=0;</div><div class=\"line\">\tfor (int i=0;i&amp;lt;=T;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\tfor (int p=a[i];p;p=next[p])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tif (r[p]) d[i]++;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tif (d[i]==0) q.push_back(i);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tint cnt=T+1;</div><div class=\"line\">\twhile (!q.empty())</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\tint x=q.front();</div><div class=\"line\">\t\tcnt--;</div><div class=\"line\">\t\tq.pop_front();</div><div class=\"line\">\t\tfor (int p=a[x];p;p=next[p])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tif (r[p^1]) </div><div class=\"line\">\t\t\t&#123;</div><div class=\"line\">\t\t\t\td[num[p]]--;</div><div class=\"line\">\t\t\t\tif (d[num[p]]==0) q.push_back(num[p]);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\treturn cnt;</div><div class=\"line\">&#125;*/</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">visit</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> ed)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (don[ed]) </div><div class=\"line\">\t\t<span class=\"keyword\">return</span> in[x];</div><div class=\"line\">\tdon[ed]=<span class=\"literal\">true</span>;</div><div class=\"line\">\tin[x]=<span class=\"literal\">true</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> p=a[x];p;p=next[p])</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (r[p] &amp;amp;&amp;amp; (ed^p)!=<span class=\"number\">1</span>)</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (visit(num[p],p)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tin[x]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">find_circle</span><span class=\"params\">()</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) in[i]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=tt;i++) don[i]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t<span class=\"keyword\">int</span> col=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">2</span>;i&amp;lt;=tt;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (r[i] &amp;amp;&amp;amp; !don[i])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tin[num[i^<span class=\"number\">1</span>]]=<span class=\"literal\">true</span>;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (visit(num[i],i)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>; </div><div class=\"line\">\t\t\tin[num[i^<span class=\"number\">1</span>]]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">print_scheme</span><span class=\"params\">()</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Unique\\n\"</span>);</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\"</span>,r[cod[i][<span class=\"number\">1</span>]]);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j=<span class=\"number\">2</span>;j&amp;lt;=m;j++) <span class=\"built_in\">printf</span>(<span class=\"string\">\" %d\"</span>,r[cod[i][j]]);</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>,&amp;amp;n,&amp;amp;m,&amp;amp;K)!=EOF)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> tmp=<span class=\"number\">0</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;row_sum[i]);</div><div class=\"line\">\t\t\ttmp+=row_sum[i];</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sum=tmp;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=m;i++)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;col_sum[i]);</div><div class=\"line\">\t\t\ttmp-=col_sum[i];</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (tmp) </div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Impossible\\n\"</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tconstruct();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (max_flow()&amp;lt;sum)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Impossible\\n\"</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (find_circle())</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Not Unique\\n\"</span>);</div><div class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> print_scheme();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">Alice and Bob are playing together. Alice is crazy about art and she has visited many museums around the world. She has a good memory and she can remember all drawings she has seen.Today Alice designs a game using these drawings in her memory. First, she matches K+1 colors appears in the picture to K+1 different integers(from 0 to K). After that, she slices the drawing into grids and there are N rows and M columns. Each grid has an integer on it(from 0 to K) representing the color on the corresponding position in the original drawing. Alice wants to share the wonderful drawings with Bob and she tells Bob the size of the drawing, the number of different colors, and the sum of integers on each row and each column. Bob has to redraw the drawing with Alice’s information. Unfortunately, somtimes, the information Alice offers is wrong because of Alice’s poor math. And sometimes, Bob can work out multiple different drawings using the information Alice provides. Bob gets confused and he needs your help. You have to tell Bob if Alice’s information is right and if her information is right you should also tell Bob whether he can get a unique drawing.</div></p>\n<p><div class=\"panel_bottom\"></div><br>","more":"<br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">The input contains mutiple testcases.For each testcase, the first line contains three integers N(1 ≤ N ≤ 400) , M(1 ≤ M ≤ 400) and K(1 ≤ K ≤ 40).<br>N integers are given in the second line representing the sum of N rows.<br>M integers are given in the third line representing the sum of M columns.The input is terminated by EOF.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">For each testcase, if there is no solution for Bob, output “Impossible” in one line(without the quotation mark); if there is only one solution for Bob, output “Unique” in one line(without the quotation mark) and output an N * M matrix in the following N lines representing Bob’s unique solution; if there are many ways for Bob to redraw the drawing, output “Not Unique” in one line(without the quotation mark).</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">2 2 4 4 2 4 2 4 2 2 2 2 5 0 5 4 1 4 3 9 1 2 3 3</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Not Unique Impossible Unique 1 2 3 3</div><br></div><br>&nbsp;</p>\n<hr>\n<p>第一步，考虑如何求是否有解。使用网络流求解，每一行和每一列分别对应一个点，加上源点和汇点一共有N+M+2个点。有三类边：</p>\n<ol>\n<li>源点 -&gt; 每一行对应的点，流量限制为该行的和</li>\n<li>每一行对应的点 -&gt; 每一列对应的点，流量限制为 K</li>\n<li>每一列对应的点 -&gt; 汇点，流量限制为该列的和<br>&nbsp;</li>\n</ol>\n<p>对上图做最大流，若源点出发的边和到达汇点的边全都满流，则有解，否则无解。若要求构造方案，则 (i,j) 对应的整数就是行 i–&gt; 列 j 的流量。</p>\n<p>第二步，考虑解是否唯一。显然，解唯一的充分必要条件是完成最大流后的残余网络没有长度大于 2 的环。所以，判断解的唯一性可使用dfs，注意遍历的时候不可以在走完一条边后马上走其反向边，加此限制检查是否有环即可判断解是否唯一。</p>\n<p>至此，全题已解决。<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;iostream&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;cstring&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;cstdio&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;queue&amp;gt; </span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> &amp;lt;cstdlib&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> maxn=<span class=\"number\">500</span>,maxm=maxn*maxn;</div><div class=\"line\"><span class=\"keyword\">int</span> next[maxm*<span class=\"number\">2</span>],num[maxm*<span class=\"number\">2</span>],r[maxm*<span class=\"number\">2</span>],a[maxn*<span class=\"number\">2</span>],row_sum[maxn],col_sum[maxn],n,m,K,tt,T,d[maxn*<span class=\"number\">2</span>],st[maxn*<span class=\"number\">2</span>],cod[maxn][maxn];</div><div class=\"line\"><span class=\"keyword\">int</span> h[maxn*<span class=\"number\">2</span>],vh[maxn*<span class=\"number\">2</span>];</div><div class=\"line\"><span class=\"keyword\">bool</span> don[maxm*<span class=\"number\">2</span>],in[maxn*<span class=\"number\">2</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y,<span class=\"keyword\">int</span> rr)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\tnext[++tt]=a[x];num[tt]=y;r[tt]=rr;a[x]=tt;</div><div class=\"line\">\tnext[++tt]=a[y];num[tt]=x;r[tt]=<span class=\"number\">0</span>;a[y]=tt;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">construct</span><span class=\"params\">()</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\ttt=<span class=\"number\">1</span>;T=n+m+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) a[i]=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++) insert(<span class=\"number\">0</span>,i,row_sum[i]);</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=m;i++) insert(i+n,T,col_sum[i]);</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&amp;lt;=m;j++)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tinsert(i,j+n,K);</div><div class=\"line\">\t\t\tcod[i][j]=tt;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (x==T) <span class=\"keyword\">return</span> y;</div><div class=\"line\">\t<span class=\"keyword\">int</span> sig=st[x],minh=T+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">do</span></div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (r[st[x]])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (h[num[st[x]]]+<span class=\"number\">1</span>==h[x])</div><div class=\"line\">\t\t\t&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> k=dfs(num[st[x]],min(y,r[st[x]]));</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (k)</div><div class=\"line\">\t\t\t\t&#123;</div><div class=\"line\">\t\t\t\t\tr[st[x]]-=k;</div><div class=\"line\">\t\t\t\t\tr[st[x]^<span class=\"number\">1</span>]+=k;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> k;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tminh=min(minh,h[num[st[x]]]+<span class=\"number\">1</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (h[<span class=\"number\">0</span>]&amp;gt;T) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tst[x]=next[st[x]];</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (st[x]==<span class=\"number\">0</span>) st[x]=a[x];</div><div class=\"line\">\t&#125;<span class=\"keyword\">while</span> (sig!=st[x]);</div><div class=\"line\">\t<span class=\"keyword\">if</span> (vh[h[x]]--==<span class=\"number\">0</span>) h[<span class=\"number\">0</span>]=T+<span class=\"number\">1</span>;</div><div class=\"line\">\tvh[h[x]=minh]++;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">max_flow</span><span class=\"params\">()</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) h[i]=vh[i]=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) st[i]=a[i];</div><div class=\"line\">\tvh[<span class=\"number\">0</span>]=T+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">int</span> ret=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (h[<span class=\"number\">0</span>]&amp;lt;=T) ret+=dfs(<span class=\"number\">0</span>,K+<span class=\"number\">1</span>);</div><div class=\"line\">\t<span class=\"keyword\">return</span> ret;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/*bool find_circle()</div><div class=\"line\">&#123;</div><div class=\"line\">\tdeque  q;</div><div class=\"line\">\tfor (int i=0;i&amp;lt;=T;i++) d[i]=0;</div><div class=\"line\">\tfor (int i=0;i&amp;lt;=T;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\tfor (int p=a[i];p;p=next[p])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tif (r[p]) d[i]++;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tif (d[i]==0) q.push_back(i);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tint cnt=T+1;</div><div class=\"line\">\twhile (!q.empty())</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\tint x=q.front();</div><div class=\"line\">\t\tcnt--;</div><div class=\"line\">\t\tq.pop_front();</div><div class=\"line\">\t\tfor (int p=a[x];p;p=next[p])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tif (r[p^1]) </div><div class=\"line\">\t\t\t&#123;</div><div class=\"line\">\t\t\t\td[num[p]]--;</div><div class=\"line\">\t\t\t\tif (d[num[p]]==0) q.push_back(num[p]);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\treturn cnt;</div><div class=\"line\">&#125;*/</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">visit</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> ed)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (don[ed]) </div><div class=\"line\">\t\t<span class=\"keyword\">return</span> in[x];</div><div class=\"line\">\tdon[ed]=<span class=\"literal\">true</span>;</div><div class=\"line\">\tin[x]=<span class=\"literal\">true</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> p=a[x];p;p=next[p])</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (r[p] &amp;amp;&amp;amp; (ed^p)!=<span class=\"number\">1</span>)</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (visit(num[p],p)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tin[x]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">find_circle</span><span class=\"params\">()</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;=T;i++) in[i]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=tt;i++) don[i]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t<span class=\"keyword\">int</span> col=<span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">2</span>;i&amp;lt;=tt;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (r[i] &amp;amp;&amp;amp; !don[i])</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\tin[num[i^<span class=\"number\">1</span>]]=<span class=\"literal\">true</span>;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (visit(num[i],i)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span>; </div><div class=\"line\">\t\t\tin[num[i^<span class=\"number\">1</span>]]=<span class=\"literal\">false</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">print_scheme</span><span class=\"params\">()</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Unique\\n\"</span>);</div><div class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\"</span>,r[cod[i][<span class=\"number\">1</span>]]);</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j=<span class=\"number\">2</span>;j&amp;lt;=m;j++) <span class=\"built_in\">printf</span>(<span class=\"string\">\" %d\"</span>,r[cod[i][j]]);</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>,&amp;amp;n,&amp;amp;m,&amp;amp;K)!=EOF)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> tmp=<span class=\"number\">0</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;row_sum[i]);</div><div class=\"line\">\t\t\ttmp+=row_sum[i];</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sum=tmp;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=m;i++)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;col_sum[i]);</div><div class=\"line\">\t\t\ttmp-=col_sum[i];</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (tmp) </div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Impossible\\n\"</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tconstruct();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (max_flow()&amp;lt;sum)</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Impossible\\n\"</span>);</div><div class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (find_circle())</div><div class=\"line\">\t\t&#123;</div><div class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Not Unique\\n\"</span>);</div><div class=\"line\">\t\t&#125;<span class=\"keyword\">else</span> print_scheme();</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"我的HerbstluftWM","date":"2014-08-14T12:04:50.000Z","_content":"\n一直以来想折腾一下WM，但是又感觉麻烦。前天把笔记本带到机房就借此机会在虚拟机中玩了一下。发现事实上比我想像的要简单的多。少量配置了一下两个配置文件就能用了。然后使用compton做透明特效。看起来也挺简洁美观的。\n\nWM最大的特点就是轻便，herbstluftWM也不例外。安装只有几百兆，附加依赖少，几乎一个命令的事情。启动、响应速度都是普通DE无法比拟的快。加上compton的透明效果，稍加修饰整个系统的界面就非常美观了。\n\n两个配置文件与更详细的说明我已经push到了github：[click here](https://github.com/stkevintan/herbstluftwm)\n","source":"_posts/herbustluftwm-config.md","raw":"---\ntitle: 我的HerbstluftWM\ndate: 2014-08-14 20:04:50\ntags: \n- DE/WM\ncategories:\n- Linux\n    \n---\n\n一直以来想折腾一下WM，但是又感觉麻烦。前天把笔记本带到机房就借此机会在虚拟机中玩了一下。发现事实上比我想像的要简单的多。少量配置了一下两个配置文件就能用了。然后使用compton做透明特效。看起来也挺简洁美观的。\n\nWM最大的特点就是轻便，herbstluftWM也不例外。安装只有几百兆，附加依赖少，几乎一个命令的事情。启动、响应速度都是普通DE无法比拟的快。加上compton的透明效果，稍加修饰整个系统的界面就非常美观了。\n\n两个配置文件与更详细的说明我已经push到了github：[click here](https://github.com/stkevintan/herbstluftwm)\n","slug":"herbustluftwm-config","published":1,"updated":"2019-10-11T05:50:15.674Z","_id":"ciz5e9l1h003d5rgx25rdqo0a","comments":1,"layout":"post","photos":[],"link":"","content":"<p>一直以来想折腾一下WM，但是又感觉麻烦。前天把笔记本带到机房就借此机会在虚拟机中玩了一下。发现事实上比我想像的要简单的多。少量配置了一下两个配置文件就能用了。然后使用compton做透明特效。看起来也挺简洁美观的。</p>\n<p>WM最大的特点就是轻便，herbstluftWM也不例外。安装只有几百兆，附加依赖少，几乎一个命令的事情。启动、响应速度都是普通DE无法比拟的快。加上compton的透明效果，稍加修饰整个系统的界面就非常美观了。</p>\n<p>两个配置文件与更详细的说明我已经push到了github：<a href=\"https://github.com/stkevintan/herbstluftwm\" target=\"_blank\" rel=\"noopener\">click here</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>一直以来想折腾一下WM，但是又感觉麻烦。前天把笔记本带到机房就借此机会在虚拟机中玩了一下。发现事实上比我想像的要简单的多。少量配置了一下两个配置文件就能用了。然后使用compton做透明特效。看起来也挺简洁美观的。</p>\n<p>WM最大的特点就是轻便，herbstluftWM也不例外。安装只有几百兆，附加依赖少，几乎一个命令的事情。启动、响应速度都是普通DE无法比拟的快。加上compton的透明效果，稍加修饰整个系统的界面就非常美观了。</p>\n<p>两个配置文件与更详细的说明我已经push到了github：<a href=\"https://github.com/stkevintan/herbstluftwm\" target=\"_blank\" rel=\"noopener\">click here</a></p>\n"},{"title":"HDU4944 FSF’s game","id":"67","date":"2014-08-12T12:59:32.000Z","_content":"\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 9000/4500 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)\nTotal Submission(s): 166    Accepted Submission(s): 76\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">FSF has programmed a game.\nIn this game, players need to divide a rectangle into several same squares.\nThe length and width of rectangles are integer, and of course the side length of squares are integer.\n\nAfter division, players can get some coins.\nIf players successfully divide a AxB rectangle(length: A, width: B) into KxK squares(side length: K), they can get A*B/ gcd(A/K,B/K) gold coins.\nIn a level, you can’t get coins twice with same method.\n(For example, You can get 6 coins from 2x2(A=2,B=2) rectangle. When K=1, A*B/gcd(A/K,B/K)=2; When K=2, A*B/gcd(A/K,B/K)=4; 2+4=6; )\n<!--more-->\nThere are N*(N+1)/2 levels in this game, and every level is an unique rectangle. (1x1 , 2x1, 2x2, 3x1, ..., Nx(N-1), NxN)\n\nFSF has played this game for a long time, and he finally gets all the coins in the game.\nUnfortunately ,he uses an UNSIGNED 32-BIT INTEGER variable to count the number of coins.\nThis variable may overflow.\nWe want to know what the variable will be.\n(In other words, the number of coins mod 2^32)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">There are multiply test cases.\n\nThe first line contains an integer T(T&lt;=500000), the number of test cases\n\nEach of the next T lines contain an integer N(N&lt;=500000).</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">Output a single line for each test case.\n\nFor each test case, you should output \"Case #C: \". first, where C indicates the case number and counts from 1.\n\nThen output the answer, the value of that UNSIGNED 32-BIT INTEGER variable.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">3 1 3 100</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 1 \nCase #2: 30 \nCase #3: 15662489\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nIn the second test case, there are six levels(1x1,1x2,1x3,2x2,2x3,3x3) Here is the details for this game: 1x1: 1(K=1); 1x2: 2(K=1); 1x3: 3(K=1); 2x2: 2(K=1), 4(K=2); 2x3: 6(K=1); 3x3: 3(K=1), 9(K=3); 1+2+3+2+4+6+3+9=30</div>\n_ _</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Author</div>\n<div class=\"panel_content\">UESTC</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 7 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%207&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Recommend</div>\n<div class=\"panel_content\">We have carefully selected several similar problems for you:  [4943](http://acm.hdu.edu.cn/showproblem.php?pid=4943) [4942](http://acm.hdu.edu.cn/showproblem.php?pid=4942) [4941](http://acm.hdu.edu.cn/showproblem.php?pid=4941) [4940](http://acm.hdu.edu.cn/showproblem.php?pid=4940) [4939](http://acm.hdu.edu.cn/showproblem.php?pid=4939)</div>\n<div class=\"panel_content\">N(LogN)的复杂度。</div>\n```C++\n#include&lt;cstdio&gt;\n#include&lt;cstring&gt;\nusing namespace std;\n#define N 500001\nunsigned int f[N];\nunsigned int g[N];\nint n;\nint main() {\n    int T;\n    for (int i = 1; i &lt; N; i++) {\n        for (int j = 1; i * j &lt; N; j++) {\n            g[i * j] += (1LL + j) * j / 2;\n        }\n    }\n    f[1] = 1;\n    for (int i = 2; i &lt; N; i++) {\n        f[i] = f[i - 1] + i * g[i];\n    }\n    scanf(\"%d\", &amp;T);\n    for (int c = 1; c &lt;= T; c++) {\n        scanf(\"%d\", &amp;n);\n        printf(\"Case #%d: %u\\n\", c, f[n]);\n    }\n}\n```\n","source":"_posts/hdu4944-fsfs-game.md","raw":"title: HDU4944 FSF’s game\ncategories:\n  - ACM\nid: 67\ndate: 2014-08-12 20:59:32\ntags: 数论\n---\n\n**<span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 9000/4500 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)\nTotal Submission(s): 166    Accepted Submission(s): 76\n</span>**\n<div class=\"panel_title\" align=\"left\">Problem Description</div>\n<div class=\"panel_content\">FSF has programmed a game.\nIn this game, players need to divide a rectangle into several same squares.\nThe length and width of rectangles are integer, and of course the side length of squares are integer.\n\nAfter division, players can get some coins.\nIf players successfully divide a AxB rectangle(length: A, width: B) into KxK squares(side length: K), they can get A*B/ gcd(A/K,B/K) gold coins.\nIn a level, you can’t get coins twice with same method.\n(For example, You can get 6 coins from 2x2(A=2,B=2) rectangle. When K=1, A*B/gcd(A/K,B/K)=2; When K=2, A*B/gcd(A/K,B/K)=4; 2+4=6; )\n<!--more-->\nThere are N*(N+1)/2 levels in this game, and every level is an unique rectangle. (1x1 , 2x1, 2x2, 3x1, ..., Nx(N-1), NxN)\n\nFSF has played this game for a long time, and he finally gets all the coins in the game.\nUnfortunately ,he uses an UNSIGNED 32-BIT INTEGER variable to count the number of coins.\nThis variable may overflow.\nWe want to know what the variable will be.\n(In other words, the number of coins mod 2^32)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Input</div>\n<div class=\"panel_content\">There are multiply test cases.\n\nThe first line contains an integer T(T&lt;=500000), the number of test cases\n\nEach of the next T lines contain an integer N(N&lt;=500000).</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Output</div>\n<div class=\"panel_content\">Output a single line for each test case.\n\nFor each test case, you should output \"Case #C: \". first, where C indicates the case number and counts from 1.\n\nThen output the answer, the value of that UNSIGNED 32-BIT INTEGER variable.</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Input</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">3 1 3 100</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Sample Output</div>\n<div class=\"panel_content\">\n<div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 1 \nCase #2: 30 \nCase #3: 15662489\n<div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\">\n<div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\">_Hint_</div>\nIn the second test case, there are six levels(1x1,1x2,1x3,2x2,2x3,3x3) Here is the details for this game: 1x1: 1(K=1); 1x2: 2(K=1); 1x3: 3(K=1); 2x2: 2(K=1), 4(K=2); 2x3: 6(K=1); 3x3: 3(K=1), 9(K=3); 1+2+3+2+4+6+3+9=30</div>\n_ _</div>\n</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Author</div>\n<div class=\"panel_content\">UESTC</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Source</div>\n<div class=\"panel_content\">[ 2014 Multi-University Training Contest 7 ](http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%207&amp;source=1&amp;searchmode=source)</div>\n<div class=\"panel_bottom\"></div>\n&nbsp;\n<div class=\"panel_title\" align=\"left\">Recommend</div>\n<div class=\"panel_content\">We have carefully selected several similar problems for you:  [4943](http://acm.hdu.edu.cn/showproblem.php?pid=4943) [4942](http://acm.hdu.edu.cn/showproblem.php?pid=4942) [4941](http://acm.hdu.edu.cn/showproblem.php?pid=4941) [4940](http://acm.hdu.edu.cn/showproblem.php?pid=4940) [4939](http://acm.hdu.edu.cn/showproblem.php?pid=4939)</div>\n<div class=\"panel_content\">N(LogN)的复杂度。</div>\n```C++\n#include&lt;cstdio&gt;\n#include&lt;cstring&gt;\nusing namespace std;\n#define N 500001\nunsigned int f[N];\nunsigned int g[N];\nint n;\nint main() {\n    int T;\n    for (int i = 1; i &lt; N; i++) {\n        for (int j = 1; i * j &lt; N; j++) {\n            g[i * j] += (1LL + j) * j / 2;\n        }\n    }\n    f[1] = 1;\n    for (int i = 2; i &lt; N; i++) {\n        f[i] = f[i - 1] + i * g[i];\n    }\n    scanf(\"%d\", &amp;T);\n    for (int c = 1; c &lt;= T; c++) {\n        scanf(\"%d\", &amp;n);\n        printf(\"Case #%d: %u\\n\", c, f[n]);\n    }\n}\n```\n","slug":"hdu4944-fsfs-game","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1i003f5rgxwnrdaper","content":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 9000/4500 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)<br>Total Submission(s): 166    Accepted Submission(s): 76<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">FSF has programmed a game.<br>In this game, players need to divide a rectangle into several same squares.<br>The length and width of rectangles are integer, and of course the side length of squares are integer.</div></p>\n<p>After division, players can get some coins.<br>If players successfully divide a AxB rectangle(length: A, width: B) into KxK squares(side length: K), they can get A<em>B/ gcd(A/K,B/K) gold coins.<br>In a level, you can’t get coins twice with same method.<br>(For example, You can get 6 coins from 2x2(A=2,B=2) rectangle. When K=1, A</em>B/gcd(A/K,B/K)=2; When K=2, A<em>B/gcd(A/K,B/K)=4; 2+4=6; )<br><a id=\"more\"></a><br>There are N</em>(N+1)/2 levels in this game, and every level is an unique rectangle. (1x1 , 2x1, 2x2, 3x1, …, Nx(N-1), NxN)</p>\n<p>FSF has played this game for a long time, and he finally gets all the coins in the game.<br>Unfortunately ,he uses an UNSIGNED 32-BIT INTEGER variable to count the number of coins.<br>This variable may overflow.<br>We want to know what the variable will be.<br>(In other words, the number of coins mod 2^32)</p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">There are multiply test cases.</div></p>\n<p>The first line contains an integer T(T&lt;=500000), the number of test cases</p>\n<p>Each of the next T lines contain an integer N(N&lt;=500000).</p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">Output a single line for each test case.</div></p>\n<p>For each test case, you should output “Case #C: “. first, where C indicates the case number and counts from 1.</p>\n<p>Then output the answer, the value of that UNSIGNED 32-BIT INTEGER variable.</p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">3 1 3 100</div><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></div></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 1<br>Case #2: 30<br>Case #3: 15662489</div></p>\n<p><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"></div></p>\n<p><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>In the second test case, there are six levels(1x1,1x2,1x3,2x2,2x3,3x3) Here is the details for this game: 1x1: 1(K=1); 1x2: 2(K=1); 1x3: 3(K=1); 2x2: 2(K=1), 4(K=2); 2x3: 6(K=1); 3x3: 3(K=1), 9(K=3); 1+2+3+2+4+6+3+9=30<br><em> </em><br></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Author</div></p>\n<p><div class=\"panel_content\">UESTC</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%207&amp;source=1&amp;searchmode=source\" target=\"_blank\" rel=\"external\"> 2014 Multi-University Training Contest 7 </a></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Recommend</div></p>\n<p><div class=\"panel_content\">We have carefully selected several similar problems for you:  <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4943\" target=\"_blank\" rel=\"external\">4943</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4942\" target=\"_blank\" rel=\"external\">4942</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4941\" target=\"_blank\" rel=\"external\">4941</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4940\" target=\"_blank\" rel=\"external\">4940</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4939\" target=\"_blank\" rel=\"external\">4939</a></div></p>\n<p><div class=\"panel_content\">N(LogN)的复杂度。</div><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 500001</span></div><div class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> f[N];</div><div class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> g[N];</div><div class=\"line\"><span class=\"keyword\">int</span> n;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> T;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; N; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; i * j &amp;lt; N; j++) &#123;</div><div class=\"line\">            g[i * j] += (<span class=\"number\">1L</span>L + j) * j / <span class=\"number\">2</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    f[<span class=\"number\">1</span>] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &amp;lt; N; i++) &#123;</div><div class=\"line\">        f[i] = f[i - <span class=\"number\">1</span>] + i * g[i];</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;T);</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> c = <span class=\"number\">1</span>; c &amp;lt;= T; c++) &#123;</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;n);</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"Case #%d: %u\\n\"</span>, c, f[n]);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p><strong><span style=\"font-family: Arial; font-size: 12px; font-weight: bold; color: green;\">Time Limit: 9000/4500 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)<br>Total Submission(s): 166    Accepted Submission(s): 76<br></span></strong></p>\n<p><div class=\"panel_title\" align=\"left\">Problem Description</div></p>\n<p><div class=\"panel_content\">FSF has programmed a game.<br>In this game, players need to divide a rectangle into several same squares.<br>The length and width of rectangles are integer, and of course the side length of squares are integer.</p>\n<p>After division, players can get some coins.<br>If players successfully divide a AxB rectangle(length: A, width: B) into KxK squares(side length: K), they can get A<em>B/ gcd(A/K,B/K) gold coins.<br>In a level, you can’t get coins twice with same method.<br>(For example, You can get 6 coins from 2x2(A=2,B=2) rectangle. When K=1, A</em>B/gcd(A/K,B/K)=2; When K=2, A<em>B/gcd(A/K,B/K)=4; 2+4=6; )<br>","more":"<br>There are N</em>(N+1)/2 levels in this game, and every level is an unique rectangle. (1x1 , 2x1, 2x2, 3x1, …, Nx(N-1), NxN)</p>\n<p>FSF has played this game for a long time, and he finally gets all the coins in the game.<br>Unfortunately ,he uses an UNSIGNED 32-BIT INTEGER variable to count the number of coins.<br>This variable may overflow.<br>We want to know what the variable will be.<br>(In other words, the number of coins mod 2^32)</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Input</div></p>\n<p><div class=\"panel_content\">There are multiply test cases.</p>\n<p>The first line contains an integer T(T&lt;=500000), the number of test cases</p>\n<p>Each of the next T lines contain an integer N(N&lt;=500000).</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Output</div></p>\n<p><div class=\"panel_content\">Output a single line for each test case.</p>\n<p>For each test case, you should output “Case #C: “. first, where C indicates the case number and counts from 1.</p>\n<p>Then output the answer, the value of that UNSIGNED 32-BIT INTEGER variable.</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Input</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">3 1 3 100</div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Sample Output</div></p>\n<p><div class=\"panel_content\"></p>\n<p><div style=\"font-family: Courier New,Courier,monospace;\">Case #1: 1<br>Case #2: 30<br>Case #3: 15662489</p>\n<p><div style=\"font-family: Times New Roman; font-size: 14px; background-color: f4fbff; border: #B7CBFF 1px dashed; padding: 6px;\"></p>\n<p><div style=\"font-family: Arial; font-weight: bold; color: #7ca9ed; border-bottom: #B7CBFF 1px dashed;\"><em>Hint</em></div><br>In the second test case, there are six levels(1x1,1x2,1x3,2x2,2x3,3x3) Here is the details for this game: 1x1: 1(K=1); 1x2: 2(K=1); 1x3: 3(K=1); 2x2: 2(K=1), 4(K=2); 2x3: 6(K=1); 3x3: 3(K=1), 9(K=3); 1+2+3+2+4+6+3+9=30</div><br><em> </em></div><br></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Author</div></p>\n<p><div class=\"panel_content\">UESTC</div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Source</div></p>\n<p><div class=\"panel_content\"><a href=\"http://acm.hdu.edu.cn/search.php?field=problem&amp;key=2014%20Multi-University%20Training%20Contest%207&amp;source=1&amp;searchmode=source\"> 2014 Multi-University Training Contest 7 </a></div></p>\n<p><div class=\"panel_bottom\"></div><br>&nbsp;</p>\n<p><div class=\"panel_title\" align=\"left\">Recommend</div></p>\n<p><div class=\"panel_content\">We have carefully selected several similar problems for you:  <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4943\">4943</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4942\">4942</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4941\">4941</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4940\">4940</a> <a href=\"http://acm.hdu.edu.cn/showproblem.php?pid=4939\">4939</a></div></p>\n<p><div class=\"panel_content\">N(LogN)的复杂度。</div><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 500001</span></div><div class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> f[N];</div><div class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> g[N];</div><div class=\"line\"><span class=\"keyword\">int</span> n;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> T;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; N; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; i * j &amp;lt; N; j++) &#123;</div><div class=\"line\">            g[i * j] += (<span class=\"number\">1L</span>L + j) * j / <span class=\"number\">2</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    f[<span class=\"number\">1</span>] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &amp;lt; N; i++) &#123;</div><div class=\"line\">        f[i] = f[i - <span class=\"number\">1</span>] + i * g[i];</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;T);</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> c = <span class=\"number\">1</span>; c &amp;lt;= T; c++) &#123;</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;n);</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"Case #%d: %u\\n\"</span>, c, f[n]);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"（转）关于卷积的一个血腥的讲解，看完给跪了","date":"2014-11-05T12:40:10.000Z","_content":"\n比如说你的老板命令你干活，你却到楼下打台球去了，后来被老板发现，他非常气愤，扇了你一巴掌（注意，这就是输入信号，脉冲），于是你的脸上会渐渐地（贱贱地）鼓起来一个包，你的脸就是一个系统，而鼓起来的包就是你的脸对巴掌的响应，好，这样就和信号系统建立起来意义对应的联系。下面还需要一些假设来保证论证的严谨：假定你的脸是线性时不变系统，也就是说，无论什么时候老板打你一巴掌，打在你脸的同一位置（这似乎要求你的脸足够光滑，如果你说你长了很多青春痘，甚至整个脸皮处处连续处处不可导，那难度太大了，我就无话可说了哈哈），你的脸上总是会在相同的时间间隔内鼓起来一个相同高度的包来，并且假定以鼓起来的包的大小作为系统输出。好了，那么，下面可以进入核心内容——卷积了！\n<!--more-->\n如果你每天都到地下去打台球，那么老板每天都要扇你一巴掌，不过当老板打你一巴掌后，你5分钟就消肿了，所以时间长了，你甚至就适应这种生活了……如果有一天，老板忍无可忍，以0.5秒的间隔开始不间断的扇你的过程，这样问题就来了，第一次扇你鼓起来的包还没消肿，第二个巴掌就来了，你脸上的包就可能鼓起来两倍高，老板不断扇你，脉冲不断作用在你脸上，效果不断叠加了，这样这些效果就可以求和了，结果就是你脸上的包的高度随时间变化的一个函数了（注意理解）；如果老板再狠一点，频率越来越高，以至于你都辨别不清时间间隔了，那么，求和就变成积分了。可以这样理解，在这个过程中的某一固定的时刻，你的脸上的包的鼓起程度和什么有关呢？和之前每次打你都有关！但是各次的贡献是不一样的，越早打的巴掌，贡献越小，所以这就是说，某一时刻的输出是之前很多次输入乘以各自的衰减系数之后的叠加而形成某一点的输出，然后再把不同时刻的输出点放在一起，形成一个函数，这就是卷积，卷积之后的函数就是你脸上的包的大小随时间变化的函数。本来你的包几分钟就可以消肿，可是如果连续打，几个小时也消不了肿了，这难道不是一种平滑过程么？反映到剑桥大学的公式上，f(a)就是第a个巴掌，g(x-a)就是第a个巴掌在x时刻的作用程度，乘起来再叠加就ok了，大家说是不是这个道理呢？我想这个例子已经非常形象了，你对卷积有了更加具体深刻的了解了吗？\n\n转自GSDzone论坛\n\n![](http://2.im.guokr.com/V5QXaMJ7D6dpiGXPGmBsKoRQe9QYz0KIMf1yyJp_D7_PAAAAnAAAAEdJ.gif)","source":"_posts/intro-of-fft.md","raw":"title: （转）关于卷积的一个血腥的讲解，看完给跪了\ncategories:\n  - ACM\ndate: 2014-11-05 20:40:10\ntags: [数论,只言片语]\n---\n\n比如说你的老板命令你干活，你却到楼下打台球去了，后来被老板发现，他非常气愤，扇了你一巴掌（注意，这就是输入信号，脉冲），于是你的脸上会渐渐地（贱贱地）鼓起来一个包，你的脸就是一个系统，而鼓起来的包就是你的脸对巴掌的响应，好，这样就和信号系统建立起来意义对应的联系。下面还需要一些假设来保证论证的严谨：假定你的脸是线性时不变系统，也就是说，无论什么时候老板打你一巴掌，打在你脸的同一位置（这似乎要求你的脸足够光滑，如果你说你长了很多青春痘，甚至整个脸皮处处连续处处不可导，那难度太大了，我就无话可说了哈哈），你的脸上总是会在相同的时间间隔内鼓起来一个相同高度的包来，并且假定以鼓起来的包的大小作为系统输出。好了，那么，下面可以进入核心内容——卷积了！\n<!--more-->\n如果你每天都到地下去打台球，那么老板每天都要扇你一巴掌，不过当老板打你一巴掌后，你5分钟就消肿了，所以时间长了，你甚至就适应这种生活了……如果有一天，老板忍无可忍，以0.5秒的间隔开始不间断的扇你的过程，这样问题就来了，第一次扇你鼓起来的包还没消肿，第二个巴掌就来了，你脸上的包就可能鼓起来两倍高，老板不断扇你，脉冲不断作用在你脸上，效果不断叠加了，这样这些效果就可以求和了，结果就是你脸上的包的高度随时间变化的一个函数了（注意理解）；如果老板再狠一点，频率越来越高，以至于你都辨别不清时间间隔了，那么，求和就变成积分了。可以这样理解，在这个过程中的某一固定的时刻，你的脸上的包的鼓起程度和什么有关呢？和之前每次打你都有关！但是各次的贡献是不一样的，越早打的巴掌，贡献越小，所以这就是说，某一时刻的输出是之前很多次输入乘以各自的衰减系数之后的叠加而形成某一点的输出，然后再把不同时刻的输出点放在一起，形成一个函数，这就是卷积，卷积之后的函数就是你脸上的包的大小随时间变化的函数。本来你的包几分钟就可以消肿，可是如果连续打，几个小时也消不了肿了，这难道不是一种平滑过程么？反映到剑桥大学的公式上，f(a)就是第a个巴掌，g(x-a)就是第a个巴掌在x时刻的作用程度，乘起来再叠加就ok了，大家说是不是这个道理呢？我想这个例子已经非常形象了，你对卷积有了更加具体深刻的了解了吗？\n\n转自GSDzone论坛\n\n![](http://2.im.guokr.com/V5QXaMJ7D6dpiGXPGmBsKoRQe9QYz0KIMf1yyJp_D7_PAAAAnAAAAEdJ.gif)","slug":"intro-of-fft","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1k003i5rgxrvzlzvpx","content":"<p>比如说你的老板命令你干活，你却到楼下打台球去了，后来被老板发现，他非常气愤，扇了你一巴掌（注意，这就是输入信号，脉冲），于是你的脸上会渐渐地（贱贱地）鼓起来一个包，你的脸就是一个系统，而鼓起来的包就是你的脸对巴掌的响应，好，这样就和信号系统建立起来意义对应的联系。下面还需要一些假设来保证论证的严谨：假定你的脸是线性时不变系统，也就是说，无论什么时候老板打你一巴掌，打在你脸的同一位置（这似乎要求你的脸足够光滑，如果你说你长了很多青春痘，甚至整个脸皮处处连续处处不可导，那难度太大了，我就无话可说了哈哈），你的脸上总是会在相同的时间间隔内鼓起来一个相同高度的包来，并且假定以鼓起来的包的大小作为系统输出。好了，那么，下面可以进入核心内容——卷积了！<br><a id=\"more\"></a><br>如果你每天都到地下去打台球，那么老板每天都要扇你一巴掌，不过当老板打你一巴掌后，你5分钟就消肿了，所以时间长了，你甚至就适应这种生活了……如果有一天，老板忍无可忍，以0.5秒的间隔开始不间断的扇你的过程，这样问题就来了，第一次扇你鼓起来的包还没消肿，第二个巴掌就来了，你脸上的包就可能鼓起来两倍高，老板不断扇你，脉冲不断作用在你脸上，效果不断叠加了，这样这些效果就可以求和了，结果就是你脸上的包的高度随时间变化的一个函数了（注意理解）；如果老板再狠一点，频率越来越高，以至于你都辨别不清时间间隔了，那么，求和就变成积分了。可以这样理解，在这个过程中的某一固定的时刻，你的脸上的包的鼓起程度和什么有关呢？和之前每次打你都有关！但是各次的贡献是不一样的，越早打的巴掌，贡献越小，所以这就是说，某一时刻的输出是之前很多次输入乘以各自的衰减系数之后的叠加而形成某一点的输出，然后再把不同时刻的输出点放在一起，形成一个函数，这就是卷积，卷积之后的函数就是你脸上的包的大小随时间变化的函数。本来你的包几分钟就可以消肿，可是如果连续打，几个小时也消不了肿了，这难道不是一种平滑过程么？反映到剑桥大学的公式上，f(a)就是第a个巴掌，g(x-a)就是第a个巴掌在x时刻的作用程度，乘起来再叠加就ok了，大家说是不是这个道理呢？我想这个例子已经非常形象了，你对卷积有了更加具体深刻的了解了吗？</p>\n<p>转自GSDzone论坛</p>\n<p><img src=\"http://2.im.guokr.com/V5QXaMJ7D6dpiGXPGmBsKoRQe9QYz0KIMf1yyJp_D7_PAAAAnAAAAEdJ.gif\" alt=\"\"></p>\n","excerpt":"<p>比如说你的老板命令你干活，你却到楼下打台球去了，后来被老板发现，他非常气愤，扇了你一巴掌（注意，这就是输入信号，脉冲），于是你的脸上会渐渐地（贱贱地）鼓起来一个包，你的脸就是一个系统，而鼓起来的包就是你的脸对巴掌的响应，好，这样就和信号系统建立起来意义对应的联系。下面还需要一些假设来保证论证的严谨：假定你的脸是线性时不变系统，也就是说，无论什么时候老板打你一巴掌，打在你脸的同一位置（这似乎要求你的脸足够光滑，如果你说你长了很多青春痘，甚至整个脸皮处处连续处处不可导，那难度太大了，我就无话可说了哈哈），你的脸上总是会在相同的时间间隔内鼓起来一个相同高度的包来，并且假定以鼓起来的包的大小作为系统输出。好了，那么，下面可以进入核心内容——卷积了！<br>","more":"<br>如果你每天都到地下去打台球，那么老板每天都要扇你一巴掌，不过当老板打你一巴掌后，你5分钟就消肿了，所以时间长了，你甚至就适应这种生活了……如果有一天，老板忍无可忍，以0.5秒的间隔开始不间断的扇你的过程，这样问题就来了，第一次扇你鼓起来的包还没消肿，第二个巴掌就来了，你脸上的包就可能鼓起来两倍高，老板不断扇你，脉冲不断作用在你脸上，效果不断叠加了，这样这些效果就可以求和了，结果就是你脸上的包的高度随时间变化的一个函数了（注意理解）；如果老板再狠一点，频率越来越高，以至于你都辨别不清时间间隔了，那么，求和就变成积分了。可以这样理解，在这个过程中的某一固定的时刻，你的脸上的包的鼓起程度和什么有关呢？和之前每次打你都有关！但是各次的贡献是不一样的，越早打的巴掌，贡献越小，所以这就是说，某一时刻的输出是之前很多次输入乘以各自的衰减系数之后的叠加而形成某一点的输出，然后再把不同时刻的输出点放在一起，形成一个函数，这就是卷积，卷积之后的函数就是你脸上的包的大小随时间变化的函数。本来你的包几分钟就可以消肿，可是如果连续打，几个小时也消不了肿了，这难道不是一种平滑过程么？反映到剑桥大学的公式上，f(a)就是第a个巴掌，g(x-a)就是第a个巴掌在x时刻的作用程度，乘起来再叠加就ok了，大家说是不是这个道理呢？我想这个例子已经非常形象了，你对卷积有了更加具体深刻的了解了吗？</p>\n<p>转自GSDzone论坛</p>\n<p><img src=\"http://2.im.guokr.com/V5QXaMJ7D6dpiGXPGmBsKoRQe9QYz0KIMf1yyJp_D7_PAAAAnAAAAEdJ.gif\" alt=\"\"></p>"},{"title":"Hexo折腾笔记（一）博客加速以及instantclick的兼容","date":"2015-02-25T12:18:23.000Z","toc":true,"_content":"\n~~首先，Gitcafe的国内速度已经够快了，加不加速其实没多大区别,只不过是闲的蛋疼而已。~~\nGitcafe无故page不更新，所以又换回了github。\n\n## Hexo加速\nHexo加速可以有以下几个方面：\n1. 使用[BootCDN](http://www.bootcdn.cn/)并将图片等资源储存至七牛云。可以使用此项目[click here](https://github.com/gyk001/hexo-qiniu-sync)。\n2. 使用[hexo optimize](https://github.com/FlashSoft/hexo-console-optimize)压缩优化HTML、CSS、JS、Image资源。\n3. 使用[InstantClick](http://instantclick.io/)。\n\nInstantClick是一款类似于[Turbolinks](http://instantclick.io/)的js库，利用[pjax](https://github.com/defunkt/jquery-pjax)（pushState and Ajax)技术对网站进行优化，能够极大的提高访问速度。\n<!--more-->\n## 解决InstantClick的兼容问题\nInstantClick效果明显，但是副作用也大。加入它之后，原来相处无碍的Fancybox、百度分享、百度统计、 mathJax、多说评论都挂了。下面是我的解决方法：\n###Fancybox\nFancybox的修复首先要避面页面切换时jquery.fancybox.min.js文件的重复加载。可以将该js文件的引用放入head中或者加入data-no-instant属性。\n然后，因为instantclick在预加载时默认只替换body元素，所以在绑定fancybox的时候需要设置parent属性为body：\n```Javascript\n(function($){\n    $('.fancybox').fancybox({parent:'body'});\n})(jQuery);\n```\n这样就应该可以了。\n###多说评论（以及最新评论、热评文章等）\n首先，多说的公共JS是不能放在加入data-no-instant属性的。因为不是网站所有页面都包含评论部分的。\n因此，我们需要将其裹入一层判断中来阻止其多次加载，提高网页的访问速度：\n```Html\n<!-- 多说公共JS代码 start (一个网页只需插入一次) -->\n<script type=\"text/javascript\">\nif(typeof duoshuoQuery === 'undefined'){\n    var duoshuoQuery = {short_name:\"你的域名\"};\n    (function() {\n        var ds = document.createElement('script');\n        ds.type = 'text/javascript';ds.async = true;\n        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';\n        ds.charset = 'UTF-8';\n        (document.getElementsByTagName('head')[0]\n         || document.getElementsByTagName('body')[0]).appendChild(ds);\n    })();\n}\n</script>\n<!-- 多说公共JS代码 end -->\n```\n然后，我们需要在页面预加载的change事件里对其进行重载：\n```Html\n<script data-no-instant>\nInstantClick.on('change', function(isInitialLoad) {\n  if (isInitialLoad === false) {\n  \tif($(\".ds-thread\").length && typeof DUOSHUO !== 'undefined'){ //support 多说评论框\n  \t\tDUOSHUO.EmbedThread($('.ds-thread')[0]);\n  \t}\n  }\n});\nInstantClick.init();\n</script>\n```\n可以用同样的方式解决多说的热门文章、最新评论等插件的问题。DUOSHUO全部的重载函数有：`\"EmbedThread\", \"RecentComments\", \"RecentVisitors\", \"TopUsers\", \"TopThreads\", \"LoginWidget\", \"ThreadCount\"`\n\n###百度统计、google统计、MathJax\n这三个可以参考这篇文章：[click here](http://zhiqiang.org/blog/it/instantclick-support-mathjax-baidu-stat.html)。同样是在change事件里对他们进行重新加载。\n```Javascript\nInstantClick.on('change', function(isInitialLoad) {\n  if (isInitialLoad === false) {\n    if (typeof MathJax !== 'undefined') // support MathJax\n      MathJax.Hub.Queue([\"Typeset\",MathJax.Hub]);\n    if (typeof prettyPrint !== 'undefined') // support google code prettify\n      prettyPrint();\n    if (typeof _hmt !== 'undefined')  // support 百度统计\n      _hmt.push(['_trackPageview', location.pathname + location.search]);\n    if (typeof ga !== 'undefined')  // support google analytics\n        ga('send', 'pageview', location.pathname + location.search);\n  }\n});\n```\n\n###百度分享\n百度分享可以用[jiathis](http://www.jiathis.com/)代替，其实国内的分享工具都差不多。\n\n##关于data-no-instant属性\ndata-no-instant属性是用来避免instantclick在页面切换时对该元素重复加载。可以用在script、style标签中，也能放在a标签中，表示该链接将使用正常方式打开而不用instantclick加速。\n\ndata-no-intant无法阻止对div等元素的重新加载，因此无法实现像网易云音乐那样在切换页面的时候无间断的播放音乐等功能。不过曾有人contribute过类似的功能，但是作者没有接受：[click here](https://github.com/dieulot/instantclick/pull/108)。\n\n\n<br/>\n至此全部问题解决了，其他的问题可以参考下面几个链接：\n- [整合 InstantClick 與 AddThis](http://shinychang.net/article/544b6c3578cf49f90fc204d7)\n- [Hexo 静态博客加速](http://lukang.me/2014/hexo-page-speed.html)\n- [fancybox文档](http://fancyapps.com/fancybox/#docs)\n- [InstantClick文档](http://instantclick.io/documentation)\n","source":"_posts/hexo-speedup-instantclick.md","raw":"title: Hexo折腾笔记（一）博客加速以及instantclick的兼容\ndate: 2015-02-25 20:18:23\ntags: [html,instantclick]\ncategories: Hexo\ntoc: true\n---\n\n~~首先，Gitcafe的国内速度已经够快了，加不加速其实没多大区别,只不过是闲的蛋疼而已。~~\nGitcafe无故page不更新，所以又换回了github。\n\n## Hexo加速\nHexo加速可以有以下几个方面：\n1. 使用[BootCDN](http://www.bootcdn.cn/)并将图片等资源储存至七牛云。可以使用此项目[click here](https://github.com/gyk001/hexo-qiniu-sync)。\n2. 使用[hexo optimize](https://github.com/FlashSoft/hexo-console-optimize)压缩优化HTML、CSS、JS、Image资源。\n3. 使用[InstantClick](http://instantclick.io/)。\n\nInstantClick是一款类似于[Turbolinks](http://instantclick.io/)的js库，利用[pjax](https://github.com/defunkt/jquery-pjax)（pushState and Ajax)技术对网站进行优化，能够极大的提高访问速度。\n<!--more-->\n## 解决InstantClick的兼容问题\nInstantClick效果明显，但是副作用也大。加入它之后，原来相处无碍的Fancybox、百度分享、百度统计、 mathJax、多说评论都挂了。下面是我的解决方法：\n###Fancybox\nFancybox的修复首先要避面页面切换时jquery.fancybox.min.js文件的重复加载。可以将该js文件的引用放入head中或者加入data-no-instant属性。\n然后，因为instantclick在预加载时默认只替换body元素，所以在绑定fancybox的时候需要设置parent属性为body：\n```Javascript\n(function($){\n    $('.fancybox').fancybox({parent:'body'});\n})(jQuery);\n```\n这样就应该可以了。\n###多说评论（以及最新评论、热评文章等）\n首先，多说的公共JS是不能放在加入data-no-instant属性的。因为不是网站所有页面都包含评论部分的。\n因此，我们需要将其裹入一层判断中来阻止其多次加载，提高网页的访问速度：\n```Html\n<!-- 多说公共JS代码 start (一个网页只需插入一次) -->\n<script type=\"text/javascript\">\nif(typeof duoshuoQuery === 'undefined'){\n    var duoshuoQuery = {short_name:\"你的域名\"};\n    (function() {\n        var ds = document.createElement('script');\n        ds.type = 'text/javascript';ds.async = true;\n        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';\n        ds.charset = 'UTF-8';\n        (document.getElementsByTagName('head')[0]\n         || document.getElementsByTagName('body')[0]).appendChild(ds);\n    })();\n}\n</script>\n<!-- 多说公共JS代码 end -->\n```\n然后，我们需要在页面预加载的change事件里对其进行重载：\n```Html\n<script data-no-instant>\nInstantClick.on('change', function(isInitialLoad) {\n  if (isInitialLoad === false) {\n  \tif($(\".ds-thread\").length && typeof DUOSHUO !== 'undefined'){ //support 多说评论框\n  \t\tDUOSHUO.EmbedThread($('.ds-thread')[0]);\n  \t}\n  }\n});\nInstantClick.init();\n</script>\n```\n可以用同样的方式解决多说的热门文章、最新评论等插件的问题。DUOSHUO全部的重载函数有：`\"EmbedThread\", \"RecentComments\", \"RecentVisitors\", \"TopUsers\", \"TopThreads\", \"LoginWidget\", \"ThreadCount\"`\n\n###百度统计、google统计、MathJax\n这三个可以参考这篇文章：[click here](http://zhiqiang.org/blog/it/instantclick-support-mathjax-baidu-stat.html)。同样是在change事件里对他们进行重新加载。\n```Javascript\nInstantClick.on('change', function(isInitialLoad) {\n  if (isInitialLoad === false) {\n    if (typeof MathJax !== 'undefined') // support MathJax\n      MathJax.Hub.Queue([\"Typeset\",MathJax.Hub]);\n    if (typeof prettyPrint !== 'undefined') // support google code prettify\n      prettyPrint();\n    if (typeof _hmt !== 'undefined')  // support 百度统计\n      _hmt.push(['_trackPageview', location.pathname + location.search]);\n    if (typeof ga !== 'undefined')  // support google analytics\n        ga('send', 'pageview', location.pathname + location.search);\n  }\n});\n```\n\n###百度分享\n百度分享可以用[jiathis](http://www.jiathis.com/)代替，其实国内的分享工具都差不多。\n\n##关于data-no-instant属性\ndata-no-instant属性是用来避免instantclick在页面切换时对该元素重复加载。可以用在script、style标签中，也能放在a标签中，表示该链接将使用正常方式打开而不用instantclick加速。\n\ndata-no-intant无法阻止对div等元素的重新加载，因此无法实现像网易云音乐那样在切换页面的时候无间断的播放音乐等功能。不过曾有人contribute过类似的功能，但是作者没有接受：[click here](https://github.com/dieulot/instantclick/pull/108)。\n\n\n<br/>\n至此全部问题解决了，其他的问题可以参考下面几个链接：\n- [整合 InstantClick 與 AddThis](http://shinychang.net/article/544b6c3578cf49f90fc204d7)\n- [Hexo 静态博客加速](http://lukang.me/2014/hexo-page-speed.html)\n- [fancybox文档](http://fancyapps.com/fancybox/#docs)\n- [InstantClick文档](http://instantclick.io/documentation)\n","slug":"hexo-speedup-instantclick","published":1,"updated":"2017-01-16T06:56:58.742Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1n003l5rgxakgqajcx","content":"<p><del>首先，Gitcafe的国内速度已经够快了，加不加速其实没多大区别,只不过是闲的蛋疼而已。</del><br>Gitcafe无故page不更新，所以又换回了github。</p>\n<h2 id=\"Hexo加速\"><a href=\"#Hexo加速\" class=\"headerlink\" title=\"Hexo加速\"></a>Hexo加速</h2><p>Hexo加速可以有以下几个方面：</p>\n<ol>\n<li>使用<a href=\"http://www.bootcdn.cn/\" target=\"_blank\" rel=\"external\">BootCDN</a>并将图片等资源储存至七牛云。可以使用此项目<a href=\"https://github.com/gyk001/hexo-qiniu-sync\" target=\"_blank\" rel=\"external\">click here</a>。</li>\n<li>使用<a href=\"https://github.com/FlashSoft/hexo-console-optimize\" target=\"_blank\" rel=\"external\">hexo optimize</a>压缩优化HTML、CSS、JS、Image资源。</li>\n<li>使用<a href=\"http://instantclick.io/\" target=\"_blank\" rel=\"external\">InstantClick</a>。</li>\n</ol>\n<p>InstantClick是一款类似于<a href=\"http://instantclick.io/\" target=\"_blank\" rel=\"external\">Turbolinks</a>的js库，利用<a href=\"https://github.com/defunkt/jquery-pjax\" target=\"_blank\" rel=\"external\">pjax</a>（pushState and Ajax)技术对网站进行优化，能够极大的提高访问速度。<br><a id=\"more\"></a></p>\n<h2 id=\"解决InstantClick的兼容问题\"><a href=\"#解决InstantClick的兼容问题\" class=\"headerlink\" title=\"解决InstantClick的兼容问题\"></a>解决InstantClick的兼容问题</h2><p>InstantClick效果明显，但是副作用也大。加入它之后，原来相处无碍的Fancybox、百度分享、百度统计、 mathJax、多说评论都挂了。下面是我的解决方法：</p>\n<p>###Fancybox<br>Fancybox的修复首先要避面页面切换时jquery.fancybox.min.js文件的重复加载。可以将该js文件的引用放入head中或者加入data-no-instant属性。<br>然后，因为instantclick在预加载时默认只替换body元素，所以在绑定fancybox的时候需要设置parent属性为body：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</div><div class=\"line\">    $(<span class=\"string\">'.fancybox'</span>).fancybox(&#123;<span class=\"attr\">parent</span>:<span class=\"string\">'body'</span>&#125;);</div><div class=\"line\">&#125;)(jQuery);</div></pre></td></tr></table></figure></p>\n<p>这样就应该可以了。</p>\n<p>###多说评论（以及最新评论、热评文章等）<br>首先，多说的公共JS是不能放在加入data-no-instant属性的。因为不是网站所有页面都包含评论部分的。<br>因此，我们需要将其裹入一层判断中来阻止其多次加载，提高网页的访问速度：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> duoshuoQuery === <span class=\"string\">'undefined'</span>)&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> duoshuoQuery = &#123;<span class=\"attr\">short_name</span>:<span class=\"string\">\"你的域名\"</span>&#125;;</div><div class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> ds = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'script'</span>);</div><div class=\"line\">        ds.type = <span class=\"string\">'text/javascript'</span>;ds.async = <span class=\"literal\">true</span>;</div><div class=\"line\">        ds.src = (<span class=\"built_in\">document</span>.location.protocol == <span class=\"string\">'https:'</span> ? <span class=\"string\">'https:'</span> : <span class=\"string\">'http:'</span>) + <span class=\"string\">'//static.duoshuo.com/embed.unstable.js'</span>;</div><div class=\"line\">        ds.charset = <span class=\"string\">'UTF-8'</span>;</div><div class=\"line\">        (<span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'head'</span>)[<span class=\"number\">0</span>]</div><div class=\"line\">         || <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'body'</span>)[<span class=\"number\">0</span>]).appendChild(ds);</div><div class=\"line\">    &#125;)();</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 多说公共JS代码 end --&gt;</span></div></pre></td></tr></table></figure></p>\n<p>然后，我们需要在页面预加载的change事件里对其进行重载：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">data-no-instant</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">InstantClick.on(<span class=\"string\">'change'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">isInitialLoad</span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span> (isInitialLoad === <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">  \t<span class=\"keyword\">if</span>($(<span class=\"string\">\".ds-thread\"</span>).length &amp;&amp; <span class=\"keyword\">typeof</span> DUOSHUO !== <span class=\"string\">'undefined'</span>)&#123; <span class=\"comment\">//support 多说评论框</span></div><div class=\"line\">  \t\tDUOSHUO.EmbedThread($(<span class=\"string\">'.ds-thread'</span>)[<span class=\"number\">0</span>]);</div><div class=\"line\">  \t&#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;);</div><div class=\"line\">InstantClick.init();</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>可以用同样的方式解决多说的热门文章、最新评论等插件的问题。DUOSHUO全部的重载函数有：<code>&quot;EmbedThread&quot;, &quot;RecentComments&quot;, &quot;RecentVisitors&quot;, &quot;TopUsers&quot;, &quot;TopThreads&quot;, &quot;LoginWidget&quot;, &quot;ThreadCount&quot;</code></p>\n<p>###百度统计、google统计、MathJax<br>这三个可以参考这篇文章：<a href=\"http://zhiqiang.org/blog/it/instantclick-support-mathjax-baidu-stat.html\" target=\"_blank\" rel=\"external\">click here</a>。同样是在change事件里对他们进行重新加载。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">InstantClick.on(<span class=\"string\">'change'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">isInitialLoad</span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span> (isInitialLoad === <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> MathJax !== <span class=\"string\">'undefined'</span>) <span class=\"comment\">// support MathJax</span></div><div class=\"line\">      MathJax.Hub.Queue([<span class=\"string\">\"Typeset\"</span>,MathJax.Hub]);</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> prettyPrint !== <span class=\"string\">'undefined'</span>) <span class=\"comment\">// support google code prettify</span></div><div class=\"line\">      prettyPrint();</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> _hmt !== <span class=\"string\">'undefined'</span>)  <span class=\"comment\">// support 百度统计</span></div><div class=\"line\">      _hmt.push([<span class=\"string\">'_trackPageview'</span>, location.pathname + location.search]);</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> ga !== <span class=\"string\">'undefined'</span>)  <span class=\"comment\">// support google analytics</span></div><div class=\"line\">        ga(<span class=\"string\">'send'</span>, <span class=\"string\">'pageview'</span>, location.pathname + location.search);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<p>###百度分享<br>百度分享可以用<a href=\"http://www.jiathis.com/\" target=\"_blank\" rel=\"external\">jiathis</a>代替，其实国内的分享工具都差不多。</p>\n<p>##关于data-no-instant属性<br>data-no-instant属性是用来避免instantclick在页面切换时对该元素重复加载。可以用在script、style标签中，也能放在a标签中，表示该链接将使用正常方式打开而不用instantclick加速。</p>\n<p>data-no-intant无法阻止对div等元素的重新加载，因此无法实现像网易云音乐那样在切换页面的时候无间断的播放音乐等功能。不过曾有人contribute过类似的功能，但是作者没有接受：<a href=\"https://github.com/dieulot/instantclick/pull/108\" target=\"_blank\" rel=\"external\">click here</a>。</p>\n<p><br><br>至此全部问题解决了，其他的问题可以参考下面几个链接：</p>\n<ul>\n<li><a href=\"http://shinychang.net/article/544b6c3578cf49f90fc204d7\" target=\"_blank\" rel=\"external\">整合 InstantClick 與 AddThis</a></li>\n<li><a href=\"http://lukang.me/2014/hexo-page-speed.html\" target=\"_blank\" rel=\"external\">Hexo 静态博客加速</a></li>\n<li><a href=\"http://fancyapps.com/fancybox/#docs\" target=\"_blank\" rel=\"external\">fancybox文档</a></li>\n<li><a href=\"http://instantclick.io/documentation\" target=\"_blank\" rel=\"external\">InstantClick文档</a></li>\n</ul>\n","excerpt":"<p><del>首先，Gitcafe的国内速度已经够快了，加不加速其实没多大区别,只不过是闲的蛋疼而已。</del><br>Gitcafe无故page不更新，所以又换回了github。</p>\n<h2 id=\"Hexo加速\"><a href=\"#Hexo加速\" class=\"headerlink\" title=\"Hexo加速\"></a>Hexo加速</h2><p>Hexo加速可以有以下几个方面：</p>\n<ol>\n<li>使用<a href=\"http://www.bootcdn.cn/\">BootCDN</a>并将图片等资源储存至七牛云。可以使用此项目<a href=\"https://github.com/gyk001/hexo-qiniu-sync\">click here</a>。</li>\n<li>使用<a href=\"https://github.com/FlashSoft/hexo-console-optimize\">hexo optimize</a>压缩优化HTML、CSS、JS、Image资源。</li>\n<li>使用<a href=\"http://instantclick.io/\">InstantClick</a>。</li>\n</ol>\n<p>InstantClick是一款类似于<a href=\"http://instantclick.io/\">Turbolinks</a>的js库，利用<a href=\"https://github.com/defunkt/jquery-pjax\">pjax</a>（pushState and Ajax)技术对网站进行优化，能够极大的提高访问速度。<br>","more":"</p>\n<h2 id=\"解决InstantClick的兼容问题\"><a href=\"#解决InstantClick的兼容问题\" class=\"headerlink\" title=\"解决InstantClick的兼容问题\"></a>解决InstantClick的兼容问题</h2><p>InstantClick效果明显，但是副作用也大。加入它之后，原来相处无碍的Fancybox、百度分享、百度统计、 mathJax、多说评论都挂了。下面是我的解决方法：</p>\n<p>###Fancybox<br>Fancybox的修复首先要避面页面切换时jquery.fancybox.min.js文件的重复加载。可以将该js文件的引用放入head中或者加入data-no-instant属性。<br>然后，因为instantclick在预加载时默认只替换body元素，所以在绑定fancybox的时候需要设置parent属性为body：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</div><div class=\"line\">    $(<span class=\"string\">'.fancybox'</span>).fancybox(&#123;<span class=\"attr\">parent</span>:<span class=\"string\">'body'</span>&#125;);</div><div class=\"line\">&#125;)(jQuery);</div></pre></td></tr></table></figure></p>\n<p>这样就应该可以了。</p>\n<p>###多说评论（以及最新评论、热评文章等）<br>首先，多说的公共JS是不能放在加入data-no-instant属性的。因为不是网站所有页面都包含评论部分的。<br>因此，我们需要将其裹入一层判断中来阻止其多次加载，提高网页的访问速度：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"javascript\"></div><div class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> duoshuoQuery === <span class=\"string\">'undefined'</span>)&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> duoshuoQuery = &#123;<span class=\"attr\">short_name</span>:<span class=\"string\">\"你的域名\"</span>&#125;;</div><div class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> ds = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'script'</span>);</div><div class=\"line\">        ds.type = <span class=\"string\">'text/javascript'</span>;ds.async = <span class=\"literal\">true</span>;</div><div class=\"line\">        ds.src = (<span class=\"built_in\">document</span>.location.protocol == <span class=\"string\">'https:'</span> ? <span class=\"string\">'https:'</span> : <span class=\"string\">'http:'</span>) + <span class=\"string\">'//static.duoshuo.com/embed.unstable.js'</span>;</div><div class=\"line\">        ds.charset = <span class=\"string\">'UTF-8'</span>;</div><div class=\"line\">        (<span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'head'</span>)[<span class=\"number\">0</span>]</div><div class=\"line\">         || <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'body'</span>)[<span class=\"number\">0</span>]).appendChild(ds);</div><div class=\"line\">    &#125;)();</div><div class=\"line\">&#125;</div><div class=\"line\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 多说公共JS代码 end --&gt;</span></div></pre></td></tr></table></figure></p>\n<p>然后，我们需要在页面预加载的change事件里对其进行重载：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">data-no-instant</span>&gt;</span><span class=\"javascript\"></div><div class=\"line\">InstantClick.on(<span class=\"string\">'change'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">isInitialLoad</span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span> (isInitialLoad === <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">  \t<span class=\"keyword\">if</span>($(<span class=\"string\">\".ds-thread\"</span>).length &amp;&amp; <span class=\"keyword\">typeof</span> DUOSHUO !== <span class=\"string\">'undefined'</span>)&#123; <span class=\"comment\">//support 多说评论框</span></div><div class=\"line\">  \t\tDUOSHUO.EmbedThread($(<span class=\"string\">'.ds-thread'</span>)[<span class=\"number\">0</span>]);</div><div class=\"line\">  \t&#125;</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;);</div><div class=\"line\">InstantClick.init();</div><div class=\"line\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>可以用同样的方式解决多说的热门文章、最新评论等插件的问题。DUOSHUO全部的重载函数有：<code>&quot;EmbedThread&quot;, &quot;RecentComments&quot;, &quot;RecentVisitors&quot;, &quot;TopUsers&quot;, &quot;TopThreads&quot;, &quot;LoginWidget&quot;, &quot;ThreadCount&quot;</code></p>\n<p>###百度统计、google统计、MathJax<br>这三个可以参考这篇文章：<a href=\"http://zhiqiang.org/blog/it/instantclick-support-mathjax-baidu-stat.html\">click here</a>。同样是在change事件里对他们进行重新加载。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">InstantClick.on(<span class=\"string\">'change'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">isInitialLoad</span>) </span>&#123;</div><div class=\"line\">  <span class=\"keyword\">if</span> (isInitialLoad === <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> MathJax !== <span class=\"string\">'undefined'</span>) <span class=\"comment\">// support MathJax</span></div><div class=\"line\">      MathJax.Hub.Queue([<span class=\"string\">\"Typeset\"</span>,MathJax.Hub]);</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> prettyPrint !== <span class=\"string\">'undefined'</span>) <span class=\"comment\">// support google code prettify</span></div><div class=\"line\">      prettyPrint();</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> _hmt !== <span class=\"string\">'undefined'</span>)  <span class=\"comment\">// support 百度统计</span></div><div class=\"line\">      _hmt.push([<span class=\"string\">'_trackPageview'</span>, location.pathname + location.search]);</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> ga !== <span class=\"string\">'undefined'</span>)  <span class=\"comment\">// support google analytics</span></div><div class=\"line\">        ga(<span class=\"string\">'send'</span>, <span class=\"string\">'pageview'</span>, location.pathname + location.search);</div><div class=\"line\">  &#125;</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<p>###百度分享<br>百度分享可以用<a href=\"http://www.jiathis.com/\">jiathis</a>代替，其实国内的分享工具都差不多。</p>\n<p>##关于data-no-instant属性<br>data-no-instant属性是用来避免instantclick在页面切换时对该元素重复加载。可以用在script、style标签中，也能放在a标签中，表示该链接将使用正常方式打开而不用instantclick加速。</p>\n<p>data-no-intant无法阻止对div等元素的重新加载，因此无法实现像网易云音乐那样在切换页面的时候无间断的播放音乐等功能。不过曾有人contribute过类似的功能，但是作者没有接受：<a href=\"https://github.com/dieulot/instantclick/pull/108\">click here</a>。</p>\n<p><br/><br>至此全部问题解决了，其他的问题可以参考下面几个链接：</p>\n<ul>\n<li><a href=\"http://shinychang.net/article/544b6c3578cf49f90fc204d7\">整合 InstantClick 與 AddThis</a></li>\n<li><a href=\"http://lukang.me/2014/hexo-page-speed.html\">Hexo 静态博客加速</a></li>\n<li><a href=\"http://fancyapps.com/fancybox/#docs\">fancybox文档</a></li>\n<li><a href=\"http://instantclick.io/documentation\">InstantClick文档</a></li>\n</ul>"},{"title":"Hexo折腾笔记（二）博客优化与定制","date":"2015-02-25T14:57:00.000Z","toc":true,"_content":"首先我使用的是由[zippera](http://zipperary.com/)基于官方[Light](https://github.com/hexojs/hexo-theme-light)主题改进而来的[Lightum](https://github.com/zippera/lightum)主题,其他主题可能稍有出入。\n##速度优化\n参考之前的文章：[静态页面优化](http://kevinsfork.info/2015/02/25/hexo-speedup-instantclick/)。然后使用了[hexo-qiniu-sync](https://github.com/gyk001/hexo-qiniu-sync)这个项目，将静态的图片以及css、js同步到了七牛云。（PS：主题模板中包含了两个不同版本的jquery，分别在head.ejs与after-footer.ejs中，随便删除一个。）\n\n对于处于body区域的script、style的引用尽可能的加入data-no-instant属性，避免InstantClick重复加载。\n##给instantclick加载进度条加上阴影效果\n```CSS\n#instantclick-bar{\n-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, 0.56);\nbox-shadow: 0 0 8px rgba(0, 0, 0, 0.56);\n}\n```\n\n##加入Swiftype搜索\n去[Swiftype](https://swiftype.com/)官网申请代码，然后修改search.ejs文件为：\n```Html\n<div class=\"search\">\n<form>\n<input type=\"search\" id=\"st-search-input\" placeholder=\"<%= __('search') %>\">\n</form>\n</div>\n```\n <!--more-->\n更具体的指导具体可以参考这篇文章：[click here](http://lukang.me/2015/optimization-of-hexo-2.html)。\n##改进多说评论框\n###添加data-thread-key等属性\n```Html\n<!-- 多说评论框 start -->\n<div class=\"ds-thread\" data-thread-key=\"<%= page.path %>\" data-title=\"<%= page.title %>\" data-url=\"<%= page.permalink %>\"></div>\n<!-- 多说评论框 end -->\n```\n###美化多说评论框\n进入多说评论的管理后台，将下面代码粘贴到‘设置->自定义CSS’中。\n```\n#ds-reset .ds-avatar img{width:54px;height:54px;border-radius:27px;-webkit-border-radius:27px;-moz-border-radius:27px;box-shadow:inset 0 -1px 0 #3333sf;-webkit-box-shadow:inset 0 -1px 0 #3333sf;-webkit-transition:0.4s;-webkit-transition:-webkit-transform 0.4s ease-out;transition:transform 0.4s ease-out;-moz-transition:-moz-transform 0.4s ease-out;}\n#ds-reset .ds-avatar img:hover{box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);-webkit-box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);transform:rotateZ(360deg);-webkit-transform:rotateZ(360deg);-moz-transform:rotateZ(360deg);}\np.ds-powered-by,#ds-sync-checkbox,.ds-sync label{display:none!important;}\n#ds-reset .ds-rounded-top{-webkit-border-top-right-radius:0px;-webkit-border-top-left-radius:0px;border-top-right-radius:0px;border-top-left-radius:0px;}\n#ds-thread #ds-reset .ds-textarea-wrapper{background:#fff;border:0;margin-bottom:20px;padding-right:0px;}\n#ds-thread #ds-reset .ds-textarea-wrapper textarea{min-height:80px;border:1px solid #ccc;padding:10px;-webkit-appearance:none;border-radius:0;background-color:#FFFFFF;border-color:#cccccc;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);color:rgba(0,0,0,0.75);-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transition:border-color 0.15s linear,background 0.15s linear;-moz-transition:border-color 0.15s linear,background 0.15s linear;-ms-transition:border-color 0.15s linear,background 0.15s linear;-o-transition:border-color 0.15s linear,background 0.15s linear;transition:border-color 0.15s linear,background 0.15s linear;}\n#ds-thread #ds-reset .ds-textarea-wrapper textarea:focus{border-color:#999999;background:#fafafa;outline:none;}\n#ds-thread #ds-reset .ds-post-options{border-bottom-left-radius:0px;-webkit-border-bottom-left-radius:0px;border:none;background:none!important;}\n#ds-thread #ds-reset .ds-post-button{border-bottom-right-radius:0px;-webkit-border-bottom-right-radius:0px;}\n#ds-reset .ds-textarea-wrapper textarea:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);}\n#ds-thread #ds-reset .ds-post-button{background-image:none;text-shadow:none;border:none;font-weight:normal;line-height:normal;position:absolute;-webkit-appearance:button;-moz-appearance:button;background-color:#008CBA;border-color:#007095;color:#FFFFFF;transition:background-color 300ms ease-out;}\n#ds-thread #ds-reset .ds-post-button:hover,#ds-thread #ds-reset .ds-post-button:focus{background-color:#007095;color:#FFFFFF;}\n```\n##加入多说最新评论\n修改'theme/lightum/_config.yml'文件，在widgets下面添加`- recent_comments`项。\n在主题文件的'theme/lightum/layout/_widget'目录中新建recent_comments.ejs文件，并放入如下代码：\n```\n<div class=\"widget tag\">\n<h3 class=\"title\"><%= __('recent_comments')</h3>\n<div class=\"entry\">\n<!-- 多说最新评论 start -->\n    <div class=\"ds-recent-comments\" data-num-items=\"5\" data-show-avatars=\"1\" data-show-time=\"1\" data-show-title=\"1\" data-show-admin=\"1\" data-excerpt-length=\"70\"></div>\n<!-- 多说最新评论 end -->\n<!-- 多说公共JS代码 start (一个网页只需插入一次) -->\n..........\n<!-- 多说公共JS代码 end -->\n</div>\n</div>\n```\n然后在'/languages/zh-CN.yml'文件添加翻译：`recent_comments: 最新评论`\n\n最后，原来的评论样式不太符合lightum主题，可以在'/source/css/_partial'里建立一个recent_comment.styl文件：\n```language\n.ds-recent-comments\n  li.ds-comment\n    &:first-child\n      border-top none !important\n```\n然后在/theme/lightum/source/css/style中将之包括进来：`@import '_partial/recent_comments'`\n\n\n多说的这个插件同样不兼容于instantclick。我们可以在这篇文章的基础上解决：[click here](/2015/02/25/hexo-speedup-instantclick/):\n- 将多说的公共JS放入head或加入'data-no-instant'属性放入body中，并删除recent.ejs与comment.ejs中重复的JS。\n- 修改change事件中的代码为：\n```\nif(typeof DUOSHUO !== 'undefined'){ //support 多说评论框\nif($(\".ds-thread\").length){\n    DUOSHUO.EmbedThread($('.ds-thread')[0]);\n}\nDUOSHUO.RecentComments($('.ds-recent-comments')[0]);\n}\n```\n这样虽然能够解决问题，但是会显示方面又会出现点小问题。可以加入下面css修复：\n```language\nspan.caption{\ndisplay: none;\n}\n```\n## 加入文章导航\n修改'/layout/_partical/article.ejs'文件\n```Html\n<article class=\"<%= item.layout %>\">\n  // ...\n  <div class=\"entry\">\n    <% if (item.excerpt && index){ %>\n      <%- item.excerpt %>\n    <% } else { %>\n      <% if (!index){ %>\n        // 插入文章导航\n        <%- partial('toc') %>\n      <% } %>\n      <%- item.content %>\n    <% } %>\n  </div>\n</article>\n```\n在'\\source\\css\\_partial\\article.styl'文件后添加：\n```language\n  .toc-article\n    float right\n     \n  #toc\n    background #eee\n    margin 0 0 10px 20px\n    padding 12px\n    line-height 18px\n    font-size 10px\n    strong\n      font-size 15px\n    ol\n      margin-top 5px\n      margin-left 0\n    .toc\n      padding 0\n      li\n        list-style-type none\n    .toc-child\n      padding-left 20px\n```\n这样，我们就能在写文章的时候添加`toc: true`来启动文章导航功能。\n###扩展：浮动式导航\n实现当页面滑动到下方时将文章导航浮动到屏幕右侧。\n\n在'\\layout\\_partial\\'里新建文件：`float_nav.ejs`\n```Html\n<div id=\"menu-nav\">\n\t<div id=\"title-nav\"><%= __('navigation') %><div>→</div>\n\t</div>\n\t<div id=\"content-nav\">\n\t\t<%- toc(item.content) %>\n\t</div>\n</div>\n<script>\n(function($, scrollSpeed, hiddenSpeed, fadeSpeed) {\n\tvar T = $('#toc');\n\tvar M = $('#menu-nav');\n\tvar C = $('#content-nav');\n\tvar Tx = T.position().top;\n\t$(window).scroll(function() {\n\t\tvar top = $(this).scrollTop();\n\t\tif (top >= Tx + 300) {\n\t\t\tM.stop().fadeIn(fadeSpeed);\n\t\t\tT.stop().fadeTo(fadeSpeed, 0);\n\t\t} else {\n\t\t\tM.stop().fadeOut(fadeSpeed);\n\t\t\tT.stop().fadeTo(fadeSpeed, 1);\n\t\t}\n\t});\n\n\t$('.toc-link').click(function(e) {\n\t\t//阻止默认跳转\n\t\te.preventDefault();\n\t\t//定义滚动动画\n\t\tvar scrollTarget = $('#' + $(this).children('.toc-text').first().text());\n\t\t$(\"html,body\").animate({\n\t\t\tscrollTop: scrollTarget.prev().offset().top\n\t\t}, scrollSpeed);\n\t});\n\tC.click(function(e) {\n\t\te.stopPropagation();\n\t});\n\tM.click(function() {\n\t\tC.toggle(hiddenSpeed, 'linear', function() {\n\t\t\tvar T = $('#title-nav div');\n\t\t\tT.text() == '←' ? T.text('→') : T.text('←');\n\t\t});\n\t});\n})(jQuery, 500, 200, 100);\n</script>\n```\n在'layout/_partial/article.ejs'中添加对其的引用：\n```Html\n<% if(!index && item.toc){ %>\n  <%- partial('float_nav') %>\n<% } %>\n```\n添加css样式：\n```language\nnavbcolor=rgba(100, 100, 100, 0.74)\n#menu-nav\n  position fixed;\n  display none;\n  cursor pointer;\n  z-index 150;\n  right 0;\n  top 20%;\n  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);\n  color white;\n  background navbcolor;\n  #title-nav\n    display inline-block;\n    vertical-align middle;\n    width: 30px;\n    height: 100%;\n    font-size: 16px;\n    text-align: center;\n    padding: 10px 0;\n  #content-nav\n    display inline-block;\n    vertical-align middle;\n    white-space:nowrap;\n    border-left: 1px dashed #ccc;\n    box-sizing border-box;\n    padding 15px;\n    line-height 18px;\n    font-size 10px;\n    li\n      list-style-type none;\n      width 100%;\n      a\n        display block;\n        box-sizing border-box;\n        color #FFFFFF;\n        &:hover\n          background rgba(100, 100, 100, 1);\n      .toc-child a\n        padding-left 20px;\n```\n###添加\"返回顶部\"\n与上一节相似，在'layout/_widget/'中添加`totop.ejs`文件：\n```Html\n<div id=\"to-top\">↑</div>\n<script>\n(function($, scrollSpeed, fadeSpeed) {\n\tvar T = $('#to-top');\n\t$(window).scroll(function() {\n\t\tvar top = $(this).scrollTop();\n\t\tif (top >= 300) {\n\t\t\tT.stop().fadeIn(fadeSpeed);\n\t\t} else {\n\t\t\tT.stop().fadeOut(fadeSpeed);\n\t\t}\n\t});\n\tT.click(function() {\n\t\t$(\"html,body\").animate({\n\t\t\tscrollTop: 0\n\t\t}, scrollSpeed);\n\t});\n})(jQuery, 500, 200);\n</script>\n```\n在'lightum/_config.yml'中启用该挂件：\n```language\nwidgets:\n- totop\n```\n添加css样式：\n```language\n#to-top\n  background navbcolor;\n  position fixed;\n  display none;\n  z-index 200;\n  right 40px;\n  bottom 10%;\n  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);\n  font-size 14px;\n  color white;\n  padding 5px 15px;\n  cursor pointer;\n  font-size 12px;\n  text-align center;\n  &:hover\n    background rgba(100,100,100,1);\n```\n\n\n##参考\n- [Hexo 主题修改:为博客实现更多功能](http://deffi.info/2014/10/03/Hexo-%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8D%9A%E5%AE%A2%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD/)\n- [多说评论也玩圆角头像动画「自定义CSS:无压力小白级教程」](https://luolei.org/duoshuo-css/)\n- [Hexo 优化与定制(二)](http://lukang.me/2015/optimization-of-hexo-2.html)","source":"_posts/hexo-lightum-enhance.md","raw":"title: Hexo折腾笔记（二）博客优化与定制\ntags:\n  - 美化\n  - html\ncategories:\n  - Hexo\ndate: 2015-02-25 22:57:00\ntoc: true\n---\n首先我使用的是由[zippera](http://zipperary.com/)基于官方[Light](https://github.com/hexojs/hexo-theme-light)主题改进而来的[Lightum](https://github.com/zippera/lightum)主题,其他主题可能稍有出入。\n##速度优化\n参考之前的文章：[静态页面优化](http://kevinsfork.info/2015/02/25/hexo-speedup-instantclick/)。然后使用了[hexo-qiniu-sync](https://github.com/gyk001/hexo-qiniu-sync)这个项目，将静态的图片以及css、js同步到了七牛云。（PS：主题模板中包含了两个不同版本的jquery，分别在head.ejs与after-footer.ejs中，随便删除一个。）\n\n对于处于body区域的script、style的引用尽可能的加入data-no-instant属性，避免InstantClick重复加载。\n##给instantclick加载进度条加上阴影效果\n```CSS\n#instantclick-bar{\n-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, 0.56);\nbox-shadow: 0 0 8px rgba(0, 0, 0, 0.56);\n}\n```\n\n##加入Swiftype搜索\n去[Swiftype](https://swiftype.com/)官网申请代码，然后修改search.ejs文件为：\n```Html\n<div class=\"search\">\n<form>\n<input type=\"search\" id=\"st-search-input\" placeholder=\"<%= __('search') %>\">\n</form>\n</div>\n```\n <!--more-->\n更具体的指导具体可以参考这篇文章：[click here](http://lukang.me/2015/optimization-of-hexo-2.html)。\n##改进多说评论框\n###添加data-thread-key等属性\n```Html\n<!-- 多说评论框 start -->\n<div class=\"ds-thread\" data-thread-key=\"<%= page.path %>\" data-title=\"<%= page.title %>\" data-url=\"<%= page.permalink %>\"></div>\n<!-- 多说评论框 end -->\n```\n###美化多说评论框\n进入多说评论的管理后台，将下面代码粘贴到‘设置->自定义CSS’中。\n```\n#ds-reset .ds-avatar img{width:54px;height:54px;border-radius:27px;-webkit-border-radius:27px;-moz-border-radius:27px;box-shadow:inset 0 -1px 0 #3333sf;-webkit-box-shadow:inset 0 -1px 0 #3333sf;-webkit-transition:0.4s;-webkit-transition:-webkit-transform 0.4s ease-out;transition:transform 0.4s ease-out;-moz-transition:-moz-transform 0.4s ease-out;}\n#ds-reset .ds-avatar img:hover{box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);-webkit-box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);transform:rotateZ(360deg);-webkit-transform:rotateZ(360deg);-moz-transform:rotateZ(360deg);}\np.ds-powered-by,#ds-sync-checkbox,.ds-sync label{display:none!important;}\n#ds-reset .ds-rounded-top{-webkit-border-top-right-radius:0px;-webkit-border-top-left-radius:0px;border-top-right-radius:0px;border-top-left-radius:0px;}\n#ds-thread #ds-reset .ds-textarea-wrapper{background:#fff;border:0;margin-bottom:20px;padding-right:0px;}\n#ds-thread #ds-reset .ds-textarea-wrapper textarea{min-height:80px;border:1px solid #ccc;padding:10px;-webkit-appearance:none;border-radius:0;background-color:#FFFFFF;border-color:#cccccc;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);color:rgba(0,0,0,0.75);-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transition:border-color 0.15s linear,background 0.15s linear;-moz-transition:border-color 0.15s linear,background 0.15s linear;-ms-transition:border-color 0.15s linear,background 0.15s linear;-o-transition:border-color 0.15s linear,background 0.15s linear;transition:border-color 0.15s linear,background 0.15s linear;}\n#ds-thread #ds-reset .ds-textarea-wrapper textarea:focus{border-color:#999999;background:#fafafa;outline:none;}\n#ds-thread #ds-reset .ds-post-options{border-bottom-left-radius:0px;-webkit-border-bottom-left-radius:0px;border:none;background:none!important;}\n#ds-thread #ds-reset .ds-post-button{border-bottom-right-radius:0px;-webkit-border-bottom-right-radius:0px;}\n#ds-reset .ds-textarea-wrapper textarea:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);}\n#ds-thread #ds-reset .ds-post-button{background-image:none;text-shadow:none;border:none;font-weight:normal;line-height:normal;position:absolute;-webkit-appearance:button;-moz-appearance:button;background-color:#008CBA;border-color:#007095;color:#FFFFFF;transition:background-color 300ms ease-out;}\n#ds-thread #ds-reset .ds-post-button:hover,#ds-thread #ds-reset .ds-post-button:focus{background-color:#007095;color:#FFFFFF;}\n```\n##加入多说最新评论\n修改'theme/lightum/_config.yml'文件，在widgets下面添加`- recent_comments`项。\n在主题文件的'theme/lightum/layout/_widget'目录中新建recent_comments.ejs文件，并放入如下代码：\n```\n<div class=\"widget tag\">\n<h3 class=\"title\"><%= __('recent_comments')</h3>\n<div class=\"entry\">\n<!-- 多说最新评论 start -->\n    <div class=\"ds-recent-comments\" data-num-items=\"5\" data-show-avatars=\"1\" data-show-time=\"1\" data-show-title=\"1\" data-show-admin=\"1\" data-excerpt-length=\"70\"></div>\n<!-- 多说最新评论 end -->\n<!-- 多说公共JS代码 start (一个网页只需插入一次) -->\n..........\n<!-- 多说公共JS代码 end -->\n</div>\n</div>\n```\n然后在'/languages/zh-CN.yml'文件添加翻译：`recent_comments: 最新评论`\n\n最后，原来的评论样式不太符合lightum主题，可以在'/source/css/_partial'里建立一个recent_comment.styl文件：\n```language\n.ds-recent-comments\n  li.ds-comment\n    &:first-child\n      border-top none !important\n```\n然后在/theme/lightum/source/css/style中将之包括进来：`@import '_partial/recent_comments'`\n\n\n多说的这个插件同样不兼容于instantclick。我们可以在这篇文章的基础上解决：[click here](/2015/02/25/hexo-speedup-instantclick/):\n- 将多说的公共JS放入head或加入'data-no-instant'属性放入body中，并删除recent.ejs与comment.ejs中重复的JS。\n- 修改change事件中的代码为：\n```\nif(typeof DUOSHUO !== 'undefined'){ //support 多说评论框\nif($(\".ds-thread\").length){\n    DUOSHUO.EmbedThread($('.ds-thread')[0]);\n}\nDUOSHUO.RecentComments($('.ds-recent-comments')[0]);\n}\n```\n这样虽然能够解决问题，但是会显示方面又会出现点小问题。可以加入下面css修复：\n```language\nspan.caption{\ndisplay: none;\n}\n```\n## 加入文章导航\n修改'/layout/_partical/article.ejs'文件\n```Html\n<article class=\"<%= item.layout %>\">\n  // ...\n  <div class=\"entry\">\n    <% if (item.excerpt && index){ %>\n      <%- item.excerpt %>\n    <% } else { %>\n      <% if (!index){ %>\n        // 插入文章导航\n        <%- partial('toc') %>\n      <% } %>\n      <%- item.content %>\n    <% } %>\n  </div>\n</article>\n```\n在'\\source\\css\\_partial\\article.styl'文件后添加：\n```language\n  .toc-article\n    float right\n     \n  #toc\n    background #eee\n    margin 0 0 10px 20px\n    padding 12px\n    line-height 18px\n    font-size 10px\n    strong\n      font-size 15px\n    ol\n      margin-top 5px\n      margin-left 0\n    .toc\n      padding 0\n      li\n        list-style-type none\n    .toc-child\n      padding-left 20px\n```\n这样，我们就能在写文章的时候添加`toc: true`来启动文章导航功能。\n###扩展：浮动式导航\n实现当页面滑动到下方时将文章导航浮动到屏幕右侧。\n\n在'\\layout\\_partial\\'里新建文件：`float_nav.ejs`\n```Html\n<div id=\"menu-nav\">\n\t<div id=\"title-nav\"><%= __('navigation') %><div>→</div>\n\t</div>\n\t<div id=\"content-nav\">\n\t\t<%- toc(item.content) %>\n\t</div>\n</div>\n<script>\n(function($, scrollSpeed, hiddenSpeed, fadeSpeed) {\n\tvar T = $('#toc');\n\tvar M = $('#menu-nav');\n\tvar C = $('#content-nav');\n\tvar Tx = T.position().top;\n\t$(window).scroll(function() {\n\t\tvar top = $(this).scrollTop();\n\t\tif (top >= Tx + 300) {\n\t\t\tM.stop().fadeIn(fadeSpeed);\n\t\t\tT.stop().fadeTo(fadeSpeed, 0);\n\t\t} else {\n\t\t\tM.stop().fadeOut(fadeSpeed);\n\t\t\tT.stop().fadeTo(fadeSpeed, 1);\n\t\t}\n\t});\n\n\t$('.toc-link').click(function(e) {\n\t\t//阻止默认跳转\n\t\te.preventDefault();\n\t\t//定义滚动动画\n\t\tvar scrollTarget = $('#' + $(this).children('.toc-text').first().text());\n\t\t$(\"html,body\").animate({\n\t\t\tscrollTop: scrollTarget.prev().offset().top\n\t\t}, scrollSpeed);\n\t});\n\tC.click(function(e) {\n\t\te.stopPropagation();\n\t});\n\tM.click(function() {\n\t\tC.toggle(hiddenSpeed, 'linear', function() {\n\t\t\tvar T = $('#title-nav div');\n\t\t\tT.text() == '←' ? T.text('→') : T.text('←');\n\t\t});\n\t});\n})(jQuery, 500, 200, 100);\n</script>\n```\n在'layout/_partial/article.ejs'中添加对其的引用：\n```Html\n<% if(!index && item.toc){ %>\n  <%- partial('float_nav') %>\n<% } %>\n```\n添加css样式：\n```language\nnavbcolor=rgba(100, 100, 100, 0.74)\n#menu-nav\n  position fixed;\n  display none;\n  cursor pointer;\n  z-index 150;\n  right 0;\n  top 20%;\n  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);\n  color white;\n  background navbcolor;\n  #title-nav\n    display inline-block;\n    vertical-align middle;\n    width: 30px;\n    height: 100%;\n    font-size: 16px;\n    text-align: center;\n    padding: 10px 0;\n  #content-nav\n    display inline-block;\n    vertical-align middle;\n    white-space:nowrap;\n    border-left: 1px dashed #ccc;\n    box-sizing border-box;\n    padding 15px;\n    line-height 18px;\n    font-size 10px;\n    li\n      list-style-type none;\n      width 100%;\n      a\n        display block;\n        box-sizing border-box;\n        color #FFFFFF;\n        &:hover\n          background rgba(100, 100, 100, 1);\n      .toc-child a\n        padding-left 20px;\n```\n###添加\"返回顶部\"\n与上一节相似，在'layout/_widget/'中添加`totop.ejs`文件：\n```Html\n<div id=\"to-top\">↑</div>\n<script>\n(function($, scrollSpeed, fadeSpeed) {\n\tvar T = $('#to-top');\n\t$(window).scroll(function() {\n\t\tvar top = $(this).scrollTop();\n\t\tif (top >= 300) {\n\t\t\tT.stop().fadeIn(fadeSpeed);\n\t\t} else {\n\t\t\tT.stop().fadeOut(fadeSpeed);\n\t\t}\n\t});\n\tT.click(function() {\n\t\t$(\"html,body\").animate({\n\t\t\tscrollTop: 0\n\t\t}, scrollSpeed);\n\t});\n})(jQuery, 500, 200);\n</script>\n```\n在'lightum/_config.yml'中启用该挂件：\n```language\nwidgets:\n- totop\n```\n添加css样式：\n```language\n#to-top\n  background navbcolor;\n  position fixed;\n  display none;\n  z-index 200;\n  right 40px;\n  bottom 10%;\n  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);\n  font-size 14px;\n  color white;\n  padding 5px 15px;\n  cursor pointer;\n  font-size 12px;\n  text-align center;\n  &:hover\n    background rgba(100,100,100,1);\n```\n\n\n##参考\n- [Hexo 主题修改:为博客实现更多功能](http://deffi.info/2014/10/03/Hexo-%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8D%9A%E5%AE%A2%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD/)\n- [多说评论也玩圆角头像动画「自定义CSS:无压力小白级教程」](https://luolei.org/duoshuo-css/)\n- [Hexo 优化与定制(二)](http://lukang.me/2015/optimization-of-hexo-2.html)","slug":"hexo-lightum-enhance","published":1,"updated":"2017-01-16T06:57:57.189Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l1p003p5rgx68tnxzmz","content":"<p>首先我使用的是由<a href=\"http://zipperary.com/\" target=\"_blank\" rel=\"external\">zippera</a>基于官方<a href=\"https://github.com/hexojs/hexo-theme-light\" target=\"_blank\" rel=\"external\">Light</a>主题改进而来的<a href=\"https://github.com/zippera/lightum\" target=\"_blank\" rel=\"external\">Lightum</a>主题,其他主题可能稍有出入。</p>\n<p>##速度优化<br>参考之前的文章：<a href=\"http://kevinsfork.info/2015/02/25/hexo-speedup-instantclick/\" target=\"_blank\" rel=\"external\">静态页面优化</a>。然后使用了<a href=\"https://github.com/gyk001/hexo-qiniu-sync\" target=\"_blank\" rel=\"external\">hexo-qiniu-sync</a>这个项目，将静态的图片以及css、js同步到了七牛云。（PS：主题模板中包含了两个不同版本的jquery，分别在head.ejs与after-footer.ejs中，随便删除一个。）</p>\n<p>对于处于body区域的script、style的引用尽可能的加入data-no-instant属性，避免InstantClick重复加载。</p>\n<p>##给instantclick加载进度条加上阴影效果<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-id\">#instantclick-bar</span>&#123;</div><div class=\"line\"><span class=\"attribute\">-webkit-box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">8px</span> <span class=\"built_in\">rgba</span>(0, 0, 0, 0.56);</div><div class=\"line\"><span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">8px</span> <span class=\"built_in\">rgba</span>(0, 0, 0, 0.56);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>##加入Swiftype搜索<br>去<a href=\"https://swiftype.com/\" target=\"_blank\" rel=\"external\">Swiftype</a>官网申请代码，然后修改search.ejs文件为：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"search\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"search\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"st-search-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"&lt;%= __('search') %&gt;\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure></p>\n <a id=\"more\"></a>\n<p>更具体的指导具体可以参考这篇文章：<a href=\"http://lukang.me/2015/optimization-of-hexo-2.html\" target=\"_blank\" rel=\"external\">click here</a>。</p>\n<p>##改进多说评论框</p>\n<p>###添加data-thread-key等属性<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 多说评论框 start --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ds-thread\"</span> <span class=\"attr\">data-thread-key</span>=<span class=\"string\">\"&lt;%= page.path %&gt;\"</span> <span class=\"attr\">data-title</span>=<span class=\"string\">\"&lt;%= page.title %&gt;\"</span> <span class=\"attr\">data-url</span>=<span class=\"string\">\"&lt;%= page.permalink %&gt;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 多说评论框 end --&gt;</span></div></pre></td></tr></table></figure></p>\n<p>###美化多说评论框<br>进入多说评论的管理后台，将下面代码粘贴到‘设置-&gt;自定义CSS’中。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">#ds-reset .ds-avatar img&#123;width:54px;height:54px;border-radius:27px;-webkit-border-radius:27px;-moz-border-radius:27px;box-shadow:inset 0 -1px 0 #3333sf;-webkit-box-shadow:inset 0 -1px 0 #3333sf;-webkit-transition:0.4s;-webkit-transition:-webkit-transform 0.4s ease-out;transition:transform 0.4s ease-out;-moz-transition:-moz-transform 0.4s ease-out;&#125;</div><div class=\"line\">#ds-reset .ds-avatar img:hover&#123;box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);-webkit-box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);transform:rotateZ(360deg);-webkit-transform:rotateZ(360deg);-moz-transform:rotateZ(360deg);&#125;</div><div class=\"line\">p.ds-powered-by,#ds-sync-checkbox,.ds-sync label&#123;display:none!important;&#125;</div><div class=\"line\">#ds-reset .ds-rounded-top&#123;-webkit-border-top-right-radius:0px;-webkit-border-top-left-radius:0px;border-top-right-radius:0px;border-top-left-radius:0px;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-textarea-wrapper&#123;background:#fff;border:0;margin-bottom:20px;padding-right:0px;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-textarea-wrapper textarea&#123;min-height:80px;border:1px solid #ccc;padding:10px;-webkit-appearance:none;border-radius:0;background-color:#FFFFFF;border-color:#cccccc;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);color:rgba(0,0,0,0.75);-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transition:border-color 0.15s linear,background 0.15s linear;-moz-transition:border-color 0.15s linear,background 0.15s linear;-ms-transition:border-color 0.15s linear,background 0.15s linear;-o-transition:border-color 0.15s linear,background 0.15s linear;transition:border-color 0.15s linear,background 0.15s linear;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-textarea-wrapper textarea:focus&#123;border-color:#999999;background:#fafafa;outline:none;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-options&#123;border-bottom-left-radius:0px;-webkit-border-bottom-left-radius:0px;border:none;background:none!important;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-button&#123;border-bottom-right-radius:0px;-webkit-border-bottom-right-radius:0px;&#125;</div><div class=\"line\">#ds-reset .ds-textarea-wrapper textarea:focus&#123;border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-button&#123;background-image:none;text-shadow:none;border:none;font-weight:normal;line-height:normal;position:absolute;-webkit-appearance:button;-moz-appearance:button;background-color:#008CBA;border-color:#007095;color:#FFFFFF;transition:background-color 300ms ease-out;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-button:hover,#ds-thread #ds-reset .ds-post-button:focus&#123;background-color:#007095;color:#FFFFFF;&#125;</div></pre></td></tr></table></figure></p>\n<p>##加入多说最新评论<br>修改’theme/lightum/_config.yml’文件，在widgets下面添加<code>- recent_comments</code>项。<br>在主题文件的’theme/lightum/layout/_widget’目录中新建recent_comments.ejs文件，并放入如下代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;div class=&quot;widget tag&quot;&gt;</div><div class=\"line\">&lt;h3 class=&quot;title&quot;&gt;&lt;%= __(&apos;recent_comments&apos;)&lt;/h3&gt;</div><div class=\"line\">&lt;div class=&quot;entry&quot;&gt;</div><div class=\"line\">&lt;!-- 多说最新评论 start --&gt;</div><div class=\"line\">    &lt;div class=&quot;ds-recent-comments&quot; data-num-items=&quot;5&quot; data-show-avatars=&quot;1&quot; data-show-time=&quot;1&quot; data-show-title=&quot;1&quot; data-show-admin=&quot;1&quot; data-excerpt-length=&quot;70&quot;&gt;&lt;/div&gt;</div><div class=\"line\">&lt;!-- 多说最新评论 end --&gt;</div><div class=\"line\">&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</div><div class=\"line\">..........</div><div class=\"line\">&lt;!-- 多说公共JS代码 end --&gt;</div><div class=\"line\">&lt;/div&gt;</div><div class=\"line\">&lt;/div&gt;</div></pre></td></tr></table></figure></p>\n<p>然后在’/languages/zh-CN.yml’文件添加翻译：<code>recent_comments: 最新评论</code></p>\n<p>最后，原来的评论样式不太符合lightum主题，可以在’/source/css/_partial’里建立一个recent_comment.styl文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">.ds-recent-comments</div><div class=\"line\">  li.ds-comment</div><div class=\"line\">    &amp;:first-child</div><div class=\"line\">      border-top none !important</div></pre></td></tr></table></figure></p>\n<p>然后在/theme/lightum/source/css/style中将之包括进来：<code>@import &#39;_partial/recent_comments&#39;</code></p>\n<p>多说的这个插件同样不兼容于instantclick。我们可以在这篇文章的基础上解决：<a href=\"/2015/02/25/hexo-speedup-instantclick/\">click here</a>:</p>\n<ul>\n<li>将多说的公共JS放入head或加入’data-no-instant’属性放入body中，并删除recent.ejs与comment.ejs中重复的JS。</li>\n<li>修改change事件中的代码为：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">if(typeof DUOSHUO !== &apos;undefined&apos;)&#123; //support 多说评论框</div><div class=\"line\">if($(&quot;.ds-thread&quot;).length)&#123;</div><div class=\"line\">    DUOSHUO.EmbedThread($(&apos;.ds-thread&apos;)[0]);</div><div class=\"line\">&#125;</div><div class=\"line\">DUOSHUO.RecentComments($(&apos;.ds-recent-comments&apos;)[0]);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这样虽然能够解决问题，但是会显示方面又会出现点小问题。可以加入下面css修复：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">span.caption&#123;</div><div class=\"line\">display: none;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"加入文章导航\"><a href=\"#加入文章导航\" class=\"headerlink\" title=\"加入文章导航\"></a>加入文章导航</h2><p>修改’/layout/_partical/article.ejs’文件<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">\"&lt;%= item.layout %&gt;\"</span>&gt;</span></div><div class=\"line\">  // ...</div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"entry\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">%</span> <span class=\"attr\">if</span> (<span class=\"attr\">item.excerpt</span> &amp;&amp; <span class=\"attr\">index</span>)&#123; %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">item.excerpt</span> %&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; <span class=\"attr\">else</span> &#123; %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%</span> <span class=\"attr\">if</span> (!<span class=\"attr\">index</span>)&#123; %&gt;</span></div><div class=\"line\">        // 插入文章导航</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">partial</span>('<span class=\"attr\">toc</span>') %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">item.content</span> %&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; %&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>在’\\source\\css_partial\\article.styl’文件后添加：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">.toc-article</div><div class=\"line\">  float right</div><div class=\"line\">   </div><div class=\"line\">#toc</div><div class=\"line\">  background #eee</div><div class=\"line\">  margin 0 0 10px 20px</div><div class=\"line\">  padding 12px</div><div class=\"line\">  line-height 18px</div><div class=\"line\">  font-size 10px</div><div class=\"line\">  strong</div><div class=\"line\">    font-size 15px</div><div class=\"line\">  ol</div><div class=\"line\">    margin-top 5px</div><div class=\"line\">    margin-left 0</div><div class=\"line\">  .toc</div><div class=\"line\">    padding 0</div><div class=\"line\">    li</div><div class=\"line\">      list-style-type none</div><div class=\"line\">  .toc-child</div><div class=\"line\">    padding-left 20px</div></pre></td></tr></table></figure></p>\n<p>这样，我们就能在写文章的时候添加<code>toc: true</code>来启动文章导航功能。</p>\n<p>###扩展：浮动式导航<br>实现当页面滑动到下方时将文章导航浮动到屏幕右侧。</p>\n<p>在’\\layout_partial\\’里新建文件：<code>float_nav.ejs</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"menu-nav\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"title-nav\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">%=</span> <span class=\"attr\">__</span>('<span class=\"attr\">navigation</span>') %&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>→<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content-nav\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">toc</span>(<span class=\"attr\">item.content</span>) %&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$, scrollSpeed, hiddenSpeed, fadeSpeed</span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> T = $(<span class=\"string\">'#toc'</span>);</div><div class=\"line\">\t<span class=\"keyword\">var</span> M = $(<span class=\"string\">'#menu-nav'</span>);</div><div class=\"line\">\t<span class=\"keyword\">var</span> C = $(<span class=\"string\">'#content-nav'</span>);</div><div class=\"line\">\t<span class=\"keyword\">var</span> Tx = T.position().top;</div><div class=\"line\">\t$(<span class=\"built_in\">window</span>).scroll(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">var</span> top = $(<span class=\"keyword\">this</span>).scrollTop();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (top &gt;= Tx + <span class=\"number\">300</span>) &#123;</div><div class=\"line\">\t\t\tM.stop().fadeIn(fadeSpeed);</div><div class=\"line\">\t\t\tT.stop().fadeTo(fadeSpeed, <span class=\"number\">0</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\tM.stop().fadeOut(fadeSpeed);</div><div class=\"line\">\t\t\tT.stop().fadeTo(fadeSpeed, <span class=\"number\">1</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t$(<span class=\"string\">'.toc-link'</span>).click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">//阻止默认跳转</span></div><div class=\"line\">\t\te.preventDefault();</div><div class=\"line\">\t\t<span class=\"comment\">//定义滚动动画</span></div><div class=\"line\">\t\t<span class=\"keyword\">var</span> scrollTarget = $(<span class=\"string\">'#'</span> + $(<span class=\"keyword\">this</span>).children(<span class=\"string\">'.toc-text'</span>).first().text());</div><div class=\"line\">\t\t$(<span class=\"string\">\"html,body\"</span>).animate(&#123;</div><div class=\"line\">\t\t\t<span class=\"attr\">scrollTop</span>: scrollTarget.prev().offset().top</div><div class=\"line\">\t\t&#125;, scrollSpeed);</div><div class=\"line\">\t&#125;);</div><div class=\"line\">\tC.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">\t\te.stopPropagation();</div><div class=\"line\">\t&#125;);</div><div class=\"line\">\tM.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\tC.toggle(hiddenSpeed, <span class=\"string\">'linear'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">var</span> T = $(<span class=\"string\">'#title-nav div'</span>);</div><div class=\"line\">\t\t\tT.text() == <span class=\"string\">'←'</span> ? T.text(<span class=\"string\">'→'</span>) : T.text(<span class=\"string\">'←'</span>);</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\">\t&#125;);</div><div class=\"line\">&#125;)(jQuery, <span class=\"number\">500</span>, <span class=\"number\">200</span>, <span class=\"number\">100</span>);</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>在’layout/_partial/article.ejs’中添加对其的引用：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">%</span> <span class=\"attr\">if</span>(!<span class=\"attr\">index</span> &amp;&amp; <span class=\"attr\">item.toc</span>)&#123; %&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">partial</span>('<span class=\"attr\">float_nav</span>') %&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; %&gt;</span></div></pre></td></tr></table></figure></p>\n<p>添加css样式：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\">navbcolor=rgba(100, 100, 100, 0.74)</div><div class=\"line\">#menu-nav</div><div class=\"line\">  position fixed;</div><div class=\"line\">  display none;</div><div class=\"line\">  cursor pointer;</div><div class=\"line\">  z-index 150;</div><div class=\"line\">  right 0;</div><div class=\"line\">  top 20%;</div><div class=\"line\">  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);</div><div class=\"line\">  color white;</div><div class=\"line\">  background navbcolor;</div><div class=\"line\">  #title-nav</div><div class=\"line\">    display inline-block;</div><div class=\"line\">    vertical-align middle;</div><div class=\"line\">    width: 30px;</div><div class=\"line\">    height: 100%;</div><div class=\"line\">    font-size: 16px;</div><div class=\"line\">    text-align: center;</div><div class=\"line\">    padding: 10px 0;</div><div class=\"line\">  #content-nav</div><div class=\"line\">    display inline-block;</div><div class=\"line\">    vertical-align middle;</div><div class=\"line\">    white-space:nowrap;</div><div class=\"line\">    border-left: 1px dashed #ccc;</div><div class=\"line\">    box-sizing border-box;</div><div class=\"line\">    padding 15px;</div><div class=\"line\">    line-height 18px;</div><div class=\"line\">    font-size 10px;</div><div class=\"line\">    li</div><div class=\"line\">      list-style-type none;</div><div class=\"line\">      width 100%;</div><div class=\"line\">      a</div><div class=\"line\">        display block;</div><div class=\"line\">        box-sizing border-box;</div><div class=\"line\">        color #FFFFFF;</div><div class=\"line\">        &amp;:hover</div><div class=\"line\">          background rgba(100, 100, 100, 1);</div><div class=\"line\">      .toc-child a</div><div class=\"line\">        padding-left 20px;</div></pre></td></tr></table></figure></p>\n<p>###添加”返回顶部”<br>与上一节相似，在’layout/_widget/‘中添加<code>totop.ejs</code>文件：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"to-top\"</span>&gt;</span>↑<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$, scrollSpeed, fadeSpeed</span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> T = $(<span class=\"string\">'#to-top'</span>);</div><div class=\"line\">\t$(<span class=\"built_in\">window</span>).scroll(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">var</span> top = $(<span class=\"keyword\">this</span>).scrollTop();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (top &gt;= <span class=\"number\">300</span>) &#123;</div><div class=\"line\">\t\t\tT.stop().fadeIn(fadeSpeed);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\tT.stop().fadeOut(fadeSpeed);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;);</div><div class=\"line\">\tT.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t$(<span class=\"string\">\"html,body\"</span>).animate(&#123;</div><div class=\"line\">\t\t\t<span class=\"attr\">scrollTop</span>: <span class=\"number\">0</span></div><div class=\"line\">\t\t&#125;, scrollSpeed);</div><div class=\"line\">\t&#125;);</div><div class=\"line\">&#125;)(jQuery, <span class=\"number\">500</span>, <span class=\"number\">200</span>);</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>在’lightum/_config.yml’中启用该挂件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">widgets:</div><div class=\"line\">- totop</div></pre></td></tr></table></figure></p>\n<p>添加css样式：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">#to-top</div><div class=\"line\">  background navbcolor;</div><div class=\"line\">  position fixed;</div><div class=\"line\">  display none;</div><div class=\"line\">  z-index 200;</div><div class=\"line\">  right 40px;</div><div class=\"line\">  bottom 10%;</div><div class=\"line\">  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);</div><div class=\"line\">  font-size 14px;</div><div class=\"line\">  color white;</div><div class=\"line\">  padding 5px 15px;</div><div class=\"line\">  cursor pointer;</div><div class=\"line\">  font-size 12px;</div><div class=\"line\">  text-align center;</div><div class=\"line\">  &amp;:hover</div><div class=\"line\">    background rgba(100,100,100,1);</div></pre></td></tr></table></figure></p>\n<p>##参考</p>\n<ul>\n<li><a href=\"http://deffi.info/2014/10/03/Hexo-%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8D%9A%E5%AE%A2%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD/\" target=\"_blank\" rel=\"external\">Hexo 主题修改:为博客实现更多功能</a></li>\n<li><a href=\"https://luolei.org/duoshuo-css/\" target=\"_blank\" rel=\"external\">多说评论也玩圆角头像动画「自定义CSS:无压力小白级教程」</a></li>\n<li><a href=\"http://lukang.me/2015/optimization-of-hexo-2.html\" target=\"_blank\" rel=\"external\">Hexo 优化与定制(二)</a></li>\n</ul>\n","excerpt":"<p>首先我使用的是由<a href=\"http://zipperary.com/\">zippera</a>基于官方<a href=\"https://github.com/hexojs/hexo-theme-light\">Light</a>主题改进而来的<a href=\"https://github.com/zippera/lightum\">Lightum</a>主题,其他主题可能稍有出入。</p>\n<p>##速度优化<br>参考之前的文章：<a href=\"http://kevinsfork.info/2015/02/25/hexo-speedup-instantclick/\">静态页面优化</a>。然后使用了<a href=\"https://github.com/gyk001/hexo-qiniu-sync\">hexo-qiniu-sync</a>这个项目，将静态的图片以及css、js同步到了七牛云。（PS：主题模板中包含了两个不同版本的jquery，分别在head.ejs与after-footer.ejs中，随便删除一个。）</p>\n<p>对于处于body区域的script、style的引用尽可能的加入data-no-instant属性，避免InstantClick重复加载。</p>\n<p>##给instantclick加载进度条加上阴影效果<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-id\">#instantclick-bar</span>&#123;</div><div class=\"line\"><span class=\"attribute\">-webkit-box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">8px</span> <span class=\"built_in\">rgba</span>(0, 0, 0, 0.56);</div><div class=\"line\"><span class=\"attribute\">box-shadow</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">8px</span> <span class=\"built_in\">rgba</span>(0, 0, 0, 0.56);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>##加入Swiftype搜索<br>去<a href=\"https://swiftype.com/\">Swiftype</a>官网申请代码，然后修改search.ejs文件为：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"search\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"search\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"st-search-input\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"&lt;%= __('search') %&gt;\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure></p>","more":"<p>更具体的指导具体可以参考这篇文章：<a href=\"http://lukang.me/2015/optimization-of-hexo-2.html\">click here</a>。</p>\n<p>##改进多说评论框</p>\n<p>###添加data-thread-key等属性<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 多说评论框 start --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ds-thread\"</span> <span class=\"attr\">data-thread-key</span>=<span class=\"string\">\"&lt;%= page.path %&gt;\"</span> <span class=\"attr\">data-title</span>=<span class=\"string\">\"&lt;%= page.title %&gt;\"</span> <span class=\"attr\">data-url</span>=<span class=\"string\">\"&lt;%= page.permalink %&gt;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 多说评论框 end --&gt;</span></div></pre></td></tr></table></figure></p>\n<p>###美化多说评论框<br>进入多说评论的管理后台，将下面代码粘贴到‘设置-&gt;自定义CSS’中。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">#ds-reset .ds-avatar img&#123;width:54px;height:54px;border-radius:27px;-webkit-border-radius:27px;-moz-border-radius:27px;box-shadow:inset 0 -1px 0 #3333sf;-webkit-box-shadow:inset 0 -1px 0 #3333sf;-webkit-transition:0.4s;-webkit-transition:-webkit-transform 0.4s ease-out;transition:transform 0.4s ease-out;-moz-transition:-moz-transform 0.4s ease-out;&#125;</div><div class=\"line\">#ds-reset .ds-avatar img:hover&#123;box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);-webkit-box-shadow:0 0 10px #fff;rgba(255,255,255,.6),inset 0 0 20px rgba(255,255,255,1);transform:rotateZ(360deg);-webkit-transform:rotateZ(360deg);-moz-transform:rotateZ(360deg);&#125;</div><div class=\"line\">p.ds-powered-by,#ds-sync-checkbox,.ds-sync label&#123;display:none!important;&#125;</div><div class=\"line\">#ds-reset .ds-rounded-top&#123;-webkit-border-top-right-radius:0px;-webkit-border-top-left-radius:0px;border-top-right-radius:0px;border-top-left-radius:0px;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-textarea-wrapper&#123;background:#fff;border:0;margin-bottom:20px;padding-right:0px;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-textarea-wrapper textarea&#123;min-height:80px;border:1px solid #ccc;padding:10px;-webkit-appearance:none;border-radius:0;background-color:#FFFFFF;border-color:#cccccc;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);color:rgba(0,0,0,0.75);-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-transition:border-color 0.15s linear,background 0.15s linear;-moz-transition:border-color 0.15s linear,background 0.15s linear;-ms-transition:border-color 0.15s linear,background 0.15s linear;-o-transition:border-color 0.15s linear,background 0.15s linear;transition:border-color 0.15s linear,background 0.15s linear;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-textarea-wrapper textarea:focus&#123;border-color:#999999;background:#fafafa;outline:none;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-options&#123;border-bottom-left-radius:0px;-webkit-border-bottom-left-radius:0px;border:none;background:none!important;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-button&#123;border-bottom-right-radius:0px;-webkit-border-bottom-right-radius:0px;&#125;</div><div class=\"line\">#ds-reset .ds-textarea-wrapper textarea:focus&#123;border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-button&#123;background-image:none;text-shadow:none;border:none;font-weight:normal;line-height:normal;position:absolute;-webkit-appearance:button;-moz-appearance:button;background-color:#008CBA;border-color:#007095;color:#FFFFFF;transition:background-color 300ms ease-out;&#125;</div><div class=\"line\">#ds-thread #ds-reset .ds-post-button:hover,#ds-thread #ds-reset .ds-post-button:focus&#123;background-color:#007095;color:#FFFFFF;&#125;</div></pre></td></tr></table></figure></p>\n<p>##加入多说最新评论<br>修改’theme/lightum/_config.yml’文件，在widgets下面添加<code>- recent_comments</code>项。<br>在主题文件的’theme/lightum/layout/_widget’目录中新建recent_comments.ejs文件，并放入如下代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;div class=&quot;widget tag&quot;&gt;</div><div class=\"line\">&lt;h3 class=&quot;title&quot;&gt;&lt;%= __(&apos;recent_comments&apos;)&lt;/h3&gt;</div><div class=\"line\">&lt;div class=&quot;entry&quot;&gt;</div><div class=\"line\">&lt;!-- 多说最新评论 start --&gt;</div><div class=\"line\">    &lt;div class=&quot;ds-recent-comments&quot; data-num-items=&quot;5&quot; data-show-avatars=&quot;1&quot; data-show-time=&quot;1&quot; data-show-title=&quot;1&quot; data-show-admin=&quot;1&quot; data-excerpt-length=&quot;70&quot;&gt;&lt;/div&gt;</div><div class=\"line\">&lt;!-- 多说最新评论 end --&gt;</div><div class=\"line\">&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</div><div class=\"line\">..........</div><div class=\"line\">&lt;!-- 多说公共JS代码 end --&gt;</div><div class=\"line\">&lt;/div&gt;</div><div class=\"line\">&lt;/div&gt;</div></pre></td></tr></table></figure></p>\n<p>然后在’/languages/zh-CN.yml’文件添加翻译：<code>recent_comments: 最新评论</code></p>\n<p>最后，原来的评论样式不太符合lightum主题，可以在’/source/css/_partial’里建立一个recent_comment.styl文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">.ds-recent-comments</div><div class=\"line\">  li.ds-comment</div><div class=\"line\">    &amp;:first-child</div><div class=\"line\">      border-top none !important</div></pre></td></tr></table></figure></p>\n<p>然后在/theme/lightum/source/css/style中将之包括进来：<code>@import &#39;_partial/recent_comments&#39;</code></p>\n<p>多说的这个插件同样不兼容于instantclick。我们可以在这篇文章的基础上解决：<a href=\"/2015/02/25/hexo-speedup-instantclick/\">click here</a>:</p>\n<ul>\n<li>将多说的公共JS放入head或加入’data-no-instant’属性放入body中，并删除recent.ejs与comment.ejs中重复的JS。</li>\n<li>修改change事件中的代码为：<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">if(typeof DUOSHUO !== &apos;undefined&apos;)&#123; //support 多说评论框</div><div class=\"line\">if($(&quot;.ds-thread&quot;).length)&#123;</div><div class=\"line\">    DUOSHUO.EmbedThread($(&apos;.ds-thread&apos;)[0]);</div><div class=\"line\">&#125;</div><div class=\"line\">DUOSHUO.RecentComments($(&apos;.ds-recent-comments&apos;)[0]);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这样虽然能够解决问题，但是会显示方面又会出现点小问题。可以加入下面css修复：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">span.caption&#123;</div><div class=\"line\">display: none;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<h2 id=\"加入文章导航\"><a href=\"#加入文章导航\" class=\"headerlink\" title=\"加入文章导航\"></a>加入文章导航</h2><p>修改’/layout/_partical/article.ejs’文件<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">\"&lt;%= item.layout %&gt;\"</span>&gt;</span></div><div class=\"line\">  // ...</div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"entry\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">%</span> <span class=\"attr\">if</span> (<span class=\"attr\">item.excerpt</span> &amp;&amp; <span class=\"attr\">index</span>)&#123; %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">item.excerpt</span> %&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; <span class=\"attr\">else</span> &#123; %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%</span> <span class=\"attr\">if</span> (!<span class=\"attr\">index</span>)&#123; %&gt;</span></div><div class=\"line\">        // 插入文章导航</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">partial</span>('<span class=\"attr\">toc</span>') %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; %&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">item.content</span> %&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; %&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>在’\\source\\css_partial\\article.styl’文件后添加：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">.toc-article</div><div class=\"line\">  float right</div><div class=\"line\">   </div><div class=\"line\">#toc</div><div class=\"line\">  background #eee</div><div class=\"line\">  margin 0 0 10px 20px</div><div class=\"line\">  padding 12px</div><div class=\"line\">  line-height 18px</div><div class=\"line\">  font-size 10px</div><div class=\"line\">  strong</div><div class=\"line\">    font-size 15px</div><div class=\"line\">  ol</div><div class=\"line\">    margin-top 5px</div><div class=\"line\">    margin-left 0</div><div class=\"line\">  .toc</div><div class=\"line\">    padding 0</div><div class=\"line\">    li</div><div class=\"line\">      list-style-type none</div><div class=\"line\">  .toc-child</div><div class=\"line\">    padding-left 20px</div></pre></td></tr></table></figure></p>\n<p>这样，我们就能在写文章的时候添加<code>toc: true</code>来启动文章导航功能。</p>\n<p>###扩展：浮动式导航<br>实现当页面滑动到下方时将文章导航浮动到屏幕右侧。</p>\n<p>在’\\layout_partial\\’里新建文件：<code>float_nav.ejs</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"menu-nav\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"title-nav\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">%=</span> <span class=\"attr\">__</span>('<span class=\"attr\">navigation</span>') %&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>→<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content-nav\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">toc</span>(<span class=\"attr\">item.content</span>) %&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></div><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$, scrollSpeed, hiddenSpeed, fadeSpeed</span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> T = $(<span class=\"string\">'#toc'</span>);</div><div class=\"line\">\t<span class=\"keyword\">var</span> M = $(<span class=\"string\">'#menu-nav'</span>);</div><div class=\"line\">\t<span class=\"keyword\">var</span> C = $(<span class=\"string\">'#content-nav'</span>);</div><div class=\"line\">\t<span class=\"keyword\">var</span> Tx = T.position().top;</div><div class=\"line\">\t$(<span class=\"built_in\">window</span>).scroll(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">var</span> top = $(<span class=\"keyword\">this</span>).scrollTop();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (top &gt;= Tx + <span class=\"number\">300</span>) &#123;</div><div class=\"line\">\t\t\tM.stop().fadeIn(fadeSpeed);</div><div class=\"line\">\t\t\tT.stop().fadeTo(fadeSpeed, <span class=\"number\">0</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\tM.stop().fadeOut(fadeSpeed);</div><div class=\"line\">\t\t\tT.stop().fadeTo(fadeSpeed, <span class=\"number\">1</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;);</div><div class=\"line\"></div><div class=\"line\">\t$(<span class=\"string\">'.toc-link'</span>).click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">//阻止默认跳转</span></div><div class=\"line\">\t\te.preventDefault();</div><div class=\"line\">\t\t<span class=\"comment\">//定义滚动动画</span></div><div class=\"line\">\t\t<span class=\"keyword\">var</span> scrollTarget = $(<span class=\"string\">'#'</span> + $(<span class=\"keyword\">this</span>).children(<span class=\"string\">'.toc-text'</span>).first().text());</div><div class=\"line\">\t\t$(<span class=\"string\">\"html,body\"</span>).animate(&#123;</div><div class=\"line\">\t\t\t<span class=\"attr\">scrollTop</span>: scrollTarget.prev().offset().top</div><div class=\"line\">\t\t&#125;, scrollSpeed);</div><div class=\"line\">\t&#125;);</div><div class=\"line\">\tC.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">\t\te.stopPropagation();</div><div class=\"line\">\t&#125;);</div><div class=\"line\">\tM.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\tC.toggle(hiddenSpeed, <span class=\"string\">'linear'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">var</span> T = $(<span class=\"string\">'#title-nav div'</span>);</div><div class=\"line\">\t\t\tT.text() == <span class=\"string\">'←'</span> ? T.text(<span class=\"string\">'→'</span>) : T.text(<span class=\"string\">'←'</span>);</div><div class=\"line\">\t\t&#125;);</div><div class=\"line\">\t&#125;);</div><div class=\"line\">&#125;)(jQuery, <span class=\"number\">500</span>, <span class=\"number\">200</span>, <span class=\"number\">100</span>);</div><div class=\"line\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>在’layout/_partial/article.ejs’中添加对其的引用：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">%</span> <span class=\"attr\">if</span>(!<span class=\"attr\">index</span> &amp;&amp; <span class=\"attr\">item.toc</span>)&#123; %&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">%-</span> <span class=\"attr\">partial</span>('<span class=\"attr\">float_nav</span>') %&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">%</span> &#125; %&gt;</span></div></pre></td></tr></table></figure></p>\n<p>添加css样式：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\">navbcolor=rgba(100, 100, 100, 0.74)</div><div class=\"line\">#menu-nav</div><div class=\"line\">  position fixed;</div><div class=\"line\">  display none;</div><div class=\"line\">  cursor pointer;</div><div class=\"line\">  z-index 150;</div><div class=\"line\">  right 0;</div><div class=\"line\">  top 20%;</div><div class=\"line\">  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);</div><div class=\"line\">  color white;</div><div class=\"line\">  background navbcolor;</div><div class=\"line\">  #title-nav</div><div class=\"line\">    display inline-block;</div><div class=\"line\">    vertical-align middle;</div><div class=\"line\">    width: 30px;</div><div class=\"line\">    height: 100%;</div><div class=\"line\">    font-size: 16px;</div><div class=\"line\">    text-align: center;</div><div class=\"line\">    padding: 10px 0;</div><div class=\"line\">  #content-nav</div><div class=\"line\">    display inline-block;</div><div class=\"line\">    vertical-align middle;</div><div class=\"line\">    white-space:nowrap;</div><div class=\"line\">    border-left: 1px dashed #ccc;</div><div class=\"line\">    box-sizing border-box;</div><div class=\"line\">    padding 15px;</div><div class=\"line\">    line-height 18px;</div><div class=\"line\">    font-size 10px;</div><div class=\"line\">    li</div><div class=\"line\">      list-style-type none;</div><div class=\"line\">      width 100%;</div><div class=\"line\">      a</div><div class=\"line\">        display block;</div><div class=\"line\">        box-sizing border-box;</div><div class=\"line\">        color #FFFFFF;</div><div class=\"line\">        &amp;:hover</div><div class=\"line\">          background rgba(100, 100, 100, 1);</div><div class=\"line\">      .toc-child a</div><div class=\"line\">        padding-left 20px;</div></pre></td></tr></table></figure></p>\n<p>###添加”返回顶部”<br>与上一节相似，在’layout/_widget/‘中添加<code>totop.ejs</code>文件：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"to-top\"</span>&gt;</span>↑<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></div><div class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$, scrollSpeed, fadeSpeed</span>) </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">var</span> T = $(<span class=\"string\">'#to-top'</span>);</div><div class=\"line\">\t$(<span class=\"built_in\">window</span>).scroll(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">var</span> top = $(<span class=\"keyword\">this</span>).scrollTop();</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (top &gt;= <span class=\"number\">300</span>) &#123;</div><div class=\"line\">\t\t\tT.stop().fadeIn(fadeSpeed);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\t\tT.stop().fadeOut(fadeSpeed);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;);</div><div class=\"line\">\tT.click(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">\t\t$(<span class=\"string\">\"html,body\"</span>).animate(&#123;</div><div class=\"line\">\t\t\t<span class=\"attr\">scrollTop</span>: <span class=\"number\">0</span></div><div class=\"line\">\t\t&#125;, scrollSpeed);</div><div class=\"line\">\t&#125;);</div><div class=\"line\">&#125;)(jQuery, <span class=\"number\">500</span>, <span class=\"number\">200</span>);</div><div class=\"line\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>在’lightum/_config.yml’中启用该挂件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">widgets:</div><div class=\"line\">- totop</div></pre></td></tr></table></figure></p>\n<p>添加css样式：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">#to-top</div><div class=\"line\">  background navbcolor;</div><div class=\"line\">  position fixed;</div><div class=\"line\">  display none;</div><div class=\"line\">  z-index 200;</div><div class=\"line\">  right 40px;</div><div class=\"line\">  bottom 10%;</div><div class=\"line\">  box-shadow 0 0 5px rgba(0, 0, 0, 0.15);</div><div class=\"line\">  font-size 14px;</div><div class=\"line\">  color white;</div><div class=\"line\">  padding 5px 15px;</div><div class=\"line\">  cursor pointer;</div><div class=\"line\">  font-size 12px;</div><div class=\"line\">  text-align center;</div><div class=\"line\">  &amp;:hover</div><div class=\"line\">    background rgba(100,100,100,1);</div></pre></td></tr></table></figure></p>\n<p>##参考</p>\n<ul>\n<li><a href=\"http://deffi.info/2014/10/03/Hexo-%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8D%9A%E5%AE%A2%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD/\">Hexo 主题修改:为博客实现更多功能</a></li>\n<li><a href=\"https://luolei.org/duoshuo-css/\">多说评论也玩圆角头像动画「自定义CSS:无压力小白级教程」</a></li>\n<li><a href=\"http://lukang.me/2015/optimization-of-hexo-2.html\">Hexo 优化与定制(二)</a></li>\n</ul>"},{"title":"KDE4的配置参考","date":"2014-10-31T12:35:05.000Z","_content":"\n西北工大回来后,时间又充裕了,所以又开始了折腾KDE。\n\n话说KDE的渲染阴影等效果非常接近MacBook。先放几张图：\n\n[![抓图14](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14.png)\n<!--more-->\n[![抓图15](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15.png) [![抓图18](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18.png)\n\n下面说一下，我的配置过程：\n\n1.  **发行版：**\n     我的发行版是Arch，没有Arch强大的AUR，很多桌面的配件很难装上。\n2.  **主题：**\n     我的plasma主题是Helium与dynamo主题混合而成。标题栏主题是Qtcurve，图标主题是dynamo与flattr混合而成，鼠标主题是Breeze。应用程序主题是Qtcurve，配色是Breeze。这些都可以到[这里下载](http://pan.baidu.com/s/1jGLy3n4)。先安装qtcurve再将下载下来的文件解压并覆盖～/.kde4/share/即可。注意，Qtcurve的配置方案是Breeze，并且在窗口管理器中设置边框大小是无侧边框。\n3.  **全局菜单：**\n     全局菜单可以先加archlinuxcn源，然后依次用yaourt安装appmenu-qt,appmenu-qt5,appmenu-gtk,kdeplasma-applets-menubar。完成之后在面板上添加刚安装的部件再打开“系统设置&gt;应用程序外观&gt;风格”然后选择微调标签，修改“菜单栏风格”为“仅导出”就能有全局菜单了。\n4.  **最大化隐藏菜单栏：**\n     最大化隐藏菜单栏可以直接在qtCurve中配置，依然在“窗口管理器”中，勾选“最大化窗口无边框”复选框即可。\n5.  **最大化上面板显示窗口控制按钮：**（最后一张图鼠标所指的地方）\n     在AUR中安装kdeplasma-applets-kwin-button-improved，然后在面板上重复三次添加这个部件，分别设置为最小化（iconify），最大化/回复（maximize/restore）和关闭（close）就行了。\n","source":"_posts/kde4-config.md","raw":"---\ntitle: KDE4的配置参考\ncategories:\n- Linux\ndate: 2014-10-31 20:35:05\ntags: [DE/WM]\n---\n\n西北工大回来后,时间又充裕了,所以又开始了折腾KDE。\n\n话说KDE的渲染阴影等效果非常接近MacBook。先放几张图：\n\n[![抓图14](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14.png)\n<!--more-->\n[![抓图15](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15.png) [![抓图18](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18.png)\n\n下面说一下，我的配置过程：\n\n1.  **发行版：**\n     我的发行版是Arch，没有Arch强大的AUR，很多桌面的配件很难装上。\n2.  **主题：**\n     我的plasma主题是Helium与dynamo主题混合而成。标题栏主题是Qtcurve，图标主题是dynamo与flattr混合而成，鼠标主题是Breeze。应用程序主题是Qtcurve，配色是Breeze。这些都可以到[这里下载](http://pan.baidu.com/s/1jGLy3n4)。先安装qtcurve再将下载下来的文件解压并覆盖～/.kde4/share/即可。注意，Qtcurve的配置方案是Breeze，并且在窗口管理器中设置边框大小是无侧边框。\n3.  **全局菜单：**\n     全局菜单可以先加archlinuxcn源，然后依次用yaourt安装appmenu-qt,appmenu-qt5,appmenu-gtk,kdeplasma-applets-menubar。完成之后在面板上添加刚安装的部件再打开“系统设置&gt;应用程序外观&gt;风格”然后选择微调标签，修改“菜单栏风格”为“仅导出”就能有全局菜单了。\n4.  **最大化隐藏菜单栏：**\n     最大化隐藏菜单栏可以直接在qtCurve中配置，依然在“窗口管理器”中，勾选“最大化窗口无边框”复选框即可。\n5.  **最大化上面板显示窗口控制按钮：**（最后一张图鼠标所指的地方）\n     在AUR中安装kdeplasma-applets-kwin-button-improved，然后在面板上重复三次添加这个部件，分别设置为最小化（iconify），最大化/回复（maximize/restore）和关闭（close）就行了。\n","slug":"kde4-config","published":1,"updated":"2019-10-11T05:50:15.682Z","_id":"ciz5e9l1r003t5rgx7ww6bs4l","comments":1,"layout":"post","photos":[],"link":"","content":"<p>西北工大回来后,时间又充裕了,所以又开始了折腾KDE。</p>\n<p>话说KDE的渲染阴影等效果非常接近MacBook。先放几张图：</p>\n<p><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14-1024x575.png\" alt=\"抓图14\"></a><br><a id=\"more\"></a><br><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15-1024x575.png\" alt=\"抓图15\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18-1024x575.png\" alt=\"抓图18\"></a></p>\n<p>下面说一下，我的配置过程：</p>\n<ol>\n<li><strong>发行版：</strong><br> 我的发行版是Arch，没有Arch强大的AUR，很多桌面的配件很难装上。</li>\n<li><strong>主题：</strong><br> 我的plasma主题是Helium与dynamo主题混合而成。标题栏主题是Qtcurve，图标主题是dynamo与flattr混合而成，鼠标主题是Breeze。应用程序主题是Qtcurve，配色是Breeze。这些都可以到<a href=\"http://pan.baidu.com/s/1jGLy3n4\" target=\"_blank\" rel=\"noopener\">这里下载</a>。先安装qtcurve再将下载下来的文件解压并覆盖～/.kde4/share/即可。注意，Qtcurve的配置方案是Breeze，并且在窗口管理器中设置边框大小是无侧边框。</li>\n<li><strong>全局菜单：</strong><br> 全局菜单可以先加archlinuxcn源，然后依次用yaourt安装appmenu-qt,appmenu-qt5,appmenu-gtk,kdeplasma-applets-menubar。完成之后在面板上添加刚安装的部件再打开“系统设置&gt;应用程序外观&gt;风格”然后选择微调标签，修改“菜单栏风格”为“仅导出”就能有全局菜单了。</li>\n<li><strong>最大化隐藏菜单栏：</strong><br> 最大化隐藏菜单栏可以直接在qtCurve中配置，依然在“窗口管理器”中，勾选“最大化窗口无边框”复选框即可。</li>\n<li><strong>最大化上面板显示窗口控制按钮：</strong>（最后一张图鼠标所指的地方）<br> 在AUR中安装kdeplasma-applets-kwin-button-improved，然后在面板上重复三次添加这个部件，分别设置为最小化（iconify），最大化/回复（maximize/restore）和关闭（close）就行了。</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>西北工大回来后,时间又充裕了,所以又开始了折腾KDE。</p>\n<p>话说KDE的渲染阴影等效果非常接近MacBook。先放几张图：</p>\n<p><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图14-1024x575.png\" alt=\"抓图14\"></a><br>","more":"<br><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图15-1024x575.png\" alt=\"抓图15\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/10/抓图18-1024x575.png\" alt=\"抓图18\"></a></p>\n<p>下面说一下，我的配置过程：</p>\n<ol>\n<li><strong>发行版：</strong><br> 我的发行版是Arch，没有Arch强大的AUR，很多桌面的配件很难装上。</li>\n<li><strong>主题：</strong><br> 我的plasma主题是Helium与dynamo主题混合而成。标题栏主题是Qtcurve，图标主题是dynamo与flattr混合而成，鼠标主题是Breeze。应用程序主题是Qtcurve，配色是Breeze。这些都可以到<a href=\"http://pan.baidu.com/s/1jGLy3n4\" target=\"_blank\" rel=\"noopener\">这里下载</a>。先安装qtcurve再将下载下来的文件解压并覆盖～/.kde4/share/即可。注意，Qtcurve的配置方案是Breeze，并且在窗口管理器中设置边框大小是无侧边框。</li>\n<li><strong>全局菜单：</strong><br> 全局菜单可以先加archlinuxcn源，然后依次用yaourt安装appmenu-qt,appmenu-qt5,appmenu-gtk,kdeplasma-applets-menubar。完成之后在面板上添加刚安装的部件再打开“系统设置&gt;应用程序外观&gt;风格”然后选择微调标签，修改“菜单栏风格”为“仅导出”就能有全局菜单了。</li>\n<li><strong>最大化隐藏菜单栏：</strong><br> 最大化隐藏菜单栏可以直接在qtCurve中配置，依然在“窗口管理器”中，勾选“最大化窗口无边框”复选框即可。</li>\n<li><strong>最大化上面板显示窗口控制按钮：</strong>（最后一张图鼠标所指的地方）<br> 在AUR中安装kdeplasma-applets-kwin-button-improved，然后在面板上重复三次添加这个部件，分别设置为最小化（iconify），最大化/回复（maximize/restore）和关闭（close）就行了。</li>\n</ol>"},{"title":"KDE的Mac向折腾指南","date":"2014-12-07T04:45:53.000Z","_content":"\n\n\n惯例，先上图：\n\n[![logo9](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9.png)\n<!--more-->\n[![logo5](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5.png) [![logo6](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6.png) [![logo7](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7.png) [![logo8](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8.png)\n\n首先，KDE的全局菜单可以参考我以前的文章《[KDE4的配置参考](http://kevinsfork.info/2014/10/31/kde4-e7-9a-84-e9-85-8d-e7-bd-ae-e5-8f-82-e8-80-83/)》。\n\n然后，Plasma的主题是AG-plasma，aurorae主题是Yoxydaze-light。这些可以去kde-look里找。\n\n底部的dock是plank，主题是ArHU，在deviantART中找到的。另外，plank上的图标是受gtk主题控制的，所以装numix-circle是最好不过的。\n\n我的apps文件可以在这里下载：[click here](http://pan.baidu.com/s/1hqGJDmk)\n\n~/.config/plank/dock1/settings文件：\n```language\n#This file auto-generated by Plank.\n#2014-12-06T09:47:52+0000\n\n[PlankDockPreferences]\n#Whether to show only windows of the current workspace.\nCurrentWorkspaceOnly=false\n#The size of dock icons (in pixels).\nIconSize=42\n#If 0, the dock won't hide. If 1, the dock intelligently hides. If 2, the dock auto-hides. If 3, the dock dodges active maximized windows.\nHideMode=0\n#Time (in ms) to wait before unhiding the dock.\nUnhideDelay=0\n#The monitor number for the dock. Use -1 to keep on the primary monitor.\nMonitor=-1\n#List of *.dockitem files on this dock. DO NOT MODIFY\nDockItems=plank.dockitem;;google-chrome.dockitem;;dolphin.dockitem;;juk.dockitem;;eclipse.dockitem;;chrome-pjkebmlmkppdjcdcilfcjdkifljollfd-Default.dockitem;;kate.dockitem;;gwenview.dockitem;;wps-office-wps.dockitem;;konsole.dockitem;;sublime_text_3.dockitem;;love-wallpaper.dockitem;;ksysguard.dockitem;;virtualbox.dockitem\n#The position for the dock on the monitor. If 0, left. If 1, right. If 2, top. If 3, bottom.\nPosition=3\n#The dock's position offset from center (in percent).\nOffset=0\n#The name of the dock's theme to use.\nTheme=ArHU\n#The alignment for the dock on the monitor's edge. If 0, panel-mode. If 1, left-aligned. If 2, right-aligned. If 3, centered.\nAlignment=3\n#The alignment of the items in this dock if panel-mode is used. If 1, left-aligned. If 2, right-aligned. If 3, centered.\nItemsAlignment=3\n#Whether to prevent drag'n'drop actions and lock items on the dock.\nLockItems=false\n#Whether to use pressure-based revealing of the dock if the support is available.\nPressureReveal=false\n#Whether to show only pinned applications. Useful for running more then one dock.\nPinnedOnly=true\n#Whether to automatically pin an application if it seems useful to do.\nAutoPinning=true\n```\n\n~/.local/share/plank/themes/ArHU/中的dock.theme和hover.theme文件分别是：\n\n```language\n\n#This file auto-generated by Plank.\n#2014-12-06T06:22:37+0000\n\n[PlankDrawingTheme]\n#The roundness of the top corners.\nTopRoundness=6\n#The roundness of the bottom corners.\nBottomRoundness=0\n#The thickness (in pixels) of lines drawn.\nLineWidth=0\n#The color (RGBA) of the outer stroke.\nOuterStrokeColor=0;;0;;0;;0\n#The starting color (RGBA) of the fill gradient.\nFillStartColor=255;;255;;255;;150\n#The ending color (RGBA) of the fill gradient.\nFillEndColor=255;;255;;255;;150\n#The color (RGBA) of the inner stroke.\nInnerStrokeColor=255;;255;;255;;255\n\n[PlankDrawingDockTheme]\n#The padding on the left/right dock edges, in tenths of a percent of IconSize.\nHorizPadding=0\n#The padding on the top dock edge, in tenths of a percent of IconSize.\nTopPadding=1\n#The padding on the bottom dock edge, in tenths of a percent of IconSize.\nBottomPadding=1\n#The padding between items on the dock, in tenths of a percent of IconSize.\nItemPadding=4\n#The size of item indicators, in tenths of a percent of IconSize.\nIndicatorSize=0\n#The size of the icon-shadow behind every item, in tenths of a percent of IconSize.\nIconShadowSize=0\n#The height (in percent of IconSize) to bounce an icon when the application sets urgent.\nUrgentBounceHeight=0.10000000000000001\n#The height (in percent of IconSize) to bounce an icon when launching an application.\nLaunchBounceHeight=0.10000000000000001\n#The opacity value (0 to 1) to fade the dock to when hiding it.\nFadeOpacity=0\n#The amount of time (in ms) for click animations.\nClickTime=150\n#The amount of time (in ms) to bounce an urgent icon.\nUrgentBounceTime=300\n#The amount of time (in ms) to bounce an icon when launching an application.\nLaunchBounceTime=300\n#The amount of time (in ms) for active window indicator animations.\nActiveTime=150\n#The amount of time (in ms) to slide icons into/out of the dock.\nSlideTime=150\n#The time (in ms) to fade the dock in/out on a hide (if FadeOpacity is &lt; 1).\nFadeTime=100\n#The time (in ms) to slide the dock in/out on a hide (if FadeOpacity is 1).\nHideTime=100\n#The size of the urgent glow (shown when dock is hidden), in tenths of a percent of IconSize.\nGlowSize=30\n#The total time (in ms) to show the hidden-dock urgent glow.\nGlowTime=10000\n#The time (in ms) of each pulse of the hidden-dock urgent glow.\nGlowPulseTime=2000\n#The hue-shift (-180 to 180) of the urgent indicator color.\nUrgentHueShift=150\n#The time (in ms) to move an item to its new position.\nItemMoveTime=150\n```\n```language\n#This theme written by Perian. thexperian.deviantart.com\n\n[PlankDrawingTheme]\nTopRoundness=3\nLineWidth=0\nOuterStrokeColor=0;;0;;0;;0\nFillStartColor=0;;0;;0;;150\nFillEndColor=0;;0;;0;;150\nInnerStrokeColor=0;;0;;0;;0\n\n```\n\n以上是我折腾的结果，找主题也找了半天。大家如果有更好的主题与壁纸也拿来分享一下吧。\n\n","source":"_posts/kde-to-mac.md","raw":"---\ntitle: KDE的Mac向折腾指南\ncategories:\n- Linux\ndate: 2014-12-07 12:45:53\ntags: [DE/WM]\n---\n\n\n\n惯例，先上图：\n\n[![logo9](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9.png)\n<!--more-->\n[![logo5](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5.png) [![logo6](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6.png) [![logo7](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7.png) [![logo8](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8-1024x575.png)](http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8.png)\n\n首先，KDE的全局菜单可以参考我以前的文章《[KDE4的配置参考](http://kevinsfork.info/2014/10/31/kde4-e7-9a-84-e9-85-8d-e7-bd-ae-e5-8f-82-e8-80-83/)》。\n\n然后，Plasma的主题是AG-plasma，aurorae主题是Yoxydaze-light。这些可以去kde-look里找。\n\n底部的dock是plank，主题是ArHU，在deviantART中找到的。另外，plank上的图标是受gtk主题控制的，所以装numix-circle是最好不过的。\n\n我的apps文件可以在这里下载：[click here](http://pan.baidu.com/s/1hqGJDmk)\n\n~/.config/plank/dock1/settings文件：\n```language\n#This file auto-generated by Plank.\n#2014-12-06T09:47:52+0000\n\n[PlankDockPreferences]\n#Whether to show only windows of the current workspace.\nCurrentWorkspaceOnly=false\n#The size of dock icons (in pixels).\nIconSize=42\n#If 0, the dock won't hide. If 1, the dock intelligently hides. If 2, the dock auto-hides. If 3, the dock dodges active maximized windows.\nHideMode=0\n#Time (in ms) to wait before unhiding the dock.\nUnhideDelay=0\n#The monitor number for the dock. Use -1 to keep on the primary monitor.\nMonitor=-1\n#List of *.dockitem files on this dock. DO NOT MODIFY\nDockItems=plank.dockitem;;google-chrome.dockitem;;dolphin.dockitem;;juk.dockitem;;eclipse.dockitem;;chrome-pjkebmlmkppdjcdcilfcjdkifljollfd-Default.dockitem;;kate.dockitem;;gwenview.dockitem;;wps-office-wps.dockitem;;konsole.dockitem;;sublime_text_3.dockitem;;love-wallpaper.dockitem;;ksysguard.dockitem;;virtualbox.dockitem\n#The position for the dock on the monitor. If 0, left. If 1, right. If 2, top. If 3, bottom.\nPosition=3\n#The dock's position offset from center (in percent).\nOffset=0\n#The name of the dock's theme to use.\nTheme=ArHU\n#The alignment for the dock on the monitor's edge. If 0, panel-mode. If 1, left-aligned. If 2, right-aligned. If 3, centered.\nAlignment=3\n#The alignment of the items in this dock if panel-mode is used. If 1, left-aligned. If 2, right-aligned. If 3, centered.\nItemsAlignment=3\n#Whether to prevent drag'n'drop actions and lock items on the dock.\nLockItems=false\n#Whether to use pressure-based revealing of the dock if the support is available.\nPressureReveal=false\n#Whether to show only pinned applications. Useful for running more then one dock.\nPinnedOnly=true\n#Whether to automatically pin an application if it seems useful to do.\nAutoPinning=true\n```\n\n~/.local/share/plank/themes/ArHU/中的dock.theme和hover.theme文件分别是：\n\n```language\n\n#This file auto-generated by Plank.\n#2014-12-06T06:22:37+0000\n\n[PlankDrawingTheme]\n#The roundness of the top corners.\nTopRoundness=6\n#The roundness of the bottom corners.\nBottomRoundness=0\n#The thickness (in pixels) of lines drawn.\nLineWidth=0\n#The color (RGBA) of the outer stroke.\nOuterStrokeColor=0;;0;;0;;0\n#The starting color (RGBA) of the fill gradient.\nFillStartColor=255;;255;;255;;150\n#The ending color (RGBA) of the fill gradient.\nFillEndColor=255;;255;;255;;150\n#The color (RGBA) of the inner stroke.\nInnerStrokeColor=255;;255;;255;;255\n\n[PlankDrawingDockTheme]\n#The padding on the left/right dock edges, in tenths of a percent of IconSize.\nHorizPadding=0\n#The padding on the top dock edge, in tenths of a percent of IconSize.\nTopPadding=1\n#The padding on the bottom dock edge, in tenths of a percent of IconSize.\nBottomPadding=1\n#The padding between items on the dock, in tenths of a percent of IconSize.\nItemPadding=4\n#The size of item indicators, in tenths of a percent of IconSize.\nIndicatorSize=0\n#The size of the icon-shadow behind every item, in tenths of a percent of IconSize.\nIconShadowSize=0\n#The height (in percent of IconSize) to bounce an icon when the application sets urgent.\nUrgentBounceHeight=0.10000000000000001\n#The height (in percent of IconSize) to bounce an icon when launching an application.\nLaunchBounceHeight=0.10000000000000001\n#The opacity value (0 to 1) to fade the dock to when hiding it.\nFadeOpacity=0\n#The amount of time (in ms) for click animations.\nClickTime=150\n#The amount of time (in ms) to bounce an urgent icon.\nUrgentBounceTime=300\n#The amount of time (in ms) to bounce an icon when launching an application.\nLaunchBounceTime=300\n#The amount of time (in ms) for active window indicator animations.\nActiveTime=150\n#The amount of time (in ms) to slide icons into/out of the dock.\nSlideTime=150\n#The time (in ms) to fade the dock in/out on a hide (if FadeOpacity is &lt; 1).\nFadeTime=100\n#The time (in ms) to slide the dock in/out on a hide (if FadeOpacity is 1).\nHideTime=100\n#The size of the urgent glow (shown when dock is hidden), in tenths of a percent of IconSize.\nGlowSize=30\n#The total time (in ms) to show the hidden-dock urgent glow.\nGlowTime=10000\n#The time (in ms) of each pulse of the hidden-dock urgent glow.\nGlowPulseTime=2000\n#The hue-shift (-180 to 180) of the urgent indicator color.\nUrgentHueShift=150\n#The time (in ms) to move an item to its new position.\nItemMoveTime=150\n```\n```language\n#This theme written by Perian. thexperian.deviantart.com\n\n[PlankDrawingTheme]\nTopRoundness=3\nLineWidth=0\nOuterStrokeColor=0;;0;;0;;0\nFillStartColor=0;;0;;0;;150\nFillEndColor=0;;0;;0;;150\nInnerStrokeColor=0;;0;;0;;0\n\n```\n\n以上是我折腾的结果，找主题也找了半天。大家如果有更好的主题与壁纸也拿来分享一下吧。\n\n","slug":"kde-to-mac","published":1,"updated":"2019-10-11T05:50:15.681Z","_id":"ciz5e9l1t003w5rgxge72vaj8","comments":1,"layout":"post","photos":[],"link":"","content":"<p>惯例，先上图：</p>\n<p><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9-1024x575.png\" alt=\"logo9\"></a><br><a id=\"more\"></a><br><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5-1024x575.png\" alt=\"logo5\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6-1024x575.png\" alt=\"logo6\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7-1024x575.png\" alt=\"logo7\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8-1024x575.png\" alt=\"logo8\"></a></p>\n<p>首先，KDE的全局菜单可以参考我以前的文章《<a href=\"http://kevinsfork.info/2014/10/31/kde4-e7-9a-84-e9-85-8d-e7-bd-ae-e5-8f-82-e8-80-83/\" target=\"_blank\" rel=\"noopener\">KDE4的配置参考</a>》。</p>\n<p>然后，Plasma的主题是AG-plasma，aurorae主题是Yoxydaze-light。这些可以去kde-look里找。</p>\n<p>底部的dock是plank，主题是ArHU，在deviantART中找到的。另外，plank上的图标是受gtk主题控制的，所以装numix-circle是最好不过的。</p>\n<p>我的apps文件可以在这里下载：<a href=\"http://pan.baidu.com/s/1hqGJDmk\" target=\"_blank\" rel=\"noopener\">click here</a></p>\n<p>~/.config/plank/dock1/settings文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#This file auto-generated by Plank.</span><br><span class=\"line\">#2014-12-06T09:47:52+0000</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDockPreferences]</span><br><span class=\"line\">#Whether to show only windows of the current workspace.</span><br><span class=\"line\">CurrentWorkspaceOnly=false</span><br><span class=\"line\">#The size of dock icons (in pixels).</span><br><span class=\"line\">IconSize=42</span><br><span class=\"line\">#If 0, the dock won&apos;t hide. If 1, the dock intelligently hides. If 2, the dock auto-hides. If 3, the dock dodges active maximized windows.</span><br><span class=\"line\">HideMode=0</span><br><span class=\"line\">#Time (in ms) to wait before unhiding the dock.</span><br><span class=\"line\">UnhideDelay=0</span><br><span class=\"line\">#The monitor number for the dock. Use -1 to keep on the primary monitor.</span><br><span class=\"line\">Monitor=-1</span><br><span class=\"line\">#List of *.dockitem files on this dock. DO NOT MODIFY</span><br><span class=\"line\">DockItems=plank.dockitem;;google-chrome.dockitem;;dolphin.dockitem;;juk.dockitem;;eclipse.dockitem;;chrome-pjkebmlmkppdjcdcilfcjdkifljollfd-Default.dockitem;;kate.dockitem;;gwenview.dockitem;;wps-office-wps.dockitem;;konsole.dockitem;;sublime_text_3.dockitem;;love-wallpaper.dockitem;;ksysguard.dockitem;;virtualbox.dockitem</span><br><span class=\"line\">#The position for the dock on the monitor. If 0, left. If 1, right. If 2, top. If 3, bottom.</span><br><span class=\"line\">Position=3</span><br><span class=\"line\">#The dock&apos;s position offset from center (in percent).</span><br><span class=\"line\">Offset=0</span><br><span class=\"line\">#The name of the dock&apos;s theme to use.</span><br><span class=\"line\">Theme=ArHU</span><br><span class=\"line\">#The alignment for the dock on the monitor&apos;s edge. If 0, panel-mode. If 1, left-aligned. If 2, right-aligned. If 3, centered.</span><br><span class=\"line\">Alignment=3</span><br><span class=\"line\">#The alignment of the items in this dock if panel-mode is used. If 1, left-aligned. If 2, right-aligned. If 3, centered.</span><br><span class=\"line\">ItemsAlignment=3</span><br><span class=\"line\">#Whether to prevent drag&apos;n&apos;drop actions and lock items on the dock.</span><br><span class=\"line\">LockItems=false</span><br><span class=\"line\">#Whether to use pressure-based revealing of the dock if the support is available.</span><br><span class=\"line\">PressureReveal=false</span><br><span class=\"line\">#Whether to show only pinned applications. Useful for running more then one dock.</span><br><span class=\"line\">PinnedOnly=true</span><br><span class=\"line\">#Whether to automatically pin an application if it seems useful to do.</span><br><span class=\"line\">AutoPinning=true</span><br></pre></td></tr></table></figure></p>\n<p>~/.local/share/plank/themes/ArHU/中的dock.theme和hover.theme文件分别是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#This file auto-generated by Plank.</span><br><span class=\"line\">#2014-12-06T06:22:37+0000</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDrawingTheme]</span><br><span class=\"line\">#The roundness of the top corners.</span><br><span class=\"line\">TopRoundness=6</span><br><span class=\"line\">#The roundness of the bottom corners.</span><br><span class=\"line\">BottomRoundness=0</span><br><span class=\"line\">#The thickness (in pixels) of lines drawn.</span><br><span class=\"line\">LineWidth=0</span><br><span class=\"line\">#The color (RGBA) of the outer stroke.</span><br><span class=\"line\">OuterStrokeColor=0;;0;;0;;0</span><br><span class=\"line\">#The starting color (RGBA) of the fill gradient.</span><br><span class=\"line\">FillStartColor=255;;255;;255;;150</span><br><span class=\"line\">#The ending color (RGBA) of the fill gradient.</span><br><span class=\"line\">FillEndColor=255;;255;;255;;150</span><br><span class=\"line\">#The color (RGBA) of the inner stroke.</span><br><span class=\"line\">InnerStrokeColor=255;;255;;255;;255</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDrawingDockTheme]</span><br><span class=\"line\">#The padding on the left/right dock edges, in tenths of a percent of IconSize.</span><br><span class=\"line\">HorizPadding=0</span><br><span class=\"line\">#The padding on the top dock edge, in tenths of a percent of IconSize.</span><br><span class=\"line\">TopPadding=1</span><br><span class=\"line\">#The padding on the bottom dock edge, in tenths of a percent of IconSize.</span><br><span class=\"line\">BottomPadding=1</span><br><span class=\"line\">#The padding between items on the dock, in tenths of a percent of IconSize.</span><br><span class=\"line\">ItemPadding=4</span><br><span class=\"line\">#The size of item indicators, in tenths of a percent of IconSize.</span><br><span class=\"line\">IndicatorSize=0</span><br><span class=\"line\">#The size of the icon-shadow behind every item, in tenths of a percent of IconSize.</span><br><span class=\"line\">IconShadowSize=0</span><br><span class=\"line\">#The height (in percent of IconSize) to bounce an icon when the application sets urgent.</span><br><span class=\"line\">UrgentBounceHeight=0.10000000000000001</span><br><span class=\"line\">#The height (in percent of IconSize) to bounce an icon when launching an application.</span><br><span class=\"line\">LaunchBounceHeight=0.10000000000000001</span><br><span class=\"line\">#The opacity value (0 to 1) to fade the dock to when hiding it.</span><br><span class=\"line\">FadeOpacity=0</span><br><span class=\"line\">#The amount of time (in ms) for click animations.</span><br><span class=\"line\">ClickTime=150</span><br><span class=\"line\">#The amount of time (in ms) to bounce an urgent icon.</span><br><span class=\"line\">UrgentBounceTime=300</span><br><span class=\"line\">#The amount of time (in ms) to bounce an icon when launching an application.</span><br><span class=\"line\">LaunchBounceTime=300</span><br><span class=\"line\">#The amount of time (in ms) for active window indicator animations.</span><br><span class=\"line\">ActiveTime=150</span><br><span class=\"line\">#The amount of time (in ms) to slide icons into/out of the dock.</span><br><span class=\"line\">SlideTime=150</span><br><span class=\"line\">#The time (in ms) to fade the dock in/out on a hide (if FadeOpacity is &amp;lt; 1).</span><br><span class=\"line\">FadeTime=100</span><br><span class=\"line\">#The time (in ms) to slide the dock in/out on a hide (if FadeOpacity is 1).</span><br><span class=\"line\">HideTime=100</span><br><span class=\"line\">#The size of the urgent glow (shown when dock is hidden), in tenths of a percent of IconSize.</span><br><span class=\"line\">GlowSize=30</span><br><span class=\"line\">#The total time (in ms) to show the hidden-dock urgent glow.</span><br><span class=\"line\">GlowTime=10000</span><br><span class=\"line\">#The time (in ms) of each pulse of the hidden-dock urgent glow.</span><br><span class=\"line\">GlowPulseTime=2000</span><br><span class=\"line\">#The hue-shift (-180 to 180) of the urgent indicator color.</span><br><span class=\"line\">UrgentHueShift=150</span><br><span class=\"line\">#The time (in ms) to move an item to its new position.</span><br><span class=\"line\">ItemMoveTime=150</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#This theme written by Perian. thexperian.deviantart.com</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDrawingTheme]</span><br><span class=\"line\">TopRoundness=3</span><br><span class=\"line\">LineWidth=0</span><br><span class=\"line\">OuterStrokeColor=0;;0;;0;;0</span><br><span class=\"line\">FillStartColor=0;;0;;0;;150</span><br><span class=\"line\">FillEndColor=0;;0;;0;;150</span><br><span class=\"line\">InnerStrokeColor=0;;0;;0;;0</span><br></pre></td></tr></table></figure>\n<p>以上是我折腾的结果，找主题也找了半天。大家如果有更好的主题与壁纸也拿来分享一下吧。</p>\n","site":{"data":{}},"excerpt":"<p>惯例，先上图：</p>\n<p><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo9-1024x575.png\" alt=\"logo9\"></a><br>","more":"<br><a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo5-1024x575.png\" alt=\"logo5\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo6-1024x575.png\" alt=\"logo6\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo7-1024x575.png\" alt=\"logo7\"></a> <a href=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://sforkw-wp.qiniudn.com/jae/uploads/2014/12/logo8-1024x575.png\" alt=\"logo8\"></a></p>\n<p>首先，KDE的全局菜单可以参考我以前的文章《<a href=\"http://kevinsfork.info/2014/10/31/kde4-e7-9a-84-e9-85-8d-e7-bd-ae-e5-8f-82-e8-80-83/\" target=\"_blank\" rel=\"noopener\">KDE4的配置参考</a>》。</p>\n<p>然后，Plasma的主题是AG-plasma，aurorae主题是Yoxydaze-light。这些可以去kde-look里找。</p>\n<p>底部的dock是plank，主题是ArHU，在deviantART中找到的。另外，plank上的图标是受gtk主题控制的，所以装numix-circle是最好不过的。</p>\n<p>我的apps文件可以在这里下载：<a href=\"http://pan.baidu.com/s/1hqGJDmk\" target=\"_blank\" rel=\"noopener\">click here</a></p>\n<p>~/.config/plank/dock1/settings文件：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#This file auto-generated by Plank.</span><br><span class=\"line\">#2014-12-06T09:47:52+0000</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDockPreferences]</span><br><span class=\"line\">#Whether to show only windows of the current workspace.</span><br><span class=\"line\">CurrentWorkspaceOnly=false</span><br><span class=\"line\">#The size of dock icons (in pixels).</span><br><span class=\"line\">IconSize=42</span><br><span class=\"line\">#If 0, the dock won&apos;t hide. If 1, the dock intelligently hides. If 2, the dock auto-hides. If 3, the dock dodges active maximized windows.</span><br><span class=\"line\">HideMode=0</span><br><span class=\"line\">#Time (in ms) to wait before unhiding the dock.</span><br><span class=\"line\">UnhideDelay=0</span><br><span class=\"line\">#The monitor number for the dock. Use -1 to keep on the primary monitor.</span><br><span class=\"line\">Monitor=-1</span><br><span class=\"line\">#List of *.dockitem files on this dock. DO NOT MODIFY</span><br><span class=\"line\">DockItems=plank.dockitem;;google-chrome.dockitem;;dolphin.dockitem;;juk.dockitem;;eclipse.dockitem;;chrome-pjkebmlmkppdjcdcilfcjdkifljollfd-Default.dockitem;;kate.dockitem;;gwenview.dockitem;;wps-office-wps.dockitem;;konsole.dockitem;;sublime_text_3.dockitem;;love-wallpaper.dockitem;;ksysguard.dockitem;;virtualbox.dockitem</span><br><span class=\"line\">#The position for the dock on the monitor. If 0, left. If 1, right. If 2, top. If 3, bottom.</span><br><span class=\"line\">Position=3</span><br><span class=\"line\">#The dock&apos;s position offset from center (in percent).</span><br><span class=\"line\">Offset=0</span><br><span class=\"line\">#The name of the dock&apos;s theme to use.</span><br><span class=\"line\">Theme=ArHU</span><br><span class=\"line\">#The alignment for the dock on the monitor&apos;s edge. If 0, panel-mode. If 1, left-aligned. If 2, right-aligned. If 3, centered.</span><br><span class=\"line\">Alignment=3</span><br><span class=\"line\">#The alignment of the items in this dock if panel-mode is used. If 1, left-aligned. If 2, right-aligned. If 3, centered.</span><br><span class=\"line\">ItemsAlignment=3</span><br><span class=\"line\">#Whether to prevent drag&apos;n&apos;drop actions and lock items on the dock.</span><br><span class=\"line\">LockItems=false</span><br><span class=\"line\">#Whether to use pressure-based revealing of the dock if the support is available.</span><br><span class=\"line\">PressureReveal=false</span><br><span class=\"line\">#Whether to show only pinned applications. Useful for running more then one dock.</span><br><span class=\"line\">PinnedOnly=true</span><br><span class=\"line\">#Whether to automatically pin an application if it seems useful to do.</span><br><span class=\"line\">AutoPinning=true</span><br></pre></td></tr></table></figure></p>\n<p>~/.local/share/plank/themes/ArHU/中的dock.theme和hover.theme文件分别是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#This file auto-generated by Plank.</span><br><span class=\"line\">#2014-12-06T06:22:37+0000</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDrawingTheme]</span><br><span class=\"line\">#The roundness of the top corners.</span><br><span class=\"line\">TopRoundness=6</span><br><span class=\"line\">#The roundness of the bottom corners.</span><br><span class=\"line\">BottomRoundness=0</span><br><span class=\"line\">#The thickness (in pixels) of lines drawn.</span><br><span class=\"line\">LineWidth=0</span><br><span class=\"line\">#The color (RGBA) of the outer stroke.</span><br><span class=\"line\">OuterStrokeColor=0;;0;;0;;0</span><br><span class=\"line\">#The starting color (RGBA) of the fill gradient.</span><br><span class=\"line\">FillStartColor=255;;255;;255;;150</span><br><span class=\"line\">#The ending color (RGBA) of the fill gradient.</span><br><span class=\"line\">FillEndColor=255;;255;;255;;150</span><br><span class=\"line\">#The color (RGBA) of the inner stroke.</span><br><span class=\"line\">InnerStrokeColor=255;;255;;255;;255</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDrawingDockTheme]</span><br><span class=\"line\">#The padding on the left/right dock edges, in tenths of a percent of IconSize.</span><br><span class=\"line\">HorizPadding=0</span><br><span class=\"line\">#The padding on the top dock edge, in tenths of a percent of IconSize.</span><br><span class=\"line\">TopPadding=1</span><br><span class=\"line\">#The padding on the bottom dock edge, in tenths of a percent of IconSize.</span><br><span class=\"line\">BottomPadding=1</span><br><span class=\"line\">#The padding between items on the dock, in tenths of a percent of IconSize.</span><br><span class=\"line\">ItemPadding=4</span><br><span class=\"line\">#The size of item indicators, in tenths of a percent of IconSize.</span><br><span class=\"line\">IndicatorSize=0</span><br><span class=\"line\">#The size of the icon-shadow behind every item, in tenths of a percent of IconSize.</span><br><span class=\"line\">IconShadowSize=0</span><br><span class=\"line\">#The height (in percent of IconSize) to bounce an icon when the application sets urgent.</span><br><span class=\"line\">UrgentBounceHeight=0.10000000000000001</span><br><span class=\"line\">#The height (in percent of IconSize) to bounce an icon when launching an application.</span><br><span class=\"line\">LaunchBounceHeight=0.10000000000000001</span><br><span class=\"line\">#The opacity value (0 to 1) to fade the dock to when hiding it.</span><br><span class=\"line\">FadeOpacity=0</span><br><span class=\"line\">#The amount of time (in ms) for click animations.</span><br><span class=\"line\">ClickTime=150</span><br><span class=\"line\">#The amount of time (in ms) to bounce an urgent icon.</span><br><span class=\"line\">UrgentBounceTime=300</span><br><span class=\"line\">#The amount of time (in ms) to bounce an icon when launching an application.</span><br><span class=\"line\">LaunchBounceTime=300</span><br><span class=\"line\">#The amount of time (in ms) for active window indicator animations.</span><br><span class=\"line\">ActiveTime=150</span><br><span class=\"line\">#The amount of time (in ms) to slide icons into/out of the dock.</span><br><span class=\"line\">SlideTime=150</span><br><span class=\"line\">#The time (in ms) to fade the dock in/out on a hide (if FadeOpacity is &amp;lt; 1).</span><br><span class=\"line\">FadeTime=100</span><br><span class=\"line\">#The time (in ms) to slide the dock in/out on a hide (if FadeOpacity is 1).</span><br><span class=\"line\">HideTime=100</span><br><span class=\"line\">#The size of the urgent glow (shown when dock is hidden), in tenths of a percent of IconSize.</span><br><span class=\"line\">GlowSize=30</span><br><span class=\"line\">#The total time (in ms) to show the hidden-dock urgent glow.</span><br><span class=\"line\">GlowTime=10000</span><br><span class=\"line\">#The time (in ms) of each pulse of the hidden-dock urgent glow.</span><br><span class=\"line\">GlowPulseTime=2000</span><br><span class=\"line\">#The hue-shift (-180 to 180) of the urgent indicator color.</span><br><span class=\"line\">UrgentHueShift=150</span><br><span class=\"line\">#The time (in ms) to move an item to its new position.</span><br><span class=\"line\">ItemMoveTime=150</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#This theme written by Perian. thexperian.deviantart.com</span><br><span class=\"line\"></span><br><span class=\"line\">[PlankDrawingTheme]</span><br><span class=\"line\">TopRoundness=3</span><br><span class=\"line\">LineWidth=0</span><br><span class=\"line\">OuterStrokeColor=0;;0;;0;;0</span><br><span class=\"line\">FillStartColor=0;;0;;0;;150</span><br><span class=\"line\">FillEndColor=0;;0;;0;;150</span><br><span class=\"line\">InnerStrokeColor=0;;0;;0;;0</span><br></pre></td></tr></table></figure>\n<p>以上是我折腾的结果，找主题也找了半天。大家如果有更好的主题与壁纸也拿来分享一下吧。</p>"},{"title":"网易云音乐新API简述","date":"2017-02-07T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n\n新API采用了略微修改过的AES和RSA加密，主要用在登陆接口上，对新API进行简单的分析。\n## Url\n估计会抓包的人都知道，Url中的api便成了weapi。比如手机登录：\n原来是：`http://music.163.com/api/login/cellphone/`\n现在是：`http://music.163.com/weapi/login/cellphone/`\n\n## 加密算法\n核心过程如下：\n```Javascript\n aesRsaEncrypt = function (text, pubKey, modulus, nonce) {\n  const secKey = createSecretKey(16);  // 随机生成16位加密密钥\n  return {\n\tparams:  aesEncrypt(aesEncrypt(text, nonce), secKey),\n\tencSecKey: rsaEncrypt(secKey, pubKey, modulus)\n  }\n}\n```\n<!--more-->\n```javascript\n{\n\tText : \"JSON.stringify({phone:xxx,password:\"md5 hashed Data\",rememberLogin:\"true\"})\" //需要加密的post body\n\tpubKey : \"010001\"\n\tnonce : \"0CoJUm6Qyw8W8jud\"\n\tmodulus : \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\n}\n```\n\n### 一些细节\n1. AES加密的具体算法为:AES-128-CBC，输出格式为base64。\n2. AES加密时需要指定iv：`0102030405060708`\n3. RSA加密输出为Hex格式，公钥是`{N:modulus,e:pubKey}`\n4. 我的Javascript实现：[Crypto](https://github.com/stkevintan/Cube/blob/master/src/model/Crypto.js)\n5. RSA算法的JS实现方法参考：<http://www.cnblogs.com/kxdhm/archive/2012/02/02/2336103.html>\n\n","source":"_posts/netease-music-api.md","raw":"---\ntitle: 网易云音乐新API简述\ndate: 2017-2-8\ntags: [网易云音乐,API,Encryption]\ncategories: [Web]\ngrammar_cjkRuby: true\n---\n\n\n新API采用了略微修改过的AES和RSA加密，主要用在登陆接口上，对新API进行简单的分析。\n## Url\n估计会抓包的人都知道，Url中的api便成了weapi。比如手机登录：\n原来是：`http://music.163.com/api/login/cellphone/`\n现在是：`http://music.163.com/weapi/login/cellphone/`\n\n## 加密算法\n核心过程如下：\n```Javascript\n aesRsaEncrypt = function (text, pubKey, modulus, nonce) {\n  const secKey = createSecretKey(16);  // 随机生成16位加密密钥\n  return {\n\tparams:  aesEncrypt(aesEncrypt(text, nonce), secKey),\n\tencSecKey: rsaEncrypt(secKey, pubKey, modulus)\n  }\n}\n```\n<!--more-->\n```javascript\n{\n\tText : \"JSON.stringify({phone:xxx,password:\"md5 hashed Data\",rememberLogin:\"true\"})\" //需要加密的post body\n\tpubKey : \"010001\"\n\tnonce : \"0CoJUm6Qyw8W8jud\"\n\tmodulus : \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"\n}\n```\n\n### 一些细节\n1. AES加密的具体算法为:AES-128-CBC，输出格式为base64。\n2. AES加密时需要指定iv：`0102030405060708`\n3. RSA加密输出为Hex格式，公钥是`{N:modulus,e:pubKey}`\n4. 我的Javascript实现：[Crypto](https://github.com/stkevintan/Cube/blob/master/src/model/Crypto.js)\n5. RSA算法的JS实现方法参考：<http://www.cnblogs.com/kxdhm/archive/2012/02/02/2336103.html>\n\n","slug":"netease-music-api","published":1,"updated":"2019-10-11T05:50:15.685Z","_id":"ciz5e9l1v003y5rgxpr7jpvgd","comments":1,"layout":"post","photos":[],"link":"","content":"<p>新API采用了略微修改过的AES和RSA加密，主要用在登陆接口上，对新API进行简单的分析。</p>\n<h2 id=\"Url\"><a href=\"#Url\" class=\"headerlink\" title=\"Url\"></a>Url</h2><p>估计会抓包的人都知道，Url中的api便成了weapi。比如手机登录：<br>原来是：<code>http://music.163.com/api/login/cellphone/</code><br>现在是：<code>http://music.163.com/weapi/login/cellphone/</code></p>\n<h2 id=\"加密算法\"><a href=\"#加密算法\" class=\"headerlink\" title=\"加密算法\"></a>加密算法</h2><p>核心过程如下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> aesRsaEncrypt = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">text, pubKey, modulus, nonce</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> secKey = createSecretKey(<span class=\"number\">16</span>);  <span class=\"comment\">// 随机生成16位加密密钥</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">\tparams:  aesEncrypt(aesEncrypt(text, nonce), secKey),</span><br><span class=\"line\">\tencSecKey: rsaEncrypt(secKey, pubKey, modulus)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\tText : <span class=\"string\">\"JSON.stringify(&#123;phone:xxx,password:\"</span>md5 hashed Data<span class=\"string\">\",rememberLogin:\"</span><span class=\"literal\">true</span><span class=\"string\">\"&#125;)\"</span> <span class=\"comment\">//需要加密的post body</span></span><br><span class=\"line\">\tpubKey : <span class=\"string\">\"010001\"</span></span><br><span class=\"line\">\tnonce : <span class=\"string\">\"0CoJUm6Qyw8W8jud\"</span></span><br><span class=\"line\">\tmodulus : <span class=\"string\">\"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"一些细节\"><a href=\"#一些细节\" class=\"headerlink\" title=\"一些细节\"></a>一些细节</h3><ol>\n<li>AES加密的具体算法为:AES-128-CBC，输出格式为base64。</li>\n<li>AES加密时需要指定iv：<code>0102030405060708</code></li>\n<li>RSA加密输出为Hex格式，公钥是<code>{N:modulus,e:pubKey}</code></li>\n<li>我的Javascript实现：<a href=\"https://github.com/stkevintan/Cube/blob/master/src/model/Crypto.js\" target=\"_blank\" rel=\"noopener\">Crypto</a></li>\n<li>RSA算法的JS实现方法参考：<a href=\"http://www.cnblogs.com/kxdhm/archive/2012/02/02/2336103.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/kxdhm/archive/2012/02/02/2336103.html</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>新API采用了略微修改过的AES和RSA加密，主要用在登陆接口上，对新API进行简单的分析。</p>\n<h2 id=\"Url\"><a href=\"#Url\" class=\"headerlink\" title=\"Url\"></a>Url</h2><p>估计会抓包的人都知道，Url中的api便成了weapi。比如手机登录：<br>原来是：<code>http://music.163.com/api/login/cellphone/</code><br>现在是：<code>http://music.163.com/weapi/login/cellphone/</code></p>\n<h2 id=\"加密算法\"><a href=\"#加密算法\" class=\"headerlink\" title=\"加密算法\"></a>加密算法</h2><p>核心过程如下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> aesRsaEncrypt = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">text, pubKey, modulus, nonce</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> secKey = createSecretKey(<span class=\"number\">16</span>);  <span class=\"comment\">// 随机生成16位加密密钥</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">\tparams:  aesEncrypt(aesEncrypt(text, nonce), secKey),</span><br><span class=\"line\">\tencSecKey: rsaEncrypt(secKey, pubKey, modulus)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>","more":"<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\tText : <span class=\"string\">\"JSON.stringify(&#123;phone:xxx,password:\"</span>md5 hashed Data<span class=\"string\">\",rememberLogin:\"</span><span class=\"literal\">true</span><span class=\"string\">\"&#125;)\"</span> <span class=\"comment\">//需要加密的post body</span></span><br><span class=\"line\">\tpubKey : <span class=\"string\">\"010001\"</span></span><br><span class=\"line\">\tnonce : <span class=\"string\">\"0CoJUm6Qyw8W8jud\"</span></span><br><span class=\"line\">\tmodulus : <span class=\"string\">\"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"一些细节\"><a href=\"#一些细节\" class=\"headerlink\" title=\"一些细节\"></a>一些细节</h3><ol>\n<li>AES加密的具体算法为:AES-128-CBC，输出格式为base64。</li>\n<li>AES加密时需要指定iv：<code>0102030405060708</code></li>\n<li>RSA加密输出为Hex格式，公钥是<code>{N:modulus,e:pubKey}</code></li>\n<li>我的Javascript实现：<a href=\"https://github.com/stkevintan/Cube/blob/master/src/model/Crypto.js\" target=\"_blank\" rel=\"noopener\">Crypto</a></li>\n<li>RSA算法的JS实现方法参考：<a href=\"http://www.cnblogs.com/kxdhm/archive/2012/02/02/2336103.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/kxdhm/archive/2012/02/02/2336103.html</a></li>\n</ol>"},{"title":"(转)慢慢的，就没有了，就像从未存在过","date":"2014-11-27T16:24:29.000Z","_content":"几年以前，我曾经嘲笑过某科技界大佬。当时他说：也许90后、95后会慢慢不知道谷歌是什么网站。\n\n　　那一年，这对于我来说简直就是世界上最好笑的笑话。谷歌，全世界最卓越的互联网公司，活在互联网的一代中国人，会不知道他们的网站？\n\n　　今天，我收回这句嘲笑。因为这件不可能的事，它慢慢变成了现实。\n\n　　没有人再关注什么谷歌不谷歌。对他们来说，百度也蛮好用的，反正他们几乎没用过谷歌。没有谷歌又怎样？大家还是开心的刷微博，看微信，听歌，看娱乐节目。对于从来就不知道谷歌的人来说，少了谷歌又有什么影响？\n\n![慢慢的，就没有了，就像从未存在过](http://www.williamlong.info/upload/4058_1.jpg)\n<!--more-->\n　　多年前，我们也是可以登陆Facebook的。其实这个网站和校内一样，也挺蠢的。可在上面你能看到老外们的生活，可以轻易的跟一万公里以外的人互相拜访，可以看到很多根本不会开到校内上的主页。你用汉语回复，下面给你聊起来的可能是香港仔，可能是台湾人。你用英语回复，说不定有比你英语用的更蹩脚的寂寞的北欧人来跟你搭讪。你感觉地球真的变成了地球村，你还没拉门走出去，别人就推门走了进来。\n\n　　然后，它就没有了。起初，它的失踪激起了很大的声音，后来，声音就消失了。\n\n　　多年前，我们也是可以登陆Twitter的。其实这个网站和微博一样，也不过是些信息流，刷上一整天，也不见得有什么用处。但至少，你可以以最快速度获取你想知道的任何新事，你会真正了解什么事情在全世界是流行的，而不是经过各种截图、翻译、转发，甚至曲解、断章取义、黑白颠倒的东西。你知道的是真相，赤裸裸的，也许有点太短的真相。但至少中间不会有无数人的加工与再加工，偏激、片面，就在这个过程中产生了，不管后来者有意还是无意。\n\n　　然后，它就没有了。首先是它的本体没有了，然后它的模仿者也没有了，模仿者的模仿者也没有了。只剩一个模仿者的模仿者的模仿者，现在你每天能在上面看到无数广告。\n\n　　多年前，我们也是可以登陆YouTube的。对于有的人来说，这个网站就是个大型优酷，当年有人信誓旦旦的说，没有YouTube，我们中国人会很快让优酷超过YouTube。可这么多年过去了，视频还是那么卡，内容还是那么垃圾，原创还是那么容易被盗窃，视频丰富度还是那么的可怜。在YouTube上，你能看到全世界最棒的手艺人，最逗乐的笑话，最天马行空的创意，最激荡人心的音乐，最美好的完美瞬间，可在优酷上，你想看一分钟视频，请先看半分钟广告。\n\n　　哦，对了。Instagram，有些人可能感觉它和QQ空间也差不多。可我在上面关注了六百多个摄影师，它们都是顶好顶好的影像记录者，每天看他们的作品，我感觉到很幸福，那种即使没有到那里去，也身临其境的幸福。我还在上面认识了一个日本的爱自拍的帅小伙，一个爱喝酒的韩国大叔，一个十年前到过中国今天会在每张我发的紫禁城照片下点赞的美国大爷，一个美丽无比的俄罗斯妹子，我和他们基本上都难以交流，语言是很大的障碍，但几个简单的单词，心意也就到了，这种感觉，有时候比多年老友相聚还兴奋。因为这是人类不同族群自由交流互相沟通的过程，这种过程很神奇，真的很神奇。\n\n　　可现在，它没有了，它之所以没有就因为在某个特定的时间你在搜索特定的词汇时，会搜出来特定的照片。虽然这么搜的人并不多，虽然看到的人也不会大惊小怪，也不会觉得天黑了，天亮了，天要塌了，天要变了。可它就是没了，Instagram，就这么没了。谷歌也是这么没的，Twitter也是这么没的，Facebook也是这么没的。不知道是什么人，在什么场合，说了什么话，下了什么决定。就要有超过十亿人像陷于哥谭市的孤岛里一样，看着一座又一座桥梁被炸掉，又被炸掉，又被炸掉，然后，就什么都没了。\n\n　　我时常觉得悲哀，真的好悲哀，一个我根本不认识也不知道是谁的人，也许是一个群体，在不断抢走我身边的东西，而我却无能为力。我抱怨一声，他听不到，任何人都听不到。我怒吼一句，身边的大多数人却像看疯子一样的看着我。我哀嚎一声，这声音被阻碍在黑黑的幕墙以里。我发出尖锐的嘶吼，这声音传不了多远，就和我那被抢走的东西一样，消失了，不见了，就像从来没存在过一样。\n\n　　对于本来就没存在过的东西，有谁又会觉得在意呢？那些本来拥有又被掠夺的人的哀愁，后来的人又怎么懂呢？我曾经是拥有一切的，我曾经是拥有世界的，我站在这片土地上，呼吸的是自由的空气，饮下的是自由的琼浆玉液。就在长的无法计数的时间里，我自由生命的一部分又一部分就这么被杀死了，突然就杀死了。可我还始终觉得，它们还奄奄一息的活着，就像它们是慢慢的死去的一样。\n\n　　可它们终归是死了，而且随着它们的死，愈来愈多的事情慢慢的发生了，很慢很慢，几乎不被人察觉，可还是发生了。\n\n　　没有谷歌，我可以用百度呀。可某些结果被越挪越后，越挪越后，最后就不见了。就像本来就不该搜出这个结果一样。\n\n　　没有Facebook，我可以用校内呀。可你想发只有在Facebook上能发的文章，很快在校内上就失踪了。接着，校内变成了人人，话题变成了人人都关心的话题。大家都在抢着看星座、明星、八卦、娱乐。没有人会关心什么消失了，反正它们本来也没多少存在感。\n\n　　没有YouTube，我可以用优酷呀。可你却经常只能在优酷上看到抄袭别人的作品，而且还不署名，而且还洋洋得意，而且还自我陶醉，就好像那个idea本来属于他自己一样。你看了还要惊呼，他是如此的有创意！好一个抄袭的创意，可你却不知道，因为你不知道这个世界上有个网站叫YouTube。\n\n　　没有Twitter，我还可以用微博呀。可你想知道最近发生了什么，你搜的越勤快，越能看到越明显的“根据相关法律法规，相关搜索结果不予显示”。时间长了，你想，反正知道了也没什么用，不如不看了。\n\n　　慢慢的，一扇又一扇的门关上了。今天你打开世界上最大的博客网站，发现它没了。明天你一看，世界上最好的设计师分享网站没了，一开始是刷新的很慢很慢，后来它就没了。过两天再一看，平常每天都会读两篇文章的媒体网站没了，那里的文章缤纷多彩，最后都变成了该页无法显示几个字。再过几个月，大学的网站不让上了，摄影师的网站不让上了，就连百度日本这种自家网站，也没了。\n\n　　接着，漫画看不了了，接着，动画看不成了。接着，美剧英剧失踪了。下载美剧英剧的网站又又又失踪了。尊重正版，保护权益，行吧，然后字幕网站也没了。\n\n　　游戏没了，你习惯性登陆的游戏网站，发现下载栏正在整治中。论坛关了，天天都在看的论坛，突然接到相关部门的电话，因为“报备问题”不让办了。个人网站，私人博客，对不起，说没就没有，你在上面存了多少多年辛勤耕耘的东西都没用。\n\n　　你关注的人，有一天你登陆微博，发现他怎么好久都没说话了，然后你搜索了一下，发现他的账号不存在了，而且你搜他的名字，他的名字未予显示。\n\n　　一盏一盏的灯，灭了。四面八方的光源，消失了。我们生活的五光十色的世界，变成了一片黑色。\n\n　　天黑了，那么睡觉吧，但愿长醉不复醒。\n\n　　最后，我们变成了一群做梦的人，这个梦的名字，叫根据相关法律法规，相关搜索结果不予显示梦。\n\n　　作者：小海，来源：豆瓣网，[原文](http://www.douban.com/note/456932116/)已被和谐","source":"_posts/man-man-de.md","raw":"---\ntitle: (转)慢慢的，就没有了，就像从未存在过\ncategories: [GFW]\ndate: 2014-11-28 00:24:29\ntags: [只言片语]\n---\n几年以前，我曾经嘲笑过某科技界大佬。当时他说：也许90后、95后会慢慢不知道谷歌是什么网站。\n\n　　那一年，这对于我来说简直就是世界上最好笑的笑话。谷歌，全世界最卓越的互联网公司，活在互联网的一代中国人，会不知道他们的网站？\n\n　　今天，我收回这句嘲笑。因为这件不可能的事，它慢慢变成了现实。\n\n　　没有人再关注什么谷歌不谷歌。对他们来说，百度也蛮好用的，反正他们几乎没用过谷歌。没有谷歌又怎样？大家还是开心的刷微博，看微信，听歌，看娱乐节目。对于从来就不知道谷歌的人来说，少了谷歌又有什么影响？\n\n![慢慢的，就没有了，就像从未存在过](http://www.williamlong.info/upload/4058_1.jpg)\n<!--more-->\n　　多年前，我们也是可以登陆Facebook的。其实这个网站和校内一样，也挺蠢的。可在上面你能看到老外们的生活，可以轻易的跟一万公里以外的人互相拜访，可以看到很多根本不会开到校内上的主页。你用汉语回复，下面给你聊起来的可能是香港仔，可能是台湾人。你用英语回复，说不定有比你英语用的更蹩脚的寂寞的北欧人来跟你搭讪。你感觉地球真的变成了地球村，你还没拉门走出去，别人就推门走了进来。\n\n　　然后，它就没有了。起初，它的失踪激起了很大的声音，后来，声音就消失了。\n\n　　多年前，我们也是可以登陆Twitter的。其实这个网站和微博一样，也不过是些信息流，刷上一整天，也不见得有什么用处。但至少，你可以以最快速度获取你想知道的任何新事，你会真正了解什么事情在全世界是流行的，而不是经过各种截图、翻译、转发，甚至曲解、断章取义、黑白颠倒的东西。你知道的是真相，赤裸裸的，也许有点太短的真相。但至少中间不会有无数人的加工与再加工，偏激、片面，就在这个过程中产生了，不管后来者有意还是无意。\n\n　　然后，它就没有了。首先是它的本体没有了，然后它的模仿者也没有了，模仿者的模仿者也没有了。只剩一个模仿者的模仿者的模仿者，现在你每天能在上面看到无数广告。\n\n　　多年前，我们也是可以登陆YouTube的。对于有的人来说，这个网站就是个大型优酷，当年有人信誓旦旦的说，没有YouTube，我们中国人会很快让优酷超过YouTube。可这么多年过去了，视频还是那么卡，内容还是那么垃圾，原创还是那么容易被盗窃，视频丰富度还是那么的可怜。在YouTube上，你能看到全世界最棒的手艺人，最逗乐的笑话，最天马行空的创意，最激荡人心的音乐，最美好的完美瞬间，可在优酷上，你想看一分钟视频，请先看半分钟广告。\n\n　　哦，对了。Instagram，有些人可能感觉它和QQ空间也差不多。可我在上面关注了六百多个摄影师，它们都是顶好顶好的影像记录者，每天看他们的作品，我感觉到很幸福，那种即使没有到那里去，也身临其境的幸福。我还在上面认识了一个日本的爱自拍的帅小伙，一个爱喝酒的韩国大叔，一个十年前到过中国今天会在每张我发的紫禁城照片下点赞的美国大爷，一个美丽无比的俄罗斯妹子，我和他们基本上都难以交流，语言是很大的障碍，但几个简单的单词，心意也就到了，这种感觉，有时候比多年老友相聚还兴奋。因为这是人类不同族群自由交流互相沟通的过程，这种过程很神奇，真的很神奇。\n\n　　可现在，它没有了，它之所以没有就因为在某个特定的时间你在搜索特定的词汇时，会搜出来特定的照片。虽然这么搜的人并不多，虽然看到的人也不会大惊小怪，也不会觉得天黑了，天亮了，天要塌了，天要变了。可它就是没了，Instagram，就这么没了。谷歌也是这么没的，Twitter也是这么没的，Facebook也是这么没的。不知道是什么人，在什么场合，说了什么话，下了什么决定。就要有超过十亿人像陷于哥谭市的孤岛里一样，看着一座又一座桥梁被炸掉，又被炸掉，又被炸掉，然后，就什么都没了。\n\n　　我时常觉得悲哀，真的好悲哀，一个我根本不认识也不知道是谁的人，也许是一个群体，在不断抢走我身边的东西，而我却无能为力。我抱怨一声，他听不到，任何人都听不到。我怒吼一句，身边的大多数人却像看疯子一样的看着我。我哀嚎一声，这声音被阻碍在黑黑的幕墙以里。我发出尖锐的嘶吼，这声音传不了多远，就和我那被抢走的东西一样，消失了，不见了，就像从来没存在过一样。\n\n　　对于本来就没存在过的东西，有谁又会觉得在意呢？那些本来拥有又被掠夺的人的哀愁，后来的人又怎么懂呢？我曾经是拥有一切的，我曾经是拥有世界的，我站在这片土地上，呼吸的是自由的空气，饮下的是自由的琼浆玉液。就在长的无法计数的时间里，我自由生命的一部分又一部分就这么被杀死了，突然就杀死了。可我还始终觉得，它们还奄奄一息的活着，就像它们是慢慢的死去的一样。\n\n　　可它们终归是死了，而且随着它们的死，愈来愈多的事情慢慢的发生了，很慢很慢，几乎不被人察觉，可还是发生了。\n\n　　没有谷歌，我可以用百度呀。可某些结果被越挪越后，越挪越后，最后就不见了。就像本来就不该搜出这个结果一样。\n\n　　没有Facebook，我可以用校内呀。可你想发只有在Facebook上能发的文章，很快在校内上就失踪了。接着，校内变成了人人，话题变成了人人都关心的话题。大家都在抢着看星座、明星、八卦、娱乐。没有人会关心什么消失了，反正它们本来也没多少存在感。\n\n　　没有YouTube，我可以用优酷呀。可你却经常只能在优酷上看到抄袭别人的作品，而且还不署名，而且还洋洋得意，而且还自我陶醉，就好像那个idea本来属于他自己一样。你看了还要惊呼，他是如此的有创意！好一个抄袭的创意，可你却不知道，因为你不知道这个世界上有个网站叫YouTube。\n\n　　没有Twitter，我还可以用微博呀。可你想知道最近发生了什么，你搜的越勤快，越能看到越明显的“根据相关法律法规，相关搜索结果不予显示”。时间长了，你想，反正知道了也没什么用，不如不看了。\n\n　　慢慢的，一扇又一扇的门关上了。今天你打开世界上最大的博客网站，发现它没了。明天你一看，世界上最好的设计师分享网站没了，一开始是刷新的很慢很慢，后来它就没了。过两天再一看，平常每天都会读两篇文章的媒体网站没了，那里的文章缤纷多彩，最后都变成了该页无法显示几个字。再过几个月，大学的网站不让上了，摄影师的网站不让上了，就连百度日本这种自家网站，也没了。\n\n　　接着，漫画看不了了，接着，动画看不成了。接着，美剧英剧失踪了。下载美剧英剧的网站又又又失踪了。尊重正版，保护权益，行吧，然后字幕网站也没了。\n\n　　游戏没了，你习惯性登陆的游戏网站，发现下载栏正在整治中。论坛关了，天天都在看的论坛，突然接到相关部门的电话，因为“报备问题”不让办了。个人网站，私人博客，对不起，说没就没有，你在上面存了多少多年辛勤耕耘的东西都没用。\n\n　　你关注的人，有一天你登陆微博，发现他怎么好久都没说话了，然后你搜索了一下，发现他的账号不存在了，而且你搜他的名字，他的名字未予显示。\n\n　　一盏一盏的灯，灭了。四面八方的光源，消失了。我们生活的五光十色的世界，变成了一片黑色。\n\n　　天黑了，那么睡觉吧，但愿长醉不复醒。\n\n　　最后，我们变成了一群做梦的人，这个梦的名字，叫根据相关法律法规，相关搜索结果不予显示梦。\n\n　　作者：小海，来源：豆瓣网，[原文](http://www.douban.com/note/456932116/)已被和谐","slug":"man-man-de","published":1,"updated":"2019-10-11T05:50:15.683Z","_id":"ciz5e9l1w00435rgxcv5gdy3r","comments":1,"layout":"post","photos":[],"link":"","content":"<p>几年以前，我曾经嘲笑过某科技界大佬。当时他说：也许90后、95后会慢慢不知道谷歌是什么网站。</p>\n<p>　　那一年，这对于我来说简直就是世界上最好笑的笑话。谷歌，全世界最卓越的互联网公司，活在互联网的一代中国人，会不知道他们的网站？</p>\n<p>　　今天，我收回这句嘲笑。因为这件不可能的事，它慢慢变成了现实。</p>\n<p>　　没有人再关注什么谷歌不谷歌。对他们来说，百度也蛮好用的，反正他们几乎没用过谷歌。没有谷歌又怎样？大家还是开心的刷微博，看微信，听歌，看娱乐节目。对于从来就不知道谷歌的人来说，少了谷歌又有什么影响？</p>\n<p><img src=\"http://www.williamlong.info/upload/4058_1.jpg\" alt=\"慢慢的，就没有了，就像从未存在过\"><br><a id=\"more\"></a><br>　　多年前，我们也是可以登陆Facebook的。其实这个网站和校内一样，也挺蠢的。可在上面你能看到老外们的生活，可以轻易的跟一万公里以外的人互相拜访，可以看到很多根本不会开到校内上的主页。你用汉语回复，下面给你聊起来的可能是香港仔，可能是台湾人。你用英语回复，说不定有比你英语用的更蹩脚的寂寞的北欧人来跟你搭讪。你感觉地球真的变成了地球村，你还没拉门走出去，别人就推门走了进来。</p>\n<p>　　然后，它就没有了。起初，它的失踪激起了很大的声音，后来，声音就消失了。</p>\n<p>　　多年前，我们也是可以登陆Twitter的。其实这个网站和微博一样，也不过是些信息流，刷上一整天，也不见得有什么用处。但至少，你可以以最快速度获取你想知道的任何新事，你会真正了解什么事情在全世界是流行的，而不是经过各种截图、翻译、转发，甚至曲解、断章取义、黑白颠倒的东西。你知道的是真相，赤裸裸的，也许有点太短的真相。但至少中间不会有无数人的加工与再加工，偏激、片面，就在这个过程中产生了，不管后来者有意还是无意。</p>\n<p>　　然后，它就没有了。首先是它的本体没有了，然后它的模仿者也没有了，模仿者的模仿者也没有了。只剩一个模仿者的模仿者的模仿者，现在你每天能在上面看到无数广告。</p>\n<p>　　多年前，我们也是可以登陆YouTube的。对于有的人来说，这个网站就是个大型优酷，当年有人信誓旦旦的说，没有YouTube，我们中国人会很快让优酷超过YouTube。可这么多年过去了，视频还是那么卡，内容还是那么垃圾，原创还是那么容易被盗窃，视频丰富度还是那么的可怜。在YouTube上，你能看到全世界最棒的手艺人，最逗乐的笑话，最天马行空的创意，最激荡人心的音乐，最美好的完美瞬间，可在优酷上，你想看一分钟视频，请先看半分钟广告。</p>\n<p>　　哦，对了。Instagram，有些人可能感觉它和QQ空间也差不多。可我在上面关注了六百多个摄影师，它们都是顶好顶好的影像记录者，每天看他们的作品，我感觉到很幸福，那种即使没有到那里去，也身临其境的幸福。我还在上面认识了一个日本的爱自拍的帅小伙，一个爱喝酒的韩国大叔，一个十年前到过中国今天会在每张我发的紫禁城照片下点赞的美国大爷，一个美丽无比的俄罗斯妹子，我和他们基本上都难以交流，语言是很大的障碍，但几个简单的单词，心意也就到了，这种感觉，有时候比多年老友相聚还兴奋。因为这是人类不同族群自由交流互相沟通的过程，这种过程很神奇，真的很神奇。</p>\n<p>　　可现在，它没有了，它之所以没有就因为在某个特定的时间你在搜索特定的词汇时，会搜出来特定的照片。虽然这么搜的人并不多，虽然看到的人也不会大惊小怪，也不会觉得天黑了，天亮了，天要塌了，天要变了。可它就是没了，Instagram，就这么没了。谷歌也是这么没的，Twitter也是这么没的，Facebook也是这么没的。不知道是什么人，在什么场合，说了什么话，下了什么决定。就要有超过十亿人像陷于哥谭市的孤岛里一样，看着一座又一座桥梁被炸掉，又被炸掉，又被炸掉，然后，就什么都没了。</p>\n<p>　　我时常觉得悲哀，真的好悲哀，一个我根本不认识也不知道是谁的人，也许是一个群体，在不断抢走我身边的东西，而我却无能为力。我抱怨一声，他听不到，任何人都听不到。我怒吼一句，身边的大多数人却像看疯子一样的看着我。我哀嚎一声，这声音被阻碍在黑黑的幕墙以里。我发出尖锐的嘶吼，这声音传不了多远，就和我那被抢走的东西一样，消失了，不见了，就像从来没存在过一样。</p>\n<p>　　对于本来就没存在过的东西，有谁又会觉得在意呢？那些本来拥有又被掠夺的人的哀愁，后来的人又怎么懂呢？我曾经是拥有一切的，我曾经是拥有世界的，我站在这片土地上，呼吸的是自由的空气，饮下的是自由的琼浆玉液。就在长的无法计数的时间里，我自由生命的一部分又一部分就这么被杀死了，突然就杀死了。可我还始终觉得，它们还奄奄一息的活着，就像它们是慢慢的死去的一样。</p>\n<p>　　可它们终归是死了，而且随着它们的死，愈来愈多的事情慢慢的发生了，很慢很慢，几乎不被人察觉，可还是发生了。</p>\n<p>　　没有谷歌，我可以用百度呀。可某些结果被越挪越后，越挪越后，最后就不见了。就像本来就不该搜出这个结果一样。</p>\n<p>　　没有Facebook，我可以用校内呀。可你想发只有在Facebook上能发的文章，很快在校内上就失踪了。接着，校内变成了人人，话题变成了人人都关心的话题。大家都在抢着看星座、明星、八卦、娱乐。没有人会关心什么消失了，反正它们本来也没多少存在感。</p>\n<p>　　没有YouTube，我可以用优酷呀。可你却经常只能在优酷上看到抄袭别人的作品，而且还不署名，而且还洋洋得意，而且还自我陶醉，就好像那个idea本来属于他自己一样。你看了还要惊呼，他是如此的有创意！好一个抄袭的创意，可你却不知道，因为你不知道这个世界上有个网站叫YouTube。</p>\n<p>　　没有Twitter，我还可以用微博呀。可你想知道最近发生了什么，你搜的越勤快，越能看到越明显的“根据相关法律法规，相关搜索结果不予显示”。时间长了，你想，反正知道了也没什么用，不如不看了。</p>\n<p>　　慢慢的，一扇又一扇的门关上了。今天你打开世界上最大的博客网站，发现它没了。明天你一看，世界上最好的设计师分享网站没了，一开始是刷新的很慢很慢，后来它就没了。过两天再一看，平常每天都会读两篇文章的媒体网站没了，那里的文章缤纷多彩，最后都变成了该页无法显示几个字。再过几个月，大学的网站不让上了，摄影师的网站不让上了，就连百度日本这种自家网站，也没了。</p>\n<p>　　接着，漫画看不了了，接着，动画看不成了。接着，美剧英剧失踪了。下载美剧英剧的网站又又又失踪了。尊重正版，保护权益，行吧，然后字幕网站也没了。</p>\n<p>　　游戏没了，你习惯性登陆的游戏网站，发现下载栏正在整治中。论坛关了，天天都在看的论坛，突然接到相关部门的电话，因为“报备问题”不让办了。个人网站，私人博客，对不起，说没就没有，你在上面存了多少多年辛勤耕耘的东西都没用。</p>\n<p>　　你关注的人，有一天你登陆微博，发现他怎么好久都没说话了，然后你搜索了一下，发现他的账号不存在了，而且你搜他的名字，他的名字未予显示。</p>\n<p>　　一盏一盏的灯，灭了。四面八方的光源，消失了。我们生活的五光十色的世界，变成了一片黑色。</p>\n<p>　　天黑了，那么睡觉吧，但愿长醉不复醒。</p>\n<p>　　最后，我们变成了一群做梦的人，这个梦的名字，叫根据相关法律法规，相关搜索结果不予显示梦。</p>\n<p>　　作者：小海，来源：豆瓣网，<a href=\"http://www.douban.com/note/456932116/\" target=\"_blank\" rel=\"noopener\">原文</a>已被和谐</p>\n","site":{"data":{}},"excerpt":"<p>几年以前，我曾经嘲笑过某科技界大佬。当时他说：也许90后、95后会慢慢不知道谷歌是什么网站。</p>\n<p>　　那一年，这对于我来说简直就是世界上最好笑的笑话。谷歌，全世界最卓越的互联网公司，活在互联网的一代中国人，会不知道他们的网站？</p>\n<p>　　今天，我收回这句嘲笑。因为这件不可能的事，它慢慢变成了现实。</p>\n<p>　　没有人再关注什么谷歌不谷歌。对他们来说，百度也蛮好用的，反正他们几乎没用过谷歌。没有谷歌又怎样？大家还是开心的刷微博，看微信，听歌，看娱乐节目。对于从来就不知道谷歌的人来说，少了谷歌又有什么影响？</p>\n<p><img src=\"http://www.williamlong.info/upload/4058_1.jpg\" alt=\"慢慢的，就没有了，就像从未存在过\"><br>","more":"<br>　　多年前，我们也是可以登陆Facebook的。其实这个网站和校内一样，也挺蠢的。可在上面你能看到老外们的生活，可以轻易的跟一万公里以外的人互相拜访，可以看到很多根本不会开到校内上的主页。你用汉语回复，下面给你聊起来的可能是香港仔，可能是台湾人。你用英语回复，说不定有比你英语用的更蹩脚的寂寞的北欧人来跟你搭讪。你感觉地球真的变成了地球村，你还没拉门走出去，别人就推门走了进来。</p>\n<p>　　然后，它就没有了。起初，它的失踪激起了很大的声音，后来，声音就消失了。</p>\n<p>　　多年前，我们也是可以登陆Twitter的。其实这个网站和微博一样，也不过是些信息流，刷上一整天，也不见得有什么用处。但至少，你可以以最快速度获取你想知道的任何新事，你会真正了解什么事情在全世界是流行的，而不是经过各种截图、翻译、转发，甚至曲解、断章取义、黑白颠倒的东西。你知道的是真相，赤裸裸的，也许有点太短的真相。但至少中间不会有无数人的加工与再加工，偏激、片面，就在这个过程中产生了，不管后来者有意还是无意。</p>\n<p>　　然后，它就没有了。首先是它的本体没有了，然后它的模仿者也没有了，模仿者的模仿者也没有了。只剩一个模仿者的模仿者的模仿者，现在你每天能在上面看到无数广告。</p>\n<p>　　多年前，我们也是可以登陆YouTube的。对于有的人来说，这个网站就是个大型优酷，当年有人信誓旦旦的说，没有YouTube，我们中国人会很快让优酷超过YouTube。可这么多年过去了，视频还是那么卡，内容还是那么垃圾，原创还是那么容易被盗窃，视频丰富度还是那么的可怜。在YouTube上，你能看到全世界最棒的手艺人，最逗乐的笑话，最天马行空的创意，最激荡人心的音乐，最美好的完美瞬间，可在优酷上，你想看一分钟视频，请先看半分钟广告。</p>\n<p>　　哦，对了。Instagram，有些人可能感觉它和QQ空间也差不多。可我在上面关注了六百多个摄影师，它们都是顶好顶好的影像记录者，每天看他们的作品，我感觉到很幸福，那种即使没有到那里去，也身临其境的幸福。我还在上面认识了一个日本的爱自拍的帅小伙，一个爱喝酒的韩国大叔，一个十年前到过中国今天会在每张我发的紫禁城照片下点赞的美国大爷，一个美丽无比的俄罗斯妹子，我和他们基本上都难以交流，语言是很大的障碍，但几个简单的单词，心意也就到了，这种感觉，有时候比多年老友相聚还兴奋。因为这是人类不同族群自由交流互相沟通的过程，这种过程很神奇，真的很神奇。</p>\n<p>　　可现在，它没有了，它之所以没有就因为在某个特定的时间你在搜索特定的词汇时，会搜出来特定的照片。虽然这么搜的人并不多，虽然看到的人也不会大惊小怪，也不会觉得天黑了，天亮了，天要塌了，天要变了。可它就是没了，Instagram，就这么没了。谷歌也是这么没的，Twitter也是这么没的，Facebook也是这么没的。不知道是什么人，在什么场合，说了什么话，下了什么决定。就要有超过十亿人像陷于哥谭市的孤岛里一样，看着一座又一座桥梁被炸掉，又被炸掉，又被炸掉，然后，就什么都没了。</p>\n<p>　　我时常觉得悲哀，真的好悲哀，一个我根本不认识也不知道是谁的人，也许是一个群体，在不断抢走我身边的东西，而我却无能为力。我抱怨一声，他听不到，任何人都听不到。我怒吼一句，身边的大多数人却像看疯子一样的看着我。我哀嚎一声，这声音被阻碍在黑黑的幕墙以里。我发出尖锐的嘶吼，这声音传不了多远，就和我那被抢走的东西一样，消失了，不见了，就像从来没存在过一样。</p>\n<p>　　对于本来就没存在过的东西，有谁又会觉得在意呢？那些本来拥有又被掠夺的人的哀愁，后来的人又怎么懂呢？我曾经是拥有一切的，我曾经是拥有世界的，我站在这片土地上，呼吸的是自由的空气，饮下的是自由的琼浆玉液。就在长的无法计数的时间里，我自由生命的一部分又一部分就这么被杀死了，突然就杀死了。可我还始终觉得，它们还奄奄一息的活着，就像它们是慢慢的死去的一样。</p>\n<p>　　可它们终归是死了，而且随着它们的死，愈来愈多的事情慢慢的发生了，很慢很慢，几乎不被人察觉，可还是发生了。</p>\n<p>　　没有谷歌，我可以用百度呀。可某些结果被越挪越后，越挪越后，最后就不见了。就像本来就不该搜出这个结果一样。</p>\n<p>　　没有Facebook，我可以用校内呀。可你想发只有在Facebook上能发的文章，很快在校内上就失踪了。接着，校内变成了人人，话题变成了人人都关心的话题。大家都在抢着看星座、明星、八卦、娱乐。没有人会关心什么消失了，反正它们本来也没多少存在感。</p>\n<p>　　没有YouTube，我可以用优酷呀。可你却经常只能在优酷上看到抄袭别人的作品，而且还不署名，而且还洋洋得意，而且还自我陶醉，就好像那个idea本来属于他自己一样。你看了还要惊呼，他是如此的有创意！好一个抄袭的创意，可你却不知道，因为你不知道这个世界上有个网站叫YouTube。</p>\n<p>　　没有Twitter，我还可以用微博呀。可你想知道最近发生了什么，你搜的越勤快，越能看到越明显的“根据相关法律法规，相关搜索结果不予显示”。时间长了，你想，反正知道了也没什么用，不如不看了。</p>\n<p>　　慢慢的，一扇又一扇的门关上了。今天你打开世界上最大的博客网站，发现它没了。明天你一看，世界上最好的设计师分享网站没了，一开始是刷新的很慢很慢，后来它就没了。过两天再一看，平常每天都会读两篇文章的媒体网站没了，那里的文章缤纷多彩，最后都变成了该页无法显示几个字。再过几个月，大学的网站不让上了，摄影师的网站不让上了，就连百度日本这种自家网站，也没了。</p>\n<p>　　接着，漫画看不了了，接着，动画看不成了。接着，美剧英剧失踪了。下载美剧英剧的网站又又又失踪了。尊重正版，保护权益，行吧，然后字幕网站也没了。</p>\n<p>　　游戏没了，你习惯性登陆的游戏网站，发现下载栏正在整治中。论坛关了，天天都在看的论坛，突然接到相关部门的电话，因为“报备问题”不让办了。个人网站，私人博客，对不起，说没就没有，你在上面存了多少多年辛勤耕耘的东西都没用。</p>\n<p>　　你关注的人，有一天你登陆微博，发现他怎么好久都没说话了，然后你搜索了一下，发现他的账号不存在了，而且你搜他的名字，他的名字未予显示。</p>\n<p>　　一盏一盏的灯，灭了。四面八方的光源，消失了。我们生活的五光十色的世界，变成了一片黑色。</p>\n<p>　　天黑了，那么睡觉吧，但愿长醉不复醒。</p>\n<p>　　最后，我们变成了一群做梦的人，这个梦的名字，叫根据相关法律法规，相关搜索结果不予显示梦。</p>\n<p>　　作者：小海，来源：豆瓣网，<a href=\"http://www.douban.com/note/456932116/\" target=\"_blank\" rel=\"noopener\">原文</a>已被和谐</p>"},{"title":"neutron源码分析","date":"2016-10-28T06:52:02.000Z","_content":"## 消息总线\nOpenstack各项目之间通过RESTful API进行通信；而项目内部不同服务进程则需要通过消息总线通信。关于消息总线的实现，包含在Openstack.oslo.messaging库中。\n### RPC\n远程过程调用，一个服务进程可以调用其他远程服务进程的方法，有两种方式：\n- call 远程方法会被同步执行，调用者会阻塞直到取得返回结果。\n- cast 远程方法会被异步执行，调用者需要通过其他方式查询这次远程调用的结果。\n\n<!--more-->\n\n### 事件通知(Event Notification)\n服务可以把事件通知发到消息总线上，该消息总线上所有对此类事件感兴趣的服务进程，都可以获得次事件通知并进行处理。处理结果不会返回事件发送者。\n\n### AMQP\nAMQP是一个异步消息传递所使用的开放的应用层协议规范。包括导向、队列、路由、可靠性和安全性。不同的AMQP实现可以进行相互操作。\n所有消息都有一个routing key,所有Queue都有一个binding key。生产者将消息发送给Exchange,然后Exchange根据这两个key把消息送到相匹配的Queue中。不同类型的Exchange有不同的匹配算法。\n\n\n|类型|说明|\n|:---|:---|\n|Direct|binding key和routing key必须完全一样，不支持通配符|\n|Topic|同Direct类型，但是支持通配符，\"*\"匹配单字，“#”匹配零个或多个单字，单字之间由“.”来分割|\n|Fanout|忽略binding key和routing key，广播式路由|\n\n\n## WSGI\nWSGI 是一个连接服务端和应用端的接口。WSGI把Web组件分为三部分：\n- WSGI Server\n- WSGI Middleware\n- WSGI Application\n\nAn Application must return an iterable object.\n```python\ndef application(environ,start_response):\n   start_response('200 Ok',[('Content-Type','text/plain')])\n   yield 'Hello World\\n'\n```\n- `environ`:一个dict，包括CGI中定义的环境变量以及7个WSGI所定义的环境变量：wsgi.version,wsgi_input...\n- `start_response`: 回调函数，要返回一个write(data)对象，用作兼容现有的特殊框架，一般返回None\n\n### Paste.Deploy\nPaste Deploy通过api-paste.ini配置\nPaste配置文件分为多个section，每个section以`type`:`name`的格式命名。\n（书上P99）\n### WebOb\n对WSGI的封装，包含：\n- `webob.Request` 对WSGI的environ的封装\n- `webob.Response` 对WSGI响应的封装 \n- `webob.exc` 对HTTP错误代码的封装\n\nWebob提供了`webob.dec.wsgify`的decorator，可以快速开发application\n```python\n# 继承自webob.Request\nclass MyRequest(webob.Request): \n    @property\n    def is_local(self):\n        return self.remote_addr == '127.0.0.1'\n\n\n@wsgify(RequestClass=MyRequest) \ndef myfunc(req):\n    if req.is_local:\n        return Response('hi!')\n    else:\n        raise webob.exc.HTTPForbidden\n```\n## Eventlet\nOpenstack的协程模块\n### 协程\n与线程类似，拥有独立的栈和局部变量，但是无法同时执行，(Compare To: Javascript callback)\n### GreenThread\n```python\nimport eventlet\ndef my_func(param):\n    # do something in coroutine\n    return param\ngt = eventlet.spawn(my_func,param)\nresult = gt.wait()\n```\n`eventlet.spawn`只是创建一个协程并不立即执行，直到主线程运行到`gt.wait()`时才开始进入调度序列。\n### Monkey Path\n实现协程需要使用Patch的方式对Python的网络相关的标准库进行改写，这个patch就叫`monkey_patch`。\nMonkey Patch是大部分使用Eventlet函数库之前需要进行的初始化工作\n```python\n# ceilometer/cmd/__init__.py\nimport eventlet\n# patch socket,select,thread三个模块\neventlet.monkey_patch(socket=True,select=True,thread=True)\n```\n## Oslo\nOpenstack 通用库\n### Cliff\n构建命令行程序\nDEMO: <https://github.com/openstack/cliff/tree/master/demoapp>\n\n### oslo.config\n解析命令行和配置文件中的配置选项（书上P111）\n```python\nfrom oslo.config import cfg\nconf(sys.argv[1:],project=`xyz`) # 初始化，使得oslo.config能够正常解析配置文件和命令行选项\nrabbit_group = cfg.OptGroup(name='rabbit',\n                            title='RabbitMQ options')\n\nrabbit_host_opt = cfg.StrOpt('host',\n                             default='localhost',\n                             help='IP/hostname to listen on.'),\nrabbit_port_opt = cfg.PortOpt('port',\n                              default=5672,\n                              help='Port number to listen on.')\n\ndef register_rabbit_opts(conf):\n    conf.register_group(rabbit_group)\n    # options can be registered under a group in either of these ways:\n    conf.register_opt(rabbit_host_opt, group=rabbit_group)\n    conf.register_opt(rabbit_port_opt, group='rabbit')\n```\n如果没有指定group，则选项默认放在[DEFAULT]组下\n```ini\n# glance-api.conf:\n  [DEFAULT]\n  bind_port = 9292\n  # ...\n\n  [rabbit]\n  host = localhost\n  port = 5672\n  use_ssl = False\n  userid = guest\n  password = guest\n  virtual_host = /\n```\n从命令行中设置conf，需要使用使用‘-’连接groupname和optionname\n```shell\n--rabbit-host localhost --rabbit-port 9999\n```\n### oslo.db\nSQLAlchemy数据库模型的抽象\n### oslo.i18n\n是对Python gettext的封装，主要用于字符串翻译和国际化\n### oslo.messaging\nOpenstack各项目使用RPC和事件通知的统一的接口。其中包括下面4个对象。\n#### Transport\n传输层，主要实现RPC底层的通信，支持rabbit、qpid、zmq三种协议。可以通过URL来指定不同的transport的实现。\n```\ntransport://user:pass@host1:port[,hostN:portN]/virtual_host\n```\n#### Target\n封装了指定某一消息最终目的地的所有信息\n#### Server\n即服务端，创建一个Server对象需要指定Transport、Target、endpoints(包含多组可被远程调用的方法，比如某一资源包含CUID四个操作）\n#### RPC Client\n即客户端，一个RPC Client可以调用RPC Server上的方法。\n#### Notifier\nNotifier是一个用来发送通知消息的对象。格式如下：\n```javscript\n{\n    message_id:six_text_type(uuid.uuid4()), #消息id号\n    publisher_id:'computer.host1',#发送者id\n    timestamp:timeutils.utcnow(),#时间戳\n    priority:'WARN', # 通知优先级\n    event_type:'compute.create_instance',#通知类型\n    payload:{'instance_id':12,...} #通知内容\n}\n```\n#### Notifier Listener\n消息监听者，跟Server类似，可以暴露多个endpoint，每个endpoint中也可以包含多种方法，但是它们只是对应者不同的消息优先级。（P118）\n\n\n","source":"_posts/neutron-code.md","raw":"---\ntitle: neutron源码分析\ndate: 2016-10-28 14:52:02\ntags: [openstack,neutron]\ncategories: ['Cloud Computing']\n---\n## 消息总线\nOpenstack各项目之间通过RESTful API进行通信；而项目内部不同服务进程则需要通过消息总线通信。关于消息总线的实现，包含在Openstack.oslo.messaging库中。\n### RPC\n远程过程调用，一个服务进程可以调用其他远程服务进程的方法，有两种方式：\n- call 远程方法会被同步执行，调用者会阻塞直到取得返回结果。\n- cast 远程方法会被异步执行，调用者需要通过其他方式查询这次远程调用的结果。\n\n<!--more-->\n\n### 事件通知(Event Notification)\n服务可以把事件通知发到消息总线上，该消息总线上所有对此类事件感兴趣的服务进程，都可以获得次事件通知并进行处理。处理结果不会返回事件发送者。\n\n### AMQP\nAMQP是一个异步消息传递所使用的开放的应用层协议规范。包括导向、队列、路由、可靠性和安全性。不同的AMQP实现可以进行相互操作。\n所有消息都有一个routing key,所有Queue都有一个binding key。生产者将消息发送给Exchange,然后Exchange根据这两个key把消息送到相匹配的Queue中。不同类型的Exchange有不同的匹配算法。\n\n\n|类型|说明|\n|:---|:---|\n|Direct|binding key和routing key必须完全一样，不支持通配符|\n|Topic|同Direct类型，但是支持通配符，\"*\"匹配单字，“#”匹配零个或多个单字，单字之间由“.”来分割|\n|Fanout|忽略binding key和routing key，广播式路由|\n\n\n## WSGI\nWSGI 是一个连接服务端和应用端的接口。WSGI把Web组件分为三部分：\n- WSGI Server\n- WSGI Middleware\n- WSGI Application\n\nAn Application must return an iterable object.\n```python\ndef application(environ,start_response):\n   start_response('200 Ok',[('Content-Type','text/plain')])\n   yield 'Hello World\\n'\n```\n- `environ`:一个dict，包括CGI中定义的环境变量以及7个WSGI所定义的环境变量：wsgi.version,wsgi_input...\n- `start_response`: 回调函数，要返回一个write(data)对象，用作兼容现有的特殊框架，一般返回None\n\n### Paste.Deploy\nPaste Deploy通过api-paste.ini配置\nPaste配置文件分为多个section，每个section以`type`:`name`的格式命名。\n（书上P99）\n### WebOb\n对WSGI的封装，包含：\n- `webob.Request` 对WSGI的environ的封装\n- `webob.Response` 对WSGI响应的封装 \n- `webob.exc` 对HTTP错误代码的封装\n\nWebob提供了`webob.dec.wsgify`的decorator，可以快速开发application\n```python\n# 继承自webob.Request\nclass MyRequest(webob.Request): \n    @property\n    def is_local(self):\n        return self.remote_addr == '127.0.0.1'\n\n\n@wsgify(RequestClass=MyRequest) \ndef myfunc(req):\n    if req.is_local:\n        return Response('hi!')\n    else:\n        raise webob.exc.HTTPForbidden\n```\n## Eventlet\nOpenstack的协程模块\n### 协程\n与线程类似，拥有独立的栈和局部变量，但是无法同时执行，(Compare To: Javascript callback)\n### GreenThread\n```python\nimport eventlet\ndef my_func(param):\n    # do something in coroutine\n    return param\ngt = eventlet.spawn(my_func,param)\nresult = gt.wait()\n```\n`eventlet.spawn`只是创建一个协程并不立即执行，直到主线程运行到`gt.wait()`时才开始进入调度序列。\n### Monkey Path\n实现协程需要使用Patch的方式对Python的网络相关的标准库进行改写，这个patch就叫`monkey_patch`。\nMonkey Patch是大部分使用Eventlet函数库之前需要进行的初始化工作\n```python\n# ceilometer/cmd/__init__.py\nimport eventlet\n# patch socket,select,thread三个模块\neventlet.monkey_patch(socket=True,select=True,thread=True)\n```\n## Oslo\nOpenstack 通用库\n### Cliff\n构建命令行程序\nDEMO: <https://github.com/openstack/cliff/tree/master/demoapp>\n\n### oslo.config\n解析命令行和配置文件中的配置选项（书上P111）\n```python\nfrom oslo.config import cfg\nconf(sys.argv[1:],project=`xyz`) # 初始化，使得oslo.config能够正常解析配置文件和命令行选项\nrabbit_group = cfg.OptGroup(name='rabbit',\n                            title='RabbitMQ options')\n\nrabbit_host_opt = cfg.StrOpt('host',\n                             default='localhost',\n                             help='IP/hostname to listen on.'),\nrabbit_port_opt = cfg.PortOpt('port',\n                              default=5672,\n                              help='Port number to listen on.')\n\ndef register_rabbit_opts(conf):\n    conf.register_group(rabbit_group)\n    # options can be registered under a group in either of these ways:\n    conf.register_opt(rabbit_host_opt, group=rabbit_group)\n    conf.register_opt(rabbit_port_opt, group='rabbit')\n```\n如果没有指定group，则选项默认放在[DEFAULT]组下\n```ini\n# glance-api.conf:\n  [DEFAULT]\n  bind_port = 9292\n  # ...\n\n  [rabbit]\n  host = localhost\n  port = 5672\n  use_ssl = False\n  userid = guest\n  password = guest\n  virtual_host = /\n```\n从命令行中设置conf，需要使用使用‘-’连接groupname和optionname\n```shell\n--rabbit-host localhost --rabbit-port 9999\n```\n### oslo.db\nSQLAlchemy数据库模型的抽象\n### oslo.i18n\n是对Python gettext的封装，主要用于字符串翻译和国际化\n### oslo.messaging\nOpenstack各项目使用RPC和事件通知的统一的接口。其中包括下面4个对象。\n#### Transport\n传输层，主要实现RPC底层的通信，支持rabbit、qpid、zmq三种协议。可以通过URL来指定不同的transport的实现。\n```\ntransport://user:pass@host1:port[,hostN:portN]/virtual_host\n```\n#### Target\n封装了指定某一消息最终目的地的所有信息\n#### Server\n即服务端，创建一个Server对象需要指定Transport、Target、endpoints(包含多组可被远程调用的方法，比如某一资源包含CUID四个操作）\n#### RPC Client\n即客户端，一个RPC Client可以调用RPC Server上的方法。\n#### Notifier\nNotifier是一个用来发送通知消息的对象。格式如下：\n```javscript\n{\n    message_id:six_text_type(uuid.uuid4()), #消息id号\n    publisher_id:'computer.host1',#发送者id\n    timestamp:timeutils.utcnow(),#时间戳\n    priority:'WARN', # 通知优先级\n    event_type:'compute.create_instance',#通知类型\n    payload:{'instance_id':12,...} #通知内容\n}\n```\n#### Notifier Listener\n消息监听者，跟Server类似，可以暴露多个endpoint，每个endpoint中也可以包含多种方法，但是它们只是对应者不同的消息优先级。（P118）\n\n\n","slug":"neutron-code","published":1,"updated":"2019-10-11T05:50:15.686Z","_id":"ciz5e9l1y00465rgx9t3o7gv0","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"消息总线\"><a href=\"#消息总线\" class=\"headerlink\" title=\"消息总线\"></a>消息总线</h2><p>Openstack各项目之间通过RESTful API进行通信；而项目内部不同服务进程则需要通过消息总线通信。关于消息总线的实现，包含在Openstack.oslo.messaging库中。</p>\n<h3 id=\"RPC\"><a href=\"#RPC\" class=\"headerlink\" title=\"RPC\"></a>RPC</h3><p>远程过程调用，一个服务进程可以调用其他远程服务进程的方法，有两种方式：</p>\n<ul>\n<li>call 远程方法会被同步执行，调用者会阻塞直到取得返回结果。</li>\n<li>cast 远程方法会被异步执行，调用者需要通过其他方式查询这次远程调用的结果。</li>\n</ul>\n<a id=\"more\"></a>\n<h3 id=\"事件通知-Event-Notification\"><a href=\"#事件通知-Event-Notification\" class=\"headerlink\" title=\"事件通知(Event Notification)\"></a>事件通知(Event Notification)</h3><p>服务可以把事件通知发到消息总线上，该消息总线上所有对此类事件感兴趣的服务进程，都可以获得次事件通知并进行处理。处理结果不会返回事件发送者。</p>\n<h3 id=\"AMQP\"><a href=\"#AMQP\" class=\"headerlink\" title=\"AMQP\"></a>AMQP</h3><p>AMQP是一个异步消息传递所使用的开放的应用层协议规范。包括导向、队列、路由、可靠性和安全性。不同的AMQP实现可以进行相互操作。<br>所有消息都有一个routing key,所有Queue都有一个binding key。生产者将消息发送给Exchange,然后Exchange根据这两个key把消息送到相匹配的Queue中。不同类型的Exchange有不同的匹配算法。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Direct</td>\n<td style=\"text-align:left\">binding key和routing key必须完全一样，不支持通配符</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Topic</td>\n<td style=\"text-align:left\">同Direct类型，但是支持通配符，”*”匹配单字，“#”匹配零个或多个单字，单字之间由“.”来分割</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Fanout</td>\n<td style=\"text-align:left\">忽略binding key和routing key，广播式路由</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"WSGI\"><a href=\"#WSGI\" class=\"headerlink\" title=\"WSGI\"></a>WSGI</h2><p>WSGI 是一个连接服务端和应用端的接口。WSGI把Web组件分为三部分：</p>\n<ul>\n<li>WSGI Server</li>\n<li>WSGI Middleware</li>\n<li>WSGI Application</li>\n</ul>\n<p>An Application must return an iterable object.<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">application</span><span class=\"params\">(environ,start_response)</span>:</span></span><br><span class=\"line\">   start_response(<span class=\"string\">'200 Ok'</span>,[(<span class=\"string\">'Content-Type'</span>,<span class=\"string\">'text/plain'</span>)])</span><br><span class=\"line\">   <span class=\"keyword\">yield</span> <span class=\"string\">'Hello World\\n'</span></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><code>environ</code>:一个dict，包括CGI中定义的环境变量以及7个WSGI所定义的环境变量：wsgi.version,wsgi_input…</li>\n<li><code>start_response</code>: 回调函数，要返回一个write(data)对象，用作兼容现有的特殊框架，一般返回None</li>\n</ul>\n<h3 id=\"Paste-Deploy\"><a href=\"#Paste-Deploy\" class=\"headerlink\" title=\"Paste.Deploy\"></a>Paste.Deploy</h3><p>Paste Deploy通过api-paste.ini配置<br>Paste配置文件分为多个section，每个section以<code>type</code>:<code>name</code>的格式命名。<br>（书上P99）</p>\n<h3 id=\"WebOb\"><a href=\"#WebOb\" class=\"headerlink\" title=\"WebOb\"></a>WebOb</h3><p>对WSGI的封装，包含：</p>\n<ul>\n<li><code>webob.Request</code> 对WSGI的environ的封装</li>\n<li><code>webob.Response</code> 对WSGI响应的封装 </li>\n<li><code>webob.exc</code> 对HTTP错误代码的封装</li>\n</ul>\n<p>Webob提供了<code>webob.dec.wsgify</code>的decorator，可以快速开发application<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 继承自webob.Request</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyRequest</span><span class=\"params\">(webob.Request)</span>:</span> </span><br><span class=\"line\"><span class=\"meta\">    @property</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">is_local</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.remote_addr == <span class=\"string\">'127.0.0.1'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@wsgify(RequestClass=MyRequest) </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">myfunc</span><span class=\"params\">(req)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> req.is_local:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(<span class=\"string\">'hi!'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">raise</span> webob.exc.HTTPForbidden</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Eventlet\"><a href=\"#Eventlet\" class=\"headerlink\" title=\"Eventlet\"></a>Eventlet</h2><p>Openstack的协程模块</p>\n<h3 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h3><p>与线程类似，拥有独立的栈和局部变量，但是无法同时执行，(Compare To: Javascript callback)</p>\n<h3 id=\"GreenThread\"><a href=\"#GreenThread\" class=\"headerlink\" title=\"GreenThread\"></a>GreenThread</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> eventlet</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_func</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># do something in coroutine</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> param</span><br><span class=\"line\">gt = eventlet.spawn(my_func,param)</span><br><span class=\"line\">result = gt.wait()</span><br></pre></td></tr></table></figure>\n<p><code>eventlet.spawn</code>只是创建一个协程并不立即执行，直到主线程运行到<code>gt.wait()</code>时才开始进入调度序列。</p>\n<h3 id=\"Monkey-Path\"><a href=\"#Monkey-Path\" class=\"headerlink\" title=\"Monkey Path\"></a>Monkey Path</h3><p>实现协程需要使用Patch的方式对Python的网络相关的标准库进行改写，这个patch就叫<code>monkey_patch</code>。<br>Monkey Patch是大部分使用Eventlet函数库之前需要进行的初始化工作<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ceilometer/cmd/__init__.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> eventlet</span><br><span class=\"line\"><span class=\"comment\"># patch socket,select,thread三个模块</span></span><br><span class=\"line\">eventlet.monkey_patch(socket=<span class=\"literal\">True</span>,select=<span class=\"literal\">True</span>,thread=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Oslo\"><a href=\"#Oslo\" class=\"headerlink\" title=\"Oslo\"></a>Oslo</h2><p>Openstack 通用库</p>\n<h3 id=\"Cliff\"><a href=\"#Cliff\" class=\"headerlink\" title=\"Cliff\"></a>Cliff</h3><p>构建命令行程序<br>DEMO: <a href=\"https://github.com/openstack/cliff/tree/master/demoapp\" target=\"_blank\" rel=\"noopener\">https://github.com/openstack/cliff/tree/master/demoapp</a></p>\n<h3 id=\"oslo-config\"><a href=\"#oslo-config\" class=\"headerlink\" title=\"oslo.config\"></a>oslo.config</h3><p>解析命令行和配置文件中的配置选项（书上P111）<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> oslo.config <span class=\"keyword\">import</span> cfg</span><br><span class=\"line\">conf(sys.argv[<span class=\"number\">1</span>:],project=`xyz`) <span class=\"comment\"># 初始化，使得oslo.config能够正常解析配置文件和命令行选项</span></span><br><span class=\"line\">rabbit_group = cfg.OptGroup(name=<span class=\"string\">'rabbit'</span>,</span><br><span class=\"line\">                            title=<span class=\"string\">'RabbitMQ options'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit_host_opt = cfg.StrOpt(<span class=\"string\">'host'</span>,</span><br><span class=\"line\">                             default=<span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">                             help=<span class=\"string\">'IP/hostname to listen on.'</span>),</span><br><span class=\"line\">rabbit_port_opt = cfg.PortOpt(<span class=\"string\">'port'</span>,</span><br><span class=\"line\">                              default=<span class=\"number\">5672</span>,</span><br><span class=\"line\">                              help=<span class=\"string\">'Port number to listen on.'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">register_rabbit_opts</span><span class=\"params\">(conf)</span>:</span></span><br><span class=\"line\">    conf.register_group(rabbit_group)</span><br><span class=\"line\">    <span class=\"comment\"># options can be registered under a group in either of these ways:</span></span><br><span class=\"line\">    conf.register_opt(rabbit_host_opt, group=rabbit_group)</span><br><span class=\"line\">    conf.register_opt(rabbit_port_opt, group=<span class=\"string\">'rabbit'</span>)</span><br></pre></td></tr></table></figure></p>\n<p>如果没有指定group，则选项默认放在[DEFAULT]组下<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># glance-api.conf:</span></span><br><span class=\"line\"><span class=\"section\">  [DEFAULT]</span></span><br><span class=\"line\">  bind_port = 9292</span><br><span class=\"line\">  <span class=\"comment\"># ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">  [rabbit]</span></span><br><span class=\"line\">  host = localhost</span><br><span class=\"line\">  port = 5672</span><br><span class=\"line\">  use_ssl = False</span><br><span class=\"line\">  userid = guest</span><br><span class=\"line\">  password = guest</span><br><span class=\"line\">  virtual_host = /</span><br></pre></td></tr></table></figure></p>\n<p>从命令行中设置conf，需要使用使用‘-’连接groupname和optionname<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--rabbit-host localhost --rabbit-port 9999</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"oslo-db\"><a href=\"#oslo-db\" class=\"headerlink\" title=\"oslo.db\"></a>oslo.db</h3><p>SQLAlchemy数据库模型的抽象</p>\n<h3 id=\"oslo-i18n\"><a href=\"#oslo-i18n\" class=\"headerlink\" title=\"oslo.i18n\"></a>oslo.i18n</h3><p>是对Python gettext的封装，主要用于字符串翻译和国际化</p>\n<h3 id=\"oslo-messaging\"><a href=\"#oslo-messaging\" class=\"headerlink\" title=\"oslo.messaging\"></a>oslo.messaging</h3><p>Openstack各项目使用RPC和事件通知的统一的接口。其中包括下面4个对象。</p>\n<h4 id=\"Transport\"><a href=\"#Transport\" class=\"headerlink\" title=\"Transport\"></a>Transport</h4><p>传输层，主要实现RPC底层的通信，支持rabbit、qpid、zmq三种协议。可以通过URL来指定不同的transport的实现。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transport://user:pass@host1:port[,hostN:portN]/virtual_host</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Target\"><a href=\"#Target\" class=\"headerlink\" title=\"Target\"></a>Target</h4><p>封装了指定某一消息最终目的地的所有信息</p>\n<h4 id=\"Server\"><a href=\"#Server\" class=\"headerlink\" title=\"Server\"></a>Server</h4><p>即服务端，创建一个Server对象需要指定Transport、Target、endpoints(包含多组可被远程调用的方法，比如某一资源包含CUID四个操作）</p>\n<h4 id=\"RPC-Client\"><a href=\"#RPC-Client\" class=\"headerlink\" title=\"RPC Client\"></a>RPC Client</h4><p>即客户端，一个RPC Client可以调用RPC Server上的方法。</p>\n<h4 id=\"Notifier\"><a href=\"#Notifier\" class=\"headerlink\" title=\"Notifier\"></a>Notifier</h4><p>Notifier是一个用来发送通知消息的对象。格式如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    message_id:six_text_type(uuid.uuid4()), #消息id号</span><br><span class=\"line\">    publisher_id:&apos;computer.host1&apos;,#发送者id</span><br><span class=\"line\">    timestamp:timeutils.utcnow(),#时间戳</span><br><span class=\"line\">    priority:&apos;WARN&apos;, # 通知优先级</span><br><span class=\"line\">    event_type:&apos;compute.create_instance&apos;,#通知类型</span><br><span class=\"line\">    payload:&#123;&apos;instance_id&apos;:12,...&#125; #通知内容</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Notifier-Listener\"><a href=\"#Notifier-Listener\" class=\"headerlink\" title=\"Notifier Listener\"></a>Notifier Listener</h4><p>消息监听者，跟Server类似，可以暴露多个endpoint，每个endpoint中也可以包含多种方法，但是它们只是对应者不同的消息优先级。（P118）</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"消息总线\"><a href=\"#消息总线\" class=\"headerlink\" title=\"消息总线\"></a>消息总线</h2><p>Openstack各项目之间通过RESTful API进行通信；而项目内部不同服务进程则需要通过消息总线通信。关于消息总线的实现，包含在Openstack.oslo.messaging库中。</p>\n<h3 id=\"RPC\"><a href=\"#RPC\" class=\"headerlink\" title=\"RPC\"></a>RPC</h3><p>远程过程调用，一个服务进程可以调用其他远程服务进程的方法，有两种方式：</p>\n<ul>\n<li>call 远程方法会被同步执行，调用者会阻塞直到取得返回结果。</li>\n<li>cast 远程方法会被异步执行，调用者需要通过其他方式查询这次远程调用的结果。</li>\n</ul>","more":"<h3 id=\"事件通知-Event-Notification\"><a href=\"#事件通知-Event-Notification\" class=\"headerlink\" title=\"事件通知(Event Notification)\"></a>事件通知(Event Notification)</h3><p>服务可以把事件通知发到消息总线上，该消息总线上所有对此类事件感兴趣的服务进程，都可以获得次事件通知并进行处理。处理结果不会返回事件发送者。</p>\n<h3 id=\"AMQP\"><a href=\"#AMQP\" class=\"headerlink\" title=\"AMQP\"></a>AMQP</h3><p>AMQP是一个异步消息传递所使用的开放的应用层协议规范。包括导向、队列、路由、可靠性和安全性。不同的AMQP实现可以进行相互操作。<br>所有消息都有一个routing key,所有Queue都有一个binding key。生产者将消息发送给Exchange,然后Exchange根据这两个key把消息送到相匹配的Queue中。不同类型的Exchange有不同的匹配算法。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Direct</td>\n<td style=\"text-align:left\">binding key和routing key必须完全一样，不支持通配符</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Topic</td>\n<td style=\"text-align:left\">同Direct类型，但是支持通配符，”*”匹配单字，“#”匹配零个或多个单字，单字之间由“.”来分割</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Fanout</td>\n<td style=\"text-align:left\">忽略binding key和routing key，广播式路由</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"WSGI\"><a href=\"#WSGI\" class=\"headerlink\" title=\"WSGI\"></a>WSGI</h2><p>WSGI 是一个连接服务端和应用端的接口。WSGI把Web组件分为三部分：</p>\n<ul>\n<li>WSGI Server</li>\n<li>WSGI Middleware</li>\n<li>WSGI Application</li>\n</ul>\n<p>An Application must return an iterable object.<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">application</span><span class=\"params\">(environ,start_response)</span>:</span></span><br><span class=\"line\">   start_response(<span class=\"string\">'200 Ok'</span>,[(<span class=\"string\">'Content-Type'</span>,<span class=\"string\">'text/plain'</span>)])</span><br><span class=\"line\">   <span class=\"keyword\">yield</span> <span class=\"string\">'Hello World\\n'</span></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><code>environ</code>:一个dict，包括CGI中定义的环境变量以及7个WSGI所定义的环境变量：wsgi.version,wsgi_input…</li>\n<li><code>start_response</code>: 回调函数，要返回一个write(data)对象，用作兼容现有的特殊框架，一般返回None</li>\n</ul>\n<h3 id=\"Paste-Deploy\"><a href=\"#Paste-Deploy\" class=\"headerlink\" title=\"Paste.Deploy\"></a>Paste.Deploy</h3><p>Paste Deploy通过api-paste.ini配置<br>Paste配置文件分为多个section，每个section以<code>type</code>:<code>name</code>的格式命名。<br>（书上P99）</p>\n<h3 id=\"WebOb\"><a href=\"#WebOb\" class=\"headerlink\" title=\"WebOb\"></a>WebOb</h3><p>对WSGI的封装，包含：</p>\n<ul>\n<li><code>webob.Request</code> 对WSGI的environ的封装</li>\n<li><code>webob.Response</code> 对WSGI响应的封装 </li>\n<li><code>webob.exc</code> 对HTTP错误代码的封装</li>\n</ul>\n<p>Webob提供了<code>webob.dec.wsgify</code>的decorator，可以快速开发application<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 继承自webob.Request</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyRequest</span><span class=\"params\">(webob.Request)</span>:</span> </span><br><span class=\"line\"><span class=\"meta\">    @property</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">is_local</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.remote_addr == <span class=\"string\">'127.0.0.1'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@wsgify(RequestClass=MyRequest) </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">myfunc</span><span class=\"params\">(req)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> req.is_local:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Response(<span class=\"string\">'hi!'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">raise</span> webob.exc.HTTPForbidden</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Eventlet\"><a href=\"#Eventlet\" class=\"headerlink\" title=\"Eventlet\"></a>Eventlet</h2><p>Openstack的协程模块</p>\n<h3 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h3><p>与线程类似，拥有独立的栈和局部变量，但是无法同时执行，(Compare To: Javascript callback)</p>\n<h3 id=\"GreenThread\"><a href=\"#GreenThread\" class=\"headerlink\" title=\"GreenThread\"></a>GreenThread</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> eventlet</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_func</span><span class=\"params\">(param)</span>:</span></span><br><span class=\"line\">    <span class=\"comment\"># do something in coroutine</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> param</span><br><span class=\"line\">gt = eventlet.spawn(my_func,param)</span><br><span class=\"line\">result = gt.wait()</span><br></pre></td></tr></table></figure>\n<p><code>eventlet.spawn</code>只是创建一个协程并不立即执行，直到主线程运行到<code>gt.wait()</code>时才开始进入调度序列。</p>\n<h3 id=\"Monkey-Path\"><a href=\"#Monkey-Path\" class=\"headerlink\" title=\"Monkey Path\"></a>Monkey Path</h3><p>实现协程需要使用Patch的方式对Python的网络相关的标准库进行改写，这个patch就叫<code>monkey_patch</code>。<br>Monkey Patch是大部分使用Eventlet函数库之前需要进行的初始化工作<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ceilometer/cmd/__init__.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> eventlet</span><br><span class=\"line\"><span class=\"comment\"># patch socket,select,thread三个模块</span></span><br><span class=\"line\">eventlet.monkey_patch(socket=<span class=\"literal\">True</span>,select=<span class=\"literal\">True</span>,thread=<span class=\"literal\">True</span>)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Oslo\"><a href=\"#Oslo\" class=\"headerlink\" title=\"Oslo\"></a>Oslo</h2><p>Openstack 通用库</p>\n<h3 id=\"Cliff\"><a href=\"#Cliff\" class=\"headerlink\" title=\"Cliff\"></a>Cliff</h3><p>构建命令行程序<br>DEMO: <a href=\"https://github.com/openstack/cliff/tree/master/demoapp\" target=\"_blank\" rel=\"noopener\">https://github.com/openstack/cliff/tree/master/demoapp</a></p>\n<h3 id=\"oslo-config\"><a href=\"#oslo-config\" class=\"headerlink\" title=\"oslo.config\"></a>oslo.config</h3><p>解析命令行和配置文件中的配置选项（书上P111）<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> oslo.config <span class=\"keyword\">import</span> cfg</span><br><span class=\"line\">conf(sys.argv[<span class=\"number\">1</span>:],project=`xyz`) <span class=\"comment\"># 初始化，使得oslo.config能够正常解析配置文件和命令行选项</span></span><br><span class=\"line\">rabbit_group = cfg.OptGroup(name=<span class=\"string\">'rabbit'</span>,</span><br><span class=\"line\">                            title=<span class=\"string\">'RabbitMQ options'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit_host_opt = cfg.StrOpt(<span class=\"string\">'host'</span>,</span><br><span class=\"line\">                             default=<span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">                             help=<span class=\"string\">'IP/hostname to listen on.'</span>),</span><br><span class=\"line\">rabbit_port_opt = cfg.PortOpt(<span class=\"string\">'port'</span>,</span><br><span class=\"line\">                              default=<span class=\"number\">5672</span>,</span><br><span class=\"line\">                              help=<span class=\"string\">'Port number to listen on.'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">register_rabbit_opts</span><span class=\"params\">(conf)</span>:</span></span><br><span class=\"line\">    conf.register_group(rabbit_group)</span><br><span class=\"line\">    <span class=\"comment\"># options can be registered under a group in either of these ways:</span></span><br><span class=\"line\">    conf.register_opt(rabbit_host_opt, group=rabbit_group)</span><br><span class=\"line\">    conf.register_opt(rabbit_port_opt, group=<span class=\"string\">'rabbit'</span>)</span><br></pre></td></tr></table></figure></p>\n<p>如果没有指定group，则选项默认放在[DEFAULT]组下<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># glance-api.conf:</span></span><br><span class=\"line\"><span class=\"section\">  [DEFAULT]</span></span><br><span class=\"line\">  bind_port = 9292</span><br><span class=\"line\">  <span class=\"comment\"># ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">  [rabbit]</span></span><br><span class=\"line\">  host = localhost</span><br><span class=\"line\">  port = 5672</span><br><span class=\"line\">  use_ssl = False</span><br><span class=\"line\">  userid = guest</span><br><span class=\"line\">  password = guest</span><br><span class=\"line\">  virtual_host = /</span><br></pre></td></tr></table></figure></p>\n<p>从命令行中设置conf，需要使用使用‘-’连接groupname和optionname<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--rabbit-host localhost --rabbit-port 9999</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"oslo-db\"><a href=\"#oslo-db\" class=\"headerlink\" title=\"oslo.db\"></a>oslo.db</h3><p>SQLAlchemy数据库模型的抽象</p>\n<h3 id=\"oslo-i18n\"><a href=\"#oslo-i18n\" class=\"headerlink\" title=\"oslo.i18n\"></a>oslo.i18n</h3><p>是对Python gettext的封装，主要用于字符串翻译和国际化</p>\n<h3 id=\"oslo-messaging\"><a href=\"#oslo-messaging\" class=\"headerlink\" title=\"oslo.messaging\"></a>oslo.messaging</h3><p>Openstack各项目使用RPC和事件通知的统一的接口。其中包括下面4个对象。</p>\n<h4 id=\"Transport\"><a href=\"#Transport\" class=\"headerlink\" title=\"Transport\"></a>Transport</h4><p>传输层，主要实现RPC底层的通信，支持rabbit、qpid、zmq三种协议。可以通过URL来指定不同的transport的实现。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transport://user:pass@host1:port[,hostN:portN]/virtual_host</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Target\"><a href=\"#Target\" class=\"headerlink\" title=\"Target\"></a>Target</h4><p>封装了指定某一消息最终目的地的所有信息</p>\n<h4 id=\"Server\"><a href=\"#Server\" class=\"headerlink\" title=\"Server\"></a>Server</h4><p>即服务端，创建一个Server对象需要指定Transport、Target、endpoints(包含多组可被远程调用的方法，比如某一资源包含CUID四个操作）</p>\n<h4 id=\"RPC-Client\"><a href=\"#RPC-Client\" class=\"headerlink\" title=\"RPC Client\"></a>RPC Client</h4><p>即客户端，一个RPC Client可以调用RPC Server上的方法。</p>\n<h4 id=\"Notifier\"><a href=\"#Notifier\" class=\"headerlink\" title=\"Notifier\"></a>Notifier</h4><p>Notifier是一个用来发送通知消息的对象。格式如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    message_id:six_text_type(uuid.uuid4()), #消息id号</span><br><span class=\"line\">    publisher_id:&apos;computer.host1&apos;,#发送者id</span><br><span class=\"line\">    timestamp:timeutils.utcnow(),#时间戳</span><br><span class=\"line\">    priority:&apos;WARN&apos;, # 通知优先级</span><br><span class=\"line\">    event_type:&apos;compute.create_instance&apos;,#通知类型</span><br><span class=\"line\">    payload:&#123;&apos;instance_id&apos;:12,...&#125; #通知内容</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Notifier-Listener\"><a href=\"#Notifier-Listener\" class=\"headerlink\" title=\"Notifier Listener\"></a>Notifier Listener</h4><p>消息监听者，跟Server类似，可以暴露多个endpoint，每个endpoint中也可以包含多种方法，但是它们只是对应者不同的消息优先级。（P118）</p>"},{"title":"pygobject-tutorial-1","date":"2016-11-08T08:55:47.000Z","_content":"# 基础\n这章将会介绍GTK+比较重要的几个方面\n## 主循环和信号\n就像大部分GUI库一样，GTK+使用了一种事件驱动的编程模型。当用户什么都没做，GTK+让主循环处于就绪状态并等待用户的输入。如果用户做了一些动作，比如鼠标事件，主循环就会被唤醒，然后将这个事件传递给GTK+程序。\n<!-- more -->\n当部件收到一个事件，它们将会频繁的发出一个或者更多的信号，这些信号将会调用与之相绑定的函数。这样的函数通常被称作回调函数。当回调函数被调用时，你就可以进行一些操作了。比如说，你可能要弹出一个文件选择对话框当一个“打开”按钮被点击的之后。当回调函数执行完毕之后，GTK+将会返回到主循环然后等待用户再一次输入。\n\n一个典型的例子：\n```python\nhandler_id = widget.connect('event',callback,data)\n```\n首先，`widget`是一个之前以及创建好的widget实例。接着，我们来看看事件，每个部件都有它自己的事件。举个例子，如果你有一个按钮，那么你往往希望绑定它的点击事件。这样只要按钮被点击，你就能收到它所触发的信号。然后，参数`callback`代表者需要调用的回调函数的名字，它包含者将要运行的代码，当特定的信号产生之后。最后，`data`参数包含着任意你想要传递的数据，这个参数是一个可选参数，如果不需要可以省略。\n该方法返回一个数值，标志着这个signal-callback对。当这个函数再也不会","source":"_posts/pygobject-tutorial-1.md","raw":"---\ntitle: pygobject-tutorial-1\ndate: 2016-11-08 16:55:47\ntags: [python,gtk]\ncategories:\n- Python\n---\n# 基础\n这章将会介绍GTK+比较重要的几个方面\n## 主循环和信号\n就像大部分GUI库一样，GTK+使用了一种事件驱动的编程模型。当用户什么都没做，GTK+让主循环处于就绪状态并等待用户的输入。如果用户做了一些动作，比如鼠标事件，主循环就会被唤醒，然后将这个事件传递给GTK+程序。\n<!-- more -->\n当部件收到一个事件，它们将会频繁的发出一个或者更多的信号，这些信号将会调用与之相绑定的函数。这样的函数通常被称作回调函数。当回调函数被调用时，你就可以进行一些操作了。比如说，你可能要弹出一个文件选择对话框当一个“打开”按钮被点击的之后。当回调函数执行完毕之后，GTK+将会返回到主循环然后等待用户再一次输入。\n\n一个典型的例子：\n```python\nhandler_id = widget.connect('event',callback,data)\n```\n首先，`widget`是一个之前以及创建好的widget实例。接着，我们来看看事件，每个部件都有它自己的事件。举个例子，如果你有一个按钮，那么你往往希望绑定它的点击事件。这样只要按钮被点击，你就能收到它所触发的信号。然后，参数`callback`代表者需要调用的回调函数的名字，它包含者将要运行的代码，当特定的信号产生之后。最后，`data`参数包含着任意你想要传递的数据，这个参数是一个可选参数，如果不需要可以省略。\n该方法返回一个数值，标志着这个signal-callback对。当这个函数再也不会","slug":"pygobject-tutorial-1","published":1,"updated":"2019-10-11T05:50:15.690Z","_id":"ciz5e9l21004a5rgxtp6trlpu","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h1><p>这章将会介绍GTK+比较重要的几个方面</p>\n<h2 id=\"主循环和信号\"><a href=\"#主循环和信号\" class=\"headerlink\" title=\"主循环和信号\"></a>主循环和信号</h2><p>就像大部分GUI库一样，GTK+使用了一种事件驱动的编程模型。当用户什么都没做，GTK+让主循环处于就绪状态并等待用户的输入。如果用户做了一些动作，比如鼠标事件，主循环就会被唤醒，然后将这个事件传递给GTK+程序。<br><a id=\"more\"></a><br>当部件收到一个事件，它们将会频繁的发出一个或者更多的信号，这些信号将会调用与之相绑定的函数。这样的函数通常被称作回调函数。当回调函数被调用时，你就可以进行一些操作了。比如说，你可能要弹出一个文件选择对话框当一个“打开”按钮被点击的之后。当回调函数执行完毕之后，GTK+将会返回到主循环然后等待用户再一次输入。</p>\n<p>一个典型的例子：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">handler_id = widget.connect(<span class=\"string\">'event'</span>,callback,data)</span><br></pre></td></tr></table></figure></p>\n<p>首先，<code>widget</code>是一个之前以及创建好的widget实例。接着，我们来看看事件，每个部件都有它自己的事件。举个例子，如果你有一个按钮，那么你往往希望绑定它的点击事件。这样只要按钮被点击，你就能收到它所触发的信号。然后，参数<code>callback</code>代表者需要调用的回调函数的名字，它包含者将要运行的代码，当特定的信号产生之后。最后，<code>data</code>参数包含着任意你想要传递的数据，这个参数是一个可选参数，如果不需要可以省略。<br>该方法返回一个数值，标志着这个signal-callback对。当这个函数再也不会</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"基础\"><a href=\"#基础\" class=\"headerlink\" title=\"基础\"></a>基础</h1><p>这章将会介绍GTK+比较重要的几个方面</p>\n<h2 id=\"主循环和信号\"><a href=\"#主循环和信号\" class=\"headerlink\" title=\"主循环和信号\"></a>主循环和信号</h2><p>就像大部分GUI库一样，GTK+使用了一种事件驱动的编程模型。当用户什么都没做，GTK+让主循环处于就绪状态并等待用户的输入。如果用户做了一些动作，比如鼠标事件，主循环就会被唤醒，然后将这个事件传递给GTK+程序。<br>","more":"<br>当部件收到一个事件，它们将会频繁的发出一个或者更多的信号，这些信号将会调用与之相绑定的函数。这样的函数通常被称作回调函数。当回调函数被调用时，你就可以进行一些操作了。比如说，你可能要弹出一个文件选择对话框当一个“打开”按钮被点击的之后。当回调函数执行完毕之后，GTK+将会返回到主循环然后等待用户再一次输入。</p>\n<p>一个典型的例子：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">handler_id = widget.connect(<span class=\"string\">'event'</span>,callback,data)</span><br></pre></td></tr></table></figure></p>\n<p>首先，<code>widget</code>是一个之前以及创建好的widget实例。接着，我们来看看事件，每个部件都有它自己的事件。举个例子，如果你有一个按钮，那么你往往希望绑定它的点击事件。这样只要按钮被点击，你就能收到它所触发的信号。然后，参数<code>callback</code>代表者需要调用的回调函数的名字，它包含者将要运行的代码，当特定的信号产生之后。最后，<code>data</code>参数包含着任意你想要传递的数据，这个参数是一个可选参数，如果不需要可以省略。<br>该方法返回一个数值，标志着这个signal-callback对。当这个函数再也不会</p>"},{"title":"POJ1989 Distance Queries","id":"42","date":"2014-08-01T06:30:11.000Z","_content":"##Description\n\nFarmer John's cows refused to run in his marathon since he chose a path much too long for their leisurely lifestyle. He therefore wants to find a path of a more reasonable length. The input to this problem consists of the same input as in \"Navigation Nightmare\",followed by a line containing a single integer K, followed by K \"distance queries\". Each distance query is a line of input containing two integers, giving the numbers of two farms between which FJ is interested in computing distance (measured in the length of the roads along the path between the two farms). Please answer FJ's distance queries as quickly as possible!\n<!--more-->\n##Input\n\n\n-  Lines 1..1+M: Same format as \"Navigation Nightmare\"\n-  Line 2+M: A single integer, K. 1 &lt;= K &lt;= 10,000\n-  Lines 3+M..2+M+K: Each line corresponds to a distance query and contains the indices of two farms.\n\n##Output\n\n- Lines 1..K: For each distance query, output on a single line an integer giving the appropriate distance.\n\n##Sample Input\n\n7 6\n1 6 13 E\n6 3 9 E\n3 5 7 S\n4 1 3 N\n2 4 20 W\n4 7 2 S\n3\n1 6\n1 4\n2 6\n\n\n##Sample Output\n13\n3\n36\n\n##Hint\nFarms 2 and 6 are 20+3+13=36 apart.\n\n##Source\n[USACO 2004 February](http://poj.org/searchproblem?field=source&amp;key=USACO+2004+February)\n<br/>\n\n- - -\n\n- 无向树求节点距离：`dist(u,v)=dist(root,u)+dist(root,v)-2*dist(root,lca(u,v))`\n- tarjan+并查集求LCA。注意可能树不连通。\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SI(x) set&lt;x&gt;::iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 40005\n#define M 40005\nint n, m;\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, w, nxt;\n} e[M &lt;&lt; 1];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v, int w) {\n    e[pos].v = v;\n    e[pos].w = w;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//UnionSet\nint p[N];\nvoid initUset() {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    return x == p[x] ? p[x] : p[x] = uFind(p[x]);\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy) p[fy] = fx;\n}\n//tarjan-LCA\nint size,bcnt;\nint lca[10005];\nint vis[N];\nint dis[N];\nint ans[10005];\nvector&lt;pr&lt;int, int&gt; &gt; query[N];\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (!vis[i]) return i;\n    }\n    return assert(false),-1;\n}\nint dfs(int u, int fa) {\n    int solved = 0;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        if (v == fa) continue;\n        dis[v] = dis[u] + e[i].w;\n        solved += dfs(v, u);\n        if (solved == size) return solved;\n        uMerge(u, v);\n    }\n    vis[u] = bcnt;\n    for (int i = 0; i &lt; (int) query[u].size(); i++) {\n        int v = query[u][i].F;\n        if (vis[v]==bcnt) {\n            solved++;\n            lca[query[u][i].S] = uFind(v);\n            ans[query[u][i].S] = dis[u] + dis[v] - 2 * dis[lca[query[u][i].S]];\n        }\n    }\n    return solved;\n}\nvoid tarjan() {\n    clrA(vis, 0);\n    clrA(dis, 0);\n    int tot = 0;\n    bcnt=0;\n    do {\n        bcnt++;//从1开始\n        tot += dfs(findRoot(), -1);\n    } while (tot &lt; size);//图可能不连通\n}\n\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        int u, v, w;\n        char c;\n        initEdge();\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d %c\", &amp;u, &amp;v, &amp;w, &amp;c);\n            add(u, v, w);\n            add(v, u, w);\n        }\n        initUset();\n        scanf(\"%d\", &amp;size);\n        for (int i = 1; i &lt;= n; i++)\n            query[i].clear();\n        for (int i = 1; i &lt;= size; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            query[u].push_back(MP(v, i));\n            query[v].push_back(MP(u, i));\n        }\n        tarjan();\n        for (int i = 1; i &lt;= size; i++) {\n            printf(\"%d\\n\", ans[i]);\n        }\n    }\n}\n```\n\n另外，还可以转化为RMQ问题求解：\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 40005\n#define M 40005\nint n, m;\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, w, nxt;\n} e[M &lt;&lt; 1];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v, int w) {\n    e[pos].v = v;\n    e[pos].w = w;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//RMQ\nint dpM[20][N&lt;&lt;1|1];//dpM[i][j]  从j开始的，连续2^i个数字的最值,j从1开始\nint lg2[N&lt;&lt;1|1];//等价于 (int)lg2(1.0*m)/lg2(2.0) 若空间不足可以这样写\n#define getLeft(R,L) (R-(L)+1) //输入右端点和长度，返回左端点\nvoid initRMQ(int n) {\n    lg2[0]=-1;int limit;\n    for(int i=1;i&lt;=n;i++) {\n        lg2[i]=(i&amp;(i-1))?lg2[i-1]:lg2[i-1]+1;\n    }\n    for(int i=1;i&lt;=lg2[n];i++){\n        limit=getLeft(n,1&lt;&lt;i);\n        for(int j=1;j&lt;=limit;j++){\n            dpM[i][j]=min(dpM[i-1][j],dpM[i-1][j+(1&lt;&lt;i&gt;&gt;1)]);\n        }\n    }\n}\nint getRMQ(int a,int b) {\n    int t=lg2[b-a+1];\n    int s1=a;\n    int s2=getLeft(b,1&lt;&lt;t);\n    //return max(Max[t][s1],Max[t][s2]);\n    return min(dpM[t][s1],dpM[t][s2]);\n}\n#undef getLeft\n//LCA\nint dist[N];\nint H[N];//节点第一次出现的位置\nint E[N&lt;&lt;1|1];//欧拉序列2n+1个\nint cnt,depth;\nint findRoot(){\n    for(int i=1;i&lt;=n;i++)return i;\n    return -1;\n}\nvoid getEuler(int u=findRoot(),int fa=-1){\n    int tmp=dpM[0][H[u]=++cnt]=++depth;\n    E[tmp]=u;\n    for(int i=head[u];~i;i=e[i].nxt){\n        int v=e[i].v;\n        if(v==fa)continue;\n        dist[v]=dist[u]+e[i].w;\n        getEuler(v,u);\n        dpM[0][++cnt]=tmp;\n    }\n}\nvoid initLCA(){\n    memset(dist,0,sizeof(dist));\n    cnt=depth=0;\n    getEuler();\n    initRMQ(cnt);\n}\nint getLCA(int u,int v){\n    if(H[u]&gt;H[v])swap(u,v);\n    return E[getRMQ(H[u],H[v])];\n}\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        int u, v, w;\n        char c;\n        initEdge();\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d %c\", &amp;u, &amp;v, &amp;w, &amp;c);\n            add(u, v, w);\n            add(v, u, w);\n        }\n        initLCA();\n        scanf(\"%d\",&amp;m);\n        while(m--){\n            scanf(\"%d%d\",&amp;u,&amp;v);\n            printf(\"%d\\n\",dist[u]+dist[v]-2*dist[getLCA(u,v)]);\n        }\n    }\n}\n```","source":"_posts/poj1989-distance-queries.md","raw":"title: POJ1989 Distance Queries\ntags:\n  - LCA\n  - RMQ\n  - 图论\n  - tarjan\ncategories:\n  - ACM\nid: 42\ndate: 2014-08-01 14:30:11\n---\n##Description\n\nFarmer John's cows refused to run in his marathon since he chose a path much too long for their leisurely lifestyle. He therefore wants to find a path of a more reasonable length. The input to this problem consists of the same input as in \"Navigation Nightmare\",followed by a line containing a single integer K, followed by K \"distance queries\". Each distance query is a line of input containing two integers, giving the numbers of two farms between which FJ is interested in computing distance (measured in the length of the roads along the path between the two farms). Please answer FJ's distance queries as quickly as possible!\n<!--more-->\n##Input\n\n\n-  Lines 1..1+M: Same format as \"Navigation Nightmare\"\n-  Line 2+M: A single integer, K. 1 &lt;= K &lt;= 10,000\n-  Lines 3+M..2+M+K: Each line corresponds to a distance query and contains the indices of two farms.\n\n##Output\n\n- Lines 1..K: For each distance query, output on a single line an integer giving the appropriate distance.\n\n##Sample Input\n\n7 6\n1 6 13 E\n6 3 9 E\n3 5 7 S\n4 1 3 N\n2 4 20 W\n4 7 2 S\n3\n1 6\n1 4\n2 6\n\n\n##Sample Output\n13\n3\n36\n\n##Hint\nFarms 2 and 6 are 20+3+13=36 apart.\n\n##Source\n[USACO 2004 February](http://poj.org/searchproblem?field=source&amp;key=USACO+2004+February)\n<br/>\n\n- - -\n\n- 无向树求节点距离：`dist(u,v)=dist(root,u)+dist(root,v)-2*dist(root,lca(u,v))`\n- tarjan+并查集求LCA。注意可能树不连通。\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SI(x) set&lt;x&gt;::iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 40005\n#define M 40005\nint n, m;\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, w, nxt;\n} e[M &lt;&lt; 1];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v, int w) {\n    e[pos].v = v;\n    e[pos].w = w;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//UnionSet\nint p[N];\nvoid initUset() {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    return x == p[x] ? p[x] : p[x] = uFind(p[x]);\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy) p[fy] = fx;\n}\n//tarjan-LCA\nint size,bcnt;\nint lca[10005];\nint vis[N];\nint dis[N];\nint ans[10005];\nvector&lt;pr&lt;int, int&gt; &gt; query[N];\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (!vis[i]) return i;\n    }\n    return assert(false),-1;\n}\nint dfs(int u, int fa) {\n    int solved = 0;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        if (v == fa) continue;\n        dis[v] = dis[u] + e[i].w;\n        solved += dfs(v, u);\n        if (solved == size) return solved;\n        uMerge(u, v);\n    }\n    vis[u] = bcnt;\n    for (int i = 0; i &lt; (int) query[u].size(); i++) {\n        int v = query[u][i].F;\n        if (vis[v]==bcnt) {\n            solved++;\n            lca[query[u][i].S] = uFind(v);\n            ans[query[u][i].S] = dis[u] + dis[v] - 2 * dis[lca[query[u][i].S]];\n        }\n    }\n    return solved;\n}\nvoid tarjan() {\n    clrA(vis, 0);\n    clrA(dis, 0);\n    int tot = 0;\n    bcnt=0;\n    do {\n        bcnt++;//从1开始\n        tot += dfs(findRoot(), -1);\n    } while (tot &lt; size);//图可能不连通\n}\n\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        int u, v, w;\n        char c;\n        initEdge();\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d %c\", &amp;u, &amp;v, &amp;w, &amp;c);\n            add(u, v, w);\n            add(v, u, w);\n        }\n        initUset();\n        scanf(\"%d\", &amp;size);\n        for (int i = 1; i &lt;= n; i++)\n            query[i].clear();\n        for (int i = 1; i &lt;= size; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            query[u].push_back(MP(v, i));\n            query[v].push_back(MP(u, i));\n        }\n        tarjan();\n        for (int i = 1; i &lt;= size; i++) {\n            printf(\"%d\\n\", ans[i]);\n        }\n    }\n}\n```\n\n另外，还可以转化为RMQ问题求解：\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 40005\n#define M 40005\nint n, m;\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, w, nxt;\n} e[M &lt;&lt; 1];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v, int w) {\n    e[pos].v = v;\n    e[pos].w = w;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//RMQ\nint dpM[20][N&lt;&lt;1|1];//dpM[i][j]  从j开始的，连续2^i个数字的最值,j从1开始\nint lg2[N&lt;&lt;1|1];//等价于 (int)lg2(1.0*m)/lg2(2.0) 若空间不足可以这样写\n#define getLeft(R,L) (R-(L)+1) //输入右端点和长度，返回左端点\nvoid initRMQ(int n) {\n    lg2[0]=-1;int limit;\n    for(int i=1;i&lt;=n;i++) {\n        lg2[i]=(i&amp;(i-1))?lg2[i-1]:lg2[i-1]+1;\n    }\n    for(int i=1;i&lt;=lg2[n];i++){\n        limit=getLeft(n,1&lt;&lt;i);\n        for(int j=1;j&lt;=limit;j++){\n            dpM[i][j]=min(dpM[i-1][j],dpM[i-1][j+(1&lt;&lt;i&gt;&gt;1)]);\n        }\n    }\n}\nint getRMQ(int a,int b) {\n    int t=lg2[b-a+1];\n    int s1=a;\n    int s2=getLeft(b,1&lt;&lt;t);\n    //return max(Max[t][s1],Max[t][s2]);\n    return min(dpM[t][s1],dpM[t][s2]);\n}\n#undef getLeft\n//LCA\nint dist[N];\nint H[N];//节点第一次出现的位置\nint E[N&lt;&lt;1|1];//欧拉序列2n+1个\nint cnt,depth;\nint findRoot(){\n    for(int i=1;i&lt;=n;i++)return i;\n    return -1;\n}\nvoid getEuler(int u=findRoot(),int fa=-1){\n    int tmp=dpM[0][H[u]=++cnt]=++depth;\n    E[tmp]=u;\n    for(int i=head[u];~i;i=e[i].nxt){\n        int v=e[i].v;\n        if(v==fa)continue;\n        dist[v]=dist[u]+e[i].w;\n        getEuler(v,u);\n        dpM[0][++cnt]=tmp;\n    }\n}\nvoid initLCA(){\n    memset(dist,0,sizeof(dist));\n    cnt=depth=0;\n    getEuler();\n    initRMQ(cnt);\n}\nint getLCA(int u,int v){\n    if(H[u]&gt;H[v])swap(u,v);\n    return E[getRMQ(H[u],H[v])];\n}\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        int u, v, w;\n        char c;\n        initEdge();\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d %c\", &amp;u, &amp;v, &amp;w, &amp;c);\n            add(u, v, w);\n            add(v, u, w);\n        }\n        initLCA();\n        scanf(\"%d\",&amp;m);\n        while(m--){\n            scanf(\"%d%d\",&amp;u,&amp;v);\n            printf(\"%d\\n\",dist[u]+dist[v]-2*dist[getLCA(u,v)]);\n        }\n    }\n}\n```","slug":"poj1989-distance-queries","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l22004e5rgxwu69cxu8","content":"<p>##Description</p>\n<p>Farmer John’s cows refused to run in his marathon since he chose a path much too long for their leisurely lifestyle. He therefore wants to find a path of a more reasonable length. The input to this problem consists of the same input as in “Navigation Nightmare”,followed by a line containing a single integer K, followed by K “distance queries”. Each distance query is a line of input containing two integers, giving the numbers of two farms between which FJ is interested in computing distance (measured in the length of the roads along the path between the two farms). Please answer FJ’s distance queries as quickly as possible!<br><a id=\"more\"></a></p>\n<p>##Input</p>\n<ul>\n<li>Lines 1..1+M: Same format as “Navigation Nightmare”</li>\n<li>Line 2+M: A single integer, K. 1 &lt;= K &lt;= 10,000</li>\n<li>Lines 3+M..2+M+K: Each line corresponds to a distance query and contains the indices of two farms.</li>\n</ul>\n<p>##Output</p>\n<ul>\n<li>Lines 1..K: For each distance query, output on a single line an integer giving the appropriate distance.</li>\n</ul>\n<p>##Sample Input</p>\n<p>7 6<br>1 6 13 E<br>6 3 9 E<br>3 5 7 S<br>4 1 3 N<br>2 4 20 W<br>4 7 2 S<br>3<br>1 6<br>1 4<br>2 6</p>\n<p>##Sample Output<br>13<br>3<br>36</p>\n<p>##Hint<br>Farms 2 and 6 are 20+3+13=36 apart.</p>\n<p>##Source<br><a href=\"http://poj.org/searchproblem?field=source&amp;key=USACO+2004+February\" target=\"_blank\" rel=\"external\">USACO 2004 February</a><br><br></p>\n<hr>\n<ul>\n<li>无向树求节点距离：<code>dist(u,v)=dist(root,u)+dist(root,v)-2*dist(root,lca(u,v))</code></li>\n<li>tarjan+并查集求LCA。注意可能树不连通。</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 40005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 40005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, w, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v, <span class=\"keyword\">int</span> w)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].w = w;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> x == p[x] ? p[x] : p[x] = uFind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy) p[fy] = fx;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//tarjan-LCA</span></div><div class=\"line\"><span class=\"keyword\">int</span> size,bcnt;</div><div class=\"line\"><span class=\"keyword\">int</span> lca[<span class=\"number\">10005</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> dis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> ans[<span class=\"number\">10005</span>];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pr&amp;lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&amp;gt; &amp;gt; query[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!vis[i]) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> assert(<span class=\"literal\">false</span>),<span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> solved = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        <span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        dis[v] = dis[u] + e[i].w;</div><div class=\"line\">        solved += dfs(v, u);</div><div class=\"line\">        <span class=\"keyword\">if</span> (solved == size) <span class=\"keyword\">return</span> solved;</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    vis[u] = bcnt;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) query[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = query[u][i].F;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]==bcnt) &#123;</div><div class=\"line\">            solved++;</div><div class=\"line\">            lca[query[u][i].S] = uFind(v);</div><div class=\"line\">            ans[query[u][i].S] = dis[u] + dis[v] - <span class=\"number\">2</span> * dis[lca[query[u][i].S]];</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> solved;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    clrA(vis, <span class=\"number\">0</span>);</div><div class=\"line\">    clrA(dis, <span class=\"number\">0</span>);</div><div class=\"line\">    <span class=\"keyword\">int</span> tot = <span class=\"number\">0</span>;</div><div class=\"line\">    bcnt=<span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">do</span> &#123;</div><div class=\"line\">        bcnt++;<span class=\"comment\">//从1开始</span></div><div class=\"line\">        tot += dfs(findRoot(), <span class=\"number\">-1</span>);</div><div class=\"line\">    &#125; <span class=\"keyword\">while</span> (tot &amp;lt; size);<span class=\"comment\">//图可能不连通</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">char</span> c;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d %c\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w, &amp;amp;c);</div><div class=\"line\">            add(u, v, w);</div><div class=\"line\">            add(v, u, w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initUset();</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;size);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++)</div><div class=\"line\">            query[i].clear();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            query[u].push_back(MP(v, i));</div><div class=\"line\">            query[v].push_back(MP(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, ans[i]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>另外，还可以转化为RMQ问题求解：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clrA(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">#define N 40005</div><div class=\"line\">#define M 40005</div><div class=\"line\">int n, m;</div><div class=\"line\">//Edge Graph</div><div class=\"line\">int head[N], pos;</div><div class=\"line\">struct Edge &#123;</div><div class=\"line\">    int v, w, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; 1];</div><div class=\"line\">void initEdge() &#123;</div><div class=\"line\">    memset(head, -1, sizeof(head));</div><div class=\"line\">    pos = 0;</div><div class=\"line\">&#125;</div><div class=\"line\">void add(int u, int v, int w) &#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].w = w;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\">//RMQ</div><div class=\"line\">int dpM[20][N&amp;lt;&amp;lt;1|1];//dpM[i][j]  从j开始的，连续2^i个数字的最值,j从1开始</div><div class=\"line\">int lg2[N&amp;lt;&amp;lt;1|1];//等价于 (int)lg2(1.0*m)/lg2(2.0) 若空间不足可以这样写</div><div class=\"line\">#define getLeft(R,L) (R-(L)+1) //输入右端点和长度，返回左端点</div><div class=\"line\">void initRMQ(int n) &#123;</div><div class=\"line\">    lg2[0]=-1;int limit;</div><div class=\"line\">    for(int i=1;i&amp;lt;=n;i++) &#123;</div><div class=\"line\">        lg2[i]=(i&amp;amp;(i-1))?lg2[i-1]:lg2[i-1]+1;</div><div class=\"line\">    &#125;</div><div class=\"line\">    for(int i=1;i&amp;lt;=lg2[n];i++)&#123;</div><div class=\"line\">        limit=getLeft(n,1&amp;lt;&amp;lt;i);</div><div class=\"line\">        for(int j=1;j&amp;lt;=limit;j++)&#123;</div><div class=\"line\">            dpM[i][j]=min(dpM[i-1][j],dpM[i-1][j+(1&amp;lt;&amp;lt;i&amp;gt;&amp;gt;1)]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int getRMQ(int a,int b) &#123;</div><div class=\"line\">    int t=lg2[b-a+1];</div><div class=\"line\">    int s1=a;</div><div class=\"line\">    int s2=getLeft(b,1&amp;lt;&amp;lt;t);</div><div class=\"line\">    //return max(Max[t][s1],Max[t][s2]);</div><div class=\"line\">    return min(dpM[t][s1],dpM[t][s2]);</div><div class=\"line\">&#125;</div><div class=\"line\">#undef getLeft</div><div class=\"line\">//LCA</div><div class=\"line\">int dist[N];</div><div class=\"line\">int H[N];//节点第一次出现的位置</div><div class=\"line\">int E[N&amp;lt;&amp;lt;1|1];//欧拉序列2n+1个</div><div class=\"line\">int cnt,depth;</div><div class=\"line\">int findRoot()&#123;</div><div class=\"line\">    for(int i=1;i&amp;lt;=n;i++)return i;</div><div class=\"line\">    return -1;</div><div class=\"line\">&#125;</div><div class=\"line\">void getEuler(int u=findRoot(),int fa=-1)&#123;</div><div class=\"line\">    int tmp=dpM[0][H[u]=++cnt]=++depth;</div><div class=\"line\">    E[tmp]=u;</div><div class=\"line\">    for(int i=head[u];~i;i=e[i].nxt)&#123;</div><div class=\"line\">        int v=e[i].v;</div><div class=\"line\">        if(v==fa)continue;</div><div class=\"line\">        dist[v]=dist[u]+e[i].w;</div><div class=\"line\">        getEuler(v,u);</div><div class=\"line\">        dpM[0][++cnt]=tmp;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">void initLCA()&#123;</div><div class=\"line\">    memset(dist,0,sizeof(dist));</div><div class=\"line\">    cnt=depth=0;</div><div class=\"line\">    getEuler();</div><div class=\"line\">    initRMQ(cnt);</div><div class=\"line\">&#125;</div><div class=\"line\">int getLCA(int u,int v)&#123;</div><div class=\"line\">    if(H[u]&amp;gt;H[v])swap(u,v);</div><div class=\"line\">    return E[getRMQ(H[u],H[v])];</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">    while (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        int u, v, w;</div><div class=\"line\">        char c;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        for (int i = 1; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            scanf(\"%d%d%d %c\", &amp;amp;u, &amp;amp;v, &amp;amp;w, &amp;amp;c);</div><div class=\"line\">            add(u, v, w);</div><div class=\"line\">            add(v, u, w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        scanf(\"%d\",&amp;amp;m);</div><div class=\"line\">        while(m--)&#123;</div><div class=\"line\">            scanf(\"%d%d\",&amp;amp;u,&amp;amp;v);</div><div class=\"line\">            printf(\"%d\\n\",dist[u]+dist[v]-2*dist[getLCA(u,v)]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p>##Description</p>\n<p>Farmer John’s cows refused to run in his marathon since he chose a path much too long for their leisurely lifestyle. He therefore wants to find a path of a more reasonable length. The input to this problem consists of the same input as in “Navigation Nightmare”,followed by a line containing a single integer K, followed by K “distance queries”. Each distance query is a line of input containing two integers, giving the numbers of two farms between which FJ is interested in computing distance (measured in the length of the roads along the path between the two farms). Please answer FJ’s distance queries as quickly as possible!<br>","more":"</p>\n<p>##Input</p>\n<ul>\n<li>Lines 1..1+M: Same format as “Navigation Nightmare”</li>\n<li>Line 2+M: A single integer, K. 1 &lt;= K &lt;= 10,000</li>\n<li>Lines 3+M..2+M+K: Each line corresponds to a distance query and contains the indices of two farms.</li>\n</ul>\n<p>##Output</p>\n<ul>\n<li>Lines 1..K: For each distance query, output on a single line an integer giving the appropriate distance.</li>\n</ul>\n<p>##Sample Input</p>\n<p>7 6<br>1 6 13 E<br>6 3 9 E<br>3 5 7 S<br>4 1 3 N<br>2 4 20 W<br>4 7 2 S<br>3<br>1 6<br>1 4<br>2 6</p>\n<p>##Sample Output<br>13<br>3<br>36</p>\n<p>##Hint<br>Farms 2 and 6 are 20+3+13=36 apart.</p>\n<p>##Source<br><a href=\"http://poj.org/searchproblem?field=source&amp;key=USACO+2004+February\">USACO 2004 February</a><br><br/></p>\n<hr>\n<ul>\n<li>无向树求节点距离：<code>dist(u,v)=dist(root,u)+dist(root,v)-2*dist(root,lca(u,v))</code></li>\n<li>tarjan+并查集求LCA。注意可能树不连通。</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 40005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 40005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, w, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v, <span class=\"keyword\">int</span> w)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].w = w;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> x == p[x] ? p[x] : p[x] = uFind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy) p[fy] = fx;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//tarjan-LCA</span></div><div class=\"line\"><span class=\"keyword\">int</span> size,bcnt;</div><div class=\"line\"><span class=\"keyword\">int</span> lca[<span class=\"number\">10005</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> dis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> ans[<span class=\"number\">10005</span>];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pr&amp;lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&amp;gt; &amp;gt; query[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!vis[i]) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> assert(<span class=\"literal\">false</span>),<span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> solved = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        <span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        dis[v] = dis[u] + e[i].w;</div><div class=\"line\">        solved += dfs(v, u);</div><div class=\"line\">        <span class=\"keyword\">if</span> (solved == size) <span class=\"keyword\">return</span> solved;</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    vis[u] = bcnt;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) query[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = query[u][i].F;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]==bcnt) &#123;</div><div class=\"line\">            solved++;</div><div class=\"line\">            lca[query[u][i].S] = uFind(v);</div><div class=\"line\">            ans[query[u][i].S] = dis[u] + dis[v] - <span class=\"number\">2</span> * dis[lca[query[u][i].S]];</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> solved;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    clrA(vis, <span class=\"number\">0</span>);</div><div class=\"line\">    clrA(dis, <span class=\"number\">0</span>);</div><div class=\"line\">    <span class=\"keyword\">int</span> tot = <span class=\"number\">0</span>;</div><div class=\"line\">    bcnt=<span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">do</span> &#123;</div><div class=\"line\">        bcnt++;<span class=\"comment\">//从1开始</span></div><div class=\"line\">        tot += dfs(findRoot(), <span class=\"number\">-1</span>);</div><div class=\"line\">    &#125; <span class=\"keyword\">while</span> (tot &amp;lt; size);<span class=\"comment\">//图可能不连通</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">char</span> c;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d %c\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w, &amp;amp;c);</div><div class=\"line\">            add(u, v, w);</div><div class=\"line\">            add(v, u, w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initUset();</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;size);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++)</div><div class=\"line\">            query[i].clear();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            query[u].push_back(MP(v, i));</div><div class=\"line\">            query[v].push_back(MP(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, ans[i]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>另外，还可以转化为RMQ问题求解：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clrA(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">#define N 40005</div><div class=\"line\">#define M 40005</div><div class=\"line\">int n, m;</div><div class=\"line\">//Edge Graph</div><div class=\"line\">int head[N], pos;</div><div class=\"line\">struct Edge &#123;</div><div class=\"line\">    int v, w, nxt;</div><div class=\"line\">&#125; e[M &amp;lt;&amp;lt; 1];</div><div class=\"line\">void initEdge() &#123;</div><div class=\"line\">    memset(head, -1, sizeof(head));</div><div class=\"line\">    pos = 0;</div><div class=\"line\">&#125;</div><div class=\"line\">void add(int u, int v, int w) &#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].w = w;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\">//RMQ</div><div class=\"line\">int dpM[20][N&amp;lt;&amp;lt;1|1];//dpM[i][j]  从j开始的，连续2^i个数字的最值,j从1开始</div><div class=\"line\">int lg2[N&amp;lt;&amp;lt;1|1];//等价于 (int)lg2(1.0*m)/lg2(2.0) 若空间不足可以这样写</div><div class=\"line\">#define getLeft(R,L) (R-(L)+1) //输入右端点和长度，返回左端点</div><div class=\"line\">void initRMQ(int n) &#123;</div><div class=\"line\">    lg2[0]=-1;int limit;</div><div class=\"line\">    for(int i=1;i&amp;lt;=n;i++) &#123;</div><div class=\"line\">        lg2[i]=(i&amp;amp;(i-1))?lg2[i-1]:lg2[i-1]+1;</div><div class=\"line\">    &#125;</div><div class=\"line\">    for(int i=1;i&amp;lt;=lg2[n];i++)&#123;</div><div class=\"line\">        limit=getLeft(n,1&amp;lt;&amp;lt;i);</div><div class=\"line\">        for(int j=1;j&amp;lt;=limit;j++)&#123;</div><div class=\"line\">            dpM[i][j]=min(dpM[i-1][j],dpM[i-1][j+(1&amp;lt;&amp;lt;i&amp;gt;&amp;gt;1)]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int getRMQ(int a,int b) &#123;</div><div class=\"line\">    int t=lg2[b-a+1];</div><div class=\"line\">    int s1=a;</div><div class=\"line\">    int s2=getLeft(b,1&amp;lt;&amp;lt;t);</div><div class=\"line\">    //return max(Max[t][s1],Max[t][s2]);</div><div class=\"line\">    return min(dpM[t][s1],dpM[t][s2]);</div><div class=\"line\">&#125;</div><div class=\"line\">#undef getLeft</div><div class=\"line\">//LCA</div><div class=\"line\">int dist[N];</div><div class=\"line\">int H[N];//节点第一次出现的位置</div><div class=\"line\">int E[N&amp;lt;&amp;lt;1|1];//欧拉序列2n+1个</div><div class=\"line\">int cnt,depth;</div><div class=\"line\">int findRoot()&#123;</div><div class=\"line\">    for(int i=1;i&amp;lt;=n;i++)return i;</div><div class=\"line\">    return -1;</div><div class=\"line\">&#125;</div><div class=\"line\">void getEuler(int u=findRoot(),int fa=-1)&#123;</div><div class=\"line\">    int tmp=dpM[0][H[u]=++cnt]=++depth;</div><div class=\"line\">    E[tmp]=u;</div><div class=\"line\">    for(int i=head[u];~i;i=e[i].nxt)&#123;</div><div class=\"line\">        int v=e[i].v;</div><div class=\"line\">        if(v==fa)continue;</div><div class=\"line\">        dist[v]=dist[u]+e[i].w;</div><div class=\"line\">        getEuler(v,u);</div><div class=\"line\">        dpM[0][++cnt]=tmp;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">void initLCA()&#123;</div><div class=\"line\">    memset(dist,0,sizeof(dist));</div><div class=\"line\">    cnt=depth=0;</div><div class=\"line\">    getEuler();</div><div class=\"line\">    initRMQ(cnt);</div><div class=\"line\">&#125;</div><div class=\"line\">int getLCA(int u,int v)&#123;</div><div class=\"line\">    if(H[u]&amp;gt;H[v])swap(u,v);</div><div class=\"line\">    return E[getRMQ(H[u],H[v])];</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">    while (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        int u, v, w;</div><div class=\"line\">        char c;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        for (int i = 1; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            scanf(\"%d%d%d %c\", &amp;amp;u, &amp;amp;v, &amp;amp;w, &amp;amp;c);</div><div class=\"line\">            add(u, v, w);</div><div class=\"line\">            add(v, u, w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        scanf(\"%d\",&amp;amp;m);</div><div class=\"line\">        while(m--)&#123;</div><div class=\"line\">            scanf(\"%d%d\",&amp;amp;u,&amp;amp;v);</div><div class=\"line\">            printf(\"%d\\n\",dist[u]+dist[v]-2*dist[getLCA(u,v)]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"POJ1330 Nearest Common Ancestors","id":"39","date":"2014-08-01T02:43:01.000Z","_content":"\nTime Limit: 1000MS Memory Limit: 10000K  \nTotal Submissions: 17734 Accepted: 9405\n\n##Description\nA rooted tree is a well-known data structure in computer science and engineering. An example is shown below:\n\nIn the figure, each node is labeled with an integer from {1, 2,...,16}. Node 8 is the root of the tree. Node x is an ancestor of node y if node x is in the path between the root and node y. For example, node 4 is an ancestor of node 16\\. Node 10 is also an ancestor of node 16\\. As a matter of fact, nodes 8, 4, 10, and 16 are the ancestors of node 16\\. Remember that a node is an ancestor of itself. Nodes 8, 4, 6, and 7 are the ancestors of node 7\\. A node x is called a common ancestor of two different nodes y and z if node x is an ancestor of node y and an ancestor of node z. Thus, nodes 8 and 4 are the common ancestors of nodes 16 and 7\\. A node x is called the nearest common ancestor of nodes y and z if x is a common ancestor of y and z and nearest to y and z among their common ancestors. Hence, the nearest common ancestor of nodes 16 and 7 is node 4\\. Node 4 is nearer to nodes 16 and 7 than node 8 is.\n<!--more-->\nFor other examples, the nearest common ancestor of nodes 2 and 3 is node 10, the nearest common ancestor of nodes 6 and 13 is node 8, and the nearest common ancestor of nodes 4 and 12 is node 4\\. In the last example, if y is an ancestor of z, then the nearest common ancestor of y and z is y.\n\nWrite a program that finds the nearest common ancestor of two distinct nodes in a tree.\n\n##Input\nThe input consists of T test cases. The number of test cases (T) is given in the first line of the input file. Each test case starts with a line containing an integer N , the number of nodes in a tree, 2&lt;=N&lt;=10,000\\. The nodes are labeled with integers 1, 2,..., N. Each of the next N -1 lines contains a pair of integers that represent an edge --the first integer is the parent node of the second integer. Note that a tree with N nodes has exactly N - 1 edges. The last line of each test case contains two distinct integers whose nearest common ancestor is to be computed.\n\n##Output\nPrint exactly one line for each test case. The line should contain the integer that is the nearest common ancestor.\n\n##Sample Input\n\n2\n16\n1 14\n8 5\n10 16\n5 9\n4 6\n8 4\n4 10\n1 13\n6 15\n10 11\n6 7\n10 2\n16 3\n8 1\n16 12\n16 7\n5\n2 3\n3 4\n3 1\n1 5\n3 5\n\n##Sample Output\n\n4\n3\n\n##Source\nTaejon 2002\n<br/>\n\n- - -\n\n\ntarjan+并查集求LCA模板。将u的子儿子v递归合并到u，若y在x的子树上，则根据并查集的性质，公共祖先即为x（father[y]）。若y和x不再同一子树上。则根据dfs回溯的性质，则搜完y之后一定是回溯到x,y的最近公共祖先才能搜到x的，而此时由并查集的性质，回溯的节点刚好就是father[y]。\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SI(x) set&lt;x&gt;::iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf=~0u&gt;&gt;1;\nconst LL lnf=~0ull&gt;&gt;1;\n#define N 10005\n#define M 10005\nint n, m;\n//UnionSet\nint p[N];\nvoid initUset() {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    return x == p[x] ? p[x] : p[x] = uFind(p[x]);\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy)\n        p[fy]=fx;\n}\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, nxt;\n} e[M];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\nint findRoot(){//有向图选择入度为0的点，无向图不同节点做根，LCA结果将不同。\n    for (int i = 1; i &lt; n; i++)\n        if (indeg[i] == 0) return i;\n    return assert(false),-1;\n}\n//LCA\nint size, root;\nint vis[N];\nint ans[5];\nint indeg[N];\nvector&lt;pr&lt;int, int&gt; &gt; que[N];\nint dfs(int u) {\n    int solved=0;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        solved+=dfs(v);\n        if(solved==size)return solved;\n        uMerge(u, v);\n    }\n    vis[u] = 1;\n    for (int i = 0; i &lt; (int) que[u].size(); i++) {\n        int v = que[u][i].F;\n        if (vis[v]) {\n            ans[que[u][i].S] = uFind(v);\n            solved++;\n        }\n    }\n    return solved;\n}\nvoid tarjan() {\n    clrA(vis,0);\n    dfs(findRoot());\n}\nint main() {\n    int T;\n    scanf(\"%d\", &amp;T);\n    while (T--) {\n        scanf(\"%d\", &amp;n);\n        initEdge();\n        int u, v;\n        clrA(indeg,0);\n        for (int i = 1; i &lt; n; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            add(u, v);\n            indeg[v]++;\n        }\n        initUset();\n        size = 1;//查询的次数\n        for(int i=1;i&lt;=n;i++)que[i].clear();\n        for (int i = 1; i &lt;= size; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            que[u].push_back(MP(v, i));\n            que[v].push_back(MP(u, i));\n        }\n        tarjan();\n        for (int i = 1; i &lt;= size; i++) {\n            printf(\"%d\\n\", ans[i]);\n        }\n    }\n}\n```\nLCA还可以用倍增来求：（思想很普通，只是以2进制的步长向上走：dp[i][j]表示节点i向上走2^j步到达的节点。）\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define qlr(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 10005\n#define M N-1\nint n;\nint head[N], pos;\nstruct edge {\n    int v, nxt;\n} e[M];\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\nvoid initEdge() {\n    clr(head, -1);\n    pos = 0;\n}\nint deep[N];\nvector&lt;int&gt; dp[N];\nint size;\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (dp[i].empty()) return i;\n    }\n    return -1;\n}\nvoid getDeep(int u = findRoot()) {\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        deep[v] = deep[u] + 1;\n        getDeep(v);\n    }\n    size = max(size, deep[u] + 1);//记录最大深度\n}\nvoid initLCA() {\n    clr(deep, 0);\n    size = 0;\n    getDeep();\n    for (int len = 1,t=2;t&lt;=size; len++,t&lt;&lt;=1) {//跳出条件：(t=2^len)&lt;=size\n        for (int i = 1; i &lt;= n; i++) {\n            if ((int)dp[i].size() &gt;= len &amp;&amp; (int)dp[dp[i][len-1]].size() &gt;= len) {\n                dp[i].push_back(dp[dp[i][len-1]][len-1]);\n            }\n        }\n    }\n}\nint getLCA(int u, int v) {\n    if (deep[u] &lt; deep[v]) swap(u, v);\n    int d = deep[u] - deep[v];\n    for (int i = 0; d; i++, d &gt;&gt;= 1) {\n        u = d &amp; 1 ? dp[u][i] : u;\n    }//以差值二进制形式将u往上走差值\n    if (u == v) return u;\n    for (int i = min(dp[u].size(),dp[v].size())-1; i &gt;= 0; i--) {\n        if (dp[u][i] != dp[v][i]) {\n            u = dp[u][i];\n            v = dp[v][i];\n            i=(int)min(dp[u].size(),dp[v].size());//注意每次都要更新i！！\n        }\n    }\n    u = dp[u][0];\n    return u;\n}\nint main() {\n    int T;\n    cin &gt;&gt; T;\n    while (T--) {\n        scanf(\"%d\", &amp;n);\n        int u, v;\n        initEdge();\n        for (int i = 1; i &lt;= n; i++)\n            dp[i].clear();\n        for (int i = 1; i &lt; n; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            add(u, v);\n            dp[v].push_back(u);\n        }\n        initLCA();\n        scanf(\"%d%d\", &amp;u, &amp;v);\n        printf(\"%d\\n\", getLCA(u, v));\n    }\n}\n```\nLCA还可以转化为RMQ问题（个人更喜欢此方法，在线，且效率高）\n```C++\n//============================================================================\n// Name        : test3.cpp\n// Author      : \n// Version     :\n// Copyright   : Your copyright notice\n// Description : Hello World in C++, Ansi-style\n//============================================================================\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\nint n, m;\n#define N 10005\n#define M 10005\nint head[N], pos;\nstruct Edge {\n    int v, nxt;\n} e[M];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//RMQ\nint dpM[20][N &lt;&lt; 1 | 1];\nint lg2[N &lt;&lt; 1 | 1];\n#define getLeft(R,L) (R-(L)+1)\nvoid initRMQ(int n) { //dp[0][i]表示区间i的值。预先处理出来。\n    lg2[0] = -1;\n    int limit;\n    for (int i = 1; i &lt;= n; i++) {\n        lg2[i] = i &amp; (i - 1) ? lg2[i - 1] : lg2[i - 1] + 1;\n    }\n    for (int i = 1; i &lt;= lg2[n]; i++) {\n        limit = getLeft(n, 1 &lt;&lt; i);\n        for (int j = 1; j &lt;= limit; j++) {\n            dpM[i][j] = min(dpM[i - 1][j], dpM[i - 1][j + (1 &lt;&lt; (i - 1))]);\n        }\n    }\n}\nint getRMQ(int x, int y) {\n    if (x &gt; y) swap(x, y);\n    int t = lg2[y - x + 1];\n    return min(dpM[t][x], dpM[t][getLeft(y, 1 &lt;&lt; t)]);\n}\n//LCA\nint depth, cnt;\nint inde[N], H[N], E[N];\n//dp[0][N&lt;&lt;1|1]深度序列（dfs编号），E[N]每个dfs编号对应的节点，H[N]节点第一次出现在dfs编号序列中的位置\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++)\n        if (!inde[i]) return i;\n    return -1;\n}\nvoid getEuler(int u = findRoot()) {\n    int dfn = dpM[0][H[u] = ++cnt] = ++depth;\n    E[dfn] = u;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        getEuler(v);\n        dpM[0][++cnt] = dfn;\n    }\n}\nvoid initLCA() {\n    depth = cnt = 0;\n    getEuler();\n    initRMQ(cnt);\n}\nint getLCA(int u, int v) {\n    if (H[u] &gt; H[v]) swap(u, v);\n    return E[getRMQ(H[u], H[v])];\n}\nint main() {\n    int T;\n    scanf(\"%d\", &amp;T);\n    while (T--) {\n        scanf(\"%d\", &amp;n);m=n-1;\n        int u, v;\n        initEdge();\n        memset(inde, 0, sizeof(inde));\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            add(u, v);\n            inde[v]++;\n        }\n        initLCA();\n        scanf(\"%d%d\", &amp;u, &amp;v);\n        printf(\"%d\\n\", getLCA(u, v));\n    }\n}\n```\n&nbsp;","source":"_posts/poj1330-nearest-common-ancestors.md","raw":"title: POJ1330 Nearest Common Ancestors\ntags:\n  - LCA\n  - 图论\n  - tarjan\n  - 倍增\ncategories:\n  - ACM\nid: 39\ndate: 2014-08-01 10:43:01\n---\n\nTime Limit: 1000MS Memory Limit: 10000K  \nTotal Submissions: 17734 Accepted: 9405\n\n##Description\nA rooted tree is a well-known data structure in computer science and engineering. An example is shown below:\n\nIn the figure, each node is labeled with an integer from {1, 2,...,16}. Node 8 is the root of the tree. Node x is an ancestor of node y if node x is in the path between the root and node y. For example, node 4 is an ancestor of node 16\\. Node 10 is also an ancestor of node 16\\. As a matter of fact, nodes 8, 4, 10, and 16 are the ancestors of node 16\\. Remember that a node is an ancestor of itself. Nodes 8, 4, 6, and 7 are the ancestors of node 7\\. A node x is called a common ancestor of two different nodes y and z if node x is an ancestor of node y and an ancestor of node z. Thus, nodes 8 and 4 are the common ancestors of nodes 16 and 7\\. A node x is called the nearest common ancestor of nodes y and z if x is a common ancestor of y and z and nearest to y and z among their common ancestors. Hence, the nearest common ancestor of nodes 16 and 7 is node 4\\. Node 4 is nearer to nodes 16 and 7 than node 8 is.\n<!--more-->\nFor other examples, the nearest common ancestor of nodes 2 and 3 is node 10, the nearest common ancestor of nodes 6 and 13 is node 8, and the nearest common ancestor of nodes 4 and 12 is node 4\\. In the last example, if y is an ancestor of z, then the nearest common ancestor of y and z is y.\n\nWrite a program that finds the nearest common ancestor of two distinct nodes in a tree.\n\n##Input\nThe input consists of T test cases. The number of test cases (T) is given in the first line of the input file. Each test case starts with a line containing an integer N , the number of nodes in a tree, 2&lt;=N&lt;=10,000\\. The nodes are labeled with integers 1, 2,..., N. Each of the next N -1 lines contains a pair of integers that represent an edge --the first integer is the parent node of the second integer. Note that a tree with N nodes has exactly N - 1 edges. The last line of each test case contains two distinct integers whose nearest common ancestor is to be computed.\n\n##Output\nPrint exactly one line for each test case. The line should contain the integer that is the nearest common ancestor.\n\n##Sample Input\n\n2\n16\n1 14\n8 5\n10 16\n5 9\n4 6\n8 4\n4 10\n1 13\n6 15\n10 11\n6 7\n10 2\n16 3\n8 1\n16 12\n16 7\n5\n2 3\n3 4\n3 1\n1 5\n3 5\n\n##Sample Output\n\n4\n3\n\n##Source\nTaejon 2002\n<br/>\n\n- - -\n\n\ntarjan+并查集求LCA模板。将u的子儿子v递归合并到u，若y在x的子树上，则根据并查集的性质，公共祖先即为x（father[y]）。若y和x不再同一子树上。则根据dfs回溯的性质，则搜完y之后一定是回溯到x,y的最近公共祖先才能搜到x的，而此时由并查集的性质，回溯的节点刚好就是father[y]。\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SI(x) set&lt;x&gt;::iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf=~0u&gt;&gt;1;\nconst LL lnf=~0ull&gt;&gt;1;\n#define N 10005\n#define M 10005\nint n, m;\n//UnionSet\nint p[N];\nvoid initUset() {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    return x == p[x] ? p[x] : p[x] = uFind(p[x]);\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy)\n        p[fy]=fx;\n}\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, nxt;\n} e[M];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\nint findRoot(){//有向图选择入度为0的点，无向图不同节点做根，LCA结果将不同。\n    for (int i = 1; i &lt; n; i++)\n        if (indeg[i] == 0) return i;\n    return assert(false),-1;\n}\n//LCA\nint size, root;\nint vis[N];\nint ans[5];\nint indeg[N];\nvector&lt;pr&lt;int, int&gt; &gt; que[N];\nint dfs(int u) {\n    int solved=0;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        solved+=dfs(v);\n        if(solved==size)return solved;\n        uMerge(u, v);\n    }\n    vis[u] = 1;\n    for (int i = 0; i &lt; (int) que[u].size(); i++) {\n        int v = que[u][i].F;\n        if (vis[v]) {\n            ans[que[u][i].S] = uFind(v);\n            solved++;\n        }\n    }\n    return solved;\n}\nvoid tarjan() {\n    clrA(vis,0);\n    dfs(findRoot());\n}\nint main() {\n    int T;\n    scanf(\"%d\", &amp;T);\n    while (T--) {\n        scanf(\"%d\", &amp;n);\n        initEdge();\n        int u, v;\n        clrA(indeg,0);\n        for (int i = 1; i &lt; n; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            add(u, v);\n            indeg[v]++;\n        }\n        initUset();\n        size = 1;//查询的次数\n        for(int i=1;i&lt;=n;i++)que[i].clear();\n        for (int i = 1; i &lt;= size; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            que[u].push_back(MP(v, i));\n            que[v].push_back(MP(u, i));\n        }\n        tarjan();\n        for (int i = 1; i &lt;= size; i++) {\n            printf(\"%d\\n\", ans[i]);\n        }\n    }\n}\n```\nLCA还可以用倍增来求：（思想很普通，只是以2进制的步长向上走：dp[i][j]表示节点i向上走2^j步到达的节点。）\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define qlr(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 10005\n#define M N-1\nint n;\nint head[N], pos;\nstruct edge {\n    int v, nxt;\n} e[M];\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\nvoid initEdge() {\n    clr(head, -1);\n    pos = 0;\n}\nint deep[N];\nvector&lt;int&gt; dp[N];\nint size;\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (dp[i].empty()) return i;\n    }\n    return -1;\n}\nvoid getDeep(int u = findRoot()) {\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        deep[v] = deep[u] + 1;\n        getDeep(v);\n    }\n    size = max(size, deep[u] + 1);//记录最大深度\n}\nvoid initLCA() {\n    clr(deep, 0);\n    size = 0;\n    getDeep();\n    for (int len = 1,t=2;t&lt;=size; len++,t&lt;&lt;=1) {//跳出条件：(t=2^len)&lt;=size\n        for (int i = 1; i &lt;= n; i++) {\n            if ((int)dp[i].size() &gt;= len &amp;&amp; (int)dp[dp[i][len-1]].size() &gt;= len) {\n                dp[i].push_back(dp[dp[i][len-1]][len-1]);\n            }\n        }\n    }\n}\nint getLCA(int u, int v) {\n    if (deep[u] &lt; deep[v]) swap(u, v);\n    int d = deep[u] - deep[v];\n    for (int i = 0; d; i++, d &gt;&gt;= 1) {\n        u = d &amp; 1 ? dp[u][i] : u;\n    }//以差值二进制形式将u往上走差值\n    if (u == v) return u;\n    for (int i = min(dp[u].size(),dp[v].size())-1; i &gt;= 0; i--) {\n        if (dp[u][i] != dp[v][i]) {\n            u = dp[u][i];\n            v = dp[v][i];\n            i=(int)min(dp[u].size(),dp[v].size());//注意每次都要更新i！！\n        }\n    }\n    u = dp[u][0];\n    return u;\n}\nint main() {\n    int T;\n    cin &gt;&gt; T;\n    while (T--) {\n        scanf(\"%d\", &amp;n);\n        int u, v;\n        initEdge();\n        for (int i = 1; i &lt;= n; i++)\n            dp[i].clear();\n        for (int i = 1; i &lt; n; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            add(u, v);\n            dp[v].push_back(u);\n        }\n        initLCA();\n        scanf(\"%d%d\", &amp;u, &amp;v);\n        printf(\"%d\\n\", getLCA(u, v));\n    }\n}\n```\nLCA还可以转化为RMQ问题（个人更喜欢此方法，在线，且效率高）\n```C++\n//============================================================================\n// Name        : test3.cpp\n// Author      : \n// Version     :\n// Copyright   : Your copyright notice\n// Description : Hello World in C++, Ansi-style\n//============================================================================\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\nint n, m;\n#define N 10005\n#define M 10005\nint head[N], pos;\nstruct Edge {\n    int v, nxt;\n} e[M];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//RMQ\nint dpM[20][N &lt;&lt; 1 | 1];\nint lg2[N &lt;&lt; 1 | 1];\n#define getLeft(R,L) (R-(L)+1)\nvoid initRMQ(int n) { //dp[0][i]表示区间i的值。预先处理出来。\n    lg2[0] = -1;\n    int limit;\n    for (int i = 1; i &lt;= n; i++) {\n        lg2[i] = i &amp; (i - 1) ? lg2[i - 1] : lg2[i - 1] + 1;\n    }\n    for (int i = 1; i &lt;= lg2[n]; i++) {\n        limit = getLeft(n, 1 &lt;&lt; i);\n        for (int j = 1; j &lt;= limit; j++) {\n            dpM[i][j] = min(dpM[i - 1][j], dpM[i - 1][j + (1 &lt;&lt; (i - 1))]);\n        }\n    }\n}\nint getRMQ(int x, int y) {\n    if (x &gt; y) swap(x, y);\n    int t = lg2[y - x + 1];\n    return min(dpM[t][x], dpM[t][getLeft(y, 1 &lt;&lt; t)]);\n}\n//LCA\nint depth, cnt;\nint inde[N], H[N], E[N];\n//dp[0][N&lt;&lt;1|1]深度序列（dfs编号），E[N]每个dfs编号对应的节点，H[N]节点第一次出现在dfs编号序列中的位置\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++)\n        if (!inde[i]) return i;\n    return -1;\n}\nvoid getEuler(int u = findRoot()) {\n    int dfn = dpM[0][H[u] = ++cnt] = ++depth;\n    E[dfn] = u;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        getEuler(v);\n        dpM[0][++cnt] = dfn;\n    }\n}\nvoid initLCA() {\n    depth = cnt = 0;\n    getEuler();\n    initRMQ(cnt);\n}\nint getLCA(int u, int v) {\n    if (H[u] &gt; H[v]) swap(u, v);\n    return E[getRMQ(H[u], H[v])];\n}\nint main() {\n    int T;\n    scanf(\"%d\", &amp;T);\n    while (T--) {\n        scanf(\"%d\", &amp;n);m=n-1;\n        int u, v;\n        initEdge();\n        memset(inde, 0, sizeof(inde));\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d\", &amp;u, &amp;v);\n            add(u, v);\n            inde[v]++;\n        }\n        initLCA();\n        scanf(\"%d%d\", &amp;u, &amp;v);\n        printf(\"%d\\n\", getLCA(u, v));\n    }\n}\n```\n&nbsp;","slug":"poj1330-nearest-common-ancestors","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l23004h5rgx4muzrsh9","content":"<p>Time Limit: 1000MS Memory Limit: 10000K<br>Total Submissions: 17734 Accepted: 9405</p>\n<p>##Description<br>A rooted tree is a well-known data structure in computer science and engineering. An example is shown below:</p>\n<p>In the figure, each node is labeled with an integer from {1, 2,…,16}. Node 8 is the root of the tree. Node x is an ancestor of node y if node x is in the path between the root and node y. For example, node 4 is an ancestor of node 16. Node 10 is also an ancestor of node 16. As a matter of fact, nodes 8, 4, 10, and 16 are the ancestors of node 16. Remember that a node is an ancestor of itself. Nodes 8, 4, 6, and 7 are the ancestors of node 7. A node x is called a common ancestor of two different nodes y and z if node x is an ancestor of node y and an ancestor of node z. Thus, nodes 8 and 4 are the common ancestors of nodes 16 and 7. A node x is called the nearest common ancestor of nodes y and z if x is a common ancestor of y and z and nearest to y and z among their common ancestors. Hence, the nearest common ancestor of nodes 16 and 7 is node 4. Node 4 is nearer to nodes 16 and 7 than node 8 is.<br><a id=\"more\"></a><br>For other examples, the nearest common ancestor of nodes 2 and 3 is node 10, the nearest common ancestor of nodes 6 and 13 is node 8, and the nearest common ancestor of nodes 4 and 12 is node 4. In the last example, if y is an ancestor of z, then the nearest common ancestor of y and z is y.</p>\n<p>Write a program that finds the nearest common ancestor of two distinct nodes in a tree.</p>\n<p>##Input<br>The input consists of T test cases. The number of test cases (T) is given in the first line of the input file. Each test case starts with a line containing an integer N , the number of nodes in a tree, 2&lt;=N&lt;=10,000. The nodes are labeled with integers 1, 2,…, N. Each of the next N -1 lines contains a pair of integers that represent an edge –the first integer is the parent node of the second integer. Note that a tree with N nodes has exactly N - 1 edges. The last line of each test case contains two distinct integers whose nearest common ancestor is to be computed.</p>\n<p>##Output<br>Print exactly one line for each test case. The line should contain the integer that is the nearest common ancestor.</p>\n<p>##Sample Input</p>\n<p>2<br>16<br>1 14<br>8 5<br>10 16<br>5 9<br>4 6<br>8 4<br>4 10<br>1 13<br>6 15<br>10 11<br>6 7<br>10 2<br>16 3<br>8 1<br>16 12<br>16 7<br>5<br>2 3<br>3 4<br>3 1<br>1 5<br>3 5</p>\n<p>##Sample Output</p>\n<p>4<br>3</p>\n<p>##Source<br>Taejon 2002<br><br></p>\n<hr>\n<p>tarjan+并查集求LCA模板。将u的子儿子v递归合并到u，若y在x的子树上，则根据并查集的性质，公共祖先即为x（father[y]）。若y和x不再同一子树上。则根据dfs回溯的性质，则搜完y之后一定是回溯到x,y的最近公共祖先才能搜到x的，而此时由并查集的性质，回溯的节点刚好就是father[y]。<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf=~<span class=\"number\">0u</span>&amp;gt;&amp;gt;<span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf=~<span class=\"number\">0u</span>ll&amp;gt;&amp;gt;<span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 10005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 10005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> x == p[x] ? p[x] : p[x] = uFind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy)</div><div class=\"line\">        p[fy]=fx;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, nxt;</div><div class=\"line\">&#125; e[M];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span></span>&#123;<span class=\"comment\">//有向图选择入度为0的点，无向图不同节点做根，LCA结果将不同。</span></div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; n; i++)</div><div class=\"line\">        <span class=\"keyword\">if</span> (indeg[i] == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    <span class=\"keyword\">return</span> assert(<span class=\"literal\">false</span>),<span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//LCA</span></div><div class=\"line\"><span class=\"keyword\">int</span> size, root;</div><div class=\"line\"><span class=\"keyword\">int</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> ans[<span class=\"number\">5</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> indeg[N];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pr&amp;lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&amp;gt; &amp;gt; que[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> solved=<span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        solved+=dfs(v);</div><div class=\"line\">        <span class=\"keyword\">if</span>(solved==size)<span class=\"keyword\">return</span> solved;</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    vis[u] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) que[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = que[u][i].F;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]) &#123;</div><div class=\"line\">            ans[que[u][i].S] = uFind(v);</div><div class=\"line\">            solved++;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> solved;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    clrA(vis,<span class=\"number\">0</span>);</div><div class=\"line\">    dfs(findRoot());</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> T;</div><div class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;T);</div><div class=\"line\">    <span class=\"keyword\">while</span> (T--) &#123;</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;n);</div><div class=\"line\">        initEdge();</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v;</div><div class=\"line\">        clrA(indeg,<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            add(u, v);</div><div class=\"line\">            indeg[v]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        initUset();</div><div class=\"line\">        size = <span class=\"number\">1</span>;<span class=\"comment\">//查询的次数</span></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)que[i].clear();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            que[u].push_back(MP(v, i));</div><div class=\"line\">            que[v].push_back(MP(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, ans[i]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>LCA还可以用倍增来求：（思想很普通，只是以2进制的步长向上走：dp[i][j]表示节点i向上走2^j步到达的节点。）<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;cmath&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define qlr(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clr(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">#define N 10005</div><div class=\"line\">#define M N-1</div><div class=\"line\">int n;</div><div class=\"line\">int head[N], pos;</div><div class=\"line\">struct edge &#123;</div><div class=\"line\">    int v, nxt;</div><div class=\"line\">&#125; e[M];</div><div class=\"line\">void add(int u, int v) &#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\">void initEdge() &#123;</div><div class=\"line\">    clr(head, -1);</div><div class=\"line\">    pos = 0;</div><div class=\"line\">&#125;</div><div class=\"line\">int deep[N];</div><div class=\"line\">vector&amp;lt;int&amp;gt; dp[N];</div><div class=\"line\">int size;</div><div class=\"line\">int findRoot() &#123;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        if (dp[i].empty()) return i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    return -1;</div><div class=\"line\">&#125;</div><div class=\"line\">void getDeep(int u = findRoot()) &#123;</div><div class=\"line\">    for (int i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        int v = e[i].v;</div><div class=\"line\">        deep[v] = deep[u] + 1;</div><div class=\"line\">        getDeep(v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    size = max(size, deep[u] + 1);//记录最大深度</div><div class=\"line\">&#125;</div><div class=\"line\">void initLCA() &#123;</div><div class=\"line\">    clr(deep, 0);</div><div class=\"line\">    size = 0;</div><div class=\"line\">    getDeep();</div><div class=\"line\">    for (int len = 1,t=2;t&amp;lt;=size; len++,t&amp;lt;&amp;lt;=1) &#123;//跳出条件：(t=2^len)&amp;lt;=size</div><div class=\"line\">        for (int i = 1; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">            if ((int)dp[i].size() &amp;gt;= len &amp;amp;&amp;amp; (int)dp[dp[i][len-1]].size() &amp;gt;= len) &#123;</div><div class=\"line\">                dp[i].push_back(dp[dp[i][len-1]][len-1]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int getLCA(int u, int v) &#123;</div><div class=\"line\">    if (deep[u] &amp;lt; deep[v]) swap(u, v);</div><div class=\"line\">    int d = deep[u] - deep[v];</div><div class=\"line\">    for (int i = 0; d; i++, d &amp;gt;&amp;gt;= 1) &#123;</div><div class=\"line\">        u = d &amp;amp; 1 ? dp[u][i] : u;</div><div class=\"line\">    &#125;//以差值二进制形式将u往上走差值</div><div class=\"line\">    if (u == v) return u;</div><div class=\"line\">    for (int i = min(dp[u].size(),dp[v].size())-1; i &amp;gt;= 0; i--) &#123;</div><div class=\"line\">        if (dp[u][i] != dp[v][i]) &#123;</div><div class=\"line\">            u = dp[u][i];</div><div class=\"line\">            v = dp[v][i];</div><div class=\"line\">            i=(int)min(dp[u].size(),dp[v].size());//注意每次都要更新i！！</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    u = dp[u][0];</div><div class=\"line\">    return u;</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">    int T;</div><div class=\"line\">    cin &amp;gt;&amp;gt; T;</div><div class=\"line\">    while (T--) &#123;</div><div class=\"line\">        scanf(\"%d\", &amp;amp;n);</div><div class=\"line\">        int u, v;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        for (int i = 1; i &amp;lt;= n; i++)</div><div class=\"line\">            dp[i].clear();</div><div class=\"line\">        for (int i = 1; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            add(u, v);</div><div class=\"line\">            dp[v].push_back(u);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">        printf(\"%d\\n\", getLCA(u, v));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>LCA还可以转化为RMQ问题（个人更喜欢此方法，在线，且效率高）<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div></pre></td><td class=\"code\"><pre><div class=\"line\">//============================================================================</div><div class=\"line\">// Name        : test3.cpp</div><div class=\"line\">// Author      : </div><div class=\"line\">// Version     :</div><div class=\"line\">// Copyright   : Your copyright notice</div><div class=\"line\">// Description : Hello World in C++, Ansi-style</div><div class=\"line\">//============================================================================</div><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clrA(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">int n, m;</div><div class=\"line\">#define N 10005</div><div class=\"line\">#define M 10005</div><div class=\"line\">int head[N], pos;</div><div class=\"line\">struct Edge &#123;</div><div class=\"line\">    int v, nxt;</div><div class=\"line\">&#125; e[M];</div><div class=\"line\">void initEdge() &#123;</div><div class=\"line\">    memset(head, -1, sizeof(head));</div><div class=\"line\">    pos = 0;</div><div class=\"line\">&#125;</div><div class=\"line\">void add(int u, int v) &#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\">//RMQ</div><div class=\"line\">int dpM[20][N &amp;lt;&amp;lt; 1 | 1];</div><div class=\"line\">int lg2[N &amp;lt;&amp;lt; 1 | 1];</div><div class=\"line\">#define getLeft(R,L) (R-(L)+1)</div><div class=\"line\">void initRMQ(int n) &#123; //dp[0][i]表示区间i的值。预先处理出来。</div><div class=\"line\">    lg2[0] = -1;</div><div class=\"line\">    int limit;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        lg2[i] = i &amp;amp; (i - 1) ? lg2[i - 1] : lg2[i - 1] + 1;</div><div class=\"line\">    &#125;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= lg2[n]; i++) &#123;</div><div class=\"line\">        limit = getLeft(n, 1 &amp;lt;&amp;lt; i);</div><div class=\"line\">        for (int j = 1; j &amp;lt;= limit; j++) &#123;</div><div class=\"line\">            dpM[i][j] = min(dpM[i - 1][j], dpM[i - 1][j + (1 &amp;lt;&amp;lt; (i - 1))]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int getRMQ(int x, int y) &#123;</div><div class=\"line\">    if (x &amp;gt; y) swap(x, y);</div><div class=\"line\">    int t = lg2[y - x + 1];</div><div class=\"line\">    return min(dpM[t][x], dpM[t][getLeft(y, 1 &amp;lt;&amp;lt; t)]);</div><div class=\"line\">&#125;</div><div class=\"line\">//LCA</div><div class=\"line\">int depth, cnt;</div><div class=\"line\">int inde[N], H[N], E[N];</div><div class=\"line\">//dp[0][N&amp;lt;&amp;lt;1|1]深度序列（dfs编号），E[N]每个dfs编号对应的节点，H[N]节点第一次出现在dfs编号序列中的位置</div><div class=\"line\">int findRoot() &#123;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= n; i++)</div><div class=\"line\">        if (!inde[i]) return i;</div><div class=\"line\">    return -1;</div><div class=\"line\">&#125;</div><div class=\"line\">void getEuler(int u = findRoot()) &#123;</div><div class=\"line\">    int dfn = dpM[0][H[u] = ++cnt] = ++depth;</div><div class=\"line\">    E[dfn] = u;</div><div class=\"line\">    for (int i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        int v = e[i].v;</div><div class=\"line\">        getEuler(v);</div><div class=\"line\">        dpM[0][++cnt] = dfn;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">void initLCA() &#123;</div><div class=\"line\">    depth = cnt = 0;</div><div class=\"line\">    getEuler();</div><div class=\"line\">    initRMQ(cnt);</div><div class=\"line\">&#125;</div><div class=\"line\">int getLCA(int u, int v) &#123;</div><div class=\"line\">    if (H[u] &amp;gt; H[v]) swap(u, v);</div><div class=\"line\">    return E[getRMQ(H[u], H[v])];</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">    int T;</div><div class=\"line\">    scanf(\"%d\", &amp;amp;T);</div><div class=\"line\">    while (T--) &#123;</div><div class=\"line\">        scanf(\"%d\", &amp;amp;n);m=n-1;</div><div class=\"line\">        int u, v;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        memset(inde, 0, sizeof(inde));</div><div class=\"line\">        for (int i = 1; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            add(u, v);</div><div class=\"line\">            inde[v]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">        printf(\"%d\\n\", getLCA(u, v));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>&nbsp;</p>\n","excerpt":"<p>Time Limit: 1000MS Memory Limit: 10000K<br>Total Submissions: 17734 Accepted: 9405</p>\n<p>##Description<br>A rooted tree is a well-known data structure in computer science and engineering. An example is shown below:</p>\n<p>In the figure, each node is labeled with an integer from {1, 2,…,16}. Node 8 is the root of the tree. Node x is an ancestor of node y if node x is in the path between the root and node y. For example, node 4 is an ancestor of node 16. Node 10 is also an ancestor of node 16. As a matter of fact, nodes 8, 4, 10, and 16 are the ancestors of node 16. Remember that a node is an ancestor of itself. Nodes 8, 4, 6, and 7 are the ancestors of node 7. A node x is called a common ancestor of two different nodes y and z if node x is an ancestor of node y and an ancestor of node z. Thus, nodes 8 and 4 are the common ancestors of nodes 16 and 7. A node x is called the nearest common ancestor of nodes y and z if x is a common ancestor of y and z and nearest to y and z among their common ancestors. Hence, the nearest common ancestor of nodes 16 and 7 is node 4. Node 4 is nearer to nodes 16 and 7 than node 8 is.<br>","more":"<br>For other examples, the nearest common ancestor of nodes 2 and 3 is node 10, the nearest common ancestor of nodes 6 and 13 is node 8, and the nearest common ancestor of nodes 4 and 12 is node 4. In the last example, if y is an ancestor of z, then the nearest common ancestor of y and z is y.</p>\n<p>Write a program that finds the nearest common ancestor of two distinct nodes in a tree.</p>\n<p>##Input<br>The input consists of T test cases. The number of test cases (T) is given in the first line of the input file. Each test case starts with a line containing an integer N , the number of nodes in a tree, 2&lt;=N&lt;=10,000. The nodes are labeled with integers 1, 2,…, N. Each of the next N -1 lines contains a pair of integers that represent an edge –the first integer is the parent node of the second integer. Note that a tree with N nodes has exactly N - 1 edges. The last line of each test case contains two distinct integers whose nearest common ancestor is to be computed.</p>\n<p>##Output<br>Print exactly one line for each test case. The line should contain the integer that is the nearest common ancestor.</p>\n<p>##Sample Input</p>\n<p>2<br>16<br>1 14<br>8 5<br>10 16<br>5 9<br>4 6<br>8 4<br>4 10<br>1 13<br>6 15<br>10 11<br>6 7<br>10 2<br>16 3<br>8 1<br>16 12<br>16 7<br>5<br>2 3<br>3 4<br>3 1<br>1 5<br>3 5</p>\n<p>##Sample Output</p>\n<p>4<br>3</p>\n<p>##Source<br>Taejon 2002<br><br/></p>\n<hr>\n<p>tarjan+并查集求LCA模板。将u的子儿子v递归合并到u，若y在x的子树上，则根据并查集的性质，公共祖先即为x（father[y]）。若y和x不再同一子树上。则根据dfs回溯的性质，则搜完y之后一定是回溯到x,y的最近公共祖先才能搜到x的，而此时由并查集的性质，回溯的节点刚好就是father[y]。<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf=~<span class=\"number\">0u</span>&amp;gt;&amp;gt;<span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf=~<span class=\"number\">0u</span>ll&amp;gt;&amp;gt;<span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 10005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 10005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> x == p[x] ? p[x] : p[x] = uFind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy)</div><div class=\"line\">        p[fy]=fx;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, nxt;</div><div class=\"line\">&#125; e[M];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span></span>&#123;<span class=\"comment\">//有向图选择入度为0的点，无向图不同节点做根，LCA结果将不同。</span></div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; n; i++)</div><div class=\"line\">        <span class=\"keyword\">if</span> (indeg[i] == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    <span class=\"keyword\">return</span> assert(<span class=\"literal\">false</span>),<span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//LCA</span></div><div class=\"line\"><span class=\"keyword\">int</span> size, root;</div><div class=\"line\"><span class=\"keyword\">int</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> ans[<span class=\"number\">5</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> indeg[N];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pr&amp;lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&amp;gt; &amp;gt; que[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> solved=<span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        solved+=dfs(v);</div><div class=\"line\">        <span class=\"keyword\">if</span>(solved==size)<span class=\"keyword\">return</span> solved;</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    vis[u] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) que[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = que[u][i].F;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]) &#123;</div><div class=\"line\">            ans[que[u][i].S] = uFind(v);</div><div class=\"line\">            solved++;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> solved;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    clrA(vis,<span class=\"number\">0</span>);</div><div class=\"line\">    dfs(findRoot());</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> T;</div><div class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;T);</div><div class=\"line\">    <span class=\"keyword\">while</span> (T--) &#123;</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;n);</div><div class=\"line\">        initEdge();</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v;</div><div class=\"line\">        clrA(indeg,<span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            add(u, v);</div><div class=\"line\">            indeg[v]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        initUset();</div><div class=\"line\">        size = <span class=\"number\">1</span>;<span class=\"comment\">//查询的次数</span></div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=n;i++)que[i].clear();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            que[u].push_back(MP(v, i));</div><div class=\"line\">            que[v].push_back(MP(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>, ans[i]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>LCA还可以用倍增来求：（思想很普通，只是以2进制的步长向上走：dp[i][j]表示节点i向上走2^j步到达的节点。）<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;cmath&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define qlr(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clr(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">#define N 10005</div><div class=\"line\">#define M N-1</div><div class=\"line\">int n;</div><div class=\"line\">int head[N], pos;</div><div class=\"line\">struct edge &#123;</div><div class=\"line\">    int v, nxt;</div><div class=\"line\">&#125; e[M];</div><div class=\"line\">void add(int u, int v) &#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\">void initEdge() &#123;</div><div class=\"line\">    clr(head, -1);</div><div class=\"line\">    pos = 0;</div><div class=\"line\">&#125;</div><div class=\"line\">int deep[N];</div><div class=\"line\">vector&amp;lt;int&amp;gt; dp[N];</div><div class=\"line\">int size;</div><div class=\"line\">int findRoot() &#123;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        if (dp[i].empty()) return i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    return -1;</div><div class=\"line\">&#125;</div><div class=\"line\">void getDeep(int u = findRoot()) &#123;</div><div class=\"line\">    for (int i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        int v = e[i].v;</div><div class=\"line\">        deep[v] = deep[u] + 1;</div><div class=\"line\">        getDeep(v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    size = max(size, deep[u] + 1);//记录最大深度</div><div class=\"line\">&#125;</div><div class=\"line\">void initLCA() &#123;</div><div class=\"line\">    clr(deep, 0);</div><div class=\"line\">    size = 0;</div><div class=\"line\">    getDeep();</div><div class=\"line\">    for (int len = 1,t=2;t&amp;lt;=size; len++,t&amp;lt;&amp;lt;=1) &#123;//跳出条件：(t=2^len)&amp;lt;=size</div><div class=\"line\">        for (int i = 1; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">            if ((int)dp[i].size() &amp;gt;= len &amp;amp;&amp;amp; (int)dp[dp[i][len-1]].size() &amp;gt;= len) &#123;</div><div class=\"line\">                dp[i].push_back(dp[dp[i][len-1]][len-1]);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int getLCA(int u, int v) &#123;</div><div class=\"line\">    if (deep[u] &amp;lt; deep[v]) swap(u, v);</div><div class=\"line\">    int d = deep[u] - deep[v];</div><div class=\"line\">    for (int i = 0; d; i++, d &amp;gt;&amp;gt;= 1) &#123;</div><div class=\"line\">        u = d &amp;amp; 1 ? dp[u][i] : u;</div><div class=\"line\">    &#125;//以差值二进制形式将u往上走差值</div><div class=\"line\">    if (u == v) return u;</div><div class=\"line\">    for (int i = min(dp[u].size(),dp[v].size())-1; i &amp;gt;= 0; i--) &#123;</div><div class=\"line\">        if (dp[u][i] != dp[v][i]) &#123;</div><div class=\"line\">            u = dp[u][i];</div><div class=\"line\">            v = dp[v][i];</div><div class=\"line\">            i=(int)min(dp[u].size(),dp[v].size());//注意每次都要更新i！！</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    u = dp[u][0];</div><div class=\"line\">    return u;</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">    int T;</div><div class=\"line\">    cin &amp;gt;&amp;gt; T;</div><div class=\"line\">    while (T--) &#123;</div><div class=\"line\">        scanf(\"%d\", &amp;amp;n);</div><div class=\"line\">        int u, v;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        for (int i = 1; i &amp;lt;= n; i++)</div><div class=\"line\">            dp[i].clear();</div><div class=\"line\">        for (int i = 1; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            add(u, v);</div><div class=\"line\">            dp[v].push_back(u);</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">        printf(\"%d\\n\", getLCA(u, v));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>LCA还可以转化为RMQ问题（个人更喜欢此方法，在线，且效率高）<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div></pre></td><td class=\"code\"><pre><div class=\"line\">//============================================================================</div><div class=\"line\">// Name        : test3.cpp</div><div class=\"line\">// Author      : </div><div class=\"line\">// Version     :</div><div class=\"line\">// Copyright   : Your copyright notice</div><div class=\"line\">// Description : Hello World in C++, Ansi-style</div><div class=\"line\">//============================================================================</div><div class=\"line\">#include&amp;lt;map&amp;gt;</div><div class=\"line\">#include&amp;lt;set&amp;gt;</div><div class=\"line\">#include&amp;lt;stack&amp;gt;</div><div class=\"line\">#include&amp;lt;queue&amp;gt;</div><div class=\"line\">#include&amp;lt;string&amp;gt;</div><div class=\"line\">#include&amp;lt;cstdio&amp;gt;</div><div class=\"line\">#include&amp;lt;vector&amp;gt;</div><div class=\"line\">#include&amp;lt;cctype&amp;gt;</div><div class=\"line\">#include&amp;lt;cassert&amp;gt;</div><div class=\"line\">#include&amp;lt;utility&amp;gt;</div><div class=\"line\">#include&amp;lt;numeric&amp;gt;</div><div class=\"line\">#include&amp;lt;cstring&amp;gt;</div><div class=\"line\">#include&amp;lt;iostream&amp;gt;</div><div class=\"line\">#include&amp;lt;algorithm&amp;gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">#define pr pair</div><div class=\"line\">#define MP make_pair</div><div class=\"line\">#define SI(x) set&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define VI(x) vector&amp;lt;x&amp;gt;::iterator</div><div class=\"line\">#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</div><div class=\"line\">#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</div><div class=\"line\">#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</div><div class=\"line\">#define F first</div><div class=\"line\">#define S second</div><div class=\"line\">#define clrQ(x) while(!x.empty)x.pop();</div><div class=\"line\">#define clrA(x,y) memset(x,y,sizeof(x));</div><div class=\"line\">#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</div><div class=\"line\">#define LL __int64</div><div class=\"line\">#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#else</div><div class=\"line\">#define LL long long</div><div class=\"line\">#define LLS \"%\" \"l\" \"l\" \"d\"</div><div class=\"line\">#define LLU \"%\" \"l\" \"l\" \"u\"</div><div class=\"line\">#define LL_MAX _I64_MAX</div><div class=\"line\">#endif</div><div class=\"line\">const int inf = ~0u &amp;gt;&amp;gt; 1;</div><div class=\"line\">const LL lnf = ~0ull &amp;gt;&amp;gt; 1;</div><div class=\"line\">int n, m;</div><div class=\"line\">#define N 10005</div><div class=\"line\">#define M 10005</div><div class=\"line\">int head[N], pos;</div><div class=\"line\">struct Edge &#123;</div><div class=\"line\">    int v, nxt;</div><div class=\"line\">&#125; e[M];</div><div class=\"line\">void initEdge() &#123;</div><div class=\"line\">    memset(head, -1, sizeof(head));</div><div class=\"line\">    pos = 0;</div><div class=\"line\">&#125;</div><div class=\"line\">void add(int u, int v) &#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\">//RMQ</div><div class=\"line\">int dpM[20][N &amp;lt;&amp;lt; 1 | 1];</div><div class=\"line\">int lg2[N &amp;lt;&amp;lt; 1 | 1];</div><div class=\"line\">#define getLeft(R,L) (R-(L)+1)</div><div class=\"line\">void initRMQ(int n) &#123; //dp[0][i]表示区间i的值。预先处理出来。</div><div class=\"line\">    lg2[0] = -1;</div><div class=\"line\">    int limit;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        lg2[i] = i &amp;amp; (i - 1) ? lg2[i - 1] : lg2[i - 1] + 1;</div><div class=\"line\">    &#125;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= lg2[n]; i++) &#123;</div><div class=\"line\">        limit = getLeft(n, 1 &amp;lt;&amp;lt; i);</div><div class=\"line\">        for (int j = 1; j &amp;lt;= limit; j++) &#123;</div><div class=\"line\">            dpM[i][j] = min(dpM[i - 1][j], dpM[i - 1][j + (1 &amp;lt;&amp;lt; (i - 1))]);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int getRMQ(int x, int y) &#123;</div><div class=\"line\">    if (x &amp;gt; y) swap(x, y);</div><div class=\"line\">    int t = lg2[y - x + 1];</div><div class=\"line\">    return min(dpM[t][x], dpM[t][getLeft(y, 1 &amp;lt;&amp;lt; t)]);</div><div class=\"line\">&#125;</div><div class=\"line\">//LCA</div><div class=\"line\">int depth, cnt;</div><div class=\"line\">int inde[N], H[N], E[N];</div><div class=\"line\">//dp[0][N&amp;lt;&amp;lt;1|1]深度序列（dfs编号），E[N]每个dfs编号对应的节点，H[N]节点第一次出现在dfs编号序列中的位置</div><div class=\"line\">int findRoot() &#123;</div><div class=\"line\">    for (int i = 1; i &amp;lt;= n; i++)</div><div class=\"line\">        if (!inde[i]) return i;</div><div class=\"line\">    return -1;</div><div class=\"line\">&#125;</div><div class=\"line\">void getEuler(int u = findRoot()) &#123;</div><div class=\"line\">    int dfn = dpM[0][H[u] = ++cnt] = ++depth;</div><div class=\"line\">    E[dfn] = u;</div><div class=\"line\">    for (int i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        int v = e[i].v;</div><div class=\"line\">        getEuler(v);</div><div class=\"line\">        dpM[0][++cnt] = dfn;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">void initLCA() &#123;</div><div class=\"line\">    depth = cnt = 0;</div><div class=\"line\">    getEuler();</div><div class=\"line\">    initRMQ(cnt);</div><div class=\"line\">&#125;</div><div class=\"line\">int getLCA(int u, int v) &#123;</div><div class=\"line\">    if (H[u] &amp;gt; H[v]) swap(u, v);</div><div class=\"line\">    return E[getRMQ(H[u], H[v])];</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">    int T;</div><div class=\"line\">    scanf(\"%d\", &amp;amp;T);</div><div class=\"line\">    while (T--) &#123;</div><div class=\"line\">        scanf(\"%d\", &amp;amp;n);m=n-1;</div><div class=\"line\">        int u, v;</div><div class=\"line\">        initEdge();</div><div class=\"line\">        memset(inde, 0, sizeof(inde));</div><div class=\"line\">        for (int i = 1; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">            add(u, v);</div><div class=\"line\">            inde[v]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        initLCA();</div><div class=\"line\">        scanf(\"%d%d\", &amp;amp;u, &amp;amp;v);</div><div class=\"line\">        printf(\"%d\\n\", getLCA(u, v));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>&nbsp;</p>"},{"title":"Shadowsocks免费账号网址集","date":"2015-02-24T08:26:42.000Z","_content":"G+圈子很多这样的网站，大部分是由[ss-panel](https://github.com/orvice/ss-panel)这个开源项目建成。不知道他们是乐于分享还是另有目的。下面是列表：\n\n1. [Shadow X](https://cattt.com/)(ss-panel作者)\n1. [kuaishangSS](http://free.kuaishangss.tk/)\n2. [pepsishadowsocks](http://vpn.lintwo.com/)\n3. [ChangZ](http://tashi.xyz/)\n4. [ssserver](http://ss.ssserver.biz/)\n\n另外推荐Linux下ss GUI客户端：[shadowsocks-qt5](https://github.com/librehat/shadowsocks-qt5)","source":"_posts/shadowsocks-account.md","raw":"title: Shadowsocks免费账号网址集\ndate: 2015-02-24 16:26:42\ntags: [shadowsocks]\ncategories: GFW\n---\nG+圈子很多这样的网站，大部分是由[ss-panel](https://github.com/orvice/ss-panel)这个开源项目建成。不知道他们是乐于分享还是另有目的。下面是列表：\n\n1. [Shadow X](https://cattt.com/)(ss-panel作者)\n1. [kuaishangSS](http://free.kuaishangss.tk/)\n2. [pepsishadowsocks](http://vpn.lintwo.com/)\n3. [ChangZ](http://tashi.xyz/)\n4. [ssserver](http://ss.ssserver.biz/)\n\n另外推荐Linux下ss GUI客户端：[shadowsocks-qt5](https://github.com/librehat/shadowsocks-qt5)","slug":"shadowsocks-account","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l25004m5rgxyqsm7a5t","content":"<p>G+圈子很多这样的网站，大部分是由<a href=\"https://github.com/orvice/ss-panel\" target=\"_blank\" rel=\"external\">ss-panel</a>这个开源项目建成。不知道他们是乐于分享还是另有目的。下面是列表：</p>\n<ol>\n<li><a href=\"https://cattt.com/\" target=\"_blank\" rel=\"external\">Shadow X</a>(ss-panel作者)</li>\n<li><a href=\"http://free.kuaishangss.tk/\" target=\"_blank\" rel=\"external\">kuaishangSS</a></li>\n<li><a href=\"http://vpn.lintwo.com/\" target=\"_blank\" rel=\"external\">pepsishadowsocks</a></li>\n<li><a href=\"http://tashi.xyz/\" target=\"_blank\" rel=\"external\">ChangZ</a></li>\n<li><a href=\"http://ss.ssserver.biz/\" target=\"_blank\" rel=\"external\">ssserver</a></li>\n</ol>\n<p>另外推荐Linux下ss GUI客户端：<a href=\"https://github.com/librehat/shadowsocks-qt5\" target=\"_blank\" rel=\"external\">shadowsocks-qt5</a></p>\n","excerpt":"","more":"<p>G+圈子很多这样的网站，大部分是由<a href=\"https://github.com/orvice/ss-panel\">ss-panel</a>这个开源项目建成。不知道他们是乐于分享还是另有目的。下面是列表：</p>\n<ol>\n<li><a href=\"https://cattt.com/\">Shadow X</a>(ss-panel作者)</li>\n<li><a href=\"http://free.kuaishangss.tk/\">kuaishangSS</a></li>\n<li><a href=\"http://vpn.lintwo.com/\">pepsishadowsocks</a></li>\n<li><a href=\"http://tashi.xyz/\">ChangZ</a></li>\n<li><a href=\"http://ss.ssserver.biz/\">ssserver</a></li>\n</ol>\n<p>另外推荐Linux下ss GUI客户端：<a href=\"https://github.com/librehat/shadowsocks-qt5\">shadowsocks-qt5</a></p>\n"},{"title":"用Sublime Text 3 dev 做网页开发的配置","date":"2014-09-16T08:45:07.000Z","_content":"\n文件：[click here](http://pan.baidu.com/s/1pJ7FVuz)","source":"_posts/sublime-config-web.md","raw":"title: 用Sublime Text 3 dev 做网页开发的配置\ncategories:\n  - IDE/Editor\ndate: 2014-09-16 16:45:07\ntags: [sublime text,html]\n---\n\n文件：[click here](http://pan.baidu.com/s/1pJ7FVuz)","slug":"sublime-config-web","published":1,"updated":"2017-01-16T01:58:03.969Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l26004p5rgxh0s4298g","content":"<p>文件：<a href=\"http://pan.baidu.com/s/1pJ7FVuz\" target=\"_blank\" rel=\"external\">click here</a></p>\n","excerpt":"","more":"<p>文件：<a href=\"http://pan.baidu.com/s/1pJ7FVuz\">click here</a></p>\n"},{"title":"我的xfce4配置","date":"2014-09-16T08:39:20.000Z","_content":"\n1.字体：infinally 渲染\n\n2.英文字体：courier prime\n\n3.窗口最大化隐藏标题栏：xfwm4-titleless-dev\n\n4.窗口最大化标题栏隐藏后，在任务栏上显示控制按钮的插件：xfce4-windowck-plugin","source":"_posts/xfce4-config.md","raw":"---\ntitle: 我的xfce4配置\ndate: 2014-09-16 16:39:20\ncategories:\n- Linux\n    \ntags:\n- xfce4\n- DE/WM\n---\n\n1.字体：infinally 渲染\n\n2.英文字体：courier prime\n\n3.窗口最大化隐藏标题栏：xfwm4-titleless-dev\n\n4.窗口最大化标题栏隐藏后，在任务栏上显示控制按钮的插件：xfce4-windowck-plugin","slug":"xfce4-config","published":1,"updated":"2019-10-11T05:50:15.698Z","_id":"ciz5e9l27004s5rgx0f6vl7n6","comments":1,"layout":"post","photos":[],"link":"","content":"<p>1.字体：infinally 渲染</p>\n<p>2.英文字体：courier prime</p>\n<p>3.窗口最大化隐藏标题栏：xfwm4-titleless-dev</p>\n<p>4.窗口最大化标题栏隐藏后，在任务栏上显示控制按钮的插件：xfce4-windowck-plugin</p>\n","site":{"data":{}},"excerpt":"","more":"<p>1.字体：infinally 渲染</p>\n<p>2.英文字体：courier prime</p>\n<p>3.窗口最大化隐藏标题栏：xfwm4-titleless-dev</p>\n<p>4.窗口最大化标题栏隐藏后，在任务栏上显示控制按钮的插件：xfce4-windowck-plugin</p>\n"},{"title":"优化Wine程序的字体显示","date":"2014-10-13T04:42:42.000Z","_content":"\n默认Wine的字体太难看，而且有时候还会显示不出来。开启Wine字体的反锯齿及平滑功能以及将字体映射成文泉驿微米黑的方法是：\n\n1.新建文本文件a.reg，放入如下内容：\n<!--more-->\n```language\nREGEDIT4\n\n[HKEY_CURRENT_USER\\Software\\Wine\\X11 Driver]\n\"ClientSideAntiAliasWithCore\"=\"Y\"\n\"ClientSideAntiAliasWithRender\"=\"Y\"\n\"ClientSideWithRender\"=\"Y\"\n\n[HKEY_CURRENT_USER\\Control Panel\\Desktop]\n\"FontSmoothing\"=\"2\"\n\"FontSmoothingType\"=dword:00000002\n\"FontSmoothingGamma\"=dword:00000578\n\"FontSmoothingOrientation\"=dword:00000001\n\n[HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\FontSubstitutes]\n\"Arial Baltic,186\"=\"WenQuanYi Micro Hei\"\n\"Arial CE,238\"=\"WenQuanYi Micro Hei\"\n\"Arial CYR,204\"=\"WenQuanYi Micro Hei\"\n\"Arial Greek,161\"=\"WenQuanYi Micro Hei\"\n\"Arial TUR,162\"=\"WenQuanYi Micro Hei\"\n\"Courier New Baltic,186\"=\"WenQuanYi Micro Hei\"\n\"Courier New CE,238\"=\"WenQuanYi Micro Hei\"\n\"Courier New CYR,204\"=\"WenQuanYi Micro Hei\"\n\"Courier New Greek,161\"=\"WenQuanYi Micro Hei\"\n\"Courier New TUR,162\"=\"WenQuanYi Micro Hei\"\n\"Helv\"=\"WenQuanYi Micro Hei\"\n\"Helvetica\"=\"WenQuanYi Micro Hei\"\n\"MS Shell Dlg\"=\"WenQuanYi Micro Hei\"\n\"MS Shell Dlg 2\"=\"WenQuanYi Micro Hei\"\n\"Tahoma\"=\"WenQuanYi Micro Hei\"\n\"Times\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman Baltic,186\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman CE,238\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman CYR,204\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman Greek,161\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman TUR,162\"=\"WenQuanYi Micro Hei\"\n\"Tms Rmn\"=\"WenQuanYi Micro Hei\"\n\"Simsun\"=\"WenQuanYi Micro Hei\"\n```\n\n2.如果是普通的wine直接终端输入wine regedit打开注册表编辑器。然后点击“注册表—&gt;导入注册表文件\"导入该文件。\n\n3.如果是longene等封装好的wine（比如tm2013）可以使用tm2013 -reg命令打开注册表。\n\n","source":"_posts/wine-font-config.md","raw":"title: 优化Wine程序的字体显示\ncategories:\n  - Wine\ndate: 2014-10-13 12:42:42\ntags: [linux]\n---\n\n默认Wine的字体太难看，而且有时候还会显示不出来。开启Wine字体的反锯齿及平滑功能以及将字体映射成文泉驿微米黑的方法是：\n\n1.新建文本文件a.reg，放入如下内容：\n<!--more-->\n```language\nREGEDIT4\n\n[HKEY_CURRENT_USER\\Software\\Wine\\X11 Driver]\n\"ClientSideAntiAliasWithCore\"=\"Y\"\n\"ClientSideAntiAliasWithRender\"=\"Y\"\n\"ClientSideWithRender\"=\"Y\"\n\n[HKEY_CURRENT_USER\\Control Panel\\Desktop]\n\"FontSmoothing\"=\"2\"\n\"FontSmoothingType\"=dword:00000002\n\"FontSmoothingGamma\"=dword:00000578\n\"FontSmoothingOrientation\"=dword:00000001\n\n[HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\FontSubstitutes]\n\"Arial Baltic,186\"=\"WenQuanYi Micro Hei\"\n\"Arial CE,238\"=\"WenQuanYi Micro Hei\"\n\"Arial CYR,204\"=\"WenQuanYi Micro Hei\"\n\"Arial Greek,161\"=\"WenQuanYi Micro Hei\"\n\"Arial TUR,162\"=\"WenQuanYi Micro Hei\"\n\"Courier New Baltic,186\"=\"WenQuanYi Micro Hei\"\n\"Courier New CE,238\"=\"WenQuanYi Micro Hei\"\n\"Courier New CYR,204\"=\"WenQuanYi Micro Hei\"\n\"Courier New Greek,161\"=\"WenQuanYi Micro Hei\"\n\"Courier New TUR,162\"=\"WenQuanYi Micro Hei\"\n\"Helv\"=\"WenQuanYi Micro Hei\"\n\"Helvetica\"=\"WenQuanYi Micro Hei\"\n\"MS Shell Dlg\"=\"WenQuanYi Micro Hei\"\n\"MS Shell Dlg 2\"=\"WenQuanYi Micro Hei\"\n\"Tahoma\"=\"WenQuanYi Micro Hei\"\n\"Times\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman Baltic,186\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman CE,238\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman CYR,204\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman Greek,161\"=\"WenQuanYi Micro Hei\"\n\"Times New Roman TUR,162\"=\"WenQuanYi Micro Hei\"\n\"Tms Rmn\"=\"WenQuanYi Micro Hei\"\n\"Simsun\"=\"WenQuanYi Micro Hei\"\n```\n\n2.如果是普通的wine直接终端输入wine regedit打开注册表编辑器。然后点击“注册表—&gt;导入注册表文件\"导入该文件。\n\n3.如果是longene等封装好的wine（比如tm2013）可以使用tm2013 -reg命令打开注册表。\n\n","slug":"wine-font-config","published":1,"updated":"2017-01-16T01:58:03.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l2a004w5rgxfs7hp83k","content":"<p>默认Wine的字体太难看，而且有时候还会显示不出来。开启Wine字体的反锯齿及平滑功能以及将字体映射成文泉驿微米黑的方法是：</p>\n<p>1.新建文本文件a.reg，放入如下内容：<br><a id=\"more\"></a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\">REGEDIT4</div><div class=\"line\"></div><div class=\"line\">[HKEY_CURRENT_USER\\Software\\Wine\\X11 Driver]</div><div class=\"line\">&quot;ClientSideAntiAliasWithCore&quot;=&quot;Y&quot;</div><div class=\"line\">&quot;ClientSideAntiAliasWithRender&quot;=&quot;Y&quot;</div><div class=\"line\">&quot;ClientSideWithRender&quot;=&quot;Y&quot;</div><div class=\"line\"></div><div class=\"line\">[HKEY_CURRENT_USER\\Control Panel\\Desktop]</div><div class=\"line\">&quot;FontSmoothing&quot;=&quot;2&quot;</div><div class=\"line\">&quot;FontSmoothingType&quot;=dword:00000002</div><div class=\"line\">&quot;FontSmoothingGamma&quot;=dword:00000578</div><div class=\"line\">&quot;FontSmoothingOrientation&quot;=dword:00000001</div><div class=\"line\"></div><div class=\"line\">[HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\FontSubstitutes]</div><div class=\"line\">&quot;Arial Baltic,186&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial CE,238&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial CYR,204&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial Greek,161&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial TUR,162&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New Baltic,186&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New CE,238&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New CYR,204&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New Greek,161&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New TUR,162&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Helv&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Helvetica&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;MS Shell Dlg&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;MS Shell Dlg 2&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Tahoma&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman Baltic,186&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman CE,238&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman CYR,204&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman Greek,161&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman TUR,162&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Tms Rmn&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Simsun&quot;=&quot;WenQuanYi Micro Hei&quot;</div></pre></td></tr></table></figure></p>\n<p>2.如果是普通的wine直接终端输入wine regedit打开注册表编辑器。然后点击“注册表—&gt;导入注册表文件”导入该文件。</p>\n<p>3.如果是longene等封装好的wine（比如tm2013）可以使用tm2013 -reg命令打开注册表。</p>\n","excerpt":"<p>默认Wine的字体太难看，而且有时候还会显示不出来。开启Wine字体的反锯齿及平滑功能以及将字体映射成文泉驿微米黑的方法是：</p>\n<p>1.新建文本文件a.reg，放入如下内容：<br>","more":"<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\">REGEDIT4</div><div class=\"line\"></div><div class=\"line\">[HKEY_CURRENT_USER\\Software\\Wine\\X11 Driver]</div><div class=\"line\">&quot;ClientSideAntiAliasWithCore&quot;=&quot;Y&quot;</div><div class=\"line\">&quot;ClientSideAntiAliasWithRender&quot;=&quot;Y&quot;</div><div class=\"line\">&quot;ClientSideWithRender&quot;=&quot;Y&quot;</div><div class=\"line\"></div><div class=\"line\">[HKEY_CURRENT_USER\\Control Panel\\Desktop]</div><div class=\"line\">&quot;FontSmoothing&quot;=&quot;2&quot;</div><div class=\"line\">&quot;FontSmoothingType&quot;=dword:00000002</div><div class=\"line\">&quot;FontSmoothingGamma&quot;=dword:00000578</div><div class=\"line\">&quot;FontSmoothingOrientation&quot;=dword:00000001</div><div class=\"line\"></div><div class=\"line\">[HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\FontSubstitutes]</div><div class=\"line\">&quot;Arial Baltic,186&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial CE,238&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial CYR,204&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial Greek,161&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Arial TUR,162&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New Baltic,186&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New CE,238&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New CYR,204&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New Greek,161&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Courier New TUR,162&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Helv&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Helvetica&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;MS Shell Dlg&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;MS Shell Dlg 2&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Tahoma&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman Baltic,186&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman CE,238&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman CYR,204&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman Greek,161&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Times New Roman TUR,162&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Tms Rmn&quot;=&quot;WenQuanYi Micro Hei&quot;</div><div class=\"line\">&quot;Simsun&quot;=&quot;WenQuanYi Micro Hei&quot;</div></pre></td></tr></table></figure></p>\n<p>2.如果是普通的wine直接终端输入wine regedit打开注册表编辑器。然后点击“注册表—&gt;导入注册表文件”导入该文件。</p>\n<p>3.如果是longene等封装好的wine（比如tm2013）可以使用tm2013 -reg命令打开注册表。</p>"},{"title":"Timus 1996 Cipher Message 3 KMP+FFT求卷积","id":"130","date":"2014-11-05T14:13:15.000Z","_content":"\n题目链接：[click here](http://acm.timus.ru/problem.aspx?space=1&amp;num=1996)\n##description\nEmperor Palpatine has been ruling the Empire for 25 years and Darth Vader has been the head of the Empire Armed Forces. However, the Rebel movement is strong like it never used to be. One of the rebel leaders, Princess Leia from Alderaan, managed to get hold of secret blueprints of the Death Star, the imperial war station.\n\nThe Princess was going to deliver the station plan to the secret base for further analysis and searching for vulnerable spots. But her ship was attacked by the space destroyer \"Devastator\" headed by Darth Vader. At the last moment Princess Leia managed to send her findings to one of the closest planet called Tatooine with her droid R2-D2\\. Quite conveniently, an old friend of her father Obi-Wan Kenobi lives on that planet.\n\nR2-D2 realizes the importance of his mission. He is going to encrypt the information so that the wrong people won’t get it.\n<!--more-->\nThe memory of R2-D2 has many files with images. First he wanted to use a well-known encrypting algorithm. The point of the method is to replace the least significant bits of the image with the encrypted message bits. The difference is practically unnoticeable on the picture, so one won’t suspect that it contains a hidden message.\n\nBut then R2-D2 decided that this method is quite well-known and the information won’t be protected enough. He decided to change the least significant bits of the image so that the secret information was a continuous sequence of the bytes of the image file. Help the droid determine if it is possible. And if it is, find the minimum number of bits to alter.\n\n## Input\n\nThe first line of the input contains integers _n_ and _m_ (1 ≤ _n_, _m_ ≤ 250 000) — the sizes of the image file and of the file with the secret information in bytes. On the second line the content of the file with an image is given and the third line contains the secret information. The files are given as a sequence of space-separated bytes. Each byte is written as a sequence of eight bits in the order from the most to the least significant bit.\n\n## Output\n\nPrint \"No\", if it is impossible to encrypt information in this image. Otherwise, print in the first line \"Yes\", and in the second line — the number of bits to alter and the number of the byte in the file with the image, starting from which the secret information will be recorded. If there are multiple possible variants, print the one where the secret information is written closer to the beginning of the image file.\n\n## Samples\n| input | output |\n|--------|--------|\n|  3 2<br/> 11110001 11110001 11110000<br/>11110000 11110000     |   Yes<br/>1 2|\n\n| input | output |\n|--------|--------|\n|3 1<br/>11110000 11110001 11110000<br/>11110000      |   Yes<br/>0 1|\n\n\n**Problem Author: **Denis Dublennykh (prepared by Oleg Dolgorukov)\n\n题目老长难懂，其实就是给你一个n byte的01A串，m byte的01B串.其中A串中每一byte的最后一个bit是可以修改的，问至少修改多少次A串能使B使A的子串。输出修改次数与最小的起始匹配位置。\n\n首先将A串每byte取前7位（代码中的a数组）与B串每byte取前7位（代码中的b数组）用KMP匹配，因为前7位不能改，所以如果没有一处匹配就直接输出No了。\n\n然后将A串每byte取后1位（代码中的ax数组）与B串每byte取后一位（代码中的bx数组）求hamming距离。\n\n如何求ax与bx的hamming距离呢？\n\n可以巧妙的ax作为卷积中的f函数，bx的逆向数组bx\\`作为卷积中的g函数。两者求卷积。这样就成了：\n$$c[i + m - 1] = ax[i + 0] * bx\\`[m - 0 - 1] + ax[i + 1] * bx\\`[m - 1 - 1] + …… ax[i + j] * bx\\`[m - j - 1] + …… ax[i + m - 1] * bx\\`[m - (m - 1) - 1]$$\n\n可以看出，如果ax , bx中同为1,乘积为1,否则为0,这样就能统计出了有多少位同为1了。\n\n如果将ax,bx数组中的01取反，再进行上述操作，那么救能统计出有多少位同为0了。两者相加就是全部相同的有多少，用总字符数m减去它，就能求出hamming距离了！\n\n卷积复杂度为O(nlg(n))而暴力算法的复杂度为O(n×m)，真是太神奇了！\n```C++\nusing namespace std;\nconst int N = 250005;\nint n, m;\nconst double pi = acos(-1.0);\n// Complex  z = a + b * i\nstruct Complex {\n\tdouble x, y;\n\tComplex(double x = 0.0, double y = 0.0) :\n\t\t\tx(x), y(y) {\n\t}\n\tComplex operator +(const Complex &amp;c) const {\n\t\treturn Complex(x + c.x, y + c.y);\n\t}\n\tComplex operator -(const Complex &amp;c) const {\n\t\treturn Complex(x - c.x, y - c.y);\n\t}\n\tComplex operator *(const Complex &amp;c) const {\n\t\treturn Complex(x * c.x - y * c.y, x * c.y + y * c.x);\n\t}\n};\nint a[N], b[N], ax[N], bx[N];\nchar buf[8];\n/*\n * kmpNext[]的意思:next'[i]=next[next[...[next[i]]]] (直到next'[i]&lt;0或者\n x[next'[i]]!=x[i])\n * 这样的预处理可以快一些\n */\nvoid preKMP(int x[], int m, int kmpNext[]) {\n\tint i, j;\n\tj = kmpNext[0] = -1;\n\ti = 0;\n\twhile (i &lt; m) {\n\t\twhile (-1 != j &amp;&amp; x[i] != x[j])\n\t\t\tj = kmpNext[j];\n\t\tif (x[++i] == x[++j]) kmpNext[i] = kmpNext[j];\n\t\telse kmpNext[i] = j;\n\t}\n}\n/*\n * 返回x在y中出现的次数,可以重叠\n */\nint next[N];\nvector pos;\nvoid KMP_Count(int x[], int m, int y[], int n) { //x是模式串,y是主串\n\tint i, j;\n\tpos.clear();\n\tpreKMP(x, m, next);\n\ti = j = 0;\n\twhile (i &lt; n) {\n\t\twhile (-1 != j &amp;&amp; y[i] != x[j])\n\t\t\tj = next[j];\n\t\ti++;\n\t\tj++;\n\t\tif (j &gt;= m) {\n\t\t\tpos.push_back(i - m);\n\t\t\tj = next[j];\n\t\t}\n\t}\n}\n//len = 2 ^ k\ninline void change(Complex y[], int len) {\n\tfor (int i = 1, j = len / 2; i &lt; len - 1; i++) {\n\t\tif (i &lt; j) swap(y[i], y[j]);\n\t\tint k = len / 2;\n\t\twhile (j &gt;= k) {\n\t\t\tj -= k;\n\t\t\tk /= 2;\n\t\t}\n\t\tif (j &lt; k) j += k;\n\t}\n}\n// FFT\n// len = 2 ^ k\n// on = 1  DFT    on = -1 IDFT\ninline void FFT(Complex y[], int len, int on) {\n\tchange(y, len);\n\tfor (int h = 2; h &lt;= len; h &lt;&lt;= 1) {\n\t\tComplex wn(cos(-on * 2 * pi / h), sin(-on * 2 * pi / h));\n\t\tfor (int j = 0; j &lt; len; j += h) {\n\t\t\tComplex w(1, 0);\n\t\t\tfor (int k = j; k &lt; j + h / 2; k++) {\n\t\t\t\tComplex u = y[k];\n\t\t\t\tComplex t = w * y[k + h / 2];\n\t\t\t\ty[k] = u + t;\n\t\t\t\ty[k + h / 2] = u - t;\n\t\t\t\tw = w * wn;\n\t\t\t}\n\t\t}\n\t}\n\tif (on == -1) {\n\t\tfor (int i = 0; i &lt; len; i++) {\n\t\t\ty[i].x /= len;\n\t\t}\n\t}\n}\n//FFT求卷积,a数组长度n，b数组长度m\nint res[N];\nComplex x1[N &lt;&lt; 2], x2[N &lt;&lt; 2]; //FFT开4倍\nvoid Convolution(int a[], int b[]) {\n\tint len = max(n, m);\n\tint l = 1;\n\twhile (l &lt; len * 2)\n\t\tl &lt;&lt;= 1;\n\tfor (int i = 0; i &lt; l; i++)\n\t\tx1[i] = Complex(i &lt; n ? a[i] : 0, 0);\n\tfor (int i = 0; i &lt; l; i++)\n\t\tx2[i] = Complex(i &lt; m ? b[i] : 0, 0);\n\t//DFT\n\tFFT(x1, l, 1);\n\tFFT(x2, l, 1);\n\tfor (int i = 0; i &lt; l; i++)\n\t\tx1[i] = x1[i] * x2[i];\n\t//IDFT\n\tFFT(x1, l, -1);\n\t//based on m\n\tint base = m ;\n\tfor (int i = 0; i &lt;= n - base; i++) {\n\t\tres[i] += (int) (x1[i + base - 1].x + 0.5);\n\t}\n}\nint main() {\n\twhile (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n\t\tfor (int i = 0; i &lt; n; i++) {\n\t\t\ta[i] = 0;\n\t\t\tscanf(\"%s\", buf);\n\t\t\tfor (int j = 0; j &lt; 7; j++) {\n\t\t\t\ta[i] = a[i] &lt;&lt; 1 | (buf[j] - '0');\n\t\t\t}\n\t\t\tax[i] = buf[7] - '0';\n\t\t}\n\t\tfor (int i = 0; i &lt; m; i++) {\n\t\t\tb[i] = 0;\n\t\t\tscanf(\"%s\", buf);\n\t\t\tfor (int j = 0; j &lt; 7; j++) {\n\t\t\t\tb[i] = b[i] &lt;&lt; 1 | (buf[j] - '0');\n\t\t\t}\n\t\t\tbx[i] = buf[7] - '0';\n\t\t}\n\t\tKMP_Count(b, m, a, n);\n\t\tif (pos.size() == 0) puts(\"No\");\n\t\telse {\n\t\t\treverse(bx, bx + m);\n\t\t\tmemset(res, 0, sizeof(res));\n\t\t\tputs(\"Yes\");\n\t\t\tConvolution(ax, bx);\n\t\t\tfor (int i = 0; i &lt; n; i++)\n\t\t\t\tax[i] ^= 1;\n\t\t\tfor (int i = 0; i &lt; m; i++)\n\t\t\t\tbx[i] ^= 1;\n\t\t\tConvolution(ax, bx);\n\t\t\tint ans = m, idx = 0;\n\t\t\tfor (int i = 0; i &lt; (int) pos.size(); i++) {\n\t\t\t\tif (m - res[pos[i]] &lt; ans) {\n\t\t\t\t\tans = m - res[pos[i]];\n\t\t\t\t\tidx = pos[i] + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprintf(\"%d %d\\n\", ans, idx);\n\t\t}\n\t}\n}\n```\n","source":"_posts/timus-1996-cipher-message-3-kmpfft.md","raw":"title: Timus 1996 Cipher Message 3 KMP+FFT求卷积\ncategories:\n  - ACM\nid: 130\ndate: 2014-11-05 22:13:15\ntags: 数论\n---\n\n题目链接：[click here](http://acm.timus.ru/problem.aspx?space=1&amp;num=1996)\n##description\nEmperor Palpatine has been ruling the Empire for 25 years and Darth Vader has been the head of the Empire Armed Forces. However, the Rebel movement is strong like it never used to be. One of the rebel leaders, Princess Leia from Alderaan, managed to get hold of secret blueprints of the Death Star, the imperial war station.\n\nThe Princess was going to deliver the station plan to the secret base for further analysis and searching for vulnerable spots. But her ship was attacked by the space destroyer \"Devastator\" headed by Darth Vader. At the last moment Princess Leia managed to send her findings to one of the closest planet called Tatooine with her droid R2-D2\\. Quite conveniently, an old friend of her father Obi-Wan Kenobi lives on that planet.\n\nR2-D2 realizes the importance of his mission. He is going to encrypt the information so that the wrong people won’t get it.\n<!--more-->\nThe memory of R2-D2 has many files with images. First he wanted to use a well-known encrypting algorithm. The point of the method is to replace the least significant bits of the image with the encrypted message bits. The difference is practically unnoticeable on the picture, so one won’t suspect that it contains a hidden message.\n\nBut then R2-D2 decided that this method is quite well-known and the information won’t be protected enough. He decided to change the least significant bits of the image so that the secret information was a continuous sequence of the bytes of the image file. Help the droid determine if it is possible. And if it is, find the minimum number of bits to alter.\n\n## Input\n\nThe first line of the input contains integers _n_ and _m_ (1 ≤ _n_, _m_ ≤ 250 000) — the sizes of the image file and of the file with the secret information in bytes. On the second line the content of the file with an image is given and the third line contains the secret information. The files are given as a sequence of space-separated bytes. Each byte is written as a sequence of eight bits in the order from the most to the least significant bit.\n\n## Output\n\nPrint \"No\", if it is impossible to encrypt information in this image. Otherwise, print in the first line \"Yes\", and in the second line — the number of bits to alter and the number of the byte in the file with the image, starting from which the secret information will be recorded. If there are multiple possible variants, print the one where the secret information is written closer to the beginning of the image file.\n\n## Samples\n| input | output |\n|--------|--------|\n|  3 2<br/> 11110001 11110001 11110000<br/>11110000 11110000     |   Yes<br/>1 2|\n\n| input | output |\n|--------|--------|\n|3 1<br/>11110000 11110001 11110000<br/>11110000      |   Yes<br/>0 1|\n\n\n**Problem Author: **Denis Dublennykh (prepared by Oleg Dolgorukov)\n\n题目老长难懂，其实就是给你一个n byte的01A串，m byte的01B串.其中A串中每一byte的最后一个bit是可以修改的，问至少修改多少次A串能使B使A的子串。输出修改次数与最小的起始匹配位置。\n\n首先将A串每byte取前7位（代码中的a数组）与B串每byte取前7位（代码中的b数组）用KMP匹配，因为前7位不能改，所以如果没有一处匹配就直接输出No了。\n\n然后将A串每byte取后1位（代码中的ax数组）与B串每byte取后一位（代码中的bx数组）求hamming距离。\n\n如何求ax与bx的hamming距离呢？\n\n可以巧妙的ax作为卷积中的f函数，bx的逆向数组bx\\`作为卷积中的g函数。两者求卷积。这样就成了：\n$$c[i + m - 1] = ax[i + 0] * bx\\`[m - 0 - 1] + ax[i + 1] * bx\\`[m - 1 - 1] + …… ax[i + j] * bx\\`[m - j - 1] + …… ax[i + m - 1] * bx\\`[m - (m - 1) - 1]$$\n\n可以看出，如果ax , bx中同为1,乘积为1,否则为0,这样就能统计出了有多少位同为1了。\n\n如果将ax,bx数组中的01取反，再进行上述操作，那么救能统计出有多少位同为0了。两者相加就是全部相同的有多少，用总字符数m减去它，就能求出hamming距离了！\n\n卷积复杂度为O(nlg(n))而暴力算法的复杂度为O(n×m)，真是太神奇了！\n```C++\nusing namespace std;\nconst int N = 250005;\nint n, m;\nconst double pi = acos(-1.0);\n// Complex  z = a + b * i\nstruct Complex {\n\tdouble x, y;\n\tComplex(double x = 0.0, double y = 0.0) :\n\t\t\tx(x), y(y) {\n\t}\n\tComplex operator +(const Complex &amp;c) const {\n\t\treturn Complex(x + c.x, y + c.y);\n\t}\n\tComplex operator -(const Complex &amp;c) const {\n\t\treturn Complex(x - c.x, y - c.y);\n\t}\n\tComplex operator *(const Complex &amp;c) const {\n\t\treturn Complex(x * c.x - y * c.y, x * c.y + y * c.x);\n\t}\n};\nint a[N], b[N], ax[N], bx[N];\nchar buf[8];\n/*\n * kmpNext[]的意思:next'[i]=next[next[...[next[i]]]] (直到next'[i]&lt;0或者\n x[next'[i]]!=x[i])\n * 这样的预处理可以快一些\n */\nvoid preKMP(int x[], int m, int kmpNext[]) {\n\tint i, j;\n\tj = kmpNext[0] = -1;\n\ti = 0;\n\twhile (i &lt; m) {\n\t\twhile (-1 != j &amp;&amp; x[i] != x[j])\n\t\t\tj = kmpNext[j];\n\t\tif (x[++i] == x[++j]) kmpNext[i] = kmpNext[j];\n\t\telse kmpNext[i] = j;\n\t}\n}\n/*\n * 返回x在y中出现的次数,可以重叠\n */\nint next[N];\nvector pos;\nvoid KMP_Count(int x[], int m, int y[], int n) { //x是模式串,y是主串\n\tint i, j;\n\tpos.clear();\n\tpreKMP(x, m, next);\n\ti = j = 0;\n\twhile (i &lt; n) {\n\t\twhile (-1 != j &amp;&amp; y[i] != x[j])\n\t\t\tj = next[j];\n\t\ti++;\n\t\tj++;\n\t\tif (j &gt;= m) {\n\t\t\tpos.push_back(i - m);\n\t\t\tj = next[j];\n\t\t}\n\t}\n}\n//len = 2 ^ k\ninline void change(Complex y[], int len) {\n\tfor (int i = 1, j = len / 2; i &lt; len - 1; i++) {\n\t\tif (i &lt; j) swap(y[i], y[j]);\n\t\tint k = len / 2;\n\t\twhile (j &gt;= k) {\n\t\t\tj -= k;\n\t\t\tk /= 2;\n\t\t}\n\t\tif (j &lt; k) j += k;\n\t}\n}\n// FFT\n// len = 2 ^ k\n// on = 1  DFT    on = -1 IDFT\ninline void FFT(Complex y[], int len, int on) {\n\tchange(y, len);\n\tfor (int h = 2; h &lt;= len; h &lt;&lt;= 1) {\n\t\tComplex wn(cos(-on * 2 * pi / h), sin(-on * 2 * pi / h));\n\t\tfor (int j = 0; j &lt; len; j += h) {\n\t\t\tComplex w(1, 0);\n\t\t\tfor (int k = j; k &lt; j + h / 2; k++) {\n\t\t\t\tComplex u = y[k];\n\t\t\t\tComplex t = w * y[k + h / 2];\n\t\t\t\ty[k] = u + t;\n\t\t\t\ty[k + h / 2] = u - t;\n\t\t\t\tw = w * wn;\n\t\t\t}\n\t\t}\n\t}\n\tif (on == -1) {\n\t\tfor (int i = 0; i &lt; len; i++) {\n\t\t\ty[i].x /= len;\n\t\t}\n\t}\n}\n//FFT求卷积,a数组长度n，b数组长度m\nint res[N];\nComplex x1[N &lt;&lt; 2], x2[N &lt;&lt; 2]; //FFT开4倍\nvoid Convolution(int a[], int b[]) {\n\tint len = max(n, m);\n\tint l = 1;\n\twhile (l &lt; len * 2)\n\t\tl &lt;&lt;= 1;\n\tfor (int i = 0; i &lt; l; i++)\n\t\tx1[i] = Complex(i &lt; n ? a[i] : 0, 0);\n\tfor (int i = 0; i &lt; l; i++)\n\t\tx2[i] = Complex(i &lt; m ? b[i] : 0, 0);\n\t//DFT\n\tFFT(x1, l, 1);\n\tFFT(x2, l, 1);\n\tfor (int i = 0; i &lt; l; i++)\n\t\tx1[i] = x1[i] * x2[i];\n\t//IDFT\n\tFFT(x1, l, -1);\n\t//based on m\n\tint base = m ;\n\tfor (int i = 0; i &lt;= n - base; i++) {\n\t\tres[i] += (int) (x1[i + base - 1].x + 0.5);\n\t}\n}\nint main() {\n\twhile (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n\t\tfor (int i = 0; i &lt; n; i++) {\n\t\t\ta[i] = 0;\n\t\t\tscanf(\"%s\", buf);\n\t\t\tfor (int j = 0; j &lt; 7; j++) {\n\t\t\t\ta[i] = a[i] &lt;&lt; 1 | (buf[j] - '0');\n\t\t\t}\n\t\t\tax[i] = buf[7] - '0';\n\t\t}\n\t\tfor (int i = 0; i &lt; m; i++) {\n\t\t\tb[i] = 0;\n\t\t\tscanf(\"%s\", buf);\n\t\t\tfor (int j = 0; j &lt; 7; j++) {\n\t\t\t\tb[i] = b[i] &lt;&lt; 1 | (buf[j] - '0');\n\t\t\t}\n\t\t\tbx[i] = buf[7] - '0';\n\t\t}\n\t\tKMP_Count(b, m, a, n);\n\t\tif (pos.size() == 0) puts(\"No\");\n\t\telse {\n\t\t\treverse(bx, bx + m);\n\t\t\tmemset(res, 0, sizeof(res));\n\t\t\tputs(\"Yes\");\n\t\t\tConvolution(ax, bx);\n\t\t\tfor (int i = 0; i &lt; n; i++)\n\t\t\t\tax[i] ^= 1;\n\t\t\tfor (int i = 0; i &lt; m; i++)\n\t\t\t\tbx[i] ^= 1;\n\t\t\tConvolution(ax, bx);\n\t\t\tint ans = m, idx = 0;\n\t\t\tfor (int i = 0; i &lt; (int) pos.size(); i++) {\n\t\t\t\tif (m - res[pos[i]] &lt; ans) {\n\t\t\t\t\tans = m - res[pos[i]];\n\t\t\t\t\tidx = pos[i] + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprintf(\"%d %d\\n\", ans, idx);\n\t\t}\n\t}\n}\n```\n","slug":"timus-1996-cipher-message-3-kmpfft","published":1,"updated":"2017-01-16T01:58:03.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l2b004z5rgxo8rmx87z","content":"<p>题目链接：<a href=\"http://acm.timus.ru/problem.aspx?space=1&amp;num=1996\" target=\"_blank\" rel=\"external\">click here</a></p>\n<p>##description<br>Emperor Palpatine has been ruling the Empire for 25 years and Darth Vader has been the head of the Empire Armed Forces. However, the Rebel movement is strong like it never used to be. One of the rebel leaders, Princess Leia from Alderaan, managed to get hold of secret blueprints of the Death Star, the imperial war station.</p>\n<p>The Princess was going to deliver the station plan to the secret base for further analysis and searching for vulnerable spots. But her ship was attacked by the space destroyer “Devastator” headed by Darth Vader. At the last moment Princess Leia managed to send her findings to one of the closest planet called Tatooine with her droid R2-D2. Quite conveniently, an old friend of her father Obi-Wan Kenobi lives on that planet.</p>\n<p>R2-D2 realizes the importance of his mission. He is going to encrypt the information so that the wrong people won’t get it.<br><a id=\"more\"></a><br>The memory of R2-D2 has many files with images. First he wanted to use a well-known encrypting algorithm. The point of the method is to replace the least significant bits of the image with the encrypted message bits. The difference is practically unnoticeable on the picture, so one won’t suspect that it contains a hidden message.</p>\n<p>But then R2-D2 decided that this method is quite well-known and the information won’t be protected enough. He decided to change the least significant bits of the image so that the secret information was a continuous sequence of the bytes of the image file. Help the droid determine if it is possible. And if it is, find the minimum number of bits to alter.</p>\n<h2 id=\"Input\"><a href=\"#Input\" class=\"headerlink\" title=\"Input\"></a>Input</h2><p>The first line of the input contains integers <em>n</em> and <em>m</em> (1 ≤ <em>n</em>, <em>m</em> ≤ 250 000) — the sizes of the image file and of the file with the secret information in bytes. On the second line the content of the file with an image is given and the third line contains the secret information. The files are given as a sequence of space-separated bytes. Each byte is written as a sequence of eight bits in the order from the most to the least significant bit.</p>\n<h2 id=\"Output\"><a href=\"#Output\" class=\"headerlink\" title=\"Output\"></a>Output</h2><p>Print “No”, if it is impossible to encrypt information in this image. Otherwise, print in the first line “Yes”, and in the second line — the number of bits to alter and the number of the byte in the file with the image, starting from which the secret information will be recorded. If there are multiple possible variants, print the one where the secret information is written closer to the beginning of the image file.</p>\n<h2 id=\"Samples\"><a href=\"#Samples\" class=\"headerlink\" title=\"Samples\"></a>Samples</h2><table>\n<thead>\n<tr>\n<th>input</th>\n<th>output</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3 2<br> 11110001 11110001 11110000<br>11110000 11110000</td>\n<td>Yes<br>1 2</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>input</th>\n<th>output</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3 1<br>11110000 11110001 11110000<br>11110000</td>\n<td>Yes<br>0 1</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Problem Author: </strong>Denis Dublennykh (prepared by Oleg Dolgorukov)</p>\n<p>题目老长难懂，其实就是给你一个n byte的01A串，m byte的01B串.其中A串中每一byte的最后一个bit是可以修改的，问至少修改多少次A串能使B使A的子串。输出修改次数与最小的起始匹配位置。</p>\n<p>首先将A串每byte取前7位（代码中的a数组）与B串每byte取前7位（代码中的b数组）用KMP匹配，因为前7位不能改，所以如果没有一处匹配就直接输出No了。</p>\n<p>然后将A串每byte取后1位（代码中的ax数组）与B串每byte取后一位（代码中的bx数组）求hamming距离。</p>\n<p>如何求ax与bx的hamming距离呢？</p>\n<p>可以巧妙的ax作为卷积中的f函数，bx的逆向数组bx`作为卷积中的g函数。两者求卷积。这样就成了：<br>$$c[i + m - 1] = ax[i + 0] <em> bx`[m - 0 - 1] + ax[i + 1] </em> bx`[m - 1 - 1] + …… ax[i + j] <em> bx`[m - j - 1] + …… ax[i + m - 1] </em> bx`[m - (m - 1) - 1]$$</p>\n<p>可以看出，如果ax , bx中同为1,乘积为1,否则为0,这样就能统计出了有多少位同为1了。</p>\n<p>如果将ax,bx数组中的01取反，再进行上述操作，那么救能统计出有多少位同为0了。两者相加就是全部相同的有多少，用总字符数m减去它，就能求出hamming距离了！</p>\n<p>卷积复杂度为O(nlg(n))而暴力算法的复杂度为O(n×m)，真是太神奇了！<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div></pre></td><td class=\"code\"><pre><div class=\"line\">using namespace std;</div><div class=\"line\">const int N = 250005;</div><div class=\"line\">int n, m;</div><div class=\"line\">const double pi = acos(-1.0);</div><div class=\"line\">// Complex  z = a + b * i</div><div class=\"line\">struct Complex &#123;</div><div class=\"line\">\tdouble x, y;</div><div class=\"line\">\tComplex(double x = 0.0, double y = 0.0) :</div><div class=\"line\">\t\t\tx(x), y(y) &#123;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tComplex operator +(const Complex &amp;amp;c) const &#123;</div><div class=\"line\">\t\treturn Complex(x + c.x, y + c.y);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tComplex operator -(const Complex &amp;amp;c) const &#123;</div><div class=\"line\">\t\treturn Complex(x - c.x, y - c.y);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tComplex operator *(const Complex &amp;amp;c) const &#123;</div><div class=\"line\">\t\treturn Complex(x * c.x - y * c.y, x * c.y + y * c.x);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\">int a[N], b[N], ax[N], bx[N];</div><div class=\"line\">char buf[8];</div><div class=\"line\">/*</div><div class=\"line\"> * kmpNext[]的意思:next'[i]=next[next[...[next[i]]]] (直到next'[i]&amp;lt;0或者</div><div class=\"line\"> x[next'[i]]!=x[i])</div><div class=\"line\"> * 这样的预处理可以快一些</div><div class=\"line\"> */</div><div class=\"line\">void preKMP(int x[], int m, int kmpNext[]) &#123;</div><div class=\"line\">\tint i, j;</div><div class=\"line\">\tj = kmpNext[0] = -1;</div><div class=\"line\">\ti = 0;</div><div class=\"line\">\twhile (i &amp;lt; m) &#123;</div><div class=\"line\">\t\twhile (-1 != j &amp;amp;&amp;amp; x[i] != x[j])</div><div class=\"line\">\t\t\tj = kmpNext[j];</div><div class=\"line\">\t\tif (x[++i] == x[++j]) kmpNext[i] = kmpNext[j];</div><div class=\"line\">\t\telse kmpNext[i] = j;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">/*</div><div class=\"line\"> * 返回x在y中出现的次数,可以重叠</div><div class=\"line\"> */</div><div class=\"line\">int next[N];</div><div class=\"line\">vector pos;</div><div class=\"line\">void KMP_Count(int x[], int m, int y[], int n) &#123; //x是模式串,y是主串</div><div class=\"line\">\tint i, j;</div><div class=\"line\">\tpos.clear();</div><div class=\"line\">\tpreKMP(x, m, next);</div><div class=\"line\">\ti = j = 0;</div><div class=\"line\">\twhile (i &amp;lt; n) &#123;</div><div class=\"line\">\t\twhile (-1 != j &amp;amp;&amp;amp; y[i] != x[j])</div><div class=\"line\">\t\t\tj = next[j];</div><div class=\"line\">\t\ti++;</div><div class=\"line\">\t\tj++;</div><div class=\"line\">\t\tif (j &amp;gt;= m) &#123;</div><div class=\"line\">\t\t\tpos.push_back(i - m);</div><div class=\"line\">\t\t\tj = next[j];</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">//len = 2 ^ k</div><div class=\"line\">inline void change(Complex y[], int len) &#123;</div><div class=\"line\">\tfor (int i = 1, j = len / 2; i &amp;lt; len - 1; i++) &#123;</div><div class=\"line\">\t\tif (i &amp;lt; j) swap(y[i], y[j]);</div><div class=\"line\">\t\tint k = len / 2;</div><div class=\"line\">\t\twhile (j &amp;gt;= k) &#123;</div><div class=\"line\">\t\t\tj -= k;</div><div class=\"line\">\t\t\tk /= 2;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tif (j &amp;lt; k) j += k;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">// FFT</div><div class=\"line\">// len = 2 ^ k</div><div class=\"line\">// on = 1  DFT    on = -1 IDFT</div><div class=\"line\">inline void FFT(Complex y[], int len, int on) &#123;</div><div class=\"line\">\tchange(y, len);</div><div class=\"line\">\tfor (int h = 2; h &amp;lt;= len; h &amp;lt;&amp;lt;= 1) &#123;</div><div class=\"line\">\t\tComplex wn(cos(-on * 2 * pi / h), sin(-on * 2 * pi / h));</div><div class=\"line\">\t\tfor (int j = 0; j &amp;lt; len; j += h) &#123;</div><div class=\"line\">\t\t\tComplex w(1, 0);</div><div class=\"line\">\t\t\tfor (int k = j; k &amp;lt; j + h / 2; k++) &#123;</div><div class=\"line\">\t\t\t\tComplex u = y[k];</div><div class=\"line\">\t\t\t\tComplex t = w * y[k + h / 2];</div><div class=\"line\">\t\t\t\ty[k] = u + t;</div><div class=\"line\">\t\t\t\ty[k + h / 2] = u - t;</div><div class=\"line\">\t\t\t\tw = w * wn;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tif (on == -1) &#123;</div><div class=\"line\">\t\tfor (int i = 0; i &amp;lt; len; i++) &#123;</div><div class=\"line\">\t\t\ty[i].x /= len;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">//FFT求卷积,a数组长度n，b数组长度m</div><div class=\"line\">int res[N];</div><div class=\"line\">Complex x1[N &amp;lt;&amp;lt; 2], x2[N &amp;lt;&amp;lt; 2]; //FFT开4倍</div><div class=\"line\">void Convolution(int a[], int b[]) &#123;</div><div class=\"line\">\tint len = max(n, m);</div><div class=\"line\">\tint l = 1;</div><div class=\"line\">\twhile (l &amp;lt; len * 2)</div><div class=\"line\">\t\tl &amp;lt;&amp;lt;= 1;</div><div class=\"line\">\tfor (int i = 0; i &amp;lt; l; i++)</div><div class=\"line\">\t\tx1[i] = Complex(i &amp;lt; n ? a[i] : 0, 0);</div><div class=\"line\">\tfor (int i = 0; i &amp;lt; l; i++)</div><div class=\"line\">\t\tx2[i] = Complex(i &amp;lt; m ? b[i] : 0, 0);</div><div class=\"line\">\t//DFT</div><div class=\"line\">\tFFT(x1, l, 1);</div><div class=\"line\">\tFFT(x2, l, 1);</div><div class=\"line\">\tfor (int i = 0; i &amp;lt; l; i++)</div><div class=\"line\">\t\tx1[i] = x1[i] * x2[i];</div><div class=\"line\">\t//IDFT</div><div class=\"line\">\tFFT(x1, l, -1);</div><div class=\"line\">\t//based on m</div><div class=\"line\">\tint base = m ;</div><div class=\"line\">\tfor (int i = 0; i &amp;lt;= n - base; i++) &#123;</div><div class=\"line\">\t\tres[i] += (int) (x1[i + base - 1].x + 0.5);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">\twhile (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">\t\tfor (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">\t\t\ta[i] = 0;</div><div class=\"line\">\t\t\tscanf(\"%s\", buf);</div><div class=\"line\">\t\t\tfor (int j = 0; j &amp;lt; 7; j++) &#123;</div><div class=\"line\">\t\t\t\ta[i] = a[i] &amp;lt;&amp;lt; 1 | (buf[j] - '0');</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tax[i] = buf[7] - '0';</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tfor (int i = 0; i &amp;lt; m; i++) &#123;</div><div class=\"line\">\t\t\tb[i] = 0;</div><div class=\"line\">\t\t\tscanf(\"%s\", buf);</div><div class=\"line\">\t\t\tfor (int j = 0; j &amp;lt; 7; j++) &#123;</div><div class=\"line\">\t\t\t\tb[i] = b[i] &amp;lt;&amp;lt; 1 | (buf[j] - '0');</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tbx[i] = buf[7] - '0';</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tKMP_Count(b, m, a, n);</div><div class=\"line\">\t\tif (pos.size() == 0) puts(\"No\");</div><div class=\"line\">\t\telse &#123;</div><div class=\"line\">\t\t\treverse(bx, bx + m);</div><div class=\"line\">\t\t\tmemset(res, 0, sizeof(res));</div><div class=\"line\">\t\t\tputs(\"Yes\");</div><div class=\"line\">\t\t\tConvolution(ax, bx);</div><div class=\"line\">\t\t\tfor (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">\t\t\t\tax[i] ^= 1;</div><div class=\"line\">\t\t\tfor (int i = 0; i &amp;lt; m; i++)</div><div class=\"line\">\t\t\t\tbx[i] ^= 1;</div><div class=\"line\">\t\t\tConvolution(ax, bx);</div><div class=\"line\">\t\t\tint ans = m, idx = 0;</div><div class=\"line\">\t\t\tfor (int i = 0; i &amp;lt; (int) pos.size(); i++) &#123;</div><div class=\"line\">\t\t\t\tif (m - res[pos[i]] &amp;lt; ans) &#123;</div><div class=\"line\">\t\t\t\t\tans = m - res[pos[i]];</div><div class=\"line\">\t\t\t\t\tidx = pos[i] + 1;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tprintf(\"%d %d\\n\", ans, idx);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p>题目链接：<a href=\"http://acm.timus.ru/problem.aspx?space=1&amp;num=1996\">click here</a></p>\n<p>##description<br>Emperor Palpatine has been ruling the Empire for 25 years and Darth Vader has been the head of the Empire Armed Forces. However, the Rebel movement is strong like it never used to be. One of the rebel leaders, Princess Leia from Alderaan, managed to get hold of secret blueprints of the Death Star, the imperial war station.</p>\n<p>The Princess was going to deliver the station plan to the secret base for further analysis and searching for vulnerable spots. But her ship was attacked by the space destroyer “Devastator” headed by Darth Vader. At the last moment Princess Leia managed to send her findings to one of the closest planet called Tatooine with her droid R2-D2. Quite conveniently, an old friend of her father Obi-Wan Kenobi lives on that planet.</p>\n<p>R2-D2 realizes the importance of his mission. He is going to encrypt the information so that the wrong people won’t get it.<br>","more":"<br>The memory of R2-D2 has many files with images. First he wanted to use a well-known encrypting algorithm. The point of the method is to replace the least significant bits of the image with the encrypted message bits. The difference is practically unnoticeable on the picture, so one won’t suspect that it contains a hidden message.</p>\n<p>But then R2-D2 decided that this method is quite well-known and the information won’t be protected enough. He decided to change the least significant bits of the image so that the secret information was a continuous sequence of the bytes of the image file. Help the droid determine if it is possible. And if it is, find the minimum number of bits to alter.</p>\n<h2 id=\"Input\"><a href=\"#Input\" class=\"headerlink\" title=\"Input\"></a>Input</h2><p>The first line of the input contains integers <em>n</em> and <em>m</em> (1 ≤ <em>n</em>, <em>m</em> ≤ 250 000) — the sizes of the image file and of the file with the secret information in bytes. On the second line the content of the file with an image is given and the third line contains the secret information. The files are given as a sequence of space-separated bytes. Each byte is written as a sequence of eight bits in the order from the most to the least significant bit.</p>\n<h2 id=\"Output\"><a href=\"#Output\" class=\"headerlink\" title=\"Output\"></a>Output</h2><p>Print “No”, if it is impossible to encrypt information in this image. Otherwise, print in the first line “Yes”, and in the second line — the number of bits to alter and the number of the byte in the file with the image, starting from which the secret information will be recorded. If there are multiple possible variants, print the one where the secret information is written closer to the beginning of the image file.</p>\n<h2 id=\"Samples\"><a href=\"#Samples\" class=\"headerlink\" title=\"Samples\"></a>Samples</h2><table>\n<thead>\n<tr>\n<th>input</th>\n<th>output</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3 2<br/> 11110001 11110001 11110000<br/>11110000 11110000</td>\n<td>Yes<br/>1 2</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>input</th>\n<th>output</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3 1<br/>11110000 11110001 11110000<br/>11110000</td>\n<td>Yes<br/>0 1</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Problem Author: </strong>Denis Dublennykh (prepared by Oleg Dolgorukov)</p>\n<p>题目老长难懂，其实就是给你一个n byte的01A串，m byte的01B串.其中A串中每一byte的最后一个bit是可以修改的，问至少修改多少次A串能使B使A的子串。输出修改次数与最小的起始匹配位置。</p>\n<p>首先将A串每byte取前7位（代码中的a数组）与B串每byte取前7位（代码中的b数组）用KMP匹配，因为前7位不能改，所以如果没有一处匹配就直接输出No了。</p>\n<p>然后将A串每byte取后1位（代码中的ax数组）与B串每byte取后一位（代码中的bx数组）求hamming距离。</p>\n<p>如何求ax与bx的hamming距离呢？</p>\n<p>可以巧妙的ax作为卷积中的f函数，bx的逆向数组bx`作为卷积中的g函数。两者求卷积。这样就成了：<br>$$c[i + m - 1] = ax[i + 0] <em> bx`[m - 0 - 1] + ax[i + 1] </em> bx`[m - 1 - 1] + …… ax[i + j] <em> bx`[m - j - 1] + …… ax[i + m - 1] </em> bx`[m - (m - 1) - 1]$$</p>\n<p>可以看出，如果ax , bx中同为1,乘积为1,否则为0,这样就能统计出了有多少位同为1了。</p>\n<p>如果将ax,bx数组中的01取反，再进行上述操作，那么救能统计出有多少位同为0了。两者相加就是全部相同的有多少，用总字符数m减去它，就能求出hamming距离了！</p>\n<p>卷积复杂度为O(nlg(n))而暴力算法的复杂度为O(n×m)，真是太神奇了！<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div></pre></td><td class=\"code\"><pre><div class=\"line\">using namespace std;</div><div class=\"line\">const int N = 250005;</div><div class=\"line\">int n, m;</div><div class=\"line\">const double pi = acos(-1.0);</div><div class=\"line\">// Complex  z = a + b * i</div><div class=\"line\">struct Complex &#123;</div><div class=\"line\">\tdouble x, y;</div><div class=\"line\">\tComplex(double x = 0.0, double y = 0.0) :</div><div class=\"line\">\t\t\tx(x), y(y) &#123;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tComplex operator +(const Complex &amp;amp;c) const &#123;</div><div class=\"line\">\t\treturn Complex(x + c.x, y + c.y);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tComplex operator -(const Complex &amp;amp;c) const &#123;</div><div class=\"line\">\t\treturn Complex(x - c.x, y - c.y);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tComplex operator *(const Complex &amp;amp;c) const &#123;</div><div class=\"line\">\t\treturn Complex(x * c.x - y * c.y, x * c.y + y * c.x);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;;</div><div class=\"line\">int a[N], b[N], ax[N], bx[N];</div><div class=\"line\">char buf[8];</div><div class=\"line\">/*</div><div class=\"line\"> * kmpNext[]的意思:next'[i]=next[next[...[next[i]]]] (直到next'[i]&amp;lt;0或者</div><div class=\"line\"> x[next'[i]]!=x[i])</div><div class=\"line\"> * 这样的预处理可以快一些</div><div class=\"line\"> */</div><div class=\"line\">void preKMP(int x[], int m, int kmpNext[]) &#123;</div><div class=\"line\">\tint i, j;</div><div class=\"line\">\tj = kmpNext[0] = -1;</div><div class=\"line\">\ti = 0;</div><div class=\"line\">\twhile (i &amp;lt; m) &#123;</div><div class=\"line\">\t\twhile (-1 != j &amp;amp;&amp;amp; x[i] != x[j])</div><div class=\"line\">\t\t\tj = kmpNext[j];</div><div class=\"line\">\t\tif (x[++i] == x[++j]) kmpNext[i] = kmpNext[j];</div><div class=\"line\">\t\telse kmpNext[i] = j;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">/*</div><div class=\"line\"> * 返回x在y中出现的次数,可以重叠</div><div class=\"line\"> */</div><div class=\"line\">int next[N];</div><div class=\"line\">vector pos;</div><div class=\"line\">void KMP_Count(int x[], int m, int y[], int n) &#123; //x是模式串,y是主串</div><div class=\"line\">\tint i, j;</div><div class=\"line\">\tpos.clear();</div><div class=\"line\">\tpreKMP(x, m, next);</div><div class=\"line\">\ti = j = 0;</div><div class=\"line\">\twhile (i &amp;lt; n) &#123;</div><div class=\"line\">\t\twhile (-1 != j &amp;amp;&amp;amp; y[i] != x[j])</div><div class=\"line\">\t\t\tj = next[j];</div><div class=\"line\">\t\ti++;</div><div class=\"line\">\t\tj++;</div><div class=\"line\">\t\tif (j &amp;gt;= m) &#123;</div><div class=\"line\">\t\t\tpos.push_back(i - m);</div><div class=\"line\">\t\t\tj = next[j];</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">//len = 2 ^ k</div><div class=\"line\">inline void change(Complex y[], int len) &#123;</div><div class=\"line\">\tfor (int i = 1, j = len / 2; i &amp;lt; len - 1; i++) &#123;</div><div class=\"line\">\t\tif (i &amp;lt; j) swap(y[i], y[j]);</div><div class=\"line\">\t\tint k = len / 2;</div><div class=\"line\">\t\twhile (j &amp;gt;= k) &#123;</div><div class=\"line\">\t\t\tj -= k;</div><div class=\"line\">\t\t\tk /= 2;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tif (j &amp;lt; k) j += k;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">// FFT</div><div class=\"line\">// len = 2 ^ k</div><div class=\"line\">// on = 1  DFT    on = -1 IDFT</div><div class=\"line\">inline void FFT(Complex y[], int len, int on) &#123;</div><div class=\"line\">\tchange(y, len);</div><div class=\"line\">\tfor (int h = 2; h &amp;lt;= len; h &amp;lt;&amp;lt;= 1) &#123;</div><div class=\"line\">\t\tComplex wn(cos(-on * 2 * pi / h), sin(-on * 2 * pi / h));</div><div class=\"line\">\t\tfor (int j = 0; j &amp;lt; len; j += h) &#123;</div><div class=\"line\">\t\t\tComplex w(1, 0);</div><div class=\"line\">\t\t\tfor (int k = j; k &amp;lt; j + h / 2; k++) &#123;</div><div class=\"line\">\t\t\t\tComplex u = y[k];</div><div class=\"line\">\t\t\t\tComplex t = w * y[k + h / 2];</div><div class=\"line\">\t\t\t\ty[k] = u + t;</div><div class=\"line\">\t\t\t\ty[k + h / 2] = u - t;</div><div class=\"line\">\t\t\t\tw = w * wn;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tif (on == -1) &#123;</div><div class=\"line\">\t\tfor (int i = 0; i &amp;lt; len; i++) &#123;</div><div class=\"line\">\t\t\ty[i].x /= len;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">//FFT求卷积,a数组长度n，b数组长度m</div><div class=\"line\">int res[N];</div><div class=\"line\">Complex x1[N &amp;lt;&amp;lt; 2], x2[N &amp;lt;&amp;lt; 2]; //FFT开4倍</div><div class=\"line\">void Convolution(int a[], int b[]) &#123;</div><div class=\"line\">\tint len = max(n, m);</div><div class=\"line\">\tint l = 1;</div><div class=\"line\">\twhile (l &amp;lt; len * 2)</div><div class=\"line\">\t\tl &amp;lt;&amp;lt;= 1;</div><div class=\"line\">\tfor (int i = 0; i &amp;lt; l; i++)</div><div class=\"line\">\t\tx1[i] = Complex(i &amp;lt; n ? a[i] : 0, 0);</div><div class=\"line\">\tfor (int i = 0; i &amp;lt; l; i++)</div><div class=\"line\">\t\tx2[i] = Complex(i &amp;lt; m ? b[i] : 0, 0);</div><div class=\"line\">\t//DFT</div><div class=\"line\">\tFFT(x1, l, 1);</div><div class=\"line\">\tFFT(x2, l, 1);</div><div class=\"line\">\tfor (int i = 0; i &amp;lt; l; i++)</div><div class=\"line\">\t\tx1[i] = x1[i] * x2[i];</div><div class=\"line\">\t//IDFT</div><div class=\"line\">\tFFT(x1, l, -1);</div><div class=\"line\">\t//based on m</div><div class=\"line\">\tint base = m ;</div><div class=\"line\">\tfor (int i = 0; i &amp;lt;= n - base; i++) &#123;</div><div class=\"line\">\t\tres[i] += (int) (x1[i + base - 1].x + 0.5);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">int main() &#123;</div><div class=\"line\">\twhile (~scanf(\"%d%d\", &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">\t\tfor (int i = 0; i &amp;lt; n; i++) &#123;</div><div class=\"line\">\t\t\ta[i] = 0;</div><div class=\"line\">\t\t\tscanf(\"%s\", buf);</div><div class=\"line\">\t\t\tfor (int j = 0; j &amp;lt; 7; j++) &#123;</div><div class=\"line\">\t\t\t\ta[i] = a[i] &amp;lt;&amp;lt; 1 | (buf[j] - '0');</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tax[i] = buf[7] - '0';</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tfor (int i = 0; i &amp;lt; m; i++) &#123;</div><div class=\"line\">\t\t\tb[i] = 0;</div><div class=\"line\">\t\t\tscanf(\"%s\", buf);</div><div class=\"line\">\t\t\tfor (int j = 0; j &amp;lt; 7; j++) &#123;</div><div class=\"line\">\t\t\t\tb[i] = b[i] &amp;lt;&amp;lt; 1 | (buf[j] - '0');</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tbx[i] = buf[7] - '0';</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tKMP_Count(b, m, a, n);</div><div class=\"line\">\t\tif (pos.size() == 0) puts(\"No\");</div><div class=\"line\">\t\telse &#123;</div><div class=\"line\">\t\t\treverse(bx, bx + m);</div><div class=\"line\">\t\t\tmemset(res, 0, sizeof(res));</div><div class=\"line\">\t\t\tputs(\"Yes\");</div><div class=\"line\">\t\t\tConvolution(ax, bx);</div><div class=\"line\">\t\t\tfor (int i = 0; i &amp;lt; n; i++)</div><div class=\"line\">\t\t\t\tax[i] ^= 1;</div><div class=\"line\">\t\t\tfor (int i = 0; i &amp;lt; m; i++)</div><div class=\"line\">\t\t\t\tbx[i] ^= 1;</div><div class=\"line\">\t\t\tConvolution(ax, bx);</div><div class=\"line\">\t\t\tint ans = m, idx = 0;</div><div class=\"line\">\t\t\tfor (int i = 0; i &amp;lt; (int) pos.size(); i++) &#123;</div><div class=\"line\">\t\t\t\tif (m - res[pos[i]] &amp;lt; ans) &#123;</div><div class=\"line\">\t\t\t\t\tans = m - res[pos[i]];</div><div class=\"line\">\t\t\t\t\tidx = pos[i] + 1;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tprintf(\"%d %d\\n\", ans, idx);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"内网2082 字母","id":"69","date":"2014-08-12T14:10:46.000Z","_content":"##Description\n\n乐乐开始学习英文字母了，小C为他准备了很多字母牌，每张牌有一个英文字母。有天乐乐把所有的牌排成一行，这些字母竟然形成了一个回文串。小C想知道，乐乐在排字母的时候，有多少种情况，最后的字母形成回文串。\n\n##Input\n\n输入一行，表示乐乐有哪些字母，均大写。\n\n##Output\n\n输出有多少种情况，排列的字母是一个回文串。\n<!--more-->\n##Sample Input\nAAAAB AABB CD\n\n##Sample Output\n\n1 2 0\n\n##Hint\n100%的数据，字母的个数不超过1000。\n<br/>\n---\n\nA(m,m)/(A(cnt1,cnt1)*A(cnt2,cnt2).......)\n\n主要是排列组合数的计算技巧。将n!分解质因数，然后上面的因子减去下面相同的因子，这样就不会因为计算阶乘而爆数组了。n!中质因数m的个数：n/m+n/m^2+n/m^3+n/m^4.........\n```C++\n#include \"iostream\"\n#include \"cstdio\"\n#include \"cstring\"\n#include \"string\"\n#include \"vector\"\nusing namespace std;\n#define sz(x) (int)x.size()\n#define DSIZE 10000\n#define clr(x,y) memset(x,y,sizeof(x));\nclass BigInteger {\nprivate:\n    int a[1001];\n    bool sign; //true-p , false-n\n    int len;\n\npublic:\n    BigInteger() {\n        len = 1;\n        sign = true;\n        clr(a, 0);\n        a[0] = 1;\n    }\n    void operator *=(int);\n    friend ostream &amp;operator&lt;&lt;(ostream &amp;, const BigInteger &amp;);\n};\n\nvoid BigInteger::operator*=(int x) {\n    if (x &lt; 0) x = -x, sign ^= 1;\n    for (int i = 0; i &lt; len; i++) {\n        a[i] *= x;\n    }\n    for (int i = 0; i &lt; len; i++) {\n        if (a[i] &gt;= DSIZE) {\n            a[i + 1] += a[i] / DSIZE;\n            a[i] %= DSIZE;\n        }\n    }\n    if (a[len]) len++;\n}\n\nostream &amp;operator&lt;&lt;(ostream &amp;out, const BigInteger &amp;x) {\n    if (!x.sign &amp;&amp; x.len) putchar('-');\n    printf(\"%d\", x.a[x.len - 1]);\n    for (int i = x.len - 2; i &gt;= 0; i--) {\n        printf(\"%04d\", x.a[i]);\n    }\n    return out;\n}\n\nint n, m;\nint cnt[30];\nint prime[1001], tot;\nbool ok[1001];\nint faclist[1001];\nvoid getprime(int n) {\n    clr(ok, 0);\n    tot = 0;\n    for (int i = 2; i &lt;= n; i++) {\n        if (!ok[i]) prime[tot++] = i;\n        for (int j = 0; j &lt; tot; j++) {\n            int now = i * prime[j];\n            if (now &gt; n) break;\n            ok[now] = 1;\n            if (i % prime[j] == 0) break;\n        }\n    }\n}\nvoid getfact(int x) {\n    int s = x &lt; 0 ? -x : x;\n    for (int i = 0; prime[i] &lt;= s; i++) {\n        for (int j = prime[i]; j &lt;= s; j *= prime[i]) {\n            faclist[i] += x / j;\n        }\n    }\n}\nchar str[1001];\nint main() {\n    getprime(1000);\n    while (~scanf(\"%s\",str)) {\n        n = strlen(str);\n        clr(cnt, 0);\n        for (int i = 0; i &lt; n; i++) {\n            cnt[str[i] - 'A']++;\n        }\n        int f = 0;\n        m = 0;\n        for (int i = 0; i &lt; 26 &amp;&amp; f &lt; 2; i++) {\n            if (cnt[i] &amp; 1) f++;\n            m += cnt[i] &gt;&gt;= 1;\n        }\n        if (f &gt; 1) {\n            printf(\"0\\n\");\n            continue;\n        }\n        clr(faclist, 0);\n        getfact(m);\n        for (int i = 0; i &lt; 26; i++)\n            getfact(-cnt[i]);\n        BigInteger res;\n        for (int i = 0; prime[i] &lt;= m; i++) {\n            for (int j = 0; j &lt; faclist[i]; j++) {\n                res *= prime[i];\n            }\n        }\n        cout &lt;&lt; res &lt;&lt; endl;\n    }\n}\n```language\n```\n\n</pre>","source":"_posts/zjnu2082.md","raw":"title: 内网2082 字母\ncategories:\n  - ACM\nid: 69\ndate: 2014-08-12 22:10:46\ntags: 组合\n---\n##Description\n\n乐乐开始学习英文字母了，小C为他准备了很多字母牌，每张牌有一个英文字母。有天乐乐把所有的牌排成一行，这些字母竟然形成了一个回文串。小C想知道，乐乐在排字母的时候，有多少种情况，最后的字母形成回文串。\n\n##Input\n\n输入一行，表示乐乐有哪些字母，均大写。\n\n##Output\n\n输出有多少种情况，排列的字母是一个回文串。\n<!--more-->\n##Sample Input\nAAAAB AABB CD\n\n##Sample Output\n\n1 2 0\n\n##Hint\n100%的数据，字母的个数不超过1000。\n<br/>\n---\n\nA(m,m)/(A(cnt1,cnt1)*A(cnt2,cnt2).......)\n\n主要是排列组合数的计算技巧。将n!分解质因数，然后上面的因子减去下面相同的因子，这样就不会因为计算阶乘而爆数组了。n!中质因数m的个数：n/m+n/m^2+n/m^3+n/m^4.........\n```C++\n#include \"iostream\"\n#include \"cstdio\"\n#include \"cstring\"\n#include \"string\"\n#include \"vector\"\nusing namespace std;\n#define sz(x) (int)x.size()\n#define DSIZE 10000\n#define clr(x,y) memset(x,y,sizeof(x));\nclass BigInteger {\nprivate:\n    int a[1001];\n    bool sign; //true-p , false-n\n    int len;\n\npublic:\n    BigInteger() {\n        len = 1;\n        sign = true;\n        clr(a, 0);\n        a[0] = 1;\n    }\n    void operator *=(int);\n    friend ostream &amp;operator&lt;&lt;(ostream &amp;, const BigInteger &amp;);\n};\n\nvoid BigInteger::operator*=(int x) {\n    if (x &lt; 0) x = -x, sign ^= 1;\n    for (int i = 0; i &lt; len; i++) {\n        a[i] *= x;\n    }\n    for (int i = 0; i &lt; len; i++) {\n        if (a[i] &gt;= DSIZE) {\n            a[i + 1] += a[i] / DSIZE;\n            a[i] %= DSIZE;\n        }\n    }\n    if (a[len]) len++;\n}\n\nostream &amp;operator&lt;&lt;(ostream &amp;out, const BigInteger &amp;x) {\n    if (!x.sign &amp;&amp; x.len) putchar('-');\n    printf(\"%d\", x.a[x.len - 1]);\n    for (int i = x.len - 2; i &gt;= 0; i--) {\n        printf(\"%04d\", x.a[i]);\n    }\n    return out;\n}\n\nint n, m;\nint cnt[30];\nint prime[1001], tot;\nbool ok[1001];\nint faclist[1001];\nvoid getprime(int n) {\n    clr(ok, 0);\n    tot = 0;\n    for (int i = 2; i &lt;= n; i++) {\n        if (!ok[i]) prime[tot++] = i;\n        for (int j = 0; j &lt; tot; j++) {\n            int now = i * prime[j];\n            if (now &gt; n) break;\n            ok[now] = 1;\n            if (i % prime[j] == 0) break;\n        }\n    }\n}\nvoid getfact(int x) {\n    int s = x &lt; 0 ? -x : x;\n    for (int i = 0; prime[i] &lt;= s; i++) {\n        for (int j = prime[i]; j &lt;= s; j *= prime[i]) {\n            faclist[i] += x / j;\n        }\n    }\n}\nchar str[1001];\nint main() {\n    getprime(1000);\n    while (~scanf(\"%s\",str)) {\n        n = strlen(str);\n        clr(cnt, 0);\n        for (int i = 0; i &lt; n; i++) {\n            cnt[str[i] - 'A']++;\n        }\n        int f = 0;\n        m = 0;\n        for (int i = 0; i &lt; 26 &amp;&amp; f &lt; 2; i++) {\n            if (cnt[i] &amp; 1) f++;\n            m += cnt[i] &gt;&gt;= 1;\n        }\n        if (f &gt; 1) {\n            printf(\"0\\n\");\n            continue;\n        }\n        clr(faclist, 0);\n        getfact(m);\n        for (int i = 0; i &lt; 26; i++)\n            getfact(-cnt[i]);\n        BigInteger res;\n        for (int i = 0; prime[i] &lt;= m; i++) {\n            for (int j = 0; j &lt; faclist[i]; j++) {\n                res *= prime[i];\n            }\n        }\n        cout &lt;&lt; res &lt;&lt; endl;\n    }\n}\n```language\n```\n\n</pre>","slug":"zjnu2082","published":1,"updated":"2017-01-16T01:58:03.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l2d00525rgxjsqgoac2","content":"<p>##Description</p>\n<p>乐乐开始学习英文字母了，小C为他准备了很多字母牌，每张牌有一个英文字母。有天乐乐把所有的牌排成一行，这些字母竟然形成了一个回文串。小C想知道，乐乐在排字母的时候，有多少种情况，最后的字母形成回文串。</p>\n<p>##Input</p>\n<p>输入一行，表示乐乐有哪些字母，均大写。</p>\n<p>##Output</p>\n<p>输出有多少种情况，排列的字母是一个回文串。<br><a id=\"more\"></a></p>\n<p>##Sample Input<br>AAAAB AABB CD</p>\n<p>##Sample Output</p>\n<p>1 2 0</p>\n<p>##Hint<br>100%的数据，字母的个数不超过1000。</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><br></h2><p>A(m,m)/(A(cnt1,cnt1)*A(cnt2,cnt2)…….)</p>\n<p>主要是排列组合数的计算技巧。将n!分解质因数，然后上面的因子减去下面相同的因子，这样就不会因为计算阶乘而爆数组了。n!中质因数m的个数：n/m+n/m^2+n/m^3+n/m^4………<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"iostream\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"cstdio\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"cstring\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"string\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"vector\"</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> DSIZE 10000</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"keyword\">class</span> BigInteger &#123;</div><div class=\"line\"><span class=\"keyword\">private</span>:</div><div class=\"line\">    <span class=\"keyword\">int</span> a[<span class=\"number\">1001</span>];</div><div class=\"line\">    <span class=\"keyword\">bool</span> sign; <span class=\"comment\">//true-p , false-n</span></div><div class=\"line\">    <span class=\"keyword\">int</span> len;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span>:</div><div class=\"line\">    BigInteger() &#123;</div><div class=\"line\">        len = <span class=\"number\">1</span>;</div><div class=\"line\">        sign = <span class=\"literal\">true</span>;</div><div class=\"line\">        clr(a, <span class=\"number\">0</span>);</div><div class=\"line\">        a[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">void</span> <span class=\"keyword\">operator</span> *=(<span class=\"keyword\">int</span>);</div><div class=\"line\">    <span class=\"keyword\">friend</span> ostream &amp;amp;<span class=\"keyword\">operator</span>&amp;lt;&amp;lt;(ostream &amp;amp;, <span class=\"keyword\">const</span> BigInteger &amp;amp;);</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> BigInteger::<span class=\"keyword\">operator</span>*=(<span class=\"keyword\">int</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (x &amp;lt; <span class=\"number\">0</span>) x = -x, sign ^= <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; len; i++) &#123;</div><div class=\"line\">        a[i] *= x;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; len; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (a[i] &amp;gt;= DSIZE) &#123;</div><div class=\"line\">            a[i + <span class=\"number\">1</span>] += a[i] / DSIZE;</div><div class=\"line\">            a[i] %= DSIZE;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (a[len]) len++;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">ostream &amp;amp;<span class=\"keyword\">operator</span>&amp;lt;&amp;lt;(ostream &amp;amp;out, <span class=\"keyword\">const</span> BigInteger &amp;amp;x) &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!x.sign &amp;amp;&amp;amp; x.len) <span class=\"built_in\">putchar</span>(<span class=\"string\">'-'</span>);</div><div class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\"</span>, x.a[x.len - <span class=\"number\">1</span>]);</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = x.len - <span class=\"number\">2</span>; i &amp;gt;= <span class=\"number\">0</span>; i--) &#123;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"%04d\"</span>, x.a[i]);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> out;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"keyword\">int</span> cnt[<span class=\"number\">30</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> prime[<span class=\"number\">1001</span>], tot;</div><div class=\"line\"><span class=\"keyword\">bool</span> ok[<span class=\"number\">1001</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> faclist[<span class=\"number\">1001</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getprime</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</div><div class=\"line\">    clr(ok, <span class=\"number\">0</span>);</div><div class=\"line\">    tot = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!ok[i]) prime[tot++] = i;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt; tot; j++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> now = i * prime[j];</div><div class=\"line\">            <span class=\"keyword\">if</span> (now &amp;gt; n) <span class=\"keyword\">break</span>;</div><div class=\"line\">            ok[now] = <span class=\"number\">1</span>;</div><div class=\"line\">            <span class=\"keyword\">if</span> (i % prime[j] == <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getfact</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = x &amp;lt; <span class=\"number\">0</span> ? -x : x;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; prime[i] &amp;lt;= s; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = prime[i]; j &amp;lt;= s; j *= prime[i]) &#123;</div><div class=\"line\">            faclist[i] += x / j;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">char</span> str[<span class=\"number\">1001</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    getprime(<span class=\"number\">1000</span>);</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%s\"</span>,str)) &#123;</div><div class=\"line\">        n = <span class=\"built_in\">strlen</span>(str);</div><div class=\"line\">        clr(cnt, <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            cnt[str[i] - <span class=\"string\">'A'</span>]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> f = <span class=\"number\">0</span>;</div><div class=\"line\">        m = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"number\">26</span> &amp;amp;&amp;amp; f &amp;lt; <span class=\"number\">2</span>; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (cnt[i] &amp;amp; <span class=\"number\">1</span>) f++;</div><div class=\"line\">            m += cnt[i] &amp;gt;&amp;gt;= <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (f &amp;gt; <span class=\"number\">1</span>) &#123;</div><div class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"0\\n\"</span>);</div><div class=\"line\">            <span class=\"keyword\">continue</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        clr(faclist, <span class=\"number\">0</span>);</div><div class=\"line\">        getfact(m);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"number\">26</span>; i++)</div><div class=\"line\">            getfact(-cnt[i]);</div><div class=\"line\">        BigInteger res;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; prime[i] &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt; faclist[i]; j++) &#123;</div><div class=\"line\">                res *= prime[i];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &amp;lt;&amp;lt; res &amp;lt;&amp;lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">```language</div></pre></td></tr></table></figure></p>\n<p></p>\n","excerpt":"<p>##Description</p>\n<p>乐乐开始学习英文字母了，小C为他准备了很多字母牌，每张牌有一个英文字母。有天乐乐把所有的牌排成一行，这些字母竟然形成了一个回文串。小C想知道，乐乐在排字母的时候，有多少种情况，最后的字母形成回文串。</p>\n<p>##Input</p>\n<p>输入一行，表示乐乐有哪些字母，均大写。</p>\n<p>##Output</p>\n<p>输出有多少种情况，排列的字母是一个回文串。<br>","more":"</p>\n<p>##Sample Input<br>AAAAB AABB CD</p>\n<p>##Sample Output</p>\n<p>1 2 0</p>\n<p>##Hint<br>100%的数据，字母的个数不超过1000。</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><br/></h2><p>A(m,m)/(A(cnt1,cnt1)*A(cnt2,cnt2)…….)</p>\n<p>主要是排列组合数的计算技巧。将n!分解质因数，然后上面的因子减去下面相同的因子，这样就不会因为计算阶乘而爆数组了。n!中质因数m的个数：n/m+n/m^2+n/m^3+n/m^4………<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"iostream\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"cstdio\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"cstring\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"string\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"vector\"</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> DSIZE 10000</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"keyword\">class</span> BigInteger &#123;</div><div class=\"line\"><span class=\"keyword\">private</span>:</div><div class=\"line\">    <span class=\"keyword\">int</span> a[<span class=\"number\">1001</span>];</div><div class=\"line\">    <span class=\"keyword\">bool</span> sign; <span class=\"comment\">//true-p , false-n</span></div><div class=\"line\">    <span class=\"keyword\">int</span> len;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span>:</div><div class=\"line\">    BigInteger() &#123;</div><div class=\"line\">        len = <span class=\"number\">1</span>;</div><div class=\"line\">        sign = <span class=\"literal\">true</span>;</div><div class=\"line\">        clr(a, <span class=\"number\">0</span>);</div><div class=\"line\">        a[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">void</span> <span class=\"keyword\">operator</span> *=(<span class=\"keyword\">int</span>);</div><div class=\"line\">    <span class=\"keyword\">friend</span> ostream &amp;amp;<span class=\"keyword\">operator</span>&amp;lt;&amp;lt;(ostream &amp;amp;, <span class=\"keyword\">const</span> BigInteger &amp;amp;);</div><div class=\"line\">&#125;;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">void</span> BigInteger::<span class=\"keyword\">operator</span>*=(<span class=\"keyword\">int</span> x) &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (x &amp;lt; <span class=\"number\">0</span>) x = -x, sign ^= <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; len; i++) &#123;</div><div class=\"line\">        a[i] *= x;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; len; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (a[i] &amp;gt;= DSIZE) &#123;</div><div class=\"line\">            a[i + <span class=\"number\">1</span>] += a[i] / DSIZE;</div><div class=\"line\">            a[i] %= DSIZE;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (a[len]) len++;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">ostream &amp;amp;<span class=\"keyword\">operator</span>&amp;lt;&amp;lt;(ostream &amp;amp;out, <span class=\"keyword\">const</span> BigInteger &amp;amp;x) &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!x.sign &amp;amp;&amp;amp; x.len) <span class=\"built_in\">putchar</span>(<span class=\"string\">'-'</span>);</div><div class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\"</span>, x.a[x.len - <span class=\"number\">1</span>]);</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = x.len - <span class=\"number\">2</span>; i &amp;gt;= <span class=\"number\">0</span>; i--) &#123;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"%04d\"</span>, x.a[i]);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> out;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"keyword\">int</span> cnt[<span class=\"number\">30</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> prime[<span class=\"number\">1001</span>], tot;</div><div class=\"line\"><span class=\"keyword\">bool</span> ok[<span class=\"number\">1001</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> faclist[<span class=\"number\">1001</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getprime</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</div><div class=\"line\">    clr(ok, <span class=\"number\">0</span>);</div><div class=\"line\">    tot = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!ok[i]) prime[tot++] = i;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt; tot; j++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> now = i * prime[j];</div><div class=\"line\">            <span class=\"keyword\">if</span> (now &amp;gt; n) <span class=\"keyword\">break</span>;</div><div class=\"line\">            ok[now] = <span class=\"number\">1</span>;</div><div class=\"line\">            <span class=\"keyword\">if</span> (i % prime[j] == <span class=\"number\">0</span>) <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">getfact</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = x &amp;lt; <span class=\"number\">0</span> ? -x : x;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; prime[i] &amp;lt;= s; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = prime[i]; j &amp;lt;= s; j *= prime[i]) &#123;</div><div class=\"line\">            faclist[i] += x / j;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">char</span> str[<span class=\"number\">1001</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    getprime(<span class=\"number\">1000</span>);</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%s\"</span>,str)) &#123;</div><div class=\"line\">        n = <span class=\"built_in\">strlen</span>(str);</div><div class=\"line\">        clr(cnt, <span class=\"number\">0</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; n; i++) &#123;</div><div class=\"line\">            cnt[str[i] - <span class=\"string\">'A'</span>]++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> f = <span class=\"number\">0</span>;</div><div class=\"line\">        m = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"number\">26</span> &amp;amp;&amp;amp; f &amp;lt; <span class=\"number\">2</span>; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (cnt[i] &amp;amp; <span class=\"number\">1</span>) f++;</div><div class=\"line\">            m += cnt[i] &amp;gt;&amp;gt;= <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (f &amp;gt; <span class=\"number\">1</span>) &#123;</div><div class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">\"0\\n\"</span>);</div><div class=\"line\">            <span class=\"keyword\">continue</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        clr(faclist, <span class=\"number\">0</span>);</div><div class=\"line\">        getfact(m);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; <span class=\"number\">26</span>; i++)</div><div class=\"line\">            getfact(-cnt[i]);</div><div class=\"line\">        BigInteger res;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; prime[i] &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &amp;lt; faclist[i]; j++) &#123;</div><div class=\"line\">                res *= prime[i];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &amp;lt;&amp;lt; res &amp;lt;&amp;lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">```language</div></pre></td></tr></table></figure></p>\n<p></pre></p>"},{"title":"内网2073 城主GeassCode","date":"2014-08-01T12:18:37.000Z","_content":"##Description\n\nGeassCode凭借自己在topcoder上的超凡表现，赢得了国王的喜爱，国王赏赐他一座城池。这座城池里有n个 村子，m条路连接这些村子。坐上城主的GeassCode决定要修路，他打算用最少的代价把所以的村子连在一起。据探子回报，有些村子之间虽然原来没有路 径，但是可以强行的去建一条路。GeassCode想知道，如果强行在某两个村子之间建一条路，最后的总花费是多少？\n\n<!--more-->\n\n##Input\n\n输入一行三个整数n，m，表示有n个村子，m条可建路径。\n\n2..m+1行，每行3个整数a,b,c（a≠b），表示可以在a和b村庄建一条花费为c的路径。\n\n第m+2行一个整数q，表示有多少个询问。\n\n接下来q个询问，每行3个整数a,b,c（a≠b），表示如果可以另外在a和b村庄建一条花费为c的路径，最终需要多少花费？\n\n##Output\n\n对于每个询问输出，输出最少的花费。\n\n\n##Sample Input\n4 5 1 2 4 2 3 3 1 4 6 2 4 3 1 3 2 3 3 4 3 1 3 1 1 4 2\n\n##Sample Output\n8 7 7\n\n##Hint\nn的范围[2,50000],m的范围[2,100000],q的范围[1,50000]。\n\n输入的m条边保证可以把所有村庄连在一起。输入的边权范围[1,10<sup>6</sup>]\n\n##Source\n\n张超\n<br/>\n\n- - -\n\n\n解法是如果可以在(u,v)上再加条边，则将最小生成树上的(u,v)节点最短路径中的最大边权与要加上这条边的替换。如果新的花费比旧的花费少，则取新的花费。否则什么也不换，取旧的花费。\n\n如何求树上两点之间的最短路径中的最大边权呢？\n\n可以按照这篇文章所述建一个类似于哈夫曼树，将点作为叶子，边的权值作为祖先构造一个N+N的树：[click here](http://blog.sina.com.cn/s/blog_51cea4040100ss3n.html)\n\n这样写的很容易错，尤其要区分两颗树的规模，我在这上面错了很久。\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 50005\n#define M 100005\nint n, m ;\nstruct Graph {\n    int u, v, w;\n    bool mark;\n    bool operator&lt;(Graph othr) const {\n        return w &lt; othr.w;\n    }\n} g[M];\n//UnionSet\nint p[N + N];\nvoid initUset(int n) {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    return x == p[x] ? p[x] : p[x] = uFind(p[x]);\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy) p[fy] = fx;\n}\n//Edge Graph\nint head[N + N], pos;\nstruct Edge {\n    int v, nxt;\n} e[N + N];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\nint size;\nvector&lt;pr&lt;int, int&gt; &gt; query[N];\nint qw[N];\nbool vis[N];\nint lca[N];\nint val[N + N];\nint dfs(int u) {\n    int solved = 0;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        solved += dfs(v);\n        if (size == solved) return solved;\n        uMerge(u, v);\n    }\n    if(~val[u])return solved;\n    vis[u] = 1;\n    for (int i = 0; i &lt; (int) query[u].size(); i++) {\n        int v = query[u][i].F;\n        if (vis[v]) {\n            solved++;\n            lca[query[u][i].S] = uFind(v);\n        }\n    }\n    return solved;\n}\nvoid tarjan() {\n    initUset(n);\n    clrA(vis, 0);\n    dfs(n);\n}\nvoid rebuild() {\n    clrA(val, -1);\n    initUset(n + n);\n    initEdge();\n    for (int i = 1; i &lt;= m; i++) {\n        if (g[i].mark == false) continue;\n        val[++n] = g[i].w;\n        int fu = uFind(g[i].u);\n        int fv = uFind(g[i].v);\n        p[fu] = n;\n        p[fv] = n;\n        add(n, fu);\n        add(n, fv);\n    }\n}\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;g[i].u, &amp;g[i].v, &amp;g[i].w);\n            g[i].mark = false;\n        }\n        sort(g + 1, g + 1 + m);\n        initUset(n);\n        LL sum = 0;\n        for (int i = 1; i &lt;= m; i++) {\n            int fx = uFind(g[i].u);\n            int fy = uFind(g[i].v);\n            if (fx != fy) {\n                sum += g[i].w;\n                g[i].mark = true;\n                p[fy] = fx;\n            }\n        }\n        for (int i = 1; i &lt;= n; i++)\n            query[i].clear();\n        scanf(\"%d\", &amp;size);\n        int u, v, w;\n        for (int i = 1; i &lt;= size; i++) {\n            scanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n            qw[i] = w;\n            query[u].push_back(MP(v, i));\n            query[v].push_back(MP(u, i));\n        }\n        rebuild();\n        tarjan();\n        for (int i = 1; i &lt;= size; i++) {\n            LL ans = sum - val[lca[i]] + qw[i];\n            printf(LLS\"\\n\", min(ans, sum));\n        }\n    }\n}\n```\n其实，可以直接在dfs的回溯过程中将子节点的max求出来。这样简单多了。感叹一句：并查集真神奇！\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x &gt;::iterator\n#define VI(x) vector&lt;x &gt;::iterator\n#define MI(x,y) map&lt;x,y &gt;::iterator\n#define SRI(x) set&lt;x &gt;::reverse_iterator\n#define VRI(x) vector&lt;x &gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y &gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty())x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 50005\n#define M 100005\nint n, m;\nstruct Graph {\n    int u, v, w;\n    bool operator&lt;(Graph othr) const {\n        return w &lt; othr.w;\n    }\n} g[M];\nstruct Pair {\n    int x, y;\n    Pair(int x, int y) :\n            x(x), y(y) {\n    }\n    ;\n};\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, w, nxt;\n} e[N &lt;&lt; 1];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v, int w) {\n    e[pos].v = v;\n    e[pos].w = w;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//UnionSet\nint p[N];\nint pmax[N];\nvoid initUset() {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    if (x != p[x]) {\n        int t = p[x];\n        p[x] = uFind(p[x]);\n        pmax[x] = max(pmax[x], pmax[t]);\n        return p[x];\n    }\n    return x;\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy) {\n        p[fy] = fx;\n        pmax[fy] = max(pmax[fy], pmax[fx]);\n    }\n}\nint size;\nvector&lt;Pair&gt; query[N];\nvector&lt;Pair&gt; mark[N];\nint qw[N];\nbool vis[N];\nint lca[N];\nvoid dfs(int u, int fa) {\n    if (size == 0) return;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        if (v == fa) continue;\n        dfs(v, u);\n        pmax[v] = max(pmax[v], e[i].w);\n        uMerge(u, v);\n    }\n    vis[u] = 1;\n    for (int i = 0; i &lt; (int) query[u].size(); i++) {\n        int v = query[u][i].x;\n        if (vis[v]) {\n            mark[uFind(v)].push_back(Pair(u, i));\n        }\n    }\n    if (!mark[u].empty()) {\n        for (VI(Pair)it=mark[u].begin();it!=mark[u].end();++it) {\n            int uu = it-&gt;x;\n            int vv = query[it-&gt;x][it-&gt;y].x;\n            int ss = query[it-&gt;x][it-&gt;y].y;\n            uFind(uu);\n            uFind(vv);\n            lca[ss] = max(pmax[uu], pmax[vv]);\n            size--;\n        }\n        mark[u].clear();\n    }\n}\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (!vis[i]) return i;\n    }\n    return assert(false), -1;\n}\nvoid tarjan() {\n    initUset();\n    clrA(vis, 0);\n    clrA(pmax, 0);\n    size = m;\n    dfs(findRoot(), -1);\n}\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;g[i].u, &amp;g[i].v, &amp;g[i].w);\n        }\n        sort(g + 1, g + 1 + m);\n        initUset();\n        initEdge();\n        LL sum = 0;\n        for (int i = 1; i &lt;= m; i++) {\n            int fx = uFind(g[i].u);\n            int fy = uFind(g[i].v);\n            if (fx != fy) {\n                sum += g[i].w;\n                add(g[i].u, g[i].v, g[i].w);\n                add(g[i].v, g[i].u, g[i].w);\n                p[fy] = fx;\n            }\n        }\n        for (int i = 1; i &lt;= n; i++) {\n            query[i].clear();\n            mark[i].clear();\n        }\n        scanf(\"%d\", &amp;m);\n        int u, v, w;\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n            qw[i] = w;\n            query[u].push_back(Pair(v, i));\n            query[v].push_back(Pair(u, i));\n        }\n        tarjan();\n        for (int i = 1; i &lt;= m; i++) {\n            LL tmp = sum - lca[i] + qw[i];\n            printf(LLS\"\\n\", min(tmp, sum));\n        }\n    }\n}\n```","source":"_posts/zjnu2073-geasscode.md","raw":"title: 内网2073 城主GeassCode\ntags:\n  - LCA\n  - 图论\n  - tarjan\ncategories:\n  - ACM\ndate: 2014-08-01 20:18:37\n---\n##Description\n\nGeassCode凭借自己在topcoder上的超凡表现，赢得了国王的喜爱，国王赏赐他一座城池。这座城池里有n个 村子，m条路连接这些村子。坐上城主的GeassCode决定要修路，他打算用最少的代价把所以的村子连在一起。据探子回报，有些村子之间虽然原来没有路 径，但是可以强行的去建一条路。GeassCode想知道，如果强行在某两个村子之间建一条路，最后的总花费是多少？\n\n<!--more-->\n\n##Input\n\n输入一行三个整数n，m，表示有n个村子，m条可建路径。\n\n2..m+1行，每行3个整数a,b,c（a≠b），表示可以在a和b村庄建一条花费为c的路径。\n\n第m+2行一个整数q，表示有多少个询问。\n\n接下来q个询问，每行3个整数a,b,c（a≠b），表示如果可以另外在a和b村庄建一条花费为c的路径，最终需要多少花费？\n\n##Output\n\n对于每个询问输出，输出最少的花费。\n\n\n##Sample Input\n4 5 1 2 4 2 3 3 1 4 6 2 4 3 1 3 2 3 3 4 3 1 3 1 1 4 2\n\n##Sample Output\n8 7 7\n\n##Hint\nn的范围[2,50000],m的范围[2,100000],q的范围[1,50000]。\n\n输入的m条边保证可以把所有村庄连在一起。输入的边权范围[1,10<sup>6</sup>]\n\n##Source\n\n张超\n<br/>\n\n- - -\n\n\n解法是如果可以在(u,v)上再加条边，则将最小生成树上的(u,v)节点最短路径中的最大边权与要加上这条边的替换。如果新的花费比旧的花费少，则取新的花费。否则什么也不换，取旧的花费。\n\n如何求树上两点之间的最短路径中的最大边权呢？\n\n可以按照这篇文章所述建一个类似于哈夫曼树，将点作为叶子，边的权值作为祖先构造一个N+N的树：[click here](http://blog.sina.com.cn/s/blog_51cea4040100ss3n.html)\n\n这样写的很容易错，尤其要区分两颗树的规模，我在这上面错了很久。\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty)x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 50005\n#define M 100005\nint n, m ;\nstruct Graph {\n    int u, v, w;\n    bool mark;\n    bool operator&lt;(Graph othr) const {\n        return w &lt; othr.w;\n    }\n} g[M];\n//UnionSet\nint p[N + N];\nvoid initUset(int n) {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    return x == p[x] ? p[x] : p[x] = uFind(p[x]);\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy) p[fy] = fx;\n}\n//Edge Graph\nint head[N + N], pos;\nstruct Edge {\n    int v, nxt;\n} e[N + N];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v) {\n    e[pos].v = v;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\nint size;\nvector&lt;pr&lt;int, int&gt; &gt; query[N];\nint qw[N];\nbool vis[N];\nint lca[N];\nint val[N + N];\nint dfs(int u) {\n    int solved = 0;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        solved += dfs(v);\n        if (size == solved) return solved;\n        uMerge(u, v);\n    }\n    if(~val[u])return solved;\n    vis[u] = 1;\n    for (int i = 0; i &lt; (int) query[u].size(); i++) {\n        int v = query[u][i].F;\n        if (vis[v]) {\n            solved++;\n            lca[query[u][i].S] = uFind(v);\n        }\n    }\n    return solved;\n}\nvoid tarjan() {\n    initUset(n);\n    clrA(vis, 0);\n    dfs(n);\n}\nvoid rebuild() {\n    clrA(val, -1);\n    initUset(n + n);\n    initEdge();\n    for (int i = 1; i &lt;= m; i++) {\n        if (g[i].mark == false) continue;\n        val[++n] = g[i].w;\n        int fu = uFind(g[i].u);\n        int fv = uFind(g[i].v);\n        p[fu] = n;\n        p[fv] = n;\n        add(n, fu);\n        add(n, fv);\n    }\n}\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;g[i].u, &amp;g[i].v, &amp;g[i].w);\n            g[i].mark = false;\n        }\n        sort(g + 1, g + 1 + m);\n        initUset(n);\n        LL sum = 0;\n        for (int i = 1; i &lt;= m; i++) {\n            int fx = uFind(g[i].u);\n            int fy = uFind(g[i].v);\n            if (fx != fy) {\n                sum += g[i].w;\n                g[i].mark = true;\n                p[fy] = fx;\n            }\n        }\n        for (int i = 1; i &lt;= n; i++)\n            query[i].clear();\n        scanf(\"%d\", &amp;size);\n        int u, v, w;\n        for (int i = 1; i &lt;= size; i++) {\n            scanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n            qw[i] = w;\n            query[u].push_back(MP(v, i));\n            query[v].push_back(MP(u, i));\n        }\n        rebuild();\n        tarjan();\n        for (int i = 1; i &lt;= size; i++) {\n            LL ans = sum - val[lca[i]] + qw[i];\n            printf(LLS\"\\n\", min(ans, sum));\n        }\n    }\n}\n```\n其实，可以直接在dfs的回溯过程中将子节点的max求出来。这样简单多了。感叹一句：并查集真神奇！\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x &gt;::iterator\n#define VI(x) vector&lt;x &gt;::iterator\n#define MI(x,y) map&lt;x,y &gt;::iterator\n#define SRI(x) set&lt;x &gt;::reverse_iterator\n#define VRI(x) vector&lt;x &gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y &gt;::reverse_iterator\n#define F first\n#define S second\n#define clrQ(x) while(!x.empty())x.pop();\n#define clrA(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n#define N 50005\n#define M 100005\nint n, m;\nstruct Graph {\n    int u, v, w;\n    bool operator&lt;(Graph othr) const {\n        return w &lt; othr.w;\n    }\n} g[M];\nstruct Pair {\n    int x, y;\n    Pair(int x, int y) :\n            x(x), y(y) {\n    }\n    ;\n};\n//Edge Graph\nint head[N], pos;\nstruct Edge {\n    int v, w, nxt;\n} e[N &lt;&lt; 1];\nvoid initEdge() {\n    memset(head, -1, sizeof(head));\n    pos = 0;\n}\nvoid add(int u, int v, int w) {\n    e[pos].v = v;\n    e[pos].w = w;\n    e[pos].nxt = head[u];\n    head[u] = pos++;\n}\n//UnionSet\nint p[N];\nint pmax[N];\nvoid initUset() {\n    for (int i = 0; i &lt;= n; i++)\n        p[i] = i;\n}\nint uFind(int x) {\n    if (x != p[x]) {\n        int t = p[x];\n        p[x] = uFind(p[x]);\n        pmax[x] = max(pmax[x], pmax[t]);\n        return p[x];\n    }\n    return x;\n}\nvoid uMerge(int x, int y) { //y合并到x\n    int fx = uFind(x);\n    int fy = uFind(y);\n    if (fx != fy) {\n        p[fy] = fx;\n        pmax[fy] = max(pmax[fy], pmax[fx]);\n    }\n}\nint size;\nvector&lt;Pair&gt; query[N];\nvector&lt;Pair&gt; mark[N];\nint qw[N];\nbool vis[N];\nint lca[N];\nvoid dfs(int u, int fa) {\n    if (size == 0) return;\n    for (int i = head[u]; ~i; i = e[i].nxt) {\n        int v = e[i].v;\n        if (v == fa) continue;\n        dfs(v, u);\n        pmax[v] = max(pmax[v], e[i].w);\n        uMerge(u, v);\n    }\n    vis[u] = 1;\n    for (int i = 0; i &lt; (int) query[u].size(); i++) {\n        int v = query[u][i].x;\n        if (vis[v]) {\n            mark[uFind(v)].push_back(Pair(u, i));\n        }\n    }\n    if (!mark[u].empty()) {\n        for (VI(Pair)it=mark[u].begin();it!=mark[u].end();++it) {\n            int uu = it-&gt;x;\n            int vv = query[it-&gt;x][it-&gt;y].x;\n            int ss = query[it-&gt;x][it-&gt;y].y;\n            uFind(uu);\n            uFind(vv);\n            lca[ss] = max(pmax[uu], pmax[vv]);\n            size--;\n        }\n        mark[u].clear();\n    }\n}\nint findRoot() {\n    for (int i = 1; i &lt;= n; i++) {\n        if (!vis[i]) return i;\n    }\n    return assert(false), -1;\n}\nvoid tarjan() {\n    initUset();\n    clrA(vis, 0);\n    clrA(pmax, 0);\n    size = m;\n    dfs(findRoot(), -1);\n}\nint main() {\n    while (~scanf(\"%d%d\", &amp;n, &amp;m)) {\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;g[i].u, &amp;g[i].v, &amp;g[i].w);\n        }\n        sort(g + 1, g + 1 + m);\n        initUset();\n        initEdge();\n        LL sum = 0;\n        for (int i = 1; i &lt;= m; i++) {\n            int fx = uFind(g[i].u);\n            int fy = uFind(g[i].v);\n            if (fx != fy) {\n                sum += g[i].w;\n                add(g[i].u, g[i].v, g[i].w);\n                add(g[i].v, g[i].u, g[i].w);\n                p[fy] = fx;\n            }\n        }\n        for (int i = 1; i &lt;= n; i++) {\n            query[i].clear();\n            mark[i].clear();\n        }\n        scanf(\"%d\", &amp;m);\n        int u, v, w;\n        for (int i = 1; i &lt;= m; i++) {\n            scanf(\"%d%d%d\", &amp;u, &amp;v, &amp;w);\n            qw[i] = w;\n            query[u].push_back(Pair(v, i));\n            query[v].push_back(Pair(u, i));\n        }\n        tarjan();\n        for (int i = 1; i &lt;= m; i++) {\n            LL tmp = sum - lca[i] + qw[i];\n            printf(LLS\"\\n\", min(tmp, sum));\n        }\n    }\n}\n```","slug":"zjnu2073-geasscode","published":1,"updated":"2017-01-16T01:58:03.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l2g00565rgxm4721oq0","content":"<p>##Description</p>\n<p>GeassCode凭借自己在topcoder上的超凡表现，赢得了国王的喜爱，国王赏赐他一座城池。这座城池里有n个 村子，m条路连接这些村子。坐上城主的GeassCode决定要修路，他打算用最少的代价把所以的村子连在一起。据探子回报，有些村子之间虽然原来没有路 径，但是可以强行的去建一条路。GeassCode想知道，如果强行在某两个村子之间建一条路，最后的总花费是多少？</p>\n<a id=\"more\"></a>\n<p>##Input</p>\n<p>输入一行三个整数n，m，表示有n个村子，m条可建路径。</p>\n<p>2..m+1行，每行3个整数a,b,c（a≠b），表示可以在a和b村庄建一条花费为c的路径。</p>\n<p>第m+2行一个整数q，表示有多少个询问。</p>\n<p>接下来q个询问，每行3个整数a,b,c（a≠b），表示如果可以另外在a和b村庄建一条花费为c的路径，最终需要多少花费？</p>\n<p>##Output</p>\n<p>对于每个询问输出，输出最少的花费。</p>\n<p>##Sample Input<br>4 5 1 2 4 2 3 3 1 4 6 2 4 3 1 3 2 3 3 4 3 1 3 1 1 4 2</p>\n<p>##Sample Output<br>8 7 7</p>\n<p>##Hint<br>n的范围[2,50000],m的范围[2,100000],q的范围[1,50000]。</p>\n<p>输入的m条边保证可以把所有村庄连在一起。输入的边权范围[1,10<sup>6</sup>]</p>\n<p>##Source</p>\n<p>张超<br><br></p>\n<hr>\n<p>解法是如果可以在(u,v)上再加条边，则将最小生成树上的(u,v)节点最短路径中的最大边权与要加上这条边的替换。如果新的花费比旧的花费少，则取新的花费。否则什么也不换，取旧的花费。</p>\n<p>如何求树上两点之间的最短路径中的最大边权呢？</p>\n<p>可以按照这篇文章所述建一个类似于哈夫曼树，将点作为叶子，边的权值作为祖先构造一个N+N的树：<a href=\"http://blog.sina.com.cn/s/blog_51cea4040100ss3n.html\" target=\"_blank\" rel=\"external\">click here</a></p>\n<p>这样写的很容易错，尤其要区分两颗树的规模，我在这上面错了很久。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 50005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 100005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m ;</div><div class=\"line\"><span class=\"keyword\">struct</span> Graph &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">    <span class=\"keyword\">bool</span> mark;</div><div class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&amp;lt;(Graph othr) <span class=\"keyword\">const</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> w &amp;lt; othr.w;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125; g[M];</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N + N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> x == p[x] ? p[x] : p[x] = uFind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy) p[fy] = fx;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N + N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, nxt;</div><div class=\"line\">&#125; e[N + N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> size;</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pr&amp;lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&amp;gt; &amp;gt; query[N];</div><div class=\"line\"><span class=\"keyword\">int</span> qw[N];</div><div class=\"line\"><span class=\"keyword\">bool</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> lca[N];</div><div class=\"line\"><span class=\"keyword\">int</span> val[N + N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> solved = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        solved += dfs(v);</div><div class=\"line\">        <span class=\"keyword\">if</span> (size == solved) <span class=\"keyword\">return</span> solved;</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span>(~val[u])<span class=\"keyword\">return</span> solved;</div><div class=\"line\">    vis[u] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) query[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = query[u][i].F;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]) &#123;</div><div class=\"line\">            solved++;</div><div class=\"line\">            lca[query[u][i].S] = uFind(v);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> solved;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    initUset(n);</div><div class=\"line\">    clrA(vis, <span class=\"number\">0</span>);</div><div class=\"line\">    dfs(n);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">rebuild</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    clrA(val, <span class=\"number\">-1</span>);</div><div class=\"line\">    initUset(n + n);</div><div class=\"line\">    initEdge();</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (g[i].mark == <span class=\"literal\">false</span>) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        val[++n] = g[i].w;</div><div class=\"line\">        <span class=\"keyword\">int</span> fu = uFind(g[i].u);</div><div class=\"line\">        <span class=\"keyword\">int</span> fv = uFind(g[i].v);</div><div class=\"line\">        p[fu] = n;</div><div class=\"line\">        p[fv] = n;</div><div class=\"line\">        add(n, fu);</div><div class=\"line\">        add(n, fv);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;g[i].u, &amp;amp;g[i].v, &amp;amp;g[i].w);</div><div class=\"line\">            g[i].mark = <span class=\"literal\">false</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        sort(g + <span class=\"number\">1</span>, g + <span class=\"number\">1</span> + m);</div><div class=\"line\">        initUset(n);</div><div class=\"line\">        LL sum = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> fx = uFind(g[i].u);</div><div class=\"line\">            <span class=\"keyword\">int</span> fy = uFind(g[i].v);</div><div class=\"line\">            <span class=\"keyword\">if</span> (fx != fy) &#123;</div><div class=\"line\">                sum += g[i].w;</div><div class=\"line\">                g[i].mark = <span class=\"literal\">true</span>;</div><div class=\"line\">                p[fy] = fx;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++)</div><div class=\"line\">            query[i].clear();</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;size);</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w);</div><div class=\"line\">            qw[i] = w;</div><div class=\"line\">            query[u].push_back(MP(v, i));</div><div class=\"line\">            query[v].push_back(MP(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        rebuild();</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            LL ans = sum - val[lca[i]] + qw[i];</div><div class=\"line\">            <span class=\"built_in\">printf</span>(LLS<span class=\"string\">\"\\n\"</span>, min(ans, sum));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>其实，可以直接在dfs的回溯过程中将子节点的max求出来。这样简单多了。感叹一句：并查集真神奇！<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x &amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x &amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y &amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x &amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x &amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y &amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty())x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 50005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 100005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"keyword\">struct</span> Graph &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&amp;lt;(Graph othr) <span class=\"keyword\">const</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> w &amp;lt; othr.w;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125; g[M];</div><div class=\"line\"><span class=\"keyword\">struct</span> Pair &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> x, y;</div><div class=\"line\">    Pair(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y) :</div><div class=\"line\">            x(x), y(y) &#123;</div><div class=\"line\">    &#125;</div><div class=\"line\">    ;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, w, nxt;</div><div class=\"line\">&#125; e[N &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v, <span class=\"keyword\">int</span> w)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].w = w;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"keyword\">int</span> pmax[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (x != p[x]) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> t = p[x];</div><div class=\"line\">        p[x] = uFind(p[x]);</div><div class=\"line\">        pmax[x] = max(pmax[x], pmax[t]);</div><div class=\"line\">        <span class=\"keyword\">return</span> p[x];</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> x;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy) &#123;</div><div class=\"line\">        p[fy] = fx;</div><div class=\"line\">        pmax[fy] = max(pmax[fy], pmax[fx]);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> size;</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;Pair&amp;gt; query[N];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;Pair&amp;gt; mark[N];</div><div class=\"line\"><span class=\"keyword\">int</span> qw[N];</div><div class=\"line\"><span class=\"keyword\">bool</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> lca[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (size == <span class=\"number\">0</span>) <span class=\"keyword\">return</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        <span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        dfs(v, u);</div><div class=\"line\">        pmax[v] = max(pmax[v], e[i].w);</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    vis[u] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) query[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = query[u][i].x;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]) &#123;</div><div class=\"line\">            mark[uFind(v)].push_back(Pair(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!mark[u].empty()) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (VI(Pair)it=mark[u].begin();it!=mark[u].end();++it) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> uu = it-&amp;gt;x;</div><div class=\"line\">            <span class=\"keyword\">int</span> vv = query[it-&amp;gt;x][it-&amp;gt;y].x;</div><div class=\"line\">            <span class=\"keyword\">int</span> ss = query[it-&amp;gt;x][it-&amp;gt;y].y;</div><div class=\"line\">            uFind(uu);</div><div class=\"line\">            uFind(vv);</div><div class=\"line\">            lca[ss] = max(pmax[uu], pmax[vv]);</div><div class=\"line\">            size--;</div><div class=\"line\">        &#125;</div><div class=\"line\">        mark[u].clear();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!vis[i]) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> assert(<span class=\"literal\">false</span>), <span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    initUset();</div><div class=\"line\">    clrA(vis, <span class=\"number\">0</span>);</div><div class=\"line\">    clrA(pmax, <span class=\"number\">0</span>);</div><div class=\"line\">    size = m;</div><div class=\"line\">    dfs(findRoot(), <span class=\"number\">-1</span>);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;g[i].u, &amp;amp;g[i].v, &amp;amp;g[i].w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        sort(g + <span class=\"number\">1</span>, g + <span class=\"number\">1</span> + m);</div><div class=\"line\">        initUset();</div><div class=\"line\">        initEdge();</div><div class=\"line\">        LL sum = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> fx = uFind(g[i].u);</div><div class=\"line\">            <span class=\"keyword\">int</span> fy = uFind(g[i].v);</div><div class=\"line\">            <span class=\"keyword\">if</span> (fx != fy) &#123;</div><div class=\"line\">                sum += g[i].w;</div><div class=\"line\">                add(g[i].u, g[i].v, g[i].w);</div><div class=\"line\">                add(g[i].v, g[i].u, g[i].w);</div><div class=\"line\">                p[fy] = fx;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">            query[i].clear();</div><div class=\"line\">            mark[i].clear();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;m);</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w);</div><div class=\"line\">            qw[i] = w;</div><div class=\"line\">            query[u].push_back(Pair(v, i));</div><div class=\"line\">            query[v].push_back(Pair(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            LL tmp = sum - lca[i] + qw[i];</div><div class=\"line\">            <span class=\"built_in\">printf</span>(LLS<span class=\"string\">\"\\n\"</span>, min(tmp, sum));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n","excerpt":"<p>##Description</p>\n<p>GeassCode凭借自己在topcoder上的超凡表现，赢得了国王的喜爱，国王赏赐他一座城池。这座城池里有n个 村子，m条路连接这些村子。坐上城主的GeassCode决定要修路，他打算用最少的代价把所以的村子连在一起。据探子回报，有些村子之间虽然原来没有路 径，但是可以强行的去建一条路。GeassCode想知道，如果强行在某两个村子之间建一条路，最后的总花费是多少？</p>","more":"<p>##Input</p>\n<p>输入一行三个整数n，m，表示有n个村子，m条可建路径。</p>\n<p>2..m+1行，每行3个整数a,b,c（a≠b），表示可以在a和b村庄建一条花费为c的路径。</p>\n<p>第m+2行一个整数q，表示有多少个询问。</p>\n<p>接下来q个询问，每行3个整数a,b,c（a≠b），表示如果可以另外在a和b村庄建一条花费为c的路径，最终需要多少花费？</p>\n<p>##Output</p>\n<p>对于每个询问输出，输出最少的花费。</p>\n<p>##Sample Input<br>4 5 1 2 4 2 3 3 1 4 6 2 4 3 1 3 2 3 3 4 3 1 3 1 1 4 2</p>\n<p>##Sample Output<br>8 7 7</p>\n<p>##Hint<br>n的范围[2,50000],m的范围[2,100000],q的范围[1,50000]。</p>\n<p>输入的m条边保证可以把所有村庄连在一起。输入的边权范围[1,10<sup>6</sup>]</p>\n<p>##Source</p>\n<p>张超<br><br/></p>\n<hr>\n<p>解法是如果可以在(u,v)上再加条边，则将最小生成树上的(u,v)节点最短路径中的最大边权与要加上这条边的替换。如果新的花费比旧的花费少，则取新的花费。否则什么也不换，取旧的花费。</p>\n<p>如何求树上两点之间的最短路径中的最大边权呢？</p>\n<p>可以按照这篇文章所述建一个类似于哈夫曼树，将点作为叶子，边的权值作为祖先构造一个N+N的树：<a href=\"http://blog.sina.com.cn/s/blog_51cea4040100ss3n.html\">click here</a></p>\n<p>这样写的很容易错，尤其要区分两颗树的规模，我在这上面错了很久。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 50005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 100005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m ;</div><div class=\"line\"><span class=\"keyword\">struct</span> Graph &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">    <span class=\"keyword\">bool</span> mark;</div><div class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&amp;lt;(Graph othr) <span class=\"keyword\">const</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> w &amp;lt; othr.w;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125; g[M];</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N + N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> x == p[x] ? p[x] : p[x] = uFind(p[x]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy) p[fy] = fx;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N + N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, nxt;</div><div class=\"line\">&#125; e[N + N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> size;</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;pr&amp;lt;<span class=\"keyword\">int</span>, <span class=\"keyword\">int</span>&amp;gt; &amp;gt; query[N];</div><div class=\"line\"><span class=\"keyword\">int</span> qw[N];</div><div class=\"line\"><span class=\"keyword\">bool</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> lca[N];</div><div class=\"line\"><span class=\"keyword\">int</span> val[N + N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> solved = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        solved += dfs(v);</div><div class=\"line\">        <span class=\"keyword\">if</span> (size == solved) <span class=\"keyword\">return</span> solved;</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span>(~val[u])<span class=\"keyword\">return</span> solved;</div><div class=\"line\">    vis[u] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) query[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = query[u][i].F;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]) &#123;</div><div class=\"line\">            solved++;</div><div class=\"line\">            lca[query[u][i].S] = uFind(v);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> solved;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    initUset(n);</div><div class=\"line\">    clrA(vis, <span class=\"number\">0</span>);</div><div class=\"line\">    dfs(n);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">rebuild</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    clrA(val, <span class=\"number\">-1</span>);</div><div class=\"line\">    initUset(n + n);</div><div class=\"line\">    initEdge();</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (g[i].mark == <span class=\"literal\">false</span>) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        val[++n] = g[i].w;</div><div class=\"line\">        <span class=\"keyword\">int</span> fu = uFind(g[i].u);</div><div class=\"line\">        <span class=\"keyword\">int</span> fv = uFind(g[i].v);</div><div class=\"line\">        p[fu] = n;</div><div class=\"line\">        p[fv] = n;</div><div class=\"line\">        add(n, fu);</div><div class=\"line\">        add(n, fv);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;g[i].u, &amp;amp;g[i].v, &amp;amp;g[i].w);</div><div class=\"line\">            g[i].mark = <span class=\"literal\">false</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        sort(g + <span class=\"number\">1</span>, g + <span class=\"number\">1</span> + m);</div><div class=\"line\">        initUset(n);</div><div class=\"line\">        LL sum = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> fx = uFind(g[i].u);</div><div class=\"line\">            <span class=\"keyword\">int</span> fy = uFind(g[i].v);</div><div class=\"line\">            <span class=\"keyword\">if</span> (fx != fy) &#123;</div><div class=\"line\">                sum += g[i].w;</div><div class=\"line\">                g[i].mark = <span class=\"literal\">true</span>;</div><div class=\"line\">                p[fy] = fx;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++)</div><div class=\"line\">            query[i].clear();</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;size);</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w);</div><div class=\"line\">            qw[i] = w;</div><div class=\"line\">            query[u].push_back(MP(v, i));</div><div class=\"line\">            query[v].push_back(MP(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        rebuild();</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= size; i++) &#123;</div><div class=\"line\">            LL ans = sum - val[lca[i]] + qw[i];</div><div class=\"line\">            <span class=\"built_in\">printf</span>(LLS<span class=\"string\">\"\\n\"</span>, min(ans, sum));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>其实，可以直接在dfs的回溯过程中将子节点的max求出来。这样简单多了。感叹一句：并查集真神奇！<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x &amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x &amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y &amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x &amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x &amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y &amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty())x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrA(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 50005</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 100005</span></div><div class=\"line\"><span class=\"keyword\">int</span> n, m;</div><div class=\"line\"><span class=\"keyword\">struct</span> Graph &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&amp;lt;(Graph othr) <span class=\"keyword\">const</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> w &amp;lt; othr.w;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125; g[M];</div><div class=\"line\"><span class=\"keyword\">struct</span> Pair &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> x, y;</div><div class=\"line\">    Pair(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y) :</div><div class=\"line\">            x(x), y(y) &#123;</div><div class=\"line\">    &#125;</div><div class=\"line\">    ;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"comment\">//Edge Graph</span></div><div class=\"line\"><span class=\"keyword\">int</span> head[N], pos;</div><div class=\"line\"><span class=\"keyword\">struct</span> Edge &#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> v, w, nxt;</div><div class=\"line\">&#125; e[N &amp;lt;&amp;lt; <span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initEdge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">memset</span>(head, <span class=\"number\">-1</span>, <span class=\"keyword\">sizeof</span>(head));</div><div class=\"line\">    pos = <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> v, <span class=\"keyword\">int</span> w)</span> </span>&#123;</div><div class=\"line\">    e[pos].v = v;</div><div class=\"line\">    e[pos].w = w;</div><div class=\"line\">    e[pos].nxt = head[u];</div><div class=\"line\">    head[u] = pos++;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//UnionSet</span></div><div class=\"line\"><span class=\"keyword\">int</span> p[N];</div><div class=\"line\"><span class=\"keyword\">int</span> pmax[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">initUset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt;= n; i++)</div><div class=\"line\">        p[i] = i;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uFind</span><span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (x != p[x]) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> t = p[x];</div><div class=\"line\">        p[x] = uFind(p[x]);</div><div class=\"line\">        pmax[x] = max(pmax[x], pmax[t]);</div><div class=\"line\">        <span class=\"keyword\">return</span> p[x];</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> x;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">uMerge</span><span class=\"params\">(<span class=\"keyword\">int</span> x, <span class=\"keyword\">int</span> y)</span> </span>&#123; <span class=\"comment\">//y合并到x</span></div><div class=\"line\">    <span class=\"keyword\">int</span> fx = uFind(x);</div><div class=\"line\">    <span class=\"keyword\">int</span> fy = uFind(y);</div><div class=\"line\">    <span class=\"keyword\">if</span> (fx != fy) &#123;</div><div class=\"line\">        p[fy] = fx;</div><div class=\"line\">        pmax[fy] = max(pmax[fy], pmax[fx]);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">int</span> size;</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;Pair&amp;gt; query[N];</div><div class=\"line\"><span class=\"built_in\">vector</span>&amp;lt;Pair&amp;gt; mark[N];</div><div class=\"line\"><span class=\"keyword\">int</span> qw[N];</div><div class=\"line\"><span class=\"keyword\">bool</span> vis[N];</div><div class=\"line\"><span class=\"keyword\">int</span> lca[N];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">dfs</span><span class=\"params\">(<span class=\"keyword\">int</span> u, <span class=\"keyword\">int</span> fa)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (size == <span class=\"number\">0</span>) <span class=\"keyword\">return</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = head[u]; ~i; i = e[i].nxt) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = e[i].v;</div><div class=\"line\">        <span class=\"keyword\">if</span> (v == fa) <span class=\"keyword\">continue</span>;</div><div class=\"line\">        dfs(v, u);</div><div class=\"line\">        pmax[v] = max(pmax[v], e[i].w);</div><div class=\"line\">        uMerge(u, v);</div><div class=\"line\">    &#125;</div><div class=\"line\">    vis[u] = <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &amp;lt; (<span class=\"keyword\">int</span>) query[u].size(); i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> v = query[u][i].x;</div><div class=\"line\">        <span class=\"keyword\">if</span> (vis[v]) &#123;</div><div class=\"line\">            mark[uFind(v)].push_back(Pair(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!mark[u].empty()) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (VI(Pair)it=mark[u].begin();it!=mark[u].end();++it) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> uu = it-&amp;gt;x;</div><div class=\"line\">            <span class=\"keyword\">int</span> vv = query[it-&amp;gt;x][it-&amp;gt;y].x;</div><div class=\"line\">            <span class=\"keyword\">int</span> ss = query[it-&amp;gt;x][it-&amp;gt;y].y;</div><div class=\"line\">            uFind(uu);</div><div class=\"line\">            uFind(vv);</div><div class=\"line\">            lca[ss] = max(pmax[uu], pmax[vv]);</div><div class=\"line\">            size--;</div><div class=\"line\">        &#125;</div><div class=\"line\">        mark[u].clear();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findRoot</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!vis[i]) <span class=\"keyword\">return</span> i;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> assert(<span class=\"literal\">false</span>), <span class=\"number\">-1</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">tarjan</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    initUset();</div><div class=\"line\">    clrA(vis, <span class=\"number\">0</span>);</div><div class=\"line\">    clrA(pmax, <span class=\"number\">0</span>);</div><div class=\"line\">    size = m;</div><div class=\"line\">    dfs(findRoot(), <span class=\"number\">-1</span>);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span> (~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>, &amp;amp;n, &amp;amp;m)) &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;g[i].u, &amp;amp;g[i].v, &amp;amp;g[i].w);</div><div class=\"line\">        &#125;</div><div class=\"line\">        sort(g + <span class=\"number\">1</span>, g + <span class=\"number\">1</span> + m);</div><div class=\"line\">        initUset();</div><div class=\"line\">        initEdge();</div><div class=\"line\">        LL sum = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> fx = uFind(g[i].u);</div><div class=\"line\">            <span class=\"keyword\">int</span> fy = uFind(g[i].v);</div><div class=\"line\">            <span class=\"keyword\">if</span> (fx != fy) &#123;</div><div class=\"line\">                sum += g[i].w;</div><div class=\"line\">                add(g[i].u, g[i].v, g[i].w);</div><div class=\"line\">                add(g[i].v, g[i].u, g[i].w);</div><div class=\"line\">                p[fy] = fx;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; i++) &#123;</div><div class=\"line\">            query[i].clear();</div><div class=\"line\">            mark[i].clear();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>, &amp;amp;m);</div><div class=\"line\">        <span class=\"keyword\">int</span> u, v, w;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d%d\"</span>, &amp;amp;u, &amp;amp;v, &amp;amp;w);</div><div class=\"line\">            qw[i] = w;</div><div class=\"line\">            query[u].push_back(Pair(v, i));</div><div class=\"line\">            query[v].push_back(Pair(u, i));</div><div class=\"line\">        &#125;</div><div class=\"line\">        tarjan();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= m; i++) &#123;</div><div class=\"line\">            LL tmp = sum - lca[i] + qw[i];</div><div class=\"line\">            <span class=\"built_in\">printf</span>(LLS<span class=\"string\">\"\\n\"</span>, min(tmp, sum));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>"},{"title":"内网 2085马农","date":"2014-08-13T13:09:40.000Z","_content":"##Description\n 在观看完战马检阅之后，来自大草原的两兄弟决心成为超级“马农”，专门饲养战马。\n\n兄弟两回到草原，将可以养马的区域，分为N*N的单位面积的正方形，并实地进行考察，归纳出了每个单位面积可以养马所获得的收益。接下来就要开始规划他们各自的马场了。\n\n首先，两人的马场都必须是矩形区域。同时，为了方便两人互相照应，也为了防止马匹互相走散，规定两个马场的矩形区域相邻，且只有一个交点。最后，互不认输的两人希望两个马场的收益相当，这样才不会影响他们兄弟的感情。\n\n现在，兄弟两找到你这位设计师，希望你给他们设计马场，问共有多少种设计方案。\n<!--more-->\n##Input\n\n第一行一个整数N，表示整个草原的大小为N*N。\n\n接下来N行，每行N个整数A(i,j)，表示第i行第j列的单位草地的收成。（注意：收益可能是负数，养马也不是包赚的，马匹也可能出现生病死亡等意外。）\n\n1&lt;=N&lt;=50  \n-1000&lt;A(i,j)&lt;1000\n\n##Output\n\n\n 输出符合两人要求的草原分配方案数。\n\n\n##Sample Input\n\n3 1 2 3 4 5 6 7 8 9\n\n##Sample Output\n\n2\n\n##Hint\n\n![](http://acm.zjnu.edu.cn/JudgeOnline/userfiles/images/2085.jpg)\n\n##Source\n\n\n2014宁波初中 T2\n\n<br/>\n- - -\n\n\n\n宁波镇海中学的罗方炜给我们组的一场比赛。\n\n此题主要靠技巧。枚举中心点，然后用数组hash。注意数组清空复杂度很大，每次清空必定超时。应该用一个栈来记录更改的地方，直接赋0.\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define N 55\n#define M 2500000\nint f[N][N],a[N][N];\nint h[M&lt;&lt;1|1];\nint st[N*N],top;\nint n,m;\nint main(int argc, char **argv) {\n    while(~scanf(\"%d\",&amp;n)){\n        for (int i = 1; i &lt;= n; ++i) {\n            for (int j = 1; j &lt;= n; ++j) {\n                scanf(\"%d\",&amp;a[i][j]);\n                f[i][j]=f[i-1][j]+f[i][j-1]-f[i-1][j-1]+a[i][j];\n            }\n        }\n        int res=top=0;\n        for (int x = 1; x &lt;= n; ++x) {\n            for (int y = 1; y &lt;= n; ++y) {\n                for (int i = 1; i &lt;= x; ++i) {\n                    for (int j = 1; j &lt;= y; ++j) {\n                        st[top++]=f[x][y]-f[x][j-1]-f[i-1][y]+f[i-1][j-1]+M;\n                        h[st[top-1]]++;\n                    }\n                }\n                for (int i = x+1; i &lt;= n; ++i) {\n                    for (int j = y+1; j &lt;= n; ++j) {\n                        res+=h[f[i][j]-f[i][y]-f[x][j]+f[x][y]+M];\n                    }\n                }\n\n                while(top){\n                    h[st[--top]]=0;\n                }\n                for (int i = x; i &lt;= n; ++i) {\n                    for (int j = 1; j &lt;= y; ++j) {\n                        st[top++]=f[i][y]-f[x-1][y]-f[i][j-1]+f[x-1][j-1]+M;\n                        h[st[top-1]]++;\n                    }\n                }\n                for (int i = 1; i &lt; x; ++i) {\n                    for (int j = y+1; j &lt;= n; ++j) {\n                        res+=h[f[x-1][j]-f[x-1][y]-f[i-1][j]+f[i-1][y]+M];\n                    }\n                }\n                while(top){\n                    h[st[--top]]=0;\n                }\n            }\n        }\n        printf(\"%d\\n\",res);\n    }\n}\n\n```","source":"_posts/zjnu2085.md","raw":"title: 内网 2085马农\ntags:\n  - 暴力\ncategories:\n  - ACM\ndate: 2014-08-13 21:09:40\n---\n##Description\n 在观看完战马检阅之后，来自大草原的两兄弟决心成为超级“马农”，专门饲养战马。\n\n兄弟两回到草原，将可以养马的区域，分为N*N的单位面积的正方形，并实地进行考察，归纳出了每个单位面积可以养马所获得的收益。接下来就要开始规划他们各自的马场了。\n\n首先，两人的马场都必须是矩形区域。同时，为了方便两人互相照应，也为了防止马匹互相走散，规定两个马场的矩形区域相邻，且只有一个交点。最后，互不认输的两人希望两个马场的收益相当，这样才不会影响他们兄弟的感情。\n\n现在，兄弟两找到你这位设计师，希望你给他们设计马场，问共有多少种设计方案。\n<!--more-->\n##Input\n\n第一行一个整数N，表示整个草原的大小为N*N。\n\n接下来N行，每行N个整数A(i,j)，表示第i行第j列的单位草地的收成。（注意：收益可能是负数，养马也不是包赚的，马匹也可能出现生病死亡等意外。）\n\n1&lt;=N&lt;=50  \n-1000&lt;A(i,j)&lt;1000\n\n##Output\n\n\n 输出符合两人要求的草原分配方案数。\n\n\n##Sample Input\n\n3 1 2 3 4 5 6 7 8 9\n\n##Sample Output\n\n2\n\n##Hint\n\n![](http://acm.zjnu.edu.cn/JudgeOnline/userfiles/images/2085.jpg)\n\n##Source\n\n\n2014宁波初中 T2\n\n<br/>\n- - -\n\n\n\n宁波镇海中学的罗方炜给我们组的一场比赛。\n\n此题主要靠技巧。枚举中心点，然后用数组hash。注意数组清空复杂度很大，每次清空必定超时。应该用一个栈来记录更改的地方，直接赋0.\n\n```C++\n#include&lt;map&gt;\n#include&lt;set&gt;\n#include&lt;cmath&gt;\n#include&lt;stack&gt;\n#include&lt;queue&gt;\n#include&lt;string&gt;\n#include&lt;cstdio&gt;\n#include&lt;vector&gt;\n#include&lt;cctype&gt;\n#include&lt;cassert&gt;\n#include&lt;utility&gt;\n#include&lt;numeric&gt;\n#include&lt;cstring&gt;\n#include&lt;iostream&gt;\n#include&lt;algorithm&gt;\nusing namespace std;\n#define pr pair\n#define PR pair&lt;int,int&gt;\n#define MP make_pair\n#define SI(x) set&lt;x&gt;::iterator\n#define VI(x) vector&lt;x&gt;::iterator\n#define MI(x,y) map&lt;x,y&gt;::iterator\n#define SRI(x) set&lt;x&gt;::reverse_iterator\n#define VRI(x) vector&lt;x&gt;::reverse_iterator\n#define MRI(x,y) map&lt;x,y&gt;::reverse_iterator\n#define F first\n#define S second\n#define Sz(x) (int)x.size()\n#define clrQ(x) while(!x.empty)x.pop();\n#define clr(x,y) memset(x,y,sizeof(x));\n#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)\n#define LL __int64\n#define LLS \"%\" \"I\" \"6\" \"4\" \"d\"\n#define LLU \"%\" \"I\" \"6\" \"4\" \"u\"\n#define LL_MAX _I64_MAX\n#else\n#define LL long long\n#define LLS \"%\" \"l\" \"l\" \"d\"\n#define LLU \"%\" \"l\" \"l\" \"u\"\n#define LL_MAX _I64_MAX\n#endif\nconst int inf = ~0u &gt;&gt; 1;\nconst LL lnf = ~0ull &gt;&gt; 1;\n/*start*/\n#define N 55\n#define M 2500000\nint f[N][N],a[N][N];\nint h[M&lt;&lt;1|1];\nint st[N*N],top;\nint n,m;\nint main(int argc, char **argv) {\n    while(~scanf(\"%d\",&amp;n)){\n        for (int i = 1; i &lt;= n; ++i) {\n            for (int j = 1; j &lt;= n; ++j) {\n                scanf(\"%d\",&amp;a[i][j]);\n                f[i][j]=f[i-1][j]+f[i][j-1]-f[i-1][j-1]+a[i][j];\n            }\n        }\n        int res=top=0;\n        for (int x = 1; x &lt;= n; ++x) {\n            for (int y = 1; y &lt;= n; ++y) {\n                for (int i = 1; i &lt;= x; ++i) {\n                    for (int j = 1; j &lt;= y; ++j) {\n                        st[top++]=f[x][y]-f[x][j-1]-f[i-1][y]+f[i-1][j-1]+M;\n                        h[st[top-1]]++;\n                    }\n                }\n                for (int i = x+1; i &lt;= n; ++i) {\n                    for (int j = y+1; j &lt;= n; ++j) {\n                        res+=h[f[i][j]-f[i][y]-f[x][j]+f[x][y]+M];\n                    }\n                }\n\n                while(top){\n                    h[st[--top]]=0;\n                }\n                for (int i = x; i &lt;= n; ++i) {\n                    for (int j = 1; j &lt;= y; ++j) {\n                        st[top++]=f[i][y]-f[x-1][y]-f[i][j-1]+f[x-1][j-1]+M;\n                        h[st[top-1]]++;\n                    }\n                }\n                for (int i = 1; i &lt; x; ++i) {\n                    for (int j = y+1; j &lt;= n; ++j) {\n                        res+=h[f[x-1][j]-f[x-1][y]-f[i-1][j]+f[i-1][y]+M];\n                    }\n                }\n                while(top){\n                    h[st[--top]]=0;\n                }\n            }\n        }\n        printf(\"%d\\n\",res);\n    }\n}\n\n```","slug":"zjnu2085","published":1,"updated":"2017-01-16T01:58:03.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l2h005a5rgx42jo1ofr","content":"<p>##Description<br> 在观看完战马检阅之后，来自大草原的两兄弟决心成为超级“马农”，专门饲养战马。</p>\n<p>兄弟两回到草原，将可以养马的区域，分为N*N的单位面积的正方形，并实地进行考察，归纳出了每个单位面积可以养马所获得的收益。接下来就要开始规划他们各自的马场了。</p>\n<p>首先，两人的马场都必须是矩形区域。同时，为了方便两人互相照应，也为了防止马匹互相走散，规定两个马场的矩形区域相邻，且只有一个交点。最后，互不认输的两人希望两个马场的收益相当，这样才不会影响他们兄弟的感情。</p>\n<p>现在，兄弟两找到你这位设计师，希望你给他们设计马场，问共有多少种设计方案。<br><a id=\"more\"></a></p>\n<p>##Input</p>\n<p>第一行一个整数N，表示整个草原的大小为N*N。</p>\n<p>接下来N行，每行N个整数A(i,j)，表示第i行第j列的单位草地的收成。（注意：收益可能是负数，养马也不是包赚的，马匹也可能出现生病死亡等意外。）</p>\n<p>1&lt;=N&lt;=50<br>-1000&lt;A(i,j)&lt;1000</p>\n<p>##Output</p>\n<p> 输出符合两人要求的草原分配方案数。</p>\n<p>##Sample Input</p>\n<p>3 1 2 3 4 5 6 7 8 9</p>\n<p>##Sample Output</p>\n<p>2</p>\n<p>##Hint</p>\n<p><img src=\"http://acm.zjnu.edu.cn/JudgeOnline/userfiles/images/2085.jpg\" alt=\"\"></p>\n<p>##Source</p>\n<p>2014宁波初中 T2</p>\n<p><br></p>\n<hr>\n<p>宁波镇海中学的罗方炜给我们组的一场比赛。</p>\n<p>此题主要靠技巧。枚举中心点，然后用数组hash。注意数组清空复杂度很大，每次清空必定超时。应该用一个栈来记录更改的地方，直接赋0.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 55</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 2500000</span></div><div class=\"line\"><span class=\"keyword\">int</span> f[N][N],a[N][N];</div><div class=\"line\"><span class=\"keyword\">int</span> h[M&amp;lt;&amp;lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> st[N*N],top;</div><div class=\"line\"><span class=\"keyword\">int</span> n,m;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span>(~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;n))&#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; ++i) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= n; ++j) &#123;</div><div class=\"line\">                <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;a[i][j]);</div><div class=\"line\">                f[i][j]=f[i<span class=\"number\">-1</span>][j]+f[i][j<span class=\"number\">-1</span>]-f[i<span class=\"number\">-1</span>][j<span class=\"number\">-1</span>]+a[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> res=top=<span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> x = <span class=\"number\">1</span>; x &amp;lt;= n; ++x) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> y = <span class=\"number\">1</span>; y &amp;lt;= n; ++y) &#123;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= x; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= y; ++j) &#123;</div><div class=\"line\">                        st[top++]=f[x][y]-f[x][j<span class=\"number\">-1</span>]-f[i<span class=\"number\">-1</span>][y]+f[i<span class=\"number\">-1</span>][j<span class=\"number\">-1</span>]+M;</div><div class=\"line\">                        h[st[top<span class=\"number\">-1</span>]]++;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = x+<span class=\"number\">1</span>; i &amp;lt;= n; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = y+<span class=\"number\">1</span>; j &amp;lt;= n; ++j) &#123;</div><div class=\"line\">                        res+=h[f[i][j]-f[i][y]-f[x][j]+f[x][y]+M];</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">while</span>(top)&#123;</div><div class=\"line\">                    h[st[--top]]=<span class=\"number\">0</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = x; i &amp;lt;= n; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= y; ++j) &#123;</div><div class=\"line\">                        st[top++]=f[i][y]-f[x<span class=\"number\">-1</span>][y]-f[i][j<span class=\"number\">-1</span>]+f[x<span class=\"number\">-1</span>][j<span class=\"number\">-1</span>]+M;</div><div class=\"line\">                        h[st[top<span class=\"number\">-1</span>]]++;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; x; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = y+<span class=\"number\">1</span>; j &amp;lt;= n; ++j) &#123;</div><div class=\"line\">                        res+=h[f[x<span class=\"number\">-1</span>][j]-f[x<span class=\"number\">-1</span>][y]-f[i<span class=\"number\">-1</span>][j]+f[i<span class=\"number\">-1</span>][y]+M];</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">while</span>(top)&#123;</div><div class=\"line\">                    h[st[--top]]=<span class=\"number\">0</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,res);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","excerpt":"<p>##Description<br> 在观看完战马检阅之后，来自大草原的两兄弟决心成为超级“马农”，专门饲养战马。</p>\n<p>兄弟两回到草原，将可以养马的区域，分为N*N的单位面积的正方形，并实地进行考察，归纳出了每个单位面积可以养马所获得的收益。接下来就要开始规划他们各自的马场了。</p>\n<p>首先，两人的马场都必须是矩形区域。同时，为了方便两人互相照应，也为了防止马匹互相走散，规定两个马场的矩形区域相邻，且只有一个交点。最后，互不认输的两人希望两个马场的收益相当，这样才不会影响他们兄弟的感情。</p>\n<p>现在，兄弟两找到你这位设计师，希望你给他们设计马场，问共有多少种设计方案。<br>","more":"</p>\n<p>##Input</p>\n<p>第一行一个整数N，表示整个草原的大小为N*N。</p>\n<p>接下来N行，每行N个整数A(i,j)，表示第i行第j列的单位草地的收成。（注意：收益可能是负数，养马也不是包赚的，马匹也可能出现生病死亡等意外。）</p>\n<p>1&lt;=N&lt;=50<br>-1000&lt;A(i,j)&lt;1000</p>\n<p>##Output</p>\n<p> 输出符合两人要求的草原分配方案数。</p>\n<p>##Sample Input</p>\n<p>3 1 2 3 4 5 6 7 8 9</p>\n<p>##Sample Output</p>\n<p>2</p>\n<p>##Hint</p>\n<p><img src=\"http://acm.zjnu.edu.cn/JudgeOnline/userfiles/images/2085.jpg\" alt=\"\"></p>\n<p>##Source</p>\n<p>2014宁波初中 T2</p>\n<p><br/></p>\n<hr>\n<p>宁波镇海中学的罗方炜给我们组的一场比赛。</p>\n<p>此题主要靠技巧。枚举中心点，然后用数组hash。注意数组清空复杂度很大，每次清空必定超时。应该用一个栈来记录更改的地方，直接赋0.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;map&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;set&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cmath&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;stack&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;queue&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;string&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstdio&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;vector&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cctype&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cassert&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;utility&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;numeric&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;cstring&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;iostream&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>&amp;lt;algorithm&amp;gt;</span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> pr pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> PR pair&amp;lt;int,int&amp;gt;</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MP make_pair</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SI(x) set&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VI(x) vector&amp;lt;x&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MI(x,y) map&amp;lt;x,y&amp;gt;::iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> F first</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> S second</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> Sz(x) (int)x.size()</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clrQ(x) while(!x.empty)x.pop();</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clr(x,y) memset(x,y,sizeof(x));</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL __int64</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"I\"</span> <span class=\"meta-string\">\"6\"</span> <span class=\"meta-string\">\"4\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL long long</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLS <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"d\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LLU <span class=\"meta-string\">\"%\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"l\"</span> <span class=\"meta-string\">\"u\"</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LL_MAX _I64_MAX</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> inf = ~<span class=\"number\">0u</span> &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">const</span> LL lnf = ~<span class=\"number\">0u</span>ll &amp;gt;&amp;gt; <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"comment\">/*start*/</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> N 55</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> M 2500000</span></div><div class=\"line\"><span class=\"keyword\">int</span> f[N][N],a[N][N];</div><div class=\"line\"><span class=\"keyword\">int</span> h[M&amp;lt;&amp;lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">int</span> st[N*N],top;</div><div class=\"line\"><span class=\"keyword\">int</span> n,m;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">while</span>(~<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;n))&#123;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= n; ++i) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= n; ++j) &#123;</div><div class=\"line\">                <span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d\"</span>,&amp;amp;a[i][j]);</div><div class=\"line\">                f[i][j]=f[i<span class=\"number\">-1</span>][j]+f[i][j<span class=\"number\">-1</span>]-f[i<span class=\"number\">-1</span>][j<span class=\"number\">-1</span>]+a[i][j];</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> res=top=<span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> x = <span class=\"number\">1</span>; x &amp;lt;= n; ++x) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> y = <span class=\"number\">1</span>; y &amp;lt;= n; ++y) &#123;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt;= x; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= y; ++j) &#123;</div><div class=\"line\">                        st[top++]=f[x][y]-f[x][j<span class=\"number\">-1</span>]-f[i<span class=\"number\">-1</span>][y]+f[i<span class=\"number\">-1</span>][j<span class=\"number\">-1</span>]+M;</div><div class=\"line\">                        h[st[top<span class=\"number\">-1</span>]]++;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = x+<span class=\"number\">1</span>; i &amp;lt;= n; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = y+<span class=\"number\">1</span>; j &amp;lt;= n; ++j) &#123;</div><div class=\"line\">                        res+=h[f[i][j]-f[i][y]-f[x][j]+f[x][y]+M];</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">while</span>(top)&#123;</div><div class=\"line\">                    h[st[--top]]=<span class=\"number\">0</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = x; i &amp;lt;= n; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &amp;lt;= y; ++j) &#123;</div><div class=\"line\">                        st[top++]=f[i][y]-f[x<span class=\"number\">-1</span>][y]-f[i][j<span class=\"number\">-1</span>]+f[x<span class=\"number\">-1</span>][j<span class=\"number\">-1</span>]+M;</div><div class=\"line\">                        h[st[top<span class=\"number\">-1</span>]]++;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &amp;lt; x; ++i) &#123;</div><div class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = y+<span class=\"number\">1</span>; j &amp;lt;= n; ++j) &#123;</div><div class=\"line\">                        res+=h[f[x<span class=\"number\">-1</span>][j]-f[x<span class=\"number\">-1</span>][y]-f[i<span class=\"number\">-1</span>][j]+f[i<span class=\"number\">-1</span>][y]+M];</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">while</span>(top)&#123;</div><div class=\"line\">                    h[st[--top]]=<span class=\"number\">0</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,res);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"ZOJ month contest D.Determinant and Matrix","id":"153","date":"2014-11-07T10:32:21.000Z","_content":"\n* * *\n\n<center style=\"color: #000000;\"><span style=\"color: green;\">Time Limit: </span>2 Seconds      <span style=\"color: green;\">Memory Limit: </span>65536 KB</center>\n\n* * *\n##Description\nRecently, LBH is learning the curse linear algebra. Thus he is very interested in matrix and determinant now. In order to practice his ability of solving the problem of linear algebra, he just invent some problems by himself. Once the problems was create, he would solve it immediately. However, he meet a problem that was so hard that he couldn't work out even though racked his brains. The problem was described as follow:\n\nTo a integer martix M<sub>nn</sub>(a<sub>ij</sub>), we define two function add(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> + 1) and sub(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> - 1) which were exactly like this:\n<!--more-->\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig1](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig1.png)</div>\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig2](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig2.png)</div>\n\nAccording to the martix M<sub>nn</sub>(a<sub>ij</sub>), we can permutate it and get a full permutation set Perm(M<sub>nn</sub>(a<sub>ij</sub>)) = {M<sub>nn</sub>(a<sub>I<sub>i</sub>J<sub>j</sub></sub>)| I and J is a permutation of 1..n }, (Perm(M) is a set, each matrix in Perm(M) is unique). For example:\n\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig3](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig3.png)</div>\n\nThe problem is to get the result of a fomula about an integer matrix M<sub>nn</sub>:\n\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig4](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig4.png)</div>\n<span style=\"color: #000000;\">in which the det(M) meaned to cacluate the determinant of M.</span>\n\n## Input\n\nThere are several test cases.\n\nThe first line contains an integer <var>T</var>(<var>T</var> ≤ 100) . Then <var>T</var> test cases follow.\n\nIn each test case, the first line contains one integer <var>n</var>(0&lt; <var>n</var>≤ 10). The number means the giving matrix's size is <var>n×n</var>\n\nThen there are <var>n</var> lines followed, each line contains <var>n</var> integers <var>a<sub>ij</sub></var>(-10≤ <var>a<sub>ij</sub></var>≤ 10), in the position row <var>i</var>, colum <var>j</var>, it represents the number <var>a<sub>ij</sub>.</var>\n\n## Output\n\nFor each test case, since the result may be very large, output one line with the result modulo 2<sup>30</sup>.\n\n## Sample Input\n```\n1\n2\n1 1\n1 2\n```\n#### Sample Output\n\n```\n2\n```\n\n<span style=\"color: #000000;\">Author: </span>**LIN, Binghui**\n<span style=\"color: #000000;\">Source: </span>**ZOJ Monthly, August 2014**\n\n<br/>\n\n- - -\n\n\n这道题全场现场只A了一个人。今天我们比赛的时候我A了，挺爽的。\n```Java\nimport java.util.Scanner;\nimport java.math.*;\npublic class Main {\n\tstatic long fact[]=new long[15];\n\tstatic long kind;\n\tstatic int A[][]=new int[10][10];\n\tstatic final BigInteger MOD=BigInteger.valueOf(1&lt;&lt;30);\n\tstatic void getKind(int n){\n\t\tboolean mark[]=new boolean[10];\n\t\tfor(int i,j,k,r=0;r&lt;2;r++){\n\t\t\tfor (i = 0; i &lt; n; ++ i) mark[i] = false;\n\t\t\tfor (i = 0; i &lt; n; ++ i) {\n\t\t\t\tif (mark[i]) continue;\n\t\t\t\tint cnt = 0;\n\t\t\t\tfor (j = i; j &lt; n; ++ j) {\n\t\t\t\t\tfor (k = 0; k &lt; n; ++ k) {\n\t\t\t\t\t\tif (r==1&amp;&amp;A[k][i] != A[k][j])break;\n\t\t\t\t\t\tif(r==0&amp;&amp;A[i][k] != A[j][k])break;\n\t\t\t\t\t}\n\t\t\t\t\tif (k == n) {\n\t\t\t\t\t\t++ cnt;\n\t\t\t\t\t\tmark[j] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tkind /= fact[cnt];\n\t\t\t}\n\t\t}\n\t}\n\tpublic static void main(String[] args){\n\t\tScanner cin=new Scanner(System.in);\n\t\tint n,T=cin.nextInt();\n\t\tfact[0]=1;\n\t\tfor(int i=1;i&lt;=10;i++)fact[i]=fact[i-1]*i;\n\t\twhile(T--&gt;0){\n\t\t\tn=cin.nextInt();\n\t\t\tfor(int i=0;i&lt;n;i++){\n\t\t\t\tfor(int j=0;j&lt;n;j++){\n\t\t\t\t\tA[i][j]=cin.nextInt();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlong res=0;\n\t\t\tMatrix matrix=new Matrix(n);\n\t\t\tkind=fact[n]*fact[n];\n\t\t\tgetKind(n);\n\t\t\tif(kind%2==1){\n\t\t\t\tmatrix.valueOf(A, 0);\n\t\t\t\tres=res ^(matrix.Det().mod(MOD).longValue());\n\t\t\t}\n\t\t\tmatrix.valueOf(A, 1);\n\t\t\tres=res^(matrix.Det().mod(MOD).longValue());\n\t\t\tmatrix.valueOf(A, -1);\n\t\t\tres=res^(matrix.Det().mod(MOD).longValue());\n\t\t\tSystem.out.println(res);\n\t\t}\n\t\tcin.close();\n\t}\n}\nclass Matrix{\n\tBigInteger M[][]=new BigInteger[10][10];\n\tBigInteger ZERO,ONE;\n\tint n;\n\tMatrix(int n){\n\t\tthis.n=n;\n\t\tZERO=BigInteger.ZERO;\n\t\tONE=BigInteger.ONE;\n\t}\n\tvoid valueOf(int A[][],int d){\n\t\tfor(int i=0;i&lt;n;i++){\n\t\t\tfor(int j=0;j&lt;n;j++){\n\t\t\t\tM[i][j]=BigInteger.valueOf(A[i][j]+d);\n\t\t\t}\n\t\t}\n\t}\n\tBigInteger Det(){\n\t\tBigInteger tmp, res = ONE, div = ONE;\n\t\tint i, j, k;\n\t\tfor (i = 0; i &lt; n; ++ i) {\n\t\t\tfor (j = i; j &lt; n; ++ j) {\n\t\t\t\tif (!M[j][i].equals(ZERO)) break;\n\t\t\t}\n\t\t\tif (j == n) return ZERO;\n\t\t\tif (j != i) {\n\t\t\t\t//res = res.negate();\n\t\t\t\tfor (k = 0; k &lt; n; ++ k) {\n\t\t\t\t    tmp = M[j][k];\n\t\t\t\t\tM[j][k] = M[i][k];\n\t\t\t\t\tM[i][k] = tmp;\n\t\t\t\t}\n\t\t\t}\n\t\t\tres = res.multiply(M[i][i]);\n\t\t\tfor (j = i + 1; j &lt; n; ++ j) {\n\t\t\t\tif (M[j][i].equals(ZERO)) continue;\n\t\t\t\tdiv = div.multiply(M[i][i]);\n\t\t\t\tfor (k = i + 1; k &lt; n; ++ k) {\n\t\t\t\t\tM[j][k] = M[j][k].multiply(M[i][i]).subtract(M[i][k].multiply(M[j][i]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tres = res.divide(div);\n\t\tif (res.compareTo(ZERO) &lt; 0) res = res.negate();\n\t\treturn res;\n\t}\n}\n```\n</pre>","source":"_posts/zoj-month-contest-d-determinant-and-matrix.md","raw":"title: ZOJ month contest D.Determinant and Matrix\ncategories:\n  - ACM\nid: 153\ndate: 2014-11-07 18:32:21\ntags: 数论\n---\n\n* * *\n\n<center style=\"color: #000000;\"><span style=\"color: green;\">Time Limit: </span>2 Seconds      <span style=\"color: green;\">Memory Limit: </span>65536 KB</center>\n\n* * *\n##Description\nRecently, LBH is learning the curse linear algebra. Thus he is very interested in matrix and determinant now. In order to practice his ability of solving the problem of linear algebra, he just invent some problems by himself. Once the problems was create, he would solve it immediately. However, he meet a problem that was so hard that he couldn't work out even though racked his brains. The problem was described as follow:\n\nTo a integer martix M<sub>nn</sub>(a<sub>ij</sub>), we define two function add(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> + 1) and sub(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> - 1) which were exactly like this:\n<!--more-->\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig1](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig1.png)</div>\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig2](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig2.png)</div>\n\nAccording to the martix M<sub>nn</sub>(a<sub>ij</sub>), we can permutate it and get a full permutation set Perm(M<sub>nn</sub>(a<sub>ij</sub>)) = {M<sub>nn</sub>(a<sub>I<sub>i</sub>J<sub>j</sub></sub>)| I and J is a permutation of 1..n }, (Perm(M) is a set, each matrix in Perm(M) is unique). For example:\n\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig3](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig3.png)</div>\n\nThe problem is to get the result of a fomula about an integer matrix M<sub>nn</sub>:\n\n<div style=\"color: #000000;\">![DeterminantAndMatrixFig4](http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig4.png)</div>\n<span style=\"color: #000000;\">in which the det(M) meaned to cacluate the determinant of M.</span>\n\n## Input\n\nThere are several test cases.\n\nThe first line contains an integer <var>T</var>(<var>T</var> ≤ 100) . Then <var>T</var> test cases follow.\n\nIn each test case, the first line contains one integer <var>n</var>(0&lt; <var>n</var>≤ 10). The number means the giving matrix's size is <var>n×n</var>\n\nThen there are <var>n</var> lines followed, each line contains <var>n</var> integers <var>a<sub>ij</sub></var>(-10≤ <var>a<sub>ij</sub></var>≤ 10), in the position row <var>i</var>, colum <var>j</var>, it represents the number <var>a<sub>ij</sub>.</var>\n\n## Output\n\nFor each test case, since the result may be very large, output one line with the result modulo 2<sup>30</sup>.\n\n## Sample Input\n```\n1\n2\n1 1\n1 2\n```\n#### Sample Output\n\n```\n2\n```\n\n<span style=\"color: #000000;\">Author: </span>**LIN, Binghui**\n<span style=\"color: #000000;\">Source: </span>**ZOJ Monthly, August 2014**\n\n<br/>\n\n- - -\n\n\n这道题全场现场只A了一个人。今天我们比赛的时候我A了，挺爽的。\n```Java\nimport java.util.Scanner;\nimport java.math.*;\npublic class Main {\n\tstatic long fact[]=new long[15];\n\tstatic long kind;\n\tstatic int A[][]=new int[10][10];\n\tstatic final BigInteger MOD=BigInteger.valueOf(1&lt;&lt;30);\n\tstatic void getKind(int n){\n\t\tboolean mark[]=new boolean[10];\n\t\tfor(int i,j,k,r=0;r&lt;2;r++){\n\t\t\tfor (i = 0; i &lt; n; ++ i) mark[i] = false;\n\t\t\tfor (i = 0; i &lt; n; ++ i) {\n\t\t\t\tif (mark[i]) continue;\n\t\t\t\tint cnt = 0;\n\t\t\t\tfor (j = i; j &lt; n; ++ j) {\n\t\t\t\t\tfor (k = 0; k &lt; n; ++ k) {\n\t\t\t\t\t\tif (r==1&amp;&amp;A[k][i] != A[k][j])break;\n\t\t\t\t\t\tif(r==0&amp;&amp;A[i][k] != A[j][k])break;\n\t\t\t\t\t}\n\t\t\t\t\tif (k == n) {\n\t\t\t\t\t\t++ cnt;\n\t\t\t\t\t\tmark[j] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tkind /= fact[cnt];\n\t\t\t}\n\t\t}\n\t}\n\tpublic static void main(String[] args){\n\t\tScanner cin=new Scanner(System.in);\n\t\tint n,T=cin.nextInt();\n\t\tfact[0]=1;\n\t\tfor(int i=1;i&lt;=10;i++)fact[i]=fact[i-1]*i;\n\t\twhile(T--&gt;0){\n\t\t\tn=cin.nextInt();\n\t\t\tfor(int i=0;i&lt;n;i++){\n\t\t\t\tfor(int j=0;j&lt;n;j++){\n\t\t\t\t\tA[i][j]=cin.nextInt();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlong res=0;\n\t\t\tMatrix matrix=new Matrix(n);\n\t\t\tkind=fact[n]*fact[n];\n\t\t\tgetKind(n);\n\t\t\tif(kind%2==1){\n\t\t\t\tmatrix.valueOf(A, 0);\n\t\t\t\tres=res ^(matrix.Det().mod(MOD).longValue());\n\t\t\t}\n\t\t\tmatrix.valueOf(A, 1);\n\t\t\tres=res^(matrix.Det().mod(MOD).longValue());\n\t\t\tmatrix.valueOf(A, -1);\n\t\t\tres=res^(matrix.Det().mod(MOD).longValue());\n\t\t\tSystem.out.println(res);\n\t\t}\n\t\tcin.close();\n\t}\n}\nclass Matrix{\n\tBigInteger M[][]=new BigInteger[10][10];\n\tBigInteger ZERO,ONE;\n\tint n;\n\tMatrix(int n){\n\t\tthis.n=n;\n\t\tZERO=BigInteger.ZERO;\n\t\tONE=BigInteger.ONE;\n\t}\n\tvoid valueOf(int A[][],int d){\n\t\tfor(int i=0;i&lt;n;i++){\n\t\t\tfor(int j=0;j&lt;n;j++){\n\t\t\t\tM[i][j]=BigInteger.valueOf(A[i][j]+d);\n\t\t\t}\n\t\t}\n\t}\n\tBigInteger Det(){\n\t\tBigInteger tmp, res = ONE, div = ONE;\n\t\tint i, j, k;\n\t\tfor (i = 0; i &lt; n; ++ i) {\n\t\t\tfor (j = i; j &lt; n; ++ j) {\n\t\t\t\tif (!M[j][i].equals(ZERO)) break;\n\t\t\t}\n\t\t\tif (j == n) return ZERO;\n\t\t\tif (j != i) {\n\t\t\t\t//res = res.negate();\n\t\t\t\tfor (k = 0; k &lt; n; ++ k) {\n\t\t\t\t    tmp = M[j][k];\n\t\t\t\t\tM[j][k] = M[i][k];\n\t\t\t\t\tM[i][k] = tmp;\n\t\t\t\t}\n\t\t\t}\n\t\t\tres = res.multiply(M[i][i]);\n\t\t\tfor (j = i + 1; j &lt; n; ++ j) {\n\t\t\t\tif (M[j][i].equals(ZERO)) continue;\n\t\t\t\tdiv = div.multiply(M[i][i]);\n\t\t\t\tfor (k = i + 1; k &lt; n; ++ k) {\n\t\t\t\t\tM[j][k] = M[j][k].multiply(M[i][i]).subtract(M[i][k].multiply(M[j][i]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tres = res.divide(div);\n\t\tif (res.compareTo(ZERO) &lt; 0) res = res.negate();\n\t\treturn res;\n\t}\n}\n```\n</pre>","slug":"zoj-month-contest-d-determinant-and-matrix","published":1,"updated":"2017-01-16T01:58:03.973Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz5e9l2j005d5rgxtb7z1kn6","content":"<hr>\n<center style=\"color: #000000;\"><span style=\"color: green;\">Time Limit: </span>2 Seconds      <span style=\"color: green;\">Memory Limit: </span>65536 KB</center>\n\n<hr>\n<p>##Description<br>Recently, LBH is learning the curse linear algebra. Thus he is very interested in matrix and determinant now. In order to practice his ability of solving the problem of linear algebra, he just invent some problems by himself. Once the problems was create, he would solve it immediately. However, he meet a problem that was so hard that he couldn’t work out even though racked his brains. The problem was described as follow:</p>\n<p>To a integer martix M<sub>nn</sub>(a<sub>ij</sub>), we define two function add(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> + 1) and sub(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> - 1) which were exactly like this:<br><a id=\"more\"></a></p>\n<div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig1.png\" alt=\"DeterminantAndMatrixFig1\"></div><br><div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig2.png\" alt=\"DeterminantAndMatrixFig2\"></div>\n\n<p>According to the martix M<sub>nn</sub>(a<sub>ij</sub>), we can permutate it and get a full permutation set Perm(M<sub>nn</sub>(a<sub>ij</sub>)) = {M<sub>nn</sub>(a<sub>I<sub>i</sub>J<sub>j</sub></sub>)| I and J is a permutation of 1..n }, (Perm(M) is a set, each matrix in Perm(M) is unique). For example:</p>\n<div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig3.png\" alt=\"DeterminantAndMatrixFig3\"></div>\n\n<p>The problem is to get the result of a fomula about an integer matrix M<sub>nn</sub>:</p>\n<p><div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig4.png\" alt=\"DeterminantAndMatrixFig4\"></div><br><span style=\"color: #000000;\">in which the det(M) meaned to cacluate the determinant of M.</span></p>\n<h2 id=\"Input\"><a href=\"#Input\" class=\"headerlink\" title=\"Input\"></a>Input</h2><p>There are several test cases.</p>\n<p>The first line contains an integer <var>T</var>(<var>T</var> ≤ 100) . Then <var>T</var> test cases follow.</p>\n<p>In each test case, the first line contains one integer <var>n</var>(0&lt; <var>n</var>≤ 10). The number means the giving matrix’s size is <var>n×n</var></p>\n<p>Then there are <var>n</var> lines followed, each line contains <var>n</var> integers <var>a<sub>ij</sub></var>(-10≤ <var>a<sub>ij</sub></var>≤ 10), in the position row <var>i</var>, colum <var>j</var>, it represents the number <var>a<sub>ij</sub>.</var></p>\n<h2 id=\"Output\"><a href=\"#Output\" class=\"headerlink\" title=\"Output\"></a>Output</h2><p>For each test case, since the result may be very large, output one line with the result modulo 2<sup>30</sup>.</p>\n<h2 id=\"Sample-Input\"><a href=\"#Sample-Input\" class=\"headerlink\" title=\"Sample Input\"></a>Sample Input</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">1 1</div><div class=\"line\">1 2</div></pre></td></tr></table></figure>\n<h4 id=\"Sample-Output\"><a href=\"#Sample-Output\" class=\"headerlink\" title=\"Sample Output\"></a>Sample Output</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">2</div></pre></td></tr></table></figure>\n<p><span style=\"color: #000000;\">Author: </span><strong>LIN, Binghui</strong><br><span style=\"color: #000000;\">Source: </span><strong>ZOJ Monthly, August 2014</strong></p>\n<p><br></p>\n<hr>\n<p>这道题全场现场只A了一个人。今天我们比赛的时候我A了，挺爽的。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> java.util.Scanner;</div><div class=\"line\"><span class=\"keyword\">import</span> java.math.*;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">long</span> fact[]=<span class=\"keyword\">new</span> <span class=\"keyword\">long</span>[<span class=\"number\">15</span>];</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">long</span> kind;</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">int</span> A[][]=<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">10</span>][<span class=\"number\">10</span>];</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">final</span> BigInteger MOD=BigInteger.valueOf(<span class=\"number\">1</span>&amp;lt;&amp;lt;<span class=\"number\">30</span>);</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">getKind</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">boolean</span> mark[]=<span class=\"keyword\">new</span> <span class=\"keyword\">boolean</span>[<span class=\"number\">10</span>];</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i,j,k,r=<span class=\"number\">0</span>;r&amp;lt;<span class=\"number\">2</span>;r++)&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &amp;lt; n; ++ i) mark[i] = <span class=\"keyword\">false</span>;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &amp;lt; n; ++ i) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (mark[i]) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (j = i; j &amp;lt; n; ++ j) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (k = <span class=\"number\">0</span>; k &amp;lt; n; ++ k) &#123;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (r==<span class=\"number\">1</span>&amp;amp;&amp;amp;A[k][i] != A[k][j])<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(r==<span class=\"number\">0</span>&amp;amp;&amp;amp;A[i][k] != A[j][k])<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (k == n) &#123;</div><div class=\"line\">\t\t\t\t\t\t++ cnt;</div><div class=\"line\">\t\t\t\t\t\tmark[j] = <span class=\"keyword\">true</span>;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tkind /= fact[cnt];</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</div><div class=\"line\">\t\tScanner cin=<span class=\"keyword\">new</span> Scanner(System.in);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> n,T=cin.nextInt();</div><div class=\"line\">\t\tfact[<span class=\"number\">0</span>]=<span class=\"number\">1</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=<span class=\"number\">10</span>;i++)fact[i]=fact[i-<span class=\"number\">1</span>]*i;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span>(T--&amp;gt;<span class=\"number\">0</span>)&#123;</div><div class=\"line\">\t\t\tn=cin.nextInt();</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;n;i++)&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&amp;lt;n;j++)&#123;</div><div class=\"line\">\t\t\t\t\tA[i][j]=cin.nextInt();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\t<span class=\"keyword\">long</span> res=<span class=\"number\">0</span>;</div><div class=\"line\">\t\t\tMatrix matrix=<span class=\"keyword\">new</span> Matrix(n);</div><div class=\"line\">\t\t\tkind=fact[n]*fact[n];</div><div class=\"line\">\t\t\tgetKind(n);</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span>(kind%<span class=\"number\">2</span>==<span class=\"number\">1</span>)&#123;</div><div class=\"line\">\t\t\t\tmatrix.valueOf(A, <span class=\"number\">0</span>);</div><div class=\"line\">\t\t\t\tres=res ^(matrix.Det().mod(MOD).longValue());</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tmatrix.valueOf(A, <span class=\"number\">1</span>);</div><div class=\"line\">\t\t\tres=res^(matrix.Det().mod(MOD).longValue());</div><div class=\"line\">\t\t\tmatrix.valueOf(A, -<span class=\"number\">1</span>);</div><div class=\"line\">\t\t\tres=res^(matrix.Det().mod(MOD).longValue());</div><div class=\"line\">\t\t\tSystem.out.println(res);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tcin.close();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Matrix</span></span>&#123;</div><div class=\"line\">\tBigInteger M[][]=<span class=\"keyword\">new</span> BigInteger[<span class=\"number\">10</span>][<span class=\"number\">10</span>];</div><div class=\"line\">\tBigInteger ZERO,ONE;</div><div class=\"line\">\t<span class=\"keyword\">int</span> n;</div><div class=\"line\">\tMatrix(<span class=\"keyword\">int</span> n)&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.n=n;</div><div class=\"line\">\t\tZERO=BigInteger.ZERO;</div><div class=\"line\">\t\tONE=BigInteger.ONE;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">valueOf</span><span class=\"params\">(<span class=\"keyword\">int</span> A[][],<span class=\"keyword\">int</span> d)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;n;i++)&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&amp;lt;n;j++)&#123;</div><div class=\"line\">\t\t\t\tM[i][j]=BigInteger.valueOf(A[i][j]+d);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\">BigInteger <span class=\"title\">Det</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\tBigInteger tmp, res = ONE, div = ONE;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> i, j, k;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &amp;lt; n; ++ i) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (j = i; j &amp;lt; n; ++ j) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (!M[j][i].equals(ZERO)) <span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (j == n) <span class=\"keyword\">return</span> ZERO;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (j != i) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">//res = res.negate();</span></div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (k = <span class=\"number\">0</span>; k &amp;lt; n; ++ k) &#123;</div><div class=\"line\">\t\t\t\t    tmp = M[j][k];</div><div class=\"line\">\t\t\t\t\tM[j][k] = M[i][k];</div><div class=\"line\">\t\t\t\t\tM[i][k] = tmp;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tres = res.multiply(M[i][i]);</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (j = i + <span class=\"number\">1</span>; j &amp;lt; n; ++ j) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (M[j][i].equals(ZERO)) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t\t\tdiv = div.multiply(M[i][i]);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (k = i + <span class=\"number\">1</span>; k &amp;lt; n; ++ k) &#123;</div><div class=\"line\">\t\t\t\t\tM[j][k] = M[j][k].multiply(M[i][i]).subtract(M[i][k].multiply(M[j][i]));</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tres = res.divide(div);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (res.compareTo(ZERO) &amp;lt; <span class=\"number\">0</span>) res = res.negate();</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></p>\n","excerpt":"<hr>\n<center style=\"color: #000000;\"><span style=\"color: green;\">Time Limit: </span>2 Seconds      <span style=\"color: green;\">Memory Limit: </span>65536 KB</center>\n\n<hr>\n<p>##Description<br>Recently, LBH is learning the curse linear algebra. Thus he is very interested in matrix and determinant now. In order to practice his ability of solving the problem of linear algebra, he just invent some problems by himself. Once the problems was create, he would solve it immediately. However, he meet a problem that was so hard that he couldn’t work out even though racked his brains. The problem was described as follow:</p>\n<p>To a integer martix M<sub>nn</sub>(a<sub>ij</sub>), we define two function add(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> + 1) and sub(M<sub>nn</sub>(a<sub>ij</sub>))=M<sub>nn</sub>(a<sub>ij</sub> - 1) which were exactly like this:<br>","more":"</p>\n<div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig1.png\" alt=\"DeterminantAndMatrixFig1\"></div><br><div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig2.png\" alt=\"DeterminantAndMatrixFig2\"></div>\n\n<p>According to the martix M<sub>nn</sub>(a<sub>ij</sub>), we can permutate it and get a full permutation set Perm(M<sub>nn</sub>(a<sub>ij</sub>)) = {M<sub>nn</sub>(a<sub>I<sub>i</sub>J<sub>j</sub></sub>)| I and J is a permutation of 1..n }, (Perm(M) is a set, each matrix in Perm(M) is unique). For example:</p>\n<div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig3.png\" alt=\"DeterminantAndMatrixFig3\"></div>\n\n<p>The problem is to get the result of a fomula about an integer matrix M<sub>nn</sub>:</p>\n<p><div style=\"color: #000000;\"><img src=\"http://acm.zju.edu.cn/onlinejudge/showImage.do?name=DeterminantAndMatrixFig4.png\" alt=\"DeterminantAndMatrixFig4\"></div><br><span style=\"color: #000000;\">in which the det(M) meaned to cacluate the determinant of M.</span></p>\n<h2 id=\"Input\"><a href=\"#Input\" class=\"headerlink\" title=\"Input\"></a>Input</h2><p>There are several test cases.</p>\n<p>The first line contains an integer <var>T</var>(<var>T</var> ≤ 100) . Then <var>T</var> test cases follow.</p>\n<p>In each test case, the first line contains one integer <var>n</var>(0&lt; <var>n</var>≤ 10). The number means the giving matrix’s size is <var>n×n</var></p>\n<p>Then there are <var>n</var> lines followed, each line contains <var>n</var> integers <var>a<sub>ij</sub></var>(-10≤ <var>a<sub>ij</sub></var>≤ 10), in the position row <var>i</var>, colum <var>j</var>, it represents the number <var>a<sub>ij</sub>.</var></p>\n<h2 id=\"Output\"><a href=\"#Output\" class=\"headerlink\" title=\"Output\"></a>Output</h2><p>For each test case, since the result may be very large, output one line with the result modulo 2<sup>30</sup>.</p>\n<h2 id=\"Sample-Input\"><a href=\"#Sample-Input\" class=\"headerlink\" title=\"Sample Input\"></a>Sample Input</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">1 1</div><div class=\"line\">1 2</div></pre></td></tr></table></figure>\n<h4 id=\"Sample-Output\"><a href=\"#Sample-Output\" class=\"headerlink\" title=\"Sample Output\"></a>Sample Output</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">2</div></pre></td></tr></table></figure>\n<p><span style=\"color: #000000;\">Author: </span><strong>LIN, Binghui</strong><br><span style=\"color: #000000;\">Source: </span><strong>ZOJ Monthly, August 2014</strong></p>\n<p><br/></p>\n<hr>\n<p>这道题全场现场只A了一个人。今天我们比赛的时候我A了，挺爽的。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> java.util.Scanner;</div><div class=\"line\"><span class=\"keyword\">import</span> java.math.*;</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">long</span> fact[]=<span class=\"keyword\">new</span> <span class=\"keyword\">long</span>[<span class=\"number\">15</span>];</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">long</span> kind;</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">int</span> A[][]=<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">10</span>][<span class=\"number\">10</span>];</div><div class=\"line\">\t<span class=\"keyword\">static</span> <span class=\"keyword\">final</span> BigInteger MOD=BigInteger.valueOf(<span class=\"number\">1</span>&amp;lt;&amp;lt;<span class=\"number\">30</span>);</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">getKind</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">boolean</span> mark[]=<span class=\"keyword\">new</span> <span class=\"keyword\">boolean</span>[<span class=\"number\">10</span>];</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i,j,k,r=<span class=\"number\">0</span>;r&amp;lt;<span class=\"number\">2</span>;r++)&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &amp;lt; n; ++ i) mark[i] = <span class=\"keyword\">false</span>;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &amp;lt; n; ++ i) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (mark[i]) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (j = i; j &amp;lt; n; ++ j) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> (k = <span class=\"number\">0</span>; k &amp;lt; n; ++ k) &#123;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> (r==<span class=\"number\">1</span>&amp;amp;&amp;amp;A[k][i] != A[k][j])<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(r==<span class=\"number\">0</span>&amp;amp;&amp;amp;A[i][k] != A[j][k])<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (k == n) &#123;</div><div class=\"line\">\t\t\t\t\t\t++ cnt;</div><div class=\"line\">\t\t\t\t\t\tmark[j] = <span class=\"keyword\">true</span>;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tkind /= fact[cnt];</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</div><div class=\"line\">\t\tScanner cin=<span class=\"keyword\">new</span> Scanner(System.in);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> n,T=cin.nextInt();</div><div class=\"line\">\t\tfact[<span class=\"number\">0</span>]=<span class=\"number\">1</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&amp;lt;=<span class=\"number\">10</span>;i++)fact[i]=fact[i-<span class=\"number\">1</span>]*i;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span>(T--&amp;gt;<span class=\"number\">0</span>)&#123;</div><div class=\"line\">\t\t\tn=cin.nextInt();</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;n;i++)&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&amp;lt;n;j++)&#123;</div><div class=\"line\">\t\t\t\t\tA[i][j]=cin.nextInt();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\t<span class=\"keyword\">long</span> res=<span class=\"number\">0</span>;</div><div class=\"line\">\t\t\tMatrix matrix=<span class=\"keyword\">new</span> Matrix(n);</div><div class=\"line\">\t\t\tkind=fact[n]*fact[n];</div><div class=\"line\">\t\t\tgetKind(n);</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span>(kind%<span class=\"number\">2</span>==<span class=\"number\">1</span>)&#123;</div><div class=\"line\">\t\t\t\tmatrix.valueOf(A, <span class=\"number\">0</span>);</div><div class=\"line\">\t\t\t\tres=res ^(matrix.Det().mod(MOD).longValue());</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tmatrix.valueOf(A, <span class=\"number\">1</span>);</div><div class=\"line\">\t\t\tres=res^(matrix.Det().mod(MOD).longValue());</div><div class=\"line\">\t\t\tmatrix.valueOf(A, -<span class=\"number\">1</span>);</div><div class=\"line\">\t\t\tres=res^(matrix.Det().mod(MOD).longValue());</div><div class=\"line\">\t\t\tSystem.out.println(res);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tcin.close();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Matrix</span></span>&#123;</div><div class=\"line\">\tBigInteger M[][]=<span class=\"keyword\">new</span> BigInteger[<span class=\"number\">10</span>][<span class=\"number\">10</span>];</div><div class=\"line\">\tBigInteger ZERO,ONE;</div><div class=\"line\">\t<span class=\"keyword\">int</span> n;</div><div class=\"line\">\tMatrix(<span class=\"keyword\">int</span> n)&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">this</span>.n=n;</div><div class=\"line\">\t\tZERO=BigInteger.ZERO;</div><div class=\"line\">\t\tONE=BigInteger.ONE;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">valueOf</span><span class=\"params\">(<span class=\"keyword\">int</span> A[][],<span class=\"keyword\">int</span> d)</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&amp;lt;n;i++)&#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&amp;lt;n;j++)&#123;</div><div class=\"line\">\t\t\t\tM[i][j]=BigInteger.valueOf(A[i][j]+d);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"function\">BigInteger <span class=\"title\">Det</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\tBigInteger tmp, res = ONE, div = ONE;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> i, j, k;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &amp;lt; n; ++ i) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (j = i; j &amp;lt; n; ++ j) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (!M[j][i].equals(ZERO)) <span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (j == n) <span class=\"keyword\">return</span> ZERO;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span> (j != i) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"comment\">//res = res.negate();</span></div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (k = <span class=\"number\">0</span>; k &amp;lt; n; ++ k) &#123;</div><div class=\"line\">\t\t\t\t    tmp = M[j][k];</div><div class=\"line\">\t\t\t\t\tM[j][k] = M[i][k];</div><div class=\"line\">\t\t\t\t\tM[i][k] = tmp;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tres = res.multiply(M[i][i]);</div><div class=\"line\">\t\t\t<span class=\"keyword\">for</span> (j = i + <span class=\"number\">1</span>; j &amp;lt; n; ++ j) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (M[j][i].equals(ZERO)) <span class=\"keyword\">continue</span>;</div><div class=\"line\">\t\t\t\tdiv = div.multiply(M[i][i]);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (k = i + <span class=\"number\">1</span>; k &amp;lt; n; ++ k) &#123;</div><div class=\"line\">\t\t\t\t\tM[j][k] = M[j][k].multiply(M[i][i]).subtract(M[i][k].multiply(M[j][i]));</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tres = res.divide(div);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span> (res.compareTo(ZERO) &amp;lt; <span class=\"number\">0</span>) res = res.negate();</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p></pre></p>"},{"title":"Basic Algorithms in Go","date":"2017-01-09T16:00:00.000Z","grammar_cjkRuby":true,"_content":"最近学Go，感觉挺不错的。闲来无事用它写了几种常用的基础算法。\n## 快排\n思想很简单，实现起来为了方便每次以left作为基准，也可以使用BFS来节省递归栈：\n```go\n// QuickSort returns a sorted slice\nfunc QuickSort(arr []int) {\n\tif len(arr) <= 1 {\n\t\treturn\n\t}\n\tleft, right := 0, len(arr)-1\n\tfor left < right {\n\t\tif arr[left+1] > arr[left] {\n\t\t\tarr[left+1], arr[right] = arr[right], arr[left+1]\n\t\t\tright--\n\t\t} else {\n\t\t\tarr[left+1], arr[left] = arr[left], arr[left+1]\n\t\t\tleft++\n\t\t}\n\t}\n\tQuickSort(arr[:left])\n\tQuickSort(arr[left+1:])\n}\n```\n<!--more-->\n## 最短路\n最短路核心思想就是Relax操作。效率高的单源最短路有下面两种算法：\n1. Dijikstra，不能处理负权路,但是时间复杂度比较稳定.\n2. SPFA是我比较喜欢的一种算法，可以判断负权路。正常情况的时间复杂度为`O(kE)`  其中`k<<V`；最好的情况即一次BFS，时间复杂度为 `O(E)`，然而对于某些精心构造的图，复杂度可以达到Bellman-ford级别：`O(VE)`。\n下面构图使用的是邻接表（适用于稀疏图），也可以用邻接矩阵（适用于稠密图）。\n```go\n// adjacency list definition\ntype edge struct {\n\tv, w int\n\tnext *edge\n}\n\ntype Graph struct {\n\thead []*edge\n\tn, m int\n}\n\nfunc (G *Graph) init(n, m int) {\n\tG.n, G.m = n, m\n\tG.head = make([]*edge, n)\n}\n\nfunc (G *Graph) add(u, v, w int) {\n\tG.head[u] = &edge{\n\t\tv:    v,\n\t\tw:    w,\n\t\tnext: G.head[u],\n\t}\n}\n\n// SPFA returns the shortest path from begin to end\n// begin: the begin node number\n// end: the end node number\nfunc (G *Graph) SPFA(begin, end int) int {\n\tvisit := make([]bool, G.n)\n\tdist := make([]int, G.n)\n\tQ := make([]int, 0)\n\tfor i := 0; i < G.n; i++ {\n\t\tdist[i] = -1\n\t}\n\tdist[begin] = 0\n\tQ = append(Q, begin)\n\tvisit[begin] = true\n\tfor len(Q) != 0 {\n\t\tu := Q[0]\n\t\tfor e := G.head[u]; e != nil; e = e.next {\n\t\t\tif dist[e.v] == -1 || dist[e.v] > dist[u]+e.w {\n\t\t\t\tdist[e.v] = dist[u] + e.w\n\t\t\t\tif !visit[e.v] {\n\t\t\t\t\tQ = append(Q, e.v)\n\t\t\t\t\tvisit[e.v] = true\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// pop the front node\n\t\tQ = Q[1:]\n\t\tvisit[u] = false\n\t}\n\treturn dist[end]\n}\n```\n## KMP\n字符串匹配经典算法。关键在于维护一个这样的关系：`x[i-next[i]...i-1]=x[0...next[i]-1]`\n```go\ntype Kmp struct {\n\tpattern string\n\tnext    []int\n}\n\n// x[i-p...i-1]=x[0...p-1]\nfunc (K *Kmp) getNext() {\n\tK.next = make([]int, len(K.pattern)+1)\n\tK.next[0] = -1\n\ti := 0\n\tp := -1\n\tfor i < len(K.pattern) {\n\t\tfor p != -1 && K.pattern[i] != K.pattern[p] {\n\t\t\tp = K.next[p]\n\t\t}\n\t\tp++\n\t\ti++\n\t\tif i < len(K.pattern) && K.pattern[i] == K.pattern[p] {\n\t\t\tK.next[i] = K.next[p]\n\t\t} else {\n\t\t\tK.next[i] = p\n\t\t}\n\t}\n}\n\nfunc (K *Kmp) match(matcher string) int {\n\tret := 0\n\tp := 0\n\ti := 0\n\tfor i < len(matcher) {\n\t\tfor p != -1 && matcher[i] != K.pattern[p] {\n\t\t\tp = K.next[p]\n\t\t}\n\t\ti++\n\t\tp++\n\t\tif p >= len(K.pattern) {\n\t\t\tret++\n\t\t\tp = K.next[p]\n\t\t}\n\t}\n\treturn ret\n}\n```\n\n\n___To Be Continue...___","source":"_posts/Basic Algorithms in Go.md","raw":"---\ntitle: Basic Algorithms in Go\ntags: [algorithm,golang]\ncategories: [ACM]\ndate: 2017-1-10\ngrammar_cjkRuby: true\n---\n最近学Go，感觉挺不错的。闲来无事用它写了几种常用的基础算法。\n## 快排\n思想很简单，实现起来为了方便每次以left作为基准，也可以使用BFS来节省递归栈：\n```go\n// QuickSort returns a sorted slice\nfunc QuickSort(arr []int) {\n\tif len(arr) <= 1 {\n\t\treturn\n\t}\n\tleft, right := 0, len(arr)-1\n\tfor left < right {\n\t\tif arr[left+1] > arr[left] {\n\t\t\tarr[left+1], arr[right] = arr[right], arr[left+1]\n\t\t\tright--\n\t\t} else {\n\t\t\tarr[left+1], arr[left] = arr[left], arr[left+1]\n\t\t\tleft++\n\t\t}\n\t}\n\tQuickSort(arr[:left])\n\tQuickSort(arr[left+1:])\n}\n```\n<!--more-->\n## 最短路\n最短路核心思想就是Relax操作。效率高的单源最短路有下面两种算法：\n1. Dijikstra，不能处理负权路,但是时间复杂度比较稳定.\n2. SPFA是我比较喜欢的一种算法，可以判断负权路。正常情况的时间复杂度为`O(kE)`  其中`k<<V`；最好的情况即一次BFS，时间复杂度为 `O(E)`，然而对于某些精心构造的图，复杂度可以达到Bellman-ford级别：`O(VE)`。\n下面构图使用的是邻接表（适用于稀疏图），也可以用邻接矩阵（适用于稠密图）。\n```go\n// adjacency list definition\ntype edge struct {\n\tv, w int\n\tnext *edge\n}\n\ntype Graph struct {\n\thead []*edge\n\tn, m int\n}\n\nfunc (G *Graph) init(n, m int) {\n\tG.n, G.m = n, m\n\tG.head = make([]*edge, n)\n}\n\nfunc (G *Graph) add(u, v, w int) {\n\tG.head[u] = &edge{\n\t\tv:    v,\n\t\tw:    w,\n\t\tnext: G.head[u],\n\t}\n}\n\n// SPFA returns the shortest path from begin to end\n// begin: the begin node number\n// end: the end node number\nfunc (G *Graph) SPFA(begin, end int) int {\n\tvisit := make([]bool, G.n)\n\tdist := make([]int, G.n)\n\tQ := make([]int, 0)\n\tfor i := 0; i < G.n; i++ {\n\t\tdist[i] = -1\n\t}\n\tdist[begin] = 0\n\tQ = append(Q, begin)\n\tvisit[begin] = true\n\tfor len(Q) != 0 {\n\t\tu := Q[0]\n\t\tfor e := G.head[u]; e != nil; e = e.next {\n\t\t\tif dist[e.v] == -1 || dist[e.v] > dist[u]+e.w {\n\t\t\t\tdist[e.v] = dist[u] + e.w\n\t\t\t\tif !visit[e.v] {\n\t\t\t\t\tQ = append(Q, e.v)\n\t\t\t\t\tvisit[e.v] = true\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// pop the front node\n\t\tQ = Q[1:]\n\t\tvisit[u] = false\n\t}\n\treturn dist[end]\n}\n```\n## KMP\n字符串匹配经典算法。关键在于维护一个这样的关系：`x[i-next[i]...i-1]=x[0...next[i]-1]`\n```go\ntype Kmp struct {\n\tpattern string\n\tnext    []int\n}\n\n// x[i-p...i-1]=x[0...p-1]\nfunc (K *Kmp) getNext() {\n\tK.next = make([]int, len(K.pattern)+1)\n\tK.next[0] = -1\n\ti := 0\n\tp := -1\n\tfor i < len(K.pattern) {\n\t\tfor p != -1 && K.pattern[i] != K.pattern[p] {\n\t\t\tp = K.next[p]\n\t\t}\n\t\tp++\n\t\ti++\n\t\tif i < len(K.pattern) && K.pattern[i] == K.pattern[p] {\n\t\t\tK.next[i] = K.next[p]\n\t\t} else {\n\t\t\tK.next[i] = p\n\t\t}\n\t}\n}\n\nfunc (K *Kmp) match(matcher string) int {\n\tret := 0\n\tp := 0\n\ti := 0\n\tfor i < len(matcher) {\n\t\tfor p != -1 && matcher[i] != K.pattern[p] {\n\t\t\tp = K.next[p]\n\t\t}\n\t\ti++\n\t\tp++\n\t\tif p >= len(K.pattern) {\n\t\t\tret++\n\t\t\tp = K.next[p]\n\t\t}\n\t}\n\treturn ret\n}\n```\n\n\n___To Be Continue...___","slug":"Basic Algorithms in Go","published":1,"updated":"2019-10-11T05:50:15.630Z","_id":"cizt7c0j70000awgs27d414yh","comments":1,"layout":"post","photos":[],"link":"","content":"<p>最近学Go，感觉挺不错的。闲来无事用它写了几种常用的基础算法。</p>\n<h2 id=\"快排\"><a href=\"#快排\" class=\"headerlink\" title=\"快排\"></a>快排</h2><p>思想很简单，实现起来为了方便每次以left作为基准，也可以使用BFS来节省递归栈：<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// QuickSort returns a sorted slice</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">QuickSort</span><span class=\"params\">(arr []<span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(arr) &lt;= <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tleft, right := <span class=\"number\">0</span>, <span class=\"built_in\">len</span>(arr)<span class=\"number\">-1</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> left &lt; right &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> arr[left+<span class=\"number\">1</span>] &gt; arr[left] &#123;</span><br><span class=\"line\">\t\t\tarr[left+<span class=\"number\">1</span>], arr[right] = arr[right], arr[left+<span class=\"number\">1</span>]</span><br><span class=\"line\">\t\t\tright--</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tarr[left+<span class=\"number\">1</span>], arr[left] = arr[left], arr[left+<span class=\"number\">1</span>]</span><br><span class=\"line\">\t\t\tleft++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tQuickSort(arr[:left])</span><br><span class=\"line\">\tQuickSort(arr[left+<span class=\"number\">1</span>:])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<h2 id=\"最短路\"><a href=\"#最短路\" class=\"headerlink\" title=\"最短路\"></a>最短路</h2><p>最短路核心思想就是Relax操作。效率高的单源最短路有下面两种算法：</p>\n<ol>\n<li>Dijikstra，不能处理负权路,但是时间复杂度比较稳定.</li>\n<li>SPFA是我比较喜欢的一种算法，可以判断负权路。正常情况的时间复杂度为<code>O(kE)</code>  其中<code>k&lt;&lt;V</code>；最好的情况即一次BFS，时间复杂度为 <code>O(E)</code>，然而对于某些精心构造的图，复杂度可以达到Bellman-ford级别：<code>O(VE)</code>。<br>下面构图使用的是邻接表（适用于稀疏图），也可以用邻接矩阵（适用于稠密图）。<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// adjacency list definition</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> edge <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tv, w <span class=\"keyword\">int</span></span><br><span class=\"line\">\tnext *edge</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Graph <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\thead []*edge</span><br><span class=\"line\">\tn, m <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(G *Graph)</span> <span class=\"title\">init</span><span class=\"params\">(n, m <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tG.n, G.m = n, m</span><br><span class=\"line\">\tG.head = <span class=\"built_in\">make</span>([]*edge, n)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(G *Graph)</span> <span class=\"title\">add</span><span class=\"params\">(u, v, w <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tG.head[u] = &amp;edge&#123;</span><br><span class=\"line\">\t\tv:    v,</span><br><span class=\"line\">\t\tw:    w,</span><br><span class=\"line\">\t\tnext: G.head[u],</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SPFA returns the shortest path from begin to end</span></span><br><span class=\"line\"><span class=\"comment\">// begin: the begin node number</span></span><br><span class=\"line\"><span class=\"comment\">// end: the end node number</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(G *Graph)</span> <span class=\"title\">SPFA</span><span class=\"params\">(begin, end <span class=\"keyword\">int</span>)</span> <span class=\"title\">int</span></span> &#123;</span><br><span class=\"line\">\tvisit := <span class=\"built_in\">make</span>([]<span class=\"keyword\">bool</span>, G.n)</span><br><span class=\"line\">\tdist := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, G.n)</span><br><span class=\"line\">\tQ := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; G.n; i++ &#123;</span><br><span class=\"line\">\t\tdist[i] = <span class=\"number\">-1</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdist[begin] = <span class=\"number\">0</span></span><br><span class=\"line\">\tQ = <span class=\"built_in\">append</span>(Q, begin)</span><br><span class=\"line\">\tvisit[begin] = <span class=\"literal\">true</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"built_in\">len</span>(Q) != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\tu := Q[<span class=\"number\">0</span>]</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> e := G.head[u]; e != <span class=\"literal\">nil</span>; e = e.next &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> dist[e.v] == <span class=\"number\">-1</span> || dist[e.v] &gt; dist[u]+e.w &#123;</span><br><span class=\"line\">\t\t\t\tdist[e.v] = dist[u] + e.w</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> !visit[e.v] &#123;</span><br><span class=\"line\">\t\t\t\t\tQ = <span class=\"built_in\">append</span>(Q, e.v)</span><br><span class=\"line\">\t\t\t\t\tvisit[e.v] = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// pop the front node</span></span><br><span class=\"line\">\t\tQ = Q[<span class=\"number\">1</span>:]</span><br><span class=\"line\">\t\tvisit[u] = <span class=\"literal\">false</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> dist[end]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"KMP\"><a href=\"#KMP\" class=\"headerlink\" title=\"KMP\"></a>KMP</h2><p>字符串匹配经典算法。关键在于维护一个这样的关系：<code>x[i-next[i]...i-1]=x[0...next[i]-1]</code><br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Kmp <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tpattern <span class=\"keyword\">string</span></span><br><span class=\"line\">\tnext    []<span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// x[i-p...i-1]=x[0...p-1]</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(K *Kmp)</span> <span class=\"title\">getNext</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tK.next = <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"built_in\">len</span>(K.pattern)+<span class=\"number\">1</span>)</span><br><span class=\"line\">\tK.next[<span class=\"number\">0</span>] = <span class=\"number\">-1</span></span><br><span class=\"line\">\ti := <span class=\"number\">0</span></span><br><span class=\"line\">\tp := <span class=\"number\">-1</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i &lt; <span class=\"built_in\">len</span>(K.pattern) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> p != <span class=\"number\">-1</span> &amp;&amp; K.pattern[i] != K.pattern[p] &#123;</span><br><span class=\"line\">\t\t\tp = K.next[p]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tp++</span><br><span class=\"line\">\t\ti++</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &lt; <span class=\"built_in\">len</span>(K.pattern) &amp;&amp; K.pattern[i] == K.pattern[p] &#123;</span><br><span class=\"line\">\t\t\tK.next[i] = K.next[p]</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tK.next[i] = p</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(K *Kmp)</span> <span class=\"title\">match</span><span class=\"params\">(matcher <span class=\"keyword\">string</span>)</span> <span class=\"title\">int</span></span> &#123;</span><br><span class=\"line\">\tret := <span class=\"number\">0</span></span><br><span class=\"line\">\tp := <span class=\"number\">0</span></span><br><span class=\"line\">\ti := <span class=\"number\">0</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i &lt; <span class=\"built_in\">len</span>(matcher) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> p != <span class=\"number\">-1</span> &amp;&amp; matcher[i] != K.pattern[p] &#123;</span><br><span class=\"line\">\t\t\tp = K.next[p]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ti++</span><br><span class=\"line\">\t\tp++</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> p &gt;= <span class=\"built_in\">len</span>(K.pattern) &#123;</span><br><span class=\"line\">\t\t\tret++</span><br><span class=\"line\">\t\t\tp = K.next[p]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ret</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong><em>To Be Continue…</em></strong></p>\n","site":{"data":{}},"excerpt":"<p>最近学Go，感觉挺不错的。闲来无事用它写了几种常用的基础算法。</p>\n<h2 id=\"快排\"><a href=\"#快排\" class=\"headerlink\" title=\"快排\"></a>快排</h2><p>思想很简单，实现起来为了方便每次以left作为基准，也可以使用BFS来节省递归栈：<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// QuickSort returns a sorted slice</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">QuickSort</span><span class=\"params\">(arr []<span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(arr) &lt;= <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tleft, right := <span class=\"number\">0</span>, <span class=\"built_in\">len</span>(arr)<span class=\"number\">-1</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> left &lt; right &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> arr[left+<span class=\"number\">1</span>] &gt; arr[left] &#123;</span><br><span class=\"line\">\t\t\tarr[left+<span class=\"number\">1</span>], arr[right] = arr[right], arr[left+<span class=\"number\">1</span>]</span><br><span class=\"line\">\t\t\tright--</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tarr[left+<span class=\"number\">1</span>], arr[left] = arr[left], arr[left+<span class=\"number\">1</span>]</span><br><span class=\"line\">\t\t\tleft++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tQuickSort(arr[:left])</span><br><span class=\"line\">\tQuickSort(arr[left+<span class=\"number\">1</span>:])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>","more":"<h2 id=\"最短路\"><a href=\"#最短路\" class=\"headerlink\" title=\"最短路\"></a>最短路</h2><p>最短路核心思想就是Relax操作。效率高的单源最短路有下面两种算法：</p>\n<ol>\n<li>Dijikstra，不能处理负权路,但是时间复杂度比较稳定.</li>\n<li>SPFA是我比较喜欢的一种算法，可以判断负权路。正常情况的时间复杂度为<code>O(kE)</code>  其中<code>k&lt;&lt;V</code>；最好的情况即一次BFS，时间复杂度为 <code>O(E)</code>，然而对于某些精心构造的图，复杂度可以达到Bellman-ford级别：<code>O(VE)</code>。<br>下面构图使用的是邻接表（适用于稀疏图），也可以用邻接矩阵（适用于稠密图）。<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// adjacency list definition</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> edge <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tv, w <span class=\"keyword\">int</span></span><br><span class=\"line\">\tnext *edge</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Graph <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\thead []*edge</span><br><span class=\"line\">\tn, m <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(G *Graph)</span> <span class=\"title\">init</span><span class=\"params\">(n, m <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tG.n, G.m = n, m</span><br><span class=\"line\">\tG.head = <span class=\"built_in\">make</span>([]*edge, n)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(G *Graph)</span> <span class=\"title\">add</span><span class=\"params\">(u, v, w <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tG.head[u] = &amp;edge&#123;</span><br><span class=\"line\">\t\tv:    v,</span><br><span class=\"line\">\t\tw:    w,</span><br><span class=\"line\">\t\tnext: G.head[u],</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SPFA returns the shortest path from begin to end</span></span><br><span class=\"line\"><span class=\"comment\">// begin: the begin node number</span></span><br><span class=\"line\"><span class=\"comment\">// end: the end node number</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(G *Graph)</span> <span class=\"title\">SPFA</span><span class=\"params\">(begin, end <span class=\"keyword\">int</span>)</span> <span class=\"title\">int</span></span> &#123;</span><br><span class=\"line\">\tvisit := <span class=\"built_in\">make</span>([]<span class=\"keyword\">bool</span>, G.n)</span><br><span class=\"line\">\tdist := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, G.n)</span><br><span class=\"line\">\tQ := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; G.n; i++ &#123;</span><br><span class=\"line\">\t\tdist[i] = <span class=\"number\">-1</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdist[begin] = <span class=\"number\">0</span></span><br><span class=\"line\">\tQ = <span class=\"built_in\">append</span>(Q, begin)</span><br><span class=\"line\">\tvisit[begin] = <span class=\"literal\">true</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> <span class=\"built_in\">len</span>(Q) != <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\tu := Q[<span class=\"number\">0</span>]</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> e := G.head[u]; e != <span class=\"literal\">nil</span>; e = e.next &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> dist[e.v] == <span class=\"number\">-1</span> || dist[e.v] &gt; dist[u]+e.w &#123;</span><br><span class=\"line\">\t\t\t\tdist[e.v] = dist[u] + e.w</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> !visit[e.v] &#123;</span><br><span class=\"line\">\t\t\t\t\tQ = <span class=\"built_in\">append</span>(Q, e.v)</span><br><span class=\"line\">\t\t\t\t\tvisit[e.v] = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// pop the front node</span></span><br><span class=\"line\">\t\tQ = Q[<span class=\"number\">1</span>:]</span><br><span class=\"line\">\t\tvisit[u] = <span class=\"literal\">false</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> dist[end]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"KMP\"><a href=\"#KMP\" class=\"headerlink\" title=\"KMP\"></a>KMP</h2><p>字符串匹配经典算法。关键在于维护一个这样的关系：<code>x[i-next[i]...i-1]=x[0...next[i]-1]</code><br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Kmp <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tpattern <span class=\"keyword\">string</span></span><br><span class=\"line\">\tnext    []<span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// x[i-p...i-1]=x[0...p-1]</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(K *Kmp)</span> <span class=\"title\">getNext</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tK.next = <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"built_in\">len</span>(K.pattern)+<span class=\"number\">1</span>)</span><br><span class=\"line\">\tK.next[<span class=\"number\">0</span>] = <span class=\"number\">-1</span></span><br><span class=\"line\">\ti := <span class=\"number\">0</span></span><br><span class=\"line\">\tp := <span class=\"number\">-1</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i &lt; <span class=\"built_in\">len</span>(K.pattern) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> p != <span class=\"number\">-1</span> &amp;&amp; K.pattern[i] != K.pattern[p] &#123;</span><br><span class=\"line\">\t\t\tp = K.next[p]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tp++</span><br><span class=\"line\">\t\ti++</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &lt; <span class=\"built_in\">len</span>(K.pattern) &amp;&amp; K.pattern[i] == K.pattern[p] &#123;</span><br><span class=\"line\">\t\t\tK.next[i] = K.next[p]</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tK.next[i] = p</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(K *Kmp)</span> <span class=\"title\">match</span><span class=\"params\">(matcher <span class=\"keyword\">string</span>)</span> <span class=\"title\">int</span></span> &#123;</span><br><span class=\"line\">\tret := <span class=\"number\">0</span></span><br><span class=\"line\">\tp := <span class=\"number\">0</span></span><br><span class=\"line\">\ti := <span class=\"number\">0</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i &lt; <span class=\"built_in\">len</span>(matcher) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> p != <span class=\"number\">-1</span> &amp;&amp; matcher[i] != K.pattern[p] &#123;</span><br><span class=\"line\">\t\t\tp = K.next[p]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ti++</span><br><span class=\"line\">\t\tp++</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> p &gt;= <span class=\"built_in\">len</span>(K.pattern) &#123;</span><br><span class=\"line\">\t\t\tret++</span><br><span class=\"line\">\t\t\tp = K.next[p]</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ret</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong><em>To Be Continue…</em></strong></p>"},{"title":"斐波那契堆之Go实现","date":"2017-02-28T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n一个比二叉堆更高效的数据结构，但是实现起来非常复杂。本科的时候看《算法导论》的时候曾经研究过，不是很明白。今天终于对它有了一个比较清晰的了解。\n![enter description here][1]\n<!--more-->\n```go\npackage fibonacciHeap\n\nconst MinInt = -int(^uint(0)>>1) - 1\n\ntype Vertex struct {\n\tvalue  int\n\tparent *Vertex\n\tchild  *Vertex\n\tleft   *Vertex\n\tright  *Vertex\n\tmark   bool\n\tdegree int\n}\n\ntype FibonacciHeap struct {\n\tmin  *Vertex\n\tsize int\n}\n\n// Insert inserts a node into heap with value v\nfunc (F *FibonacciHeap) Insert(value int) *Vertex {\n\tv := &Vertex{value: value}\n\tif F.min == nil {\n\t\tF.min = v\n\t} else {\n\t\tF.insertToList(F.min, v)\n\t\tif F.min.value > v.value {\n\t\t\tF.min = v\n\t\t}\n\t}\n\tF.size++\n\treturn v\n}\n\nfunc (F *FibonacciHeap) Empty() bool {\n\treturn F.min == nil\n}\n\nfunc (F *FibonacciHeap) Minmum() *Vertex {\n\treturn F.min\n}\n\nfunc (F *FibonacciHeap) ExtractMin() *Vertex {\n\tz := F.min\n\tif z == nil {\n\t\treturn nil\n\t}\n\tfor z.child != nil {\n\t\tv := F.extractVertex(z.child)\n\t\tF.insertToList(F.min, v)\n\t}\n\tif z == z.right { //the heap only contains one node\n\t\tF.min = nil\n\t} else {\n\t\tF.min = z.right\n\t\tz = F.extractVertex(z)\n\t\tF.consolidate()\n\t}\n\tF.size--\n\treturn z\n}\nfunc (F *FibonacciHeap) Merge(Other *FibonacciHeap) {\n\tif F.min == nil { // if current heap is empty\n\t\tF.min = Other.min\n\t} else if Other.min != nil {\n\t\t// cut two circle and rearrange them\n\t\tF.min.right.left = Other.min.left\n\t\tOther.min.left.right = F.min.right //reverse\n\t\tF.min.right = Other.min\n\t\tOther.min.left = F.min //reverse\n\t\tif F.min.value > Other.min.value {\n\t\t\tF.min = Other.min\n\t\t}\n\t}\n\tOther.min = nil\n}\nfunc (F *FibonacciHeap) DecreaseKey(v *Vertex, value int) bool {\n\tif v.value < value {\n\t\treturn false // do not increase\n\t}\n\tif v.value == value {\n\t\treturn true\n\t}\n\tv.value = value\n\tparent := v.parent\n\tif parent != nil && v.value < parent.value {\n\t\tv = F.extractVertex(v)\n\t\tF.insertToList(F.min, v)\n\t\tF.cascadingCut(parent)\n\t}\n\tif v.value < F.min.value {\n\t\tF.min = v\n\t}\n\treturn true\n}\n\nfunc (F *FibonacciHeap) IncreaseKey(v *Vertex, value int) bool {\n\tif v.value > value {\n\t\treturn false\n\t}\n\tif v.value == value {\n\t\treturn true\n\t}\n\tfor v.child != nil {\n\t\tF.insertToList(F.min, F.extractVertex(v.child))\n\t}\n\n\tv.value = value\n\tparent := v.parent\n\tif parent != nil {\n\t\tF.insertToList(F.min, F.extractVertex(v))\n\t\tF.cascadingCut(parent)\n\t} else if F.min == v {\n\t\tfor cur := v.right; cur != v; cur = cur.right {\n\t\t\tif v.value > cur.value {\n\t\t\t\tF.min = cur\n\t\t\t}\n\t\t}\n\t}\n\treturn true\n}\n\nfunc (F *FibonacciHeap) Modify(v *Vertex, value int) {\n\tswitch {\n\tcase v.value < value:\n\t\tF.IncreaseKey(v, value)\n\tcase v.value > value:\n\t\tF.DecreaseKey(v, value)\n\t}\n}\n\nfunc (F *FibonacciHeap) DeleteVertex(v *Vertex) {\n\tF.DecreaseKey(v, MinInt)\n\tF.extractVertex(v)\n}\n\n// insertToList inserts v after pos\nfunc (F *FibonacciHeap) insertToList(pos *Vertex, v *Vertex) {\n\tif pos == nil {\n\t\treturn\n\t}\n\tpos.right.left = v\n\tv.right = pos.right\n\tpos.right = v\n\tv.left = pos\n\tv.parent = pos.parent\n\tif pos.parent != nil {\n\t\tpos.parent.degree++\n\t}\n}\n\nfunc (F *FibonacciHeap) extractVertex(v *Vertex) *Vertex {\n\tif v == nil {\n\t\treturn nil\n\t}\n\tif v.parent != nil {\n\t\tif v.right != v {\n\t\t\tv.parent.child = v.right\n\t\t} else {\n\t\t\tv.parent.child = nil\n\t\t}\n\t\tv.parent.degree--\n\t\tv.parent = nil\n\t}\n\tif v.left != v {\n\t\tv.left.right = v.right\n\t\tv.right.left = v.left\n\t\tv.left = v\n\t\tv.right = v\n\t}\n\tv.mark = false\n\treturn v\n}\n\nfunc (F *FibonacciHeap) cascadingCut(v *Vertex) {\n\tparent := v.parent\n\tif parent == nil {\n\t\treturn\n\t}\n\tif v.mark == false {\n\t\tv.mark = true\n\t} else {\n\t\t// when the parent have lost a child\n\t\tF.extractVertex(v)\n\t\tF.insertToList(F.min, v)\n\t\tF.cascadingCut(parent)\n\t}\n}\n\nfunc (F *FibonacciHeap) consolidate() {\n\tif F.min == nil {\n\t\treturn\n\t}\n\tv := F.min\n\tdegree := v.degree\n\t// a record table to help merging vertices with the same degree\n\ttable := make([]*Vertex, degree+1)\n\tfor {\n\t\tif len(table) <= degree {\n\t\t\t// extend table size\n\t\t\ttable = append(table, make([]*Vertex, degree-len(table)+1)...)\n\t\t}\n\t\tif table[degree] == v {\n\t\t\tbreak\n\t\t}\n\t\tif table[degree] == nil {\n\t\t\t//currently ,there is no vertices having the same degree of v\n\t\t\ttable[degree] = v\n\t\t\tv = v.right\n\t\t} else {\n\t\t\t// make sure v is the minimal vertex\n\t\t\tif table[degree].value < v.value {\n\t\t\t\ttable[degree], v = v, table[degree]\n\t\t\t}\n\t\t\t// merge table[degree] to v as his child\n\t\t\t// make v become root\n\t\t\ttable[degree] = F.extractVertex(table[degree])\n\t\t\tif v.child == nil {\n\t\t\t\tv.child = table[degree]\n\t\t\t\ttable[degree].parent = v\n\t\t\t\tv.degree++\n\t\t\t} else {\n\t\t\t\t//v.degree has been increased in this function\n\t\t\t\tF.insertToList(v.child, table[degree])\n\t\t\t}\n\t\t\ttable[degree] = nil\n\t\t}\n\t\tdegree = v.degree\n\t}\n\t// find the min\n\tF.min = nil\n\tfor _, v := range table {\n\t\tif v == nil {\n\t\t\tcontinue\n\t\t}\n\t\tif F.min == nil {\n\t\t\tF.min = v\n\t\t} else if v.value < F.min.value {\n\t\t\tF.min = v\n\t\t}\n\t}\n}\n```\n\n参考\n- https://www.roading.org/algorithm/introductiontoalgorithm/斐波那契堆fibonacci-heaps.html\n- http://www.cnblogs.com/skywang12345/p/3659060.html\n\n\n  [1]: https://ol1kreips.qnssl.com/image.png \"image.png\"","source":"_posts/斐波那契堆之Go实现.md","raw":"---\ntitle: 斐波那契堆之Go实现\ntags: [algorithm,golang]\ncategories: [ACM]\ndate: 2017-3-1\ngrammar_cjkRuby: true\n---\n\n一个比二叉堆更高效的数据结构，但是实现起来非常复杂。本科的时候看《算法导论》的时候曾经研究过，不是很明白。今天终于对它有了一个比较清晰的了解。\n![enter description here][1]\n<!--more-->\n```go\npackage fibonacciHeap\n\nconst MinInt = -int(^uint(0)>>1) - 1\n\ntype Vertex struct {\n\tvalue  int\n\tparent *Vertex\n\tchild  *Vertex\n\tleft   *Vertex\n\tright  *Vertex\n\tmark   bool\n\tdegree int\n}\n\ntype FibonacciHeap struct {\n\tmin  *Vertex\n\tsize int\n}\n\n// Insert inserts a node into heap with value v\nfunc (F *FibonacciHeap) Insert(value int) *Vertex {\n\tv := &Vertex{value: value}\n\tif F.min == nil {\n\t\tF.min = v\n\t} else {\n\t\tF.insertToList(F.min, v)\n\t\tif F.min.value > v.value {\n\t\t\tF.min = v\n\t\t}\n\t}\n\tF.size++\n\treturn v\n}\n\nfunc (F *FibonacciHeap) Empty() bool {\n\treturn F.min == nil\n}\n\nfunc (F *FibonacciHeap) Minmum() *Vertex {\n\treturn F.min\n}\n\nfunc (F *FibonacciHeap) ExtractMin() *Vertex {\n\tz := F.min\n\tif z == nil {\n\t\treturn nil\n\t}\n\tfor z.child != nil {\n\t\tv := F.extractVertex(z.child)\n\t\tF.insertToList(F.min, v)\n\t}\n\tif z == z.right { //the heap only contains one node\n\t\tF.min = nil\n\t} else {\n\t\tF.min = z.right\n\t\tz = F.extractVertex(z)\n\t\tF.consolidate()\n\t}\n\tF.size--\n\treturn z\n}\nfunc (F *FibonacciHeap) Merge(Other *FibonacciHeap) {\n\tif F.min == nil { // if current heap is empty\n\t\tF.min = Other.min\n\t} else if Other.min != nil {\n\t\t// cut two circle and rearrange them\n\t\tF.min.right.left = Other.min.left\n\t\tOther.min.left.right = F.min.right //reverse\n\t\tF.min.right = Other.min\n\t\tOther.min.left = F.min //reverse\n\t\tif F.min.value > Other.min.value {\n\t\t\tF.min = Other.min\n\t\t}\n\t}\n\tOther.min = nil\n}\nfunc (F *FibonacciHeap) DecreaseKey(v *Vertex, value int) bool {\n\tif v.value < value {\n\t\treturn false // do not increase\n\t}\n\tif v.value == value {\n\t\treturn true\n\t}\n\tv.value = value\n\tparent := v.parent\n\tif parent != nil && v.value < parent.value {\n\t\tv = F.extractVertex(v)\n\t\tF.insertToList(F.min, v)\n\t\tF.cascadingCut(parent)\n\t}\n\tif v.value < F.min.value {\n\t\tF.min = v\n\t}\n\treturn true\n}\n\nfunc (F *FibonacciHeap) IncreaseKey(v *Vertex, value int) bool {\n\tif v.value > value {\n\t\treturn false\n\t}\n\tif v.value == value {\n\t\treturn true\n\t}\n\tfor v.child != nil {\n\t\tF.insertToList(F.min, F.extractVertex(v.child))\n\t}\n\n\tv.value = value\n\tparent := v.parent\n\tif parent != nil {\n\t\tF.insertToList(F.min, F.extractVertex(v))\n\t\tF.cascadingCut(parent)\n\t} else if F.min == v {\n\t\tfor cur := v.right; cur != v; cur = cur.right {\n\t\t\tif v.value > cur.value {\n\t\t\t\tF.min = cur\n\t\t\t}\n\t\t}\n\t}\n\treturn true\n}\n\nfunc (F *FibonacciHeap) Modify(v *Vertex, value int) {\n\tswitch {\n\tcase v.value < value:\n\t\tF.IncreaseKey(v, value)\n\tcase v.value > value:\n\t\tF.DecreaseKey(v, value)\n\t}\n}\n\nfunc (F *FibonacciHeap) DeleteVertex(v *Vertex) {\n\tF.DecreaseKey(v, MinInt)\n\tF.extractVertex(v)\n}\n\n// insertToList inserts v after pos\nfunc (F *FibonacciHeap) insertToList(pos *Vertex, v *Vertex) {\n\tif pos == nil {\n\t\treturn\n\t}\n\tpos.right.left = v\n\tv.right = pos.right\n\tpos.right = v\n\tv.left = pos\n\tv.parent = pos.parent\n\tif pos.parent != nil {\n\t\tpos.parent.degree++\n\t}\n}\n\nfunc (F *FibonacciHeap) extractVertex(v *Vertex) *Vertex {\n\tif v == nil {\n\t\treturn nil\n\t}\n\tif v.parent != nil {\n\t\tif v.right != v {\n\t\t\tv.parent.child = v.right\n\t\t} else {\n\t\t\tv.parent.child = nil\n\t\t}\n\t\tv.parent.degree--\n\t\tv.parent = nil\n\t}\n\tif v.left != v {\n\t\tv.left.right = v.right\n\t\tv.right.left = v.left\n\t\tv.left = v\n\t\tv.right = v\n\t}\n\tv.mark = false\n\treturn v\n}\n\nfunc (F *FibonacciHeap) cascadingCut(v *Vertex) {\n\tparent := v.parent\n\tif parent == nil {\n\t\treturn\n\t}\n\tif v.mark == false {\n\t\tv.mark = true\n\t} else {\n\t\t// when the parent have lost a child\n\t\tF.extractVertex(v)\n\t\tF.insertToList(F.min, v)\n\t\tF.cascadingCut(parent)\n\t}\n}\n\nfunc (F *FibonacciHeap) consolidate() {\n\tif F.min == nil {\n\t\treturn\n\t}\n\tv := F.min\n\tdegree := v.degree\n\t// a record table to help merging vertices with the same degree\n\ttable := make([]*Vertex, degree+1)\n\tfor {\n\t\tif len(table) <= degree {\n\t\t\t// extend table size\n\t\t\ttable = append(table, make([]*Vertex, degree-len(table)+1)...)\n\t\t}\n\t\tif table[degree] == v {\n\t\t\tbreak\n\t\t}\n\t\tif table[degree] == nil {\n\t\t\t//currently ,there is no vertices having the same degree of v\n\t\t\ttable[degree] = v\n\t\t\tv = v.right\n\t\t} else {\n\t\t\t// make sure v is the minimal vertex\n\t\t\tif table[degree].value < v.value {\n\t\t\t\ttable[degree], v = v, table[degree]\n\t\t\t}\n\t\t\t// merge table[degree] to v as his child\n\t\t\t// make v become root\n\t\t\ttable[degree] = F.extractVertex(table[degree])\n\t\t\tif v.child == nil {\n\t\t\t\tv.child = table[degree]\n\t\t\t\ttable[degree].parent = v\n\t\t\t\tv.degree++\n\t\t\t} else {\n\t\t\t\t//v.degree has been increased in this function\n\t\t\t\tF.insertToList(v.child, table[degree])\n\t\t\t}\n\t\t\ttable[degree] = nil\n\t\t}\n\t\tdegree = v.degree\n\t}\n\t// find the min\n\tF.min = nil\n\tfor _, v := range table {\n\t\tif v == nil {\n\t\t\tcontinue\n\t\t}\n\t\tif F.min == nil {\n\t\t\tF.min = v\n\t\t} else if v.value < F.min.value {\n\t\t\tF.min = v\n\t\t}\n\t}\n}\n```\n\n参考\n- https://www.roading.org/algorithm/introductiontoalgorithm/斐波那契堆fibonacci-heaps.html\n- http://www.cnblogs.com/skywang12345/p/3659060.html\n\n\n  [1]: https://ol1kreips.qnssl.com/image.png \"image.png\"","slug":"斐波那契堆之Go实现","published":1,"updated":"2019-10-11T05:50:15.705Z","_id":"cizt7c0k70006awgs6es5wjqc","comments":1,"layout":"post","photos":[],"link":"","content":"<p>一个比二叉堆更高效的数据结构，但是实现起来非常复杂。本科的时候看《算法导论》的时候曾经研究过，不是很明白。今天终于对它有了一个比较清晰的了解。<br><img src=\"https://ol1kreips.qnssl.com/image.png\" alt=\"enter description here\" title=\"image.png\"><br><a id=\"more\"></a><br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> fibonacciHeap</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> MinInt = -<span class=\"keyword\">int</span>(^<span class=\"keyword\">uint</span>(<span class=\"number\">0</span>)&gt;&gt;<span class=\"number\">1</span>) - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Vertex <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tvalue  <span class=\"keyword\">int</span></span><br><span class=\"line\">\tparent *Vertex</span><br><span class=\"line\">\tchild  *Vertex</span><br><span class=\"line\">\tleft   *Vertex</span><br><span class=\"line\">\tright  *Vertex</span><br><span class=\"line\">\tmark   <span class=\"keyword\">bool</span></span><br><span class=\"line\">\tdegree <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> FibonacciHeap <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tmin  *Vertex</span><br><span class=\"line\">\tsize <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Insert inserts a node into heap with value v</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Insert</span><span class=\"params\">(value <span class=\"keyword\">int</span>)</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\tv := &amp;Vertex&#123;value: value&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tF.min = v</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> F.min.value &gt; v.value &#123;</span><br><span class=\"line\">\t\t\tF.min = v</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tF.size++</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> v</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Empty</span><span class=\"params\">()</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> F.min == <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Minmum</span><span class=\"params\">()</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> F.min</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">ExtractMin</span><span class=\"params\">()</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\tz := F.min</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> z == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> z.child != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tv := F.extractVertex(z.child)</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> z == z.right &#123; <span class=\"comment\">//the heap only contains one node</span></span><br><span class=\"line\">\t\tF.min = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tF.min = z.right</span><br><span class=\"line\">\t\tz = F.extractVertex(z)</span><br><span class=\"line\">\t\tF.consolidate()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tF.size--</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> z</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Merge</span><span class=\"params\">(Other *FibonacciHeap)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">// if current heap is empty</span></span><br><span class=\"line\">\t\tF.min = Other.min</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> Other.min != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// cut two circle and rearrange them</span></span><br><span class=\"line\">\t\tF.min.right.left = Other.min.left</span><br><span class=\"line\">\t\tOther.min.left.right = F.min.right <span class=\"comment\">//reverse</span></span><br><span class=\"line\">\t\tF.min.right = Other.min</span><br><span class=\"line\">\t\tOther.min.left = F.min <span class=\"comment\">//reverse</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> F.min.value &gt; Other.min.value &#123;</span><br><span class=\"line\">\t\t\tF.min = Other.min</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tOther.min = <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">DecreaseKey</span><span class=\"params\">(v *Vertex, value <span class=\"keyword\">int</span>)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value &lt; value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"comment\">// do not increase</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value == value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tv.value = value</span><br><span class=\"line\">\tparent := v.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> parent != <span class=\"literal\">nil</span> &amp;&amp; v.value &lt; parent.value &#123;</span><br><span class=\"line\">\t\tv = F.extractVertex(v)</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t\tF.cascadingCut(parent)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value &lt; F.min.value &#123;</span><br><span class=\"line\">\t\tF.min = v</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">IncreaseKey</span><span class=\"params\">(v *Vertex, value <span class=\"keyword\">int</span>)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value &gt; value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value == value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> v.child != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tF.insertToList(F.min, F.extractVertex(v.child))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tv.value = value</span><br><span class=\"line\">\tparent := v.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> parent != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tF.insertToList(F.min, F.extractVertex(v))</span><br><span class=\"line\">\t\tF.cascadingCut(parent)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> F.min == v &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> cur := v.right; cur != v; cur = cur.right &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> v.value &gt; cur.value &#123;</span><br><span class=\"line\">\t\t\t\tF.min = cur</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Modify</span><span class=\"params\">(v *Vertex, value <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> v.value &lt; value:</span><br><span class=\"line\">\t\tF.IncreaseKey(v, value)</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> v.value &gt; value:</span><br><span class=\"line\">\t\tF.DecreaseKey(v, value)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">DeleteVertex</span><span class=\"params\">(v *Vertex)</span></span> &#123;</span><br><span class=\"line\">\tF.DecreaseKey(v, MinInt)</span><br><span class=\"line\">\tF.extractVertex(v)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// insertToList inserts v after pos</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">insertToList</span><span class=\"params\">(pos *Vertex, v *Vertex)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> pos == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tpos.right.left = v</span><br><span class=\"line\">\tv.right = pos.right</span><br><span class=\"line\">\tpos.right = v</span><br><span class=\"line\">\tv.left = pos</span><br><span class=\"line\">\tv.parent = pos.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> pos.parent != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tpos.parent.degree++</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">extractVertex</span><span class=\"params\">(v *Vertex)</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.parent != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> v.right != v &#123;</span><br><span class=\"line\">\t\t\tv.parent.child = v.right</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tv.parent.child = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tv.parent.degree--</span><br><span class=\"line\">\t\tv.parent = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.left != v &#123;</span><br><span class=\"line\">\t\tv.left.right = v.right</span><br><span class=\"line\">\t\tv.right.left = v.left</span><br><span class=\"line\">\t\tv.left = v</span><br><span class=\"line\">\t\tv.right = v</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tv.mark = <span class=\"literal\">false</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> v</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">cascadingCut</span><span class=\"params\">(v *Vertex)</span></span> &#123;</span><br><span class=\"line\">\tparent := v.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> parent == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.mark == <span class=\"literal\">false</span> &#123;</span><br><span class=\"line\">\t\tv.mark = <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// when the parent have lost a child</span></span><br><span class=\"line\">\t\tF.extractVertex(v)</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t\tF.cascadingCut(parent)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">consolidate</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tv := F.min</span><br><span class=\"line\">\tdegree := v.degree</span><br><span class=\"line\">\t<span class=\"comment\">// a record table to help merging vertices with the same degree</span></span><br><span class=\"line\">\ttable := <span class=\"built_in\">make</span>([]*Vertex, degree+<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(table) &lt;= degree &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// extend table size</span></span><br><span class=\"line\">\t\t\ttable = <span class=\"built_in\">append</span>(table, <span class=\"built_in\">make</span>([]*Vertex, degree-<span class=\"built_in\">len</span>(table)+<span class=\"number\">1</span>)...)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> table[degree] == v &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> table[degree] == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//currently ,there is no vertices having the same degree of v</span></span><br><span class=\"line\">\t\t\ttable[degree] = v</span><br><span class=\"line\">\t\t\tv = v.right</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// make sure v is the minimal vertex</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> table[degree].value &lt; v.value &#123;</span><br><span class=\"line\">\t\t\t\ttable[degree], v = v, table[degree]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// merge table[degree] to v as his child</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// make v become root</span></span><br><span class=\"line\">\t\t\ttable[degree] = F.extractVertex(table[degree])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> v.child == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\tv.child = table[degree]</span><br><span class=\"line\">\t\t\t\ttable[degree].parent = v</span><br><span class=\"line\">\t\t\t\tv.degree++</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//v.degree has been increased in this function</span></span><br><span class=\"line\">\t\t\t\tF.insertToList(v.child, table[degree])</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\ttable[degree] = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tdegree = v.degree</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// find the min</span></span><br><span class=\"line\">\tF.min = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, v := <span class=\"keyword\">range</span> table &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> v == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">continue</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tF.min = v</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> v.value &lt; F.min.value &#123;</span><br><span class=\"line\">\t\t\tF.min = v</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>参考</p>\n<ul>\n<li><a href=\"https://www.roading.org/algorithm/introductiontoalgorithm/斐波那契堆fibonacci-heaps.html\" target=\"_blank\" rel=\"noopener\">https://www.roading.org/algorithm/introductiontoalgorithm/斐波那契堆fibonacci-heaps.html</a></li>\n<li><a href=\"http://www.cnblogs.com/skywang12345/p/3659060.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/skywang12345/p/3659060.html</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>一个比二叉堆更高效的数据结构，但是实现起来非常复杂。本科的时候看《算法导论》的时候曾经研究过，不是很明白。今天终于对它有了一个比较清晰的了解。<br><img src=\"https://ol1kreips.qnssl.com/image.png\" alt=\"enter description here\" title=\"image.png\"><br>","more":"<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> fibonacciHeap</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> MinInt = -<span class=\"keyword\">int</span>(^<span class=\"keyword\">uint</span>(<span class=\"number\">0</span>)&gt;&gt;<span class=\"number\">1</span>) - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Vertex <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tvalue  <span class=\"keyword\">int</span></span><br><span class=\"line\">\tparent *Vertex</span><br><span class=\"line\">\tchild  *Vertex</span><br><span class=\"line\">\tleft   *Vertex</span><br><span class=\"line\">\tright  *Vertex</span><br><span class=\"line\">\tmark   <span class=\"keyword\">bool</span></span><br><span class=\"line\">\tdegree <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> FibonacciHeap <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tmin  *Vertex</span><br><span class=\"line\">\tsize <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Insert inserts a node into heap with value v</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Insert</span><span class=\"params\">(value <span class=\"keyword\">int</span>)</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\tv := &amp;Vertex&#123;value: value&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tF.min = v</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> F.min.value &gt; v.value &#123;</span><br><span class=\"line\">\t\t\tF.min = v</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tF.size++</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> v</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Empty</span><span class=\"params\">()</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> F.min == <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Minmum</span><span class=\"params\">()</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> F.min</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">ExtractMin</span><span class=\"params\">()</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\tz := F.min</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> z == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> z.child != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tv := F.extractVertex(z.child)</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> z == z.right &#123; <span class=\"comment\">//the heap only contains one node</span></span><br><span class=\"line\">\t\tF.min = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tF.min = z.right</span><br><span class=\"line\">\t\tz = F.extractVertex(z)</span><br><span class=\"line\">\t\tF.consolidate()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tF.size--</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> z</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Merge</span><span class=\"params\">(Other *FibonacciHeap)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">// if current heap is empty</span></span><br><span class=\"line\">\t\tF.min = Other.min</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> Other.min != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// cut two circle and rearrange them</span></span><br><span class=\"line\">\t\tF.min.right.left = Other.min.left</span><br><span class=\"line\">\t\tOther.min.left.right = F.min.right <span class=\"comment\">//reverse</span></span><br><span class=\"line\">\t\tF.min.right = Other.min</span><br><span class=\"line\">\t\tOther.min.left = F.min <span class=\"comment\">//reverse</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> F.min.value &gt; Other.min.value &#123;</span><br><span class=\"line\">\t\t\tF.min = Other.min</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tOther.min = <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">DecreaseKey</span><span class=\"params\">(v *Vertex, value <span class=\"keyword\">int</span>)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value &lt; value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"comment\">// do not increase</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value == value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tv.value = value</span><br><span class=\"line\">\tparent := v.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> parent != <span class=\"literal\">nil</span> &amp;&amp; v.value &lt; parent.value &#123;</span><br><span class=\"line\">\t\tv = F.extractVertex(v)</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t\tF.cascadingCut(parent)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value &lt; F.min.value &#123;</span><br><span class=\"line\">\t\tF.min = v</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">IncreaseKey</span><span class=\"params\">(v *Vertex, value <span class=\"keyword\">int</span>)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value &gt; value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.value == value &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> v.child != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tF.insertToList(F.min, F.extractVertex(v.child))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tv.value = value</span><br><span class=\"line\">\tparent := v.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> parent != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tF.insertToList(F.min, F.extractVertex(v))</span><br><span class=\"line\">\t\tF.cascadingCut(parent)</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> F.min == v &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> cur := v.right; cur != v; cur = cur.right &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> v.value &gt; cur.value &#123;</span><br><span class=\"line\">\t\t\t\tF.min = cur</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">Modify</span><span class=\"params\">(v *Vertex, value <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> v.value &lt; value:</span><br><span class=\"line\">\t\tF.IncreaseKey(v, value)</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> v.value &gt; value:</span><br><span class=\"line\">\t\tF.DecreaseKey(v, value)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">DeleteVertex</span><span class=\"params\">(v *Vertex)</span></span> &#123;</span><br><span class=\"line\">\tF.DecreaseKey(v, MinInt)</span><br><span class=\"line\">\tF.extractVertex(v)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// insertToList inserts v after pos</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">insertToList</span><span class=\"params\">(pos *Vertex, v *Vertex)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> pos == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tpos.right.left = v</span><br><span class=\"line\">\tv.right = pos.right</span><br><span class=\"line\">\tpos.right = v</span><br><span class=\"line\">\tv.left = pos</span><br><span class=\"line\">\tv.parent = pos.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> pos.parent != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tpos.parent.degree++</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">extractVertex</span><span class=\"params\">(v *Vertex)</span> *<span class=\"title\">Vertex</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.parent != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> v.right != v &#123;</span><br><span class=\"line\">\t\t\tv.parent.child = v.right</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tv.parent.child = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tv.parent.degree--</span><br><span class=\"line\">\t\tv.parent = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.left != v &#123;</span><br><span class=\"line\">\t\tv.left.right = v.right</span><br><span class=\"line\">\t\tv.right.left = v.left</span><br><span class=\"line\">\t\tv.left = v</span><br><span class=\"line\">\t\tv.right = v</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tv.mark = <span class=\"literal\">false</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> v</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">cascadingCut</span><span class=\"params\">(v *Vertex)</span></span> &#123;</span><br><span class=\"line\">\tparent := v.parent</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> parent == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> v.mark == <span class=\"literal\">false</span> &#123;</span><br><span class=\"line\">\t\tv.mark = <span class=\"literal\">true</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// when the parent have lost a child</span></span><br><span class=\"line\">\t\tF.extractVertex(v)</span><br><span class=\"line\">\t\tF.insertToList(F.min, v)</span><br><span class=\"line\">\t\tF.cascadingCut(parent)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(F *FibonacciHeap)</span> <span class=\"title\">consolidate</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tv := F.min</span><br><span class=\"line\">\tdegree := v.degree</span><br><span class=\"line\">\t<span class=\"comment\">// a record table to help merging vertices with the same degree</span></span><br><span class=\"line\">\ttable := <span class=\"built_in\">make</span>([]*Vertex, degree+<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(table) &lt;= degree &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// extend table size</span></span><br><span class=\"line\">\t\t\ttable = <span class=\"built_in\">append</span>(table, <span class=\"built_in\">make</span>([]*Vertex, degree-<span class=\"built_in\">len</span>(table)+<span class=\"number\">1</span>)...)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> table[degree] == v &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> table[degree] == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//currently ,there is no vertices having the same degree of v</span></span><br><span class=\"line\">\t\t\ttable[degree] = v</span><br><span class=\"line\">\t\t\tv = v.right</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// make sure v is the minimal vertex</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> table[degree].value &lt; v.value &#123;</span><br><span class=\"line\">\t\t\t\ttable[degree], v = v, table[degree]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// merge table[degree] to v as his child</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// make v become root</span></span><br><span class=\"line\">\t\t\ttable[degree] = F.extractVertex(table[degree])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> v.child == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\tv.child = table[degree]</span><br><span class=\"line\">\t\t\t\ttable[degree].parent = v</span><br><span class=\"line\">\t\t\t\tv.degree++</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//v.degree has been increased in this function</span></span><br><span class=\"line\">\t\t\t\tF.insertToList(v.child, table[degree])</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\ttable[degree] = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tdegree = v.degree</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// find the min</span></span><br><span class=\"line\">\tF.min = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, v := <span class=\"keyword\">range</span> table &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> v == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">continue</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> F.min == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tF.min = v</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> v.value &lt; F.min.value &#123;</span><br><span class=\"line\">\t\t\tF.min = v</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>参考</p>\n<ul>\n<li><a href=\"https://www.roading.org/algorithm/introductiontoalgorithm/斐波那契堆fibonacci-heaps.html\" target=\"_blank\" rel=\"noopener\">https://www.roading.org/algorithm/introductiontoalgorithm/斐波那契堆fibonacci-heaps.html</a></li>\n<li><a href=\"http://www.cnblogs.com/skywang12345/p/3659060.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/skywang12345/p/3659060.html</a></li>\n</ul>"},{"title":"体验I3之美","date":"2017-03-19T16:00:00.000Z","grammar_cjkRuby":true,"_content":"![enter description here][1]\n先晒张日常桌面图。Gnome3用了半年了一直被其蹩脚的交互和层出不穷的Bug所折磨。虽然Gnome3很漂亮，很简洁，但是毕竟漂亮不能当饭吃。套餐这种东西虽然简单省事，但是终究不是为你所量身定制的，总有其中一样不合你口味。因此，我决定再次抛弃“开箱即用”的DE(Desktop Environment)，在WM(Window Manager)的基础上自己打造一套适合自己的桌面环境。\n<!-- more -->\n## i3WM\ni3是一个比较知名的平铺式的窗口管理器（TilingWM），它可以通过快捷键来管理程序窗口，使他们像截图那样平铺在显示屏幕，控制他们的大小和位置。十分高效也有几分Geek的味道。  \ni3的所有配置全部使用shell写成，甚至顶部panel的各种指示器，都由用户自己写的bash脚本获得并显示。十分简单暴力。虽然没有图形界面那么直观，但是有一种一切尽在自己掌控之下的感觉。这种感觉其实是十分十分不错的。  \n我的I3WM配置文件托管在了[Github][2]。\n## 配置细节\nI3配置文件的语法其实跟shell差不多，熟悉Linux的用户应该都能完全看懂。我的配置文件分为几大模块：\n### Workspaces\n工作区配置，我根据日常使用的程序类别一共设置了10个工作区(图标显示需要在本地电脑上安装Fontawesome字体）：\n```bash\nset $ws1 \t     \"1: Browser\"\nset $ws2         \"2: Code\"\nset $ws3 \t\t \"3: Chat\"\nset $ws4 \t\t \"4: File\"\nset $ws5 \t\t \"5: Terminal\"\nset $ws6 \t\t \"6: Video\"\nset $ws7 \t     \"7: Music\"\nset $ws8  \t     \"8:  Graphic\"\nset $ws9 \t\t \"9: Game\"\nset $ws0 \t\t \"0: Fullscreen\"\n```\n然后，把属于各自类别的程序绑定到对应的工作区，这样打开这些程序的时候他们就能自动出现在合适的工作区了：\n```bash\nassign \t[class=\"google-chrome-stable\"] \t\t\t$ws1   # Browser\nassign \t[class=\"vivaldi\"] \t\t\t\t\t\t            $ws1   # Browser\nassign \t[class=\"firefox\"] \t\t\t\t\t            \t$ws1   # Browser\nassign  [class=\"(?i)code\"]                                $ws2   # Code IDE\n# ...\nassign  [class=\"dota2\"]         \t\t                   $ws0   # Fullscreen\nassign\t[class=\"Minecraft 1.8.9\"]\t\t              $ws0   # Fullscreen\n```\n### Application\n在i3配置文件里面我们可以对常用的程序绑定快捷启动键：\n```bash\nbindsym F10 exec xfce4-appfinder\nbindsym Print exec xfce4-screenshooter\n\n# bindsym $mod+Return exec i3-sensible-terminal\nbindsym $mod+Return exec pantheon-terminal\n\nbindsym $mod+Control+t exec telegram-desktop\nbindsym $mod+Control+g exec google-chrome-stable\nbindsym $mod+Control+v exec vivaldi\nbindsym $mod+Control+f exec nemo\nbindsym $mod+Control+c exec code\nbindsym $mod+Control+n exec nitrogen\nbindsym $mod+Control+w exec electronic-wechat\nbindsym $mod+Control+y exec youdao-dict\n```\n然后，对于特殊的不适合平铺的窗口，可以直接设置它们为浮动窗口：\n```bash\nfor_window [class=\"Geany\"] floating enable border normal\nfor_window [class=\"GParted\"] floating enable border normal\nfor_window [class=\"Nitrogen\"] floating enable border normal\nfor_window [class=\"(?i)virtualbox\"] floating enable border normal\nfor_window [class=\"Youdao Dict\"] floating enable border normal\n# ...\n```\nPS：可以使用`xprop|grep WM_CLASS`来查看正在运行窗口的class名称。\n### i3blocks\ni3blocks是I3顶部面板的一个可选组件。它使用ini格式的配置文件，支持多种终端脚本，还支持鼠标点击、滚动事件，十分强大。配置文件样本如下：\n```ini\ncommand=~/.config/i3/blocks/$BLOCK_NAME\nalign=center\ncolor=#ffffff\nseparator=true\nseparator_block_width=13\nmarkup=pango\n\n[disk-home]\nlabel=\ncommand=~/.config/i3/blocks/disk $HOME\ninstance=/home/kevin\ninterval=30\ncolor=#FFCC80\n\n[weather]\ninstance=1808926 # hangzhou's city code\ninterval=60\ncolor=#90CAF9\n\n# ...\n```\n主要字段解释：\n- 首先前面无section的parameters属于默认配置项，为每个section的缺省配置。  \n- 然后每个section都对应顶栏上面的一个指示器，称为block。  \n- 每个block必须显示一定的数据，可以通过command配置项指定获取数据的命令，并使用interval来设置命令执行周期间隔。\n- instance为可以传递到command脚本中的环境变量。\n- color和label为颜色和标签，属于修饰性的配置项。\n\n所有可用的block命令可以参考我的配置文件夹：[blocks][3]\n\n### compton\ncompton可以给i3带来透明和阴影效果的支持。如果只关心性能而不介意美观与否，你完全可以跳过此节。\ncompton默认是不给顶栏加透明效果的，需要加入如下配置：\n```\nwintypes:\n{\n    dock = \n    { \n        opacity = 0.8;        \n    };\n};\n```\n同时，compton的阴影效果不适用于某些窗口，需要排除它们：\n```\nshadow-exclude = [\n    \"name = 'Notification'\",\n    \"name *= 'compton'\",\n    \"class_g = 'Conky'\",\n    \"class_g = 'Firefox'\",\n    \"class_g *= 'fcitx'\",\n    \"class_g = 'Youdao Dict'\"\n];\n```\n## 易用性建议\ni3WM只是一个地基，我们可以在这之上搭建一个适合自己的环境。每个人的口味都不一样，所以我简单的罗列一下我个人比较喜欢的应用和配置以供参考。\n- dmenu: WM下使用最广泛的应用启动器，可以自动根据用户输入的命令进行提示。\n- rofi: dmenu的替代品\n- quickswitch.py:  跨工作区窗口快速跳转工具，可以整合到dmenu中。\n-  xfce4-appfinder:  xfce4的应用程序列表。能够自动搜索文件系统中的desktop文件，并生成应用列表。非常实用的工具。\n-  pantheon-terminal: elementaryOS的默认终端。小巧，依赖少，支持背景透明、多标签，很完美的终端模拟器。（需要使用dconf-editor来修改设置，位置：`/org/pantheon/terminal/settings/`）\n-  nemo: linuxmint的默认文件管理器，forks自nautilus，但是比nautilus好用得多。（使用之前需要使用dconf-editor设置`/org/nemo/desktop/show-desktop-icons`为`false`）\n-  nitrogen: 提供简单的图形界面来设置壁纸并在每次开机之后自动恢复。\n- clipit: 剪贴板支持\n- lightdm: 轻量级图形登录界面\n\n\n\n  [1]: https://ol1kreips.qnssl.com/%E6%88%AA%E5%9B%BE_2017-03-13_18-50-11.png \"截图_2017-03-13_18-50-11\"\n  [2]: https://github.com/stkevintan/i3dotfile\n  [3]: https://github.com/stkevintan/i3dotfile/tree/master/blocks","source":"_posts/beautifull-i3.md","raw":"---\ntitle:  体验I3之美\ncategories: [Linux]\ntags: [gnome,i3wm]\ndate: 2017-3-20\ngrammar_cjkRuby: true\n---\n![enter description here][1]\n先晒张日常桌面图。Gnome3用了半年了一直被其蹩脚的交互和层出不穷的Bug所折磨。虽然Gnome3很漂亮，很简洁，但是毕竟漂亮不能当饭吃。套餐这种东西虽然简单省事，但是终究不是为你所量身定制的，总有其中一样不合你口味。因此，我决定再次抛弃“开箱即用”的DE(Desktop Environment)，在WM(Window Manager)的基础上自己打造一套适合自己的桌面环境。\n<!-- more -->\n## i3WM\ni3是一个比较知名的平铺式的窗口管理器（TilingWM），它可以通过快捷键来管理程序窗口，使他们像截图那样平铺在显示屏幕，控制他们的大小和位置。十分高效也有几分Geek的味道。  \ni3的所有配置全部使用shell写成，甚至顶部panel的各种指示器，都由用户自己写的bash脚本获得并显示。十分简单暴力。虽然没有图形界面那么直观，但是有一种一切尽在自己掌控之下的感觉。这种感觉其实是十分十分不错的。  \n我的I3WM配置文件托管在了[Github][2]。\n## 配置细节\nI3配置文件的语法其实跟shell差不多，熟悉Linux的用户应该都能完全看懂。我的配置文件分为几大模块：\n### Workspaces\n工作区配置，我根据日常使用的程序类别一共设置了10个工作区(图标显示需要在本地电脑上安装Fontawesome字体）：\n```bash\nset $ws1 \t     \"1: Browser\"\nset $ws2         \"2: Code\"\nset $ws3 \t\t \"3: Chat\"\nset $ws4 \t\t \"4: File\"\nset $ws5 \t\t \"5: Terminal\"\nset $ws6 \t\t \"6: Video\"\nset $ws7 \t     \"7: Music\"\nset $ws8  \t     \"8:  Graphic\"\nset $ws9 \t\t \"9: Game\"\nset $ws0 \t\t \"0: Fullscreen\"\n```\n然后，把属于各自类别的程序绑定到对应的工作区，这样打开这些程序的时候他们就能自动出现在合适的工作区了：\n```bash\nassign \t[class=\"google-chrome-stable\"] \t\t\t$ws1   # Browser\nassign \t[class=\"vivaldi\"] \t\t\t\t\t\t            $ws1   # Browser\nassign \t[class=\"firefox\"] \t\t\t\t\t            \t$ws1   # Browser\nassign  [class=\"(?i)code\"]                                $ws2   # Code IDE\n# ...\nassign  [class=\"dota2\"]         \t\t                   $ws0   # Fullscreen\nassign\t[class=\"Minecraft 1.8.9\"]\t\t              $ws0   # Fullscreen\n```\n### Application\n在i3配置文件里面我们可以对常用的程序绑定快捷启动键：\n```bash\nbindsym F10 exec xfce4-appfinder\nbindsym Print exec xfce4-screenshooter\n\n# bindsym $mod+Return exec i3-sensible-terminal\nbindsym $mod+Return exec pantheon-terminal\n\nbindsym $mod+Control+t exec telegram-desktop\nbindsym $mod+Control+g exec google-chrome-stable\nbindsym $mod+Control+v exec vivaldi\nbindsym $mod+Control+f exec nemo\nbindsym $mod+Control+c exec code\nbindsym $mod+Control+n exec nitrogen\nbindsym $mod+Control+w exec electronic-wechat\nbindsym $mod+Control+y exec youdao-dict\n```\n然后，对于特殊的不适合平铺的窗口，可以直接设置它们为浮动窗口：\n```bash\nfor_window [class=\"Geany\"] floating enable border normal\nfor_window [class=\"GParted\"] floating enable border normal\nfor_window [class=\"Nitrogen\"] floating enable border normal\nfor_window [class=\"(?i)virtualbox\"] floating enable border normal\nfor_window [class=\"Youdao Dict\"] floating enable border normal\n# ...\n```\nPS：可以使用`xprop|grep WM_CLASS`来查看正在运行窗口的class名称。\n### i3blocks\ni3blocks是I3顶部面板的一个可选组件。它使用ini格式的配置文件，支持多种终端脚本，还支持鼠标点击、滚动事件，十分强大。配置文件样本如下：\n```ini\ncommand=~/.config/i3/blocks/$BLOCK_NAME\nalign=center\ncolor=#ffffff\nseparator=true\nseparator_block_width=13\nmarkup=pango\n\n[disk-home]\nlabel=\ncommand=~/.config/i3/blocks/disk $HOME\ninstance=/home/kevin\ninterval=30\ncolor=#FFCC80\n\n[weather]\ninstance=1808926 # hangzhou's city code\ninterval=60\ncolor=#90CAF9\n\n# ...\n```\n主要字段解释：\n- 首先前面无section的parameters属于默认配置项，为每个section的缺省配置。  \n- 然后每个section都对应顶栏上面的一个指示器，称为block。  \n- 每个block必须显示一定的数据，可以通过command配置项指定获取数据的命令，并使用interval来设置命令执行周期间隔。\n- instance为可以传递到command脚本中的环境变量。\n- color和label为颜色和标签，属于修饰性的配置项。\n\n所有可用的block命令可以参考我的配置文件夹：[blocks][3]\n\n### compton\ncompton可以给i3带来透明和阴影效果的支持。如果只关心性能而不介意美观与否，你完全可以跳过此节。\ncompton默认是不给顶栏加透明效果的，需要加入如下配置：\n```\nwintypes:\n{\n    dock = \n    { \n        opacity = 0.8;        \n    };\n};\n```\n同时，compton的阴影效果不适用于某些窗口，需要排除它们：\n```\nshadow-exclude = [\n    \"name = 'Notification'\",\n    \"name *= 'compton'\",\n    \"class_g = 'Conky'\",\n    \"class_g = 'Firefox'\",\n    \"class_g *= 'fcitx'\",\n    \"class_g = 'Youdao Dict'\"\n];\n```\n## 易用性建议\ni3WM只是一个地基，我们可以在这之上搭建一个适合自己的环境。每个人的口味都不一样，所以我简单的罗列一下我个人比较喜欢的应用和配置以供参考。\n- dmenu: WM下使用最广泛的应用启动器，可以自动根据用户输入的命令进行提示。\n- rofi: dmenu的替代品\n- quickswitch.py:  跨工作区窗口快速跳转工具，可以整合到dmenu中。\n-  xfce4-appfinder:  xfce4的应用程序列表。能够自动搜索文件系统中的desktop文件，并生成应用列表。非常实用的工具。\n-  pantheon-terminal: elementaryOS的默认终端。小巧，依赖少，支持背景透明、多标签，很完美的终端模拟器。（需要使用dconf-editor来修改设置，位置：`/org/pantheon/terminal/settings/`）\n-  nemo: linuxmint的默认文件管理器，forks自nautilus，但是比nautilus好用得多。（使用之前需要使用dconf-editor设置`/org/nemo/desktop/show-desktop-icons`为`false`）\n-  nitrogen: 提供简单的图形界面来设置壁纸并在每次开机之后自动恢复。\n- clipit: 剪贴板支持\n- lightdm: 轻量级图形登录界面\n\n\n\n  [1]: https://ol1kreips.qnssl.com/%E6%88%AA%E5%9B%BE_2017-03-13_18-50-11.png \"截图_2017-03-13_18-50-11\"\n  [2]: https://github.com/stkevintan/i3dotfile\n  [3]: https://github.com/stkevintan/i3dotfile/tree/master/blocks","slug":"beautifull-i3","published":1,"updated":"2019-10-11T05:50:15.654Z","_id":"cj1q5qb6o0000oqgxmben6x83","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"https://ol1kreips.qnssl.com/%E6%88%AA%E5%9B%BE_2017-03-13_18-50-11.png\" alt=\"enter description here\" title=\"截图_2017-03-13_18-50-11\"><br>先晒张日常桌面图。Gnome3用了半年了一直被其蹩脚的交互和层出不穷的Bug所折磨。虽然Gnome3很漂亮，很简洁，但是毕竟漂亮不能当饭吃。套餐这种东西虽然简单省事，但是终究不是为你所量身定制的，总有其中一样不合你口味。因此，我决定再次抛弃“开箱即用”的DE(Desktop Environment)，在WM(Window Manager)的基础上自己打造一套适合自己的桌面环境。<br><a id=\"more\"></a></p>\n<h2 id=\"i3WM\"><a href=\"#i3WM\" class=\"headerlink\" title=\"i3WM\"></a>i3WM</h2><p>i3是一个比较知名的平铺式的窗口管理器（TilingWM），它可以通过快捷键来管理程序窗口，使他们像截图那样平铺在显示屏幕，控制他们的大小和位置。十分高效也有几分Geek的味道。<br>i3的所有配置全部使用shell写成，甚至顶部panel的各种指示器，都由用户自己写的bash脚本获得并显示。十分简单暴力。虽然没有图形界面那么直观，但是有一种一切尽在自己掌控之下的感觉。这种感觉其实是十分十分不错的。<br>我的I3WM配置文件托管在了<a href=\"https://github.com/stkevintan/i3dotfile\" target=\"_blank\" rel=\"noopener\">Github</a>。</p>\n<h2 id=\"配置细节\"><a href=\"#配置细节\" class=\"headerlink\" title=\"配置细节\"></a>配置细节</h2><p>I3配置文件的语法其实跟shell差不多，熟悉Linux的用户应该都能完全看懂。我的配置文件分为几大模块：</p>\n<h3 id=\"Workspaces\"><a href=\"#Workspaces\" class=\"headerlink\" title=\"Workspaces\"></a>Workspaces</h3><p>工作区配置，我根据日常使用的程序类别一共设置了10个工作区(图标显示需要在本地电脑上安装Fontawesome字体）：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws1</span> \t     <span class=\"string\">\"1: Browser\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws2</span>         <span class=\"string\">\"2: Code\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws3</span> \t\t <span class=\"string\">\"3: Chat\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws4</span> \t\t <span class=\"string\">\"4: File\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws5</span> \t\t <span class=\"string\">\"5: Terminal\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws6</span> \t\t <span class=\"string\">\"6: Video\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws7</span> \t     <span class=\"string\">\"7: Music\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws8</span>  \t     <span class=\"string\">\"8:  Graphic\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws9</span> \t\t <span class=\"string\">\"9: Game\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws0</span> \t\t <span class=\"string\">\"0: Fullscreen\"</span></span><br></pre></td></tr></table></figure></p>\n<p>然后，把属于各自类别的程序绑定到对应的工作区，这样打开这些程序的时候他们就能自动出现在合适的工作区了：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">assign \t[class=<span class=\"string\">\"google-chrome-stable\"</span>] \t\t\t<span class=\"variable\">$ws1</span>   <span class=\"comment\"># Browser</span></span><br><span class=\"line\">assign \t[class=<span class=\"string\">\"vivaldi\"</span>] \t\t\t\t\t\t            <span class=\"variable\">$ws1</span>   <span class=\"comment\"># Browser</span></span><br><span class=\"line\">assign \t[class=<span class=\"string\">\"firefox\"</span>] \t\t\t\t\t            \t<span class=\"variable\">$ws1</span>   <span class=\"comment\"># Browser</span></span><br><span class=\"line\">assign  [class=<span class=\"string\">\"(?i)code\"</span>]                                <span class=\"variable\">$ws2</span>   <span class=\"comment\"># Code IDE</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br><span class=\"line\">assign  [class=<span class=\"string\">\"dota2\"</span>]         \t\t                   <span class=\"variable\">$ws0</span>   <span class=\"comment\"># Fullscreen</span></span><br><span class=\"line\">assign\t[class=<span class=\"string\">\"Minecraft 1.8.9\"</span>]\t\t              <span class=\"variable\">$ws0</span>   <span class=\"comment\"># Fullscreen</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"Application\"><a href=\"#Application\" class=\"headerlink\" title=\"Application\"></a>Application</h3><p>在i3配置文件里面我们可以对常用的程序绑定快捷启动键：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bindsym F10 <span class=\"built_in\">exec</span> xfce4-appfinder</span><br><span class=\"line\">bindsym Print <span class=\"built_in\">exec</span> xfce4-screenshooter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># bindsym $mod+Return exec i3-sensible-terminal</span></span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Return <span class=\"built_in\">exec</span> pantheon-terminal</span><br><span class=\"line\"></span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+t <span class=\"built_in\">exec</span> telegram-desktop</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+g <span class=\"built_in\">exec</span> google-chrome-stable</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+v <span class=\"built_in\">exec</span> vivaldi</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+f <span class=\"built_in\">exec</span> nemo</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+c <span class=\"built_in\">exec</span> code</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+n <span class=\"built_in\">exec</span> nitrogen</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+w <span class=\"built_in\">exec</span> electronic-wechat</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+y <span class=\"built_in\">exec</span> youdao-dict</span><br></pre></td></tr></table></figure></p>\n<p>然后，对于特殊的不适合平铺的窗口，可以直接设置它们为浮动窗口：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for_window [class=<span class=\"string\">\"Geany\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"GParted\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"Nitrogen\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"(?i)virtualbox\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"Youdao Dict\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure></p>\n<p>PS：可以使用<code>xprop|grep WM_CLASS</code>来查看正在运行窗口的class名称。</p>\n<h3 id=\"i3blocks\"><a href=\"#i3blocks\" class=\"headerlink\" title=\"i3blocks\"></a>i3blocks</h3><p>i3blocks是I3顶部面板的一个可选组件。它使用ini格式的配置文件，支持多种终端脚本，还支持鼠标点击、滚动事件，十分强大。配置文件样本如下：<br><figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">command</span>=~/.config/i3/blocks/<span class=\"variable\">$BLOCK_NAME</span></span><br><span class=\"line\"><span class=\"attr\">align</span>=center</span><br><span class=\"line\"><span class=\"attr\">color</span>=<span class=\"comment\">#ffffff</span></span><br><span class=\"line\"><span class=\"attr\">separator</span>=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">separator_block_width</span>=<span class=\"number\">13</span></span><br><span class=\"line\"><span class=\"attr\">markup</span>=pango</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[disk-home]</span></span><br><span class=\"line\"><span class=\"attr\">label</span>=</span><br><span class=\"line\"><span class=\"attr\">command</span>=~/.config/i3/blocks/disk <span class=\"variable\">$HOME</span></span><br><span class=\"line\"><span class=\"attr\">instance</span>=/home/kevin</span><br><span class=\"line\"><span class=\"attr\">interval</span>=<span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">color</span>=<span class=\"comment\">#FFCC80</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[weather]</span></span><br><span class=\"line\"><span class=\"attr\">instance</span>=<span class=\"number\">1808926</span> <span class=\"comment\"># hangzhou's city code</span></span><br><span class=\"line\"><span class=\"attr\">interval</span>=<span class=\"number\">60</span></span><br><span class=\"line\"><span class=\"attr\">color</span>=<span class=\"comment\">#90CAF9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure></p>\n<p>主要字段解释：</p>\n<ul>\n<li>首先前面无section的parameters属于默认配置项，为每个section的缺省配置。  </li>\n<li>然后每个section都对应顶栏上面的一个指示器，称为block。  </li>\n<li>每个block必须显示一定的数据，可以通过command配置项指定获取数据的命令，并使用interval来设置命令执行周期间隔。</li>\n<li>instance为可以传递到command脚本中的环境变量。</li>\n<li>color和label为颜色和标签，属于修饰性的配置项。</li>\n</ul>\n<p>所有可用的block命令可以参考我的配置文件夹：<a href=\"https://github.com/stkevintan/i3dotfile/tree/master/blocks\" target=\"_blank\" rel=\"noopener\">blocks</a></p>\n<h3 id=\"compton\"><a href=\"#compton\" class=\"headerlink\" title=\"compton\"></a>compton</h3><p>compton可以给i3带来透明和阴影效果的支持。如果只关心性能而不介意美观与否，你完全可以跳过此节。<br>compton默认是不给顶栏加透明效果的，需要加入如下配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wintypes:</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    dock = </span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">        opacity = 0.8;        </span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>同时，compton的阴影效果不适用于某些窗口，需要排除它们：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shadow-exclude = [</span><br><span class=\"line\">    &quot;name = &apos;Notification&apos;&quot;,</span><br><span class=\"line\">    &quot;name *= &apos;compton&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g = &apos;Conky&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g = &apos;Firefox&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g *= &apos;fcitx&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g = &apos;Youdao Dict&apos;&quot;</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"易用性建议\"><a href=\"#易用性建议\" class=\"headerlink\" title=\"易用性建议\"></a>易用性建议</h2><p>i3WM只是一个地基，我们可以在这之上搭建一个适合自己的环境。每个人的口味都不一样，所以我简单的罗列一下我个人比较喜欢的应用和配置以供参考。</p>\n<ul>\n<li>dmenu: WM下使用最广泛的应用启动器，可以自动根据用户输入的命令进行提示。</li>\n<li>rofi: dmenu的替代品</li>\n<li>quickswitch.py:  跨工作区窗口快速跳转工具，可以整合到dmenu中。</li>\n<li>xfce4-appfinder:  xfce4的应用程序列表。能够自动搜索文件系统中的desktop文件，并生成应用列表。非常实用的工具。</li>\n<li>pantheon-terminal: elementaryOS的默认终端。小巧，依赖少，支持背景透明、多标签，很完美的终端模拟器。（需要使用dconf-editor来修改设置，位置：<code>/org/pantheon/terminal/settings/</code>）</li>\n<li>nemo: linuxmint的默认文件管理器，forks自nautilus，但是比nautilus好用得多。（使用之前需要使用dconf-editor设置<code>/org/nemo/desktop/show-desktop-icons</code>为<code>false</code>）</li>\n<li>nitrogen: 提供简单的图形界面来设置壁纸并在每次开机之后自动恢复。</li>\n<li>clipit: 剪贴板支持</li>\n<li>lightdm: 轻量级图形登录界面</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><img src=\"https://ol1kreips.qnssl.com/%E6%88%AA%E5%9B%BE_2017-03-13_18-50-11.png\" alt=\"enter description here\" title=\"截图_2017-03-13_18-50-11\"><br>先晒张日常桌面图。Gnome3用了半年了一直被其蹩脚的交互和层出不穷的Bug所折磨。虽然Gnome3很漂亮，很简洁，但是毕竟漂亮不能当饭吃。套餐这种东西虽然简单省事，但是终究不是为你所量身定制的，总有其中一样不合你口味。因此，我决定再次抛弃“开箱即用”的DE(Desktop Environment)，在WM(Window Manager)的基础上自己打造一套适合自己的桌面环境。<br>","more":"</p>\n<h2 id=\"i3WM\"><a href=\"#i3WM\" class=\"headerlink\" title=\"i3WM\"></a>i3WM</h2><p>i3是一个比较知名的平铺式的窗口管理器（TilingWM），它可以通过快捷键来管理程序窗口，使他们像截图那样平铺在显示屏幕，控制他们的大小和位置。十分高效也有几分Geek的味道。<br>i3的所有配置全部使用shell写成，甚至顶部panel的各种指示器，都由用户自己写的bash脚本获得并显示。十分简单暴力。虽然没有图形界面那么直观，但是有一种一切尽在自己掌控之下的感觉。这种感觉其实是十分十分不错的。<br>我的I3WM配置文件托管在了<a href=\"https://github.com/stkevintan/i3dotfile\" target=\"_blank\" rel=\"noopener\">Github</a>。</p>\n<h2 id=\"配置细节\"><a href=\"#配置细节\" class=\"headerlink\" title=\"配置细节\"></a>配置细节</h2><p>I3配置文件的语法其实跟shell差不多，熟悉Linux的用户应该都能完全看懂。我的配置文件分为几大模块：</p>\n<h3 id=\"Workspaces\"><a href=\"#Workspaces\" class=\"headerlink\" title=\"Workspaces\"></a>Workspaces</h3><p>工作区配置，我根据日常使用的程序类别一共设置了10个工作区(图标显示需要在本地电脑上安装Fontawesome字体）：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws1</span> \t     <span class=\"string\">\"1: Browser\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws2</span>         <span class=\"string\">\"2: Code\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws3</span> \t\t <span class=\"string\">\"3: Chat\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws4</span> \t\t <span class=\"string\">\"4: File\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws5</span> \t\t <span class=\"string\">\"5: Terminal\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws6</span> \t\t <span class=\"string\">\"6: Video\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws7</span> \t     <span class=\"string\">\"7: Music\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws8</span>  \t     <span class=\"string\">\"8:  Graphic\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws9</span> \t\t <span class=\"string\">\"9: Game\"</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> <span class=\"variable\">$ws0</span> \t\t <span class=\"string\">\"0: Fullscreen\"</span></span><br></pre></td></tr></table></figure></p>\n<p>然后，把属于各自类别的程序绑定到对应的工作区，这样打开这些程序的时候他们就能自动出现在合适的工作区了：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">assign \t[class=<span class=\"string\">\"google-chrome-stable\"</span>] \t\t\t<span class=\"variable\">$ws1</span>   <span class=\"comment\"># Browser</span></span><br><span class=\"line\">assign \t[class=<span class=\"string\">\"vivaldi\"</span>] \t\t\t\t\t\t            <span class=\"variable\">$ws1</span>   <span class=\"comment\"># Browser</span></span><br><span class=\"line\">assign \t[class=<span class=\"string\">\"firefox\"</span>] \t\t\t\t\t            \t<span class=\"variable\">$ws1</span>   <span class=\"comment\"># Browser</span></span><br><span class=\"line\">assign  [class=<span class=\"string\">\"(?i)code\"</span>]                                <span class=\"variable\">$ws2</span>   <span class=\"comment\"># Code IDE</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br><span class=\"line\">assign  [class=<span class=\"string\">\"dota2\"</span>]         \t\t                   <span class=\"variable\">$ws0</span>   <span class=\"comment\"># Fullscreen</span></span><br><span class=\"line\">assign\t[class=<span class=\"string\">\"Minecraft 1.8.9\"</span>]\t\t              <span class=\"variable\">$ws0</span>   <span class=\"comment\"># Fullscreen</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"Application\"><a href=\"#Application\" class=\"headerlink\" title=\"Application\"></a>Application</h3><p>在i3配置文件里面我们可以对常用的程序绑定快捷启动键：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bindsym F10 <span class=\"built_in\">exec</span> xfce4-appfinder</span><br><span class=\"line\">bindsym Print <span class=\"built_in\">exec</span> xfce4-screenshooter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># bindsym $mod+Return exec i3-sensible-terminal</span></span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Return <span class=\"built_in\">exec</span> pantheon-terminal</span><br><span class=\"line\"></span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+t <span class=\"built_in\">exec</span> telegram-desktop</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+g <span class=\"built_in\">exec</span> google-chrome-stable</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+v <span class=\"built_in\">exec</span> vivaldi</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+f <span class=\"built_in\">exec</span> nemo</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+c <span class=\"built_in\">exec</span> code</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+n <span class=\"built_in\">exec</span> nitrogen</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+w <span class=\"built_in\">exec</span> electronic-wechat</span><br><span class=\"line\">bindsym <span class=\"variable\">$mod</span>+Control+y <span class=\"built_in\">exec</span> youdao-dict</span><br></pre></td></tr></table></figure></p>\n<p>然后，对于特殊的不适合平铺的窗口，可以直接设置它们为浮动窗口：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for_window [class=<span class=\"string\">\"Geany\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"GParted\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"Nitrogen\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"(?i)virtualbox\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\">for_window [class=<span class=\"string\">\"Youdao Dict\"</span>] floating <span class=\"built_in\">enable</span> border normal</span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure></p>\n<p>PS：可以使用<code>xprop|grep WM_CLASS</code>来查看正在运行窗口的class名称。</p>\n<h3 id=\"i3blocks\"><a href=\"#i3blocks\" class=\"headerlink\" title=\"i3blocks\"></a>i3blocks</h3><p>i3blocks是I3顶部面板的一个可选组件。它使用ini格式的配置文件，支持多种终端脚本，还支持鼠标点击、滚动事件，十分强大。配置文件样本如下：<br><figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">command</span>=~/.config/i3/blocks/<span class=\"variable\">$BLOCK_NAME</span></span><br><span class=\"line\"><span class=\"attr\">align</span>=center</span><br><span class=\"line\"><span class=\"attr\">color</span>=<span class=\"comment\">#ffffff</span></span><br><span class=\"line\"><span class=\"attr\">separator</span>=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">separator_block_width</span>=<span class=\"number\">13</span></span><br><span class=\"line\"><span class=\"attr\">markup</span>=pango</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[disk-home]</span></span><br><span class=\"line\"><span class=\"attr\">label</span>=</span><br><span class=\"line\"><span class=\"attr\">command</span>=~/.config/i3/blocks/disk <span class=\"variable\">$HOME</span></span><br><span class=\"line\"><span class=\"attr\">instance</span>=/home/kevin</span><br><span class=\"line\"><span class=\"attr\">interval</span>=<span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">color</span>=<span class=\"comment\">#FFCC80</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[weather]</span></span><br><span class=\"line\"><span class=\"attr\">instance</span>=<span class=\"number\">1808926</span> <span class=\"comment\"># hangzhou's city code</span></span><br><span class=\"line\"><span class=\"attr\">interval</span>=<span class=\"number\">60</span></span><br><span class=\"line\"><span class=\"attr\">color</span>=<span class=\"comment\">#90CAF9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure></p>\n<p>主要字段解释：</p>\n<ul>\n<li>首先前面无section的parameters属于默认配置项，为每个section的缺省配置。  </li>\n<li>然后每个section都对应顶栏上面的一个指示器，称为block。  </li>\n<li>每个block必须显示一定的数据，可以通过command配置项指定获取数据的命令，并使用interval来设置命令执行周期间隔。</li>\n<li>instance为可以传递到command脚本中的环境变量。</li>\n<li>color和label为颜色和标签，属于修饰性的配置项。</li>\n</ul>\n<p>所有可用的block命令可以参考我的配置文件夹：<a href=\"https://github.com/stkevintan/i3dotfile/tree/master/blocks\" target=\"_blank\" rel=\"noopener\">blocks</a></p>\n<h3 id=\"compton\"><a href=\"#compton\" class=\"headerlink\" title=\"compton\"></a>compton</h3><p>compton可以给i3带来透明和阴影效果的支持。如果只关心性能而不介意美观与否，你完全可以跳过此节。<br>compton默认是不给顶栏加透明效果的，需要加入如下配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wintypes:</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    dock = </span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">        opacity = 0.8;        </span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>同时，compton的阴影效果不适用于某些窗口，需要排除它们：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shadow-exclude = [</span><br><span class=\"line\">    &quot;name = &apos;Notification&apos;&quot;,</span><br><span class=\"line\">    &quot;name *= &apos;compton&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g = &apos;Conky&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g = &apos;Firefox&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g *= &apos;fcitx&apos;&quot;,</span><br><span class=\"line\">    &quot;class_g = &apos;Youdao Dict&apos;&quot;</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"易用性建议\"><a href=\"#易用性建议\" class=\"headerlink\" title=\"易用性建议\"></a>易用性建议</h2><p>i3WM只是一个地基，我们可以在这之上搭建一个适合自己的环境。每个人的口味都不一样，所以我简单的罗列一下我个人比较喜欢的应用和配置以供参考。</p>\n<ul>\n<li>dmenu: WM下使用最广泛的应用启动器，可以自动根据用户输入的命令进行提示。</li>\n<li>rofi: dmenu的替代品</li>\n<li>quickswitch.py:  跨工作区窗口快速跳转工具，可以整合到dmenu中。</li>\n<li>xfce4-appfinder:  xfce4的应用程序列表。能够自动搜索文件系统中的desktop文件，并生成应用列表。非常实用的工具。</li>\n<li>pantheon-terminal: elementaryOS的默认终端。小巧，依赖少，支持背景透明、多标签，很完美的终端模拟器。（需要使用dconf-editor来修改设置，位置：<code>/org/pantheon/terminal/settings/</code>）</li>\n<li>nemo: linuxmint的默认文件管理器，forks自nautilus，但是比nautilus好用得多。（使用之前需要使用dconf-editor设置<code>/org/nemo/desktop/show-desktop-icons</code>为<code>false</code>）</li>\n<li>nitrogen: 提供简单的图形界面来设置壁纸并在每次开机之后自动恢复。</li>\n<li>clipit: 剪贴板支持</li>\n<li>lightdm: 轻量级图形登录界面</li>\n</ul>"},{"title":"GraphQL Learn (4) - Execution","date":"2017-08-14T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n经过验证，GraphQL查询由GraphQL服务器执行，然后返回一个与查询形状相同的结果，通常为JSON。\n\nGraphQL无法执行没有类型系统的查询，让我们使用类型系统例子来说明执行查询，这个例子是我们教程中使用的类型系统中的一部分：\n\n```graphql\ntype Query {\n  human(id: ID!): Human\n}\ntype Human {\n  name: String\n  appearsIn: [Episode]\n  starships: [Starship]\n}\nenum Episode {\n  NEWHOPE\n  EMPIRE\n  JEDI\n}\ntype Starship {\n  name: String\n}\n```\n<!--more-->\n为了解释执行查询语句时系统发生了什么，我们用下面的例子了跑一遍：\n\n```graphql\n# { \"graphiql\": true }\n{\n  human(id: 1002) {\n    name\n    appearsIn\n    starships {\n      name\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Han Solo\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"starships\": [\n        {\n          \"name\": \"Millenium Falcon\"\n        },\n        {\n          \"name\": \"Imperial shuttle\"\n        }\n      ]\n    }\n  }\n}\n```\n\n您可以将GraphQL查询中的每个字段视为返回下一个类型的类型函数或方法。 事实上，这正是GraphQL的工作原理。 每个类型的每个字段由GraphQL服务器开发人员提供的称为解析器 _resolver_ 的函数支持。 当一个字段被执行时，相应的解析器被调用以产生下一个值。\n\n如果一个字段产生一个标量值，如字符串或数字，则执行完成。 但是，如果一个字段产生一个对象值，则该查询将应用于他的子字段。 这样一直迭代到标量值。 GraphQL查询始终以标量值结束。\n\n\n\n## 根字段和解析器（Root fields & resolvers）\n\n每个GraphQL服务器的最顶层是一个特殊的类型，表示GraphQL API中所有可能入口点，通常称为根类型（Root type）或查询类型(Query type)。\n\n在这个例子中，我们的查询类型提供了一个接受参数`id` 的`human`字段。此字段的解析函数可能通过访问数据库来构造并返回一个`Human`对象。\n\n```js\nQuery: {\n  human(obj, args, context) {\n    return context.db.loadHumanByID(args.id).then(\n      userData => new Human(userData)\n    )\n  }\n}\n```\n该示例使用JavaScript编写，但是GraphQL服务器可以使用许多[不同的语言](http://graphql.org/code/)构建。 解析器函数接收三个参数：\n\n- `obj` 前一个对象，对于查询类型（Query type）中的字段来说不常用。\n- `args` GraphQL提供的参数。\n- `context` 提供给每个解析器并保存重要的上下文信息（如当前登录的用户、访问数据库）的值。\n## 异步解析器（Asynchronous resolvers）\n我们来仔细看看这个解析器函数发生了什么：\n```js\nhuman(obj, args, context) {\n  return context.db.loadHumanByID(args.id).then(\n    userData => new Human(userData)\n  )\n}\n```\n`context`用于提供对数据库的访问，通过GraphQL查询提供的参数`id`来向数据库查询数据。 由于数据库查询是异步操作，所以返回一个Promise。 在JavaScript中，Promises用于处理异步值，但是在许多语言中都存在相同的概念，通常称为 _Futures_ ， _Tasks_ 或 _Deferred_ 。 当数据库返回时，我们可以构造并返回一个新的 _Human_ 对象。\n\n另外，虽然解析器函数需要留意Promises的使用，但是GraphQL查询不会。 在执行期间，GraphQL将等待Promises/Futures和Tasks完成，然后继续，并以最佳并发方式执行此操作。\n\n\n\n## 微型解析器（Trivial resolvers）\n至此，我们已经得到了`Human`对象，GraphQL将在这个对象内所要求的字段中继续执行。\n\n```js\nHuman: {\n  name(obj, args, context) {\n    return obj.name\n  }\n}\n```\nGraphQL服务由类型系统组成，它能够帮助服务确定下一步做什么的。 即使在`human`字段返回之前，GraphQL知道下一步将是解决`Human`中的字段，因为类型系统告诉`human`字段将返回一个`Human`。\n\n上面代码中的名称解析是很直接的。 调用名称解析函数，然后obj参数来自于上一个字段返回的新的`Human`对象。 我们期望`Human`对象有一个`name`属性，我们可以直接读取并返回。\n\n实际上，许多GraphQL库可以让你省略这个简单的解决方案，一个约定：假如一个字段没有提供解析函数，那么应该读取和返回同名的属性。\n\n\n\n## 标量强转（Scalar coercion）\n当`name`字段正在解析时，`appearsIn`和`starships`字段也可以同时进行解析。 `appearsIn`字段也可以有一个微型解析器，但是让我们进一步了解一下：\n\n```js\nHuman: {\n  appearsIn(obj) {\n    return obj.appearsIn // returns [ 4, 5, 6 ]\n  }\n}\n```\n请注意，我们的类型系统声明`appearsIn`将返回一直枚举值中的一个，但此函数却返回数字！实际上，如果我们查看结果，我们将看到正在返回适当的枚举值。 这是怎么回事？\n\n这是标量强转的一个例子。 类型系统知道期望的类型并将解析器函数返回的值转换为API约定中的内容。 在例子中，我们的服务器上可能会定义一个Enum，它在内部使用数字比如4,5和6，但在GraphQL类型系统中将它们表示为枚举值。\n\n## 列表解析器（List resolvers）\n之前我们已经看到了`appearsIn`字段返回列表的情况，因为这是系统期望的类型，列表中的每个项将被被强转为对应的枚举类型。 当`starships`解析时会发生什么？\n\n```js\nHuman: {\n  starships(obj, args, context) {\n    return obj.starshipIDs.map(\n      id => context.db.loadStarshipByID(id).then(\n        shipData => new Starship(shipData)\n      )\n    )\n  }\n}\n```\n该字段的解析器不是单单返回一个Promise，它返回了一个Promises列表。 `Human`对象有他们驾驶的`Starships`的id列表，但是我们需要通过所有这些id来获得真正的`Starship`对象。\n\nGraphQL将在继续之前同时等待所有这些Promises，并且当剩下一个对象列表时，它将同时继续加载每个这些项目上的`name`字段。\n\n\n\n## 产出结果（Producing the result）\n当每个字段被解析时，结果值被放置到键值映射中，字段名称（或别名）作为键，解析出来的值作为值，这这过程从查询底部叶子节点的字段往上直到原始字段的根查询类型。 总而言之，它们产生一个镜像的原始查询结构，然后可以将其发送（通常为JSON）到请求的客户端。\n\n我们来看看最初的查询，看看这些解析函数如何产生一个结果：\n\n```graphql\n# { \"graphiql\": true }\n{\n  human(id: 1002) {\n    name\n    appearsIn\n    starships {\n      name\n    }\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Han Solo\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"starships\": [\n        {\n          \"name\": \"Millenium Falcon\"\n        },\n        {\n          \"name\": \"Imperial shuttle\"\n        }\n      ]\n    }\n  }\n}\n```\n\n","source":"_posts/GraphQL Learn (4) - Execution.md","raw":"---\ntitle: GraphQL Learn (4) - Execution \ncategories: [Web]\ndate: 2017-8-15\ntags: [GraphQL]\ngrammar_cjkRuby: true\n---\n\n经过验证，GraphQL查询由GraphQL服务器执行，然后返回一个与查询形状相同的结果，通常为JSON。\n\nGraphQL无法执行没有类型系统的查询，让我们使用类型系统例子来说明执行查询，这个例子是我们教程中使用的类型系统中的一部分：\n\n```graphql\ntype Query {\n  human(id: ID!): Human\n}\ntype Human {\n  name: String\n  appearsIn: [Episode]\n  starships: [Starship]\n}\nenum Episode {\n  NEWHOPE\n  EMPIRE\n  JEDI\n}\ntype Starship {\n  name: String\n}\n```\n<!--more-->\n为了解释执行查询语句时系统发生了什么，我们用下面的例子了跑一遍：\n\n```graphql\n# { \"graphiql\": true }\n{\n  human(id: 1002) {\n    name\n    appearsIn\n    starships {\n      name\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Han Solo\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"starships\": [\n        {\n          \"name\": \"Millenium Falcon\"\n        },\n        {\n          \"name\": \"Imperial shuttle\"\n        }\n      ]\n    }\n  }\n}\n```\n\n您可以将GraphQL查询中的每个字段视为返回下一个类型的类型函数或方法。 事实上，这正是GraphQL的工作原理。 每个类型的每个字段由GraphQL服务器开发人员提供的称为解析器 _resolver_ 的函数支持。 当一个字段被执行时，相应的解析器被调用以产生下一个值。\n\n如果一个字段产生一个标量值，如字符串或数字，则执行完成。 但是，如果一个字段产生一个对象值，则该查询将应用于他的子字段。 这样一直迭代到标量值。 GraphQL查询始终以标量值结束。\n\n\n\n## 根字段和解析器（Root fields & resolvers）\n\n每个GraphQL服务器的最顶层是一个特殊的类型，表示GraphQL API中所有可能入口点，通常称为根类型（Root type）或查询类型(Query type)。\n\n在这个例子中，我们的查询类型提供了一个接受参数`id` 的`human`字段。此字段的解析函数可能通过访问数据库来构造并返回一个`Human`对象。\n\n```js\nQuery: {\n  human(obj, args, context) {\n    return context.db.loadHumanByID(args.id).then(\n      userData => new Human(userData)\n    )\n  }\n}\n```\n该示例使用JavaScript编写，但是GraphQL服务器可以使用许多[不同的语言](http://graphql.org/code/)构建。 解析器函数接收三个参数：\n\n- `obj` 前一个对象，对于查询类型（Query type）中的字段来说不常用。\n- `args` GraphQL提供的参数。\n- `context` 提供给每个解析器并保存重要的上下文信息（如当前登录的用户、访问数据库）的值。\n## 异步解析器（Asynchronous resolvers）\n我们来仔细看看这个解析器函数发生了什么：\n```js\nhuman(obj, args, context) {\n  return context.db.loadHumanByID(args.id).then(\n    userData => new Human(userData)\n  )\n}\n```\n`context`用于提供对数据库的访问，通过GraphQL查询提供的参数`id`来向数据库查询数据。 由于数据库查询是异步操作，所以返回一个Promise。 在JavaScript中，Promises用于处理异步值，但是在许多语言中都存在相同的概念，通常称为 _Futures_ ， _Tasks_ 或 _Deferred_ 。 当数据库返回时，我们可以构造并返回一个新的 _Human_ 对象。\n\n另外，虽然解析器函数需要留意Promises的使用，但是GraphQL查询不会。 在执行期间，GraphQL将等待Promises/Futures和Tasks完成，然后继续，并以最佳并发方式执行此操作。\n\n\n\n## 微型解析器（Trivial resolvers）\n至此，我们已经得到了`Human`对象，GraphQL将在这个对象内所要求的字段中继续执行。\n\n```js\nHuman: {\n  name(obj, args, context) {\n    return obj.name\n  }\n}\n```\nGraphQL服务由类型系统组成，它能够帮助服务确定下一步做什么的。 即使在`human`字段返回之前，GraphQL知道下一步将是解决`Human`中的字段，因为类型系统告诉`human`字段将返回一个`Human`。\n\n上面代码中的名称解析是很直接的。 调用名称解析函数，然后obj参数来自于上一个字段返回的新的`Human`对象。 我们期望`Human`对象有一个`name`属性，我们可以直接读取并返回。\n\n实际上，许多GraphQL库可以让你省略这个简单的解决方案，一个约定：假如一个字段没有提供解析函数，那么应该读取和返回同名的属性。\n\n\n\n## 标量强转（Scalar coercion）\n当`name`字段正在解析时，`appearsIn`和`starships`字段也可以同时进行解析。 `appearsIn`字段也可以有一个微型解析器，但是让我们进一步了解一下：\n\n```js\nHuman: {\n  appearsIn(obj) {\n    return obj.appearsIn // returns [ 4, 5, 6 ]\n  }\n}\n```\n请注意，我们的类型系统声明`appearsIn`将返回一直枚举值中的一个，但此函数却返回数字！实际上，如果我们查看结果，我们将看到正在返回适当的枚举值。 这是怎么回事？\n\n这是标量强转的一个例子。 类型系统知道期望的类型并将解析器函数返回的值转换为API约定中的内容。 在例子中，我们的服务器上可能会定义一个Enum，它在内部使用数字比如4,5和6，但在GraphQL类型系统中将它们表示为枚举值。\n\n## 列表解析器（List resolvers）\n之前我们已经看到了`appearsIn`字段返回列表的情况，因为这是系统期望的类型，列表中的每个项将被被强转为对应的枚举类型。 当`starships`解析时会发生什么？\n\n```js\nHuman: {\n  starships(obj, args, context) {\n    return obj.starshipIDs.map(\n      id => context.db.loadStarshipByID(id).then(\n        shipData => new Starship(shipData)\n      )\n    )\n  }\n}\n```\n该字段的解析器不是单单返回一个Promise，它返回了一个Promises列表。 `Human`对象有他们驾驶的`Starships`的id列表，但是我们需要通过所有这些id来获得真正的`Starship`对象。\n\nGraphQL将在继续之前同时等待所有这些Promises，并且当剩下一个对象列表时，它将同时继续加载每个这些项目上的`name`字段。\n\n\n\n## 产出结果（Producing the result）\n当每个字段被解析时，结果值被放置到键值映射中，字段名称（或别名）作为键，解析出来的值作为值，这这过程从查询底部叶子节点的字段往上直到原始字段的根查询类型。 总而言之，它们产生一个镜像的原始查询结构，然后可以将其发送（通常为JSON）到请求的客户端。\n\n我们来看看最初的查询，看看这些解析函数如何产生一个结果：\n\n```graphql\n# { \"graphiql\": true }\n{\n  human(id: 1002) {\n    name\n    appearsIn\n    starships {\n      name\n    }\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Han Solo\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"starships\": [\n        {\n          \"name\": \"Millenium Falcon\"\n        },\n        {\n          \"name\": \"Imperial shuttle\"\n        }\n      ]\n    }\n  }\n}\n```\n\n","slug":"GraphQL Learn (4) - Execution","published":1,"updated":"2019-10-11T05:50:15.638Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck1lqzyf60000egqq5lsl9yev","content":"<p>经过验证，GraphQL查询由GraphQL服务器执行，然后返回一个与查询形状相同的结果，通常为JSON。</p>\n<p>GraphQL无法执行没有类型系统的查询，让我们使用类型系统例子来说明执行查询，这个例子是我们教程中使用的类型系统中的一部分：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Query &#123;</span><br><span class=\"line\">  human(id: ID!): Human</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">type Human &#123;</span><br><span class=\"line\">  name: String</span><br><span class=\"line\">  appearsIn: [Episode]</span><br><span class=\"line\">  starships: [Starship]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">enum Episode &#123;</span><br><span class=\"line\">  NEWHOPE</span><br><span class=\"line\">  EMPIRE</span><br><span class=\"line\">  JEDI</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">type Starship &#123;</span><br><span class=\"line\">  name: String</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>为了解释执行查询语句时系统发生了什么，我们用下面的例子了跑一遍：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: 1002) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">    starships &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"starships\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Millenium Falcon\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Imperial shuttle\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>您可以将GraphQL查询中的每个字段视为返回下一个类型的类型函数或方法。 事实上，这正是GraphQL的工作原理。 每个类型的每个字段由GraphQL服务器开发人员提供的称为解析器 <em>resolver</em> 的函数支持。 当一个字段被执行时，相应的解析器被调用以产生下一个值。</p>\n<p>如果一个字段产生一个标量值，如字符串或数字，则执行完成。 但是，如果一个字段产生一个对象值，则该查询将应用于他的子字段。 这样一直迭代到标量值。 GraphQL查询始终以标量值结束。</p>\n<h2 id=\"根字段和解析器（Root-fields-amp-resolvers）\"><a href=\"#根字段和解析器（Root-fields-amp-resolvers）\" class=\"headerlink\" title=\"根字段和解析器（Root fields &amp; resolvers）\"></a>根字段和解析器（Root fields &amp; resolvers）</h2><p>每个GraphQL服务器的最顶层是一个特殊的类型，表示GraphQL API中所有可能入口点，通常称为根类型（Root type）或查询类型(Query type)。</p>\n<p>在这个例子中，我们的查询类型提供了一个接受参数<code>id</code> 的<code>human</code>字段。此字段的解析函数可能通过访问数据库来构造并返回一个<code>Human</code>对象。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Query: &#123;</span><br><span class=\"line\">  human(obj, args, context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> context.db.loadHumanByID(args.id).then(</span><br><span class=\"line\">      userData =&gt; <span class=\"keyword\">new</span> Human(userData)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该示例使用JavaScript编写，但是GraphQL服务器可以使用许多<a href=\"http://graphql.org/code/\" target=\"_blank\" rel=\"noopener\">不同的语言</a>构建。 解析器函数接收三个参数：</p>\n<ul>\n<li><code>obj</code> 前一个对象，对于查询类型（Query type）中的字段来说不常用。</li>\n<li><code>args</code> GraphQL提供的参数。</li>\n<li><code>context</code> 提供给每个解析器并保存重要的上下文信息（如当前登录的用户、访问数据库）的值。<h2 id=\"异步解析器（Asynchronous-resolvers）\"><a href=\"#异步解析器（Asynchronous-resolvers）\" class=\"headerlink\" title=\"异步解析器（Asynchronous resolvers）\"></a>异步解析器（Asynchronous resolvers）</h2>我们来仔细看看这个解析器函数发生了什么：<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">human(obj, args, context) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> context.db.loadHumanByID(args.id).then(</span><br><span class=\"line\">    userData =&gt; <span class=\"keyword\">new</span> Human(userData)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><code>context</code>用于提供对数据库的访问，通过GraphQL查询提供的参数<code>id</code>来向数据库查询数据。 由于数据库查询是异步操作，所以返回一个Promise。 在JavaScript中，Promises用于处理异步值，但是在许多语言中都存在相同的概念，通常称为 <em>Futures</em> ， <em>Tasks</em> 或 <em>Deferred</em> 。 当数据库返回时，我们可以构造并返回一个新的 <em>Human</em> 对象。</p>\n<p>另外，虽然解析器函数需要留意Promises的使用，但是GraphQL查询不会。 在执行期间，GraphQL将等待Promises/Futures和Tasks完成，然后继续，并以最佳并发方式执行此操作。</p>\n<h2 id=\"微型解析器（Trivial-resolvers）\"><a href=\"#微型解析器（Trivial-resolvers）\" class=\"headerlink\" title=\"微型解析器（Trivial resolvers）\"></a>微型解析器（Trivial resolvers）</h2><p>至此，我们已经得到了<code>Human</code>对象，GraphQL将在这个对象内所要求的字段中继续执行。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Human: &#123;</span><br><span class=\"line\">  name(obj, args, context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj.name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>GraphQL服务由类型系统组成，它能够帮助服务确定下一步做什么的。 即使在<code>human</code>字段返回之前，GraphQL知道下一步将是解决<code>Human</code>中的字段，因为类型系统告诉<code>human</code>字段将返回一个<code>Human</code>。</p>\n<p>上面代码中的名称解析是很直接的。 调用名称解析函数，然后obj参数来自于上一个字段返回的新的<code>Human</code>对象。 我们期望<code>Human</code>对象有一个<code>name</code>属性，我们可以直接读取并返回。</p>\n<p>实际上，许多GraphQL库可以让你省略这个简单的解决方案，一个约定：假如一个字段没有提供解析函数，那么应该读取和返回同名的属性。</p>\n<h2 id=\"标量强转（Scalar-coercion）\"><a href=\"#标量强转（Scalar-coercion）\" class=\"headerlink\" title=\"标量强转（Scalar coercion）\"></a>标量强转（Scalar coercion）</h2><p>当<code>name</code>字段正在解析时，<code>appearsIn</code>和<code>starships</code>字段也可以同时进行解析。 <code>appearsIn</code>字段也可以有一个微型解析器，但是让我们进一步了解一下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Human: &#123;</span><br><span class=\"line\">  appearsIn(obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj.appearsIn <span class=\"comment\">// returns [ 4, 5, 6 ]</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请注意，我们的类型系统声明<code>appearsIn</code>将返回一直枚举值中的一个，但此函数却返回数字！实际上，如果我们查看结果，我们将看到正在返回适当的枚举值。 这是怎么回事？</p>\n<p>这是标量强转的一个例子。 类型系统知道期望的类型并将解析器函数返回的值转换为API约定中的内容。 在例子中，我们的服务器上可能会定义一个Enum，它在内部使用数字比如4,5和6，但在GraphQL类型系统中将它们表示为枚举值。</p>\n<h2 id=\"列表解析器（List-resolvers）\"><a href=\"#列表解析器（List-resolvers）\" class=\"headerlink\" title=\"列表解析器（List resolvers）\"></a>列表解析器（List resolvers）</h2><p>之前我们已经看到了<code>appearsIn</code>字段返回列表的情况，因为这是系统期望的类型，列表中的每个项将被被强转为对应的枚举类型。 当<code>starships</code>解析时会发生什么？</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Human: &#123;</span><br><span class=\"line\">  starships(obj, args, context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj.starshipIDs.map(</span><br><span class=\"line\">      id =&gt; context.db.loadStarshipByID(id).then(</span><br><span class=\"line\">        shipData =&gt; <span class=\"keyword\">new</span> Starship(shipData)</span><br><span class=\"line\">      )</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该字段的解析器不是单单返回一个Promise，它返回了一个Promises列表。 <code>Human</code>对象有他们驾驶的<code>Starships</code>的id列表，但是我们需要通过所有这些id来获得真正的<code>Starship</code>对象。</p>\n<p>GraphQL将在继续之前同时等待所有这些Promises，并且当剩下一个对象列表时，它将同时继续加载每个这些项目上的<code>name</code>字段。</p>\n<h2 id=\"产出结果（Producing-the-result）\"><a href=\"#产出结果（Producing-the-result）\" class=\"headerlink\" title=\"产出结果（Producing the result）\"></a>产出结果（Producing the result）</h2><p>当每个字段被解析时，结果值被放置到键值映射中，字段名称（或别名）作为键，解析出来的值作为值，这这过程从查询底部叶子节点的字段往上直到原始字段的根查询类型。 总而言之，它们产生一个镜像的原始查询结构，然后可以将其发送（通常为JSON）到请求的客户端。</p>\n<p>我们来看看最初的查询，看看这些解析函数如何产生一个结果：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: 1002) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">    starships &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"starships\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Millenium Falcon\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Imperial shuttle\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>经过验证，GraphQL查询由GraphQL服务器执行，然后返回一个与查询形状相同的结果，通常为JSON。</p>\n<p>GraphQL无法执行没有类型系统的查询，让我们使用类型系统例子来说明执行查询，这个例子是我们教程中使用的类型系统中的一部分：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Query &#123;</span><br><span class=\"line\">  human(id: ID!): Human</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">type Human &#123;</span><br><span class=\"line\">  name: String</span><br><span class=\"line\">  appearsIn: [Episode]</span><br><span class=\"line\">  starships: [Starship]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">enum Episode &#123;</span><br><span class=\"line\">  NEWHOPE</span><br><span class=\"line\">  EMPIRE</span><br><span class=\"line\">  JEDI</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">type Starship &#123;</span><br><span class=\"line\">  name: String</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","more":"<p>为了解释执行查询语句时系统发生了什么，我们用下面的例子了跑一遍：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: 1002) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">    starships &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"starships\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Millenium Falcon\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Imperial shuttle\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>您可以将GraphQL查询中的每个字段视为返回下一个类型的类型函数或方法。 事实上，这正是GraphQL的工作原理。 每个类型的每个字段由GraphQL服务器开发人员提供的称为解析器 <em>resolver</em> 的函数支持。 当一个字段被执行时，相应的解析器被调用以产生下一个值。</p>\n<p>如果一个字段产生一个标量值，如字符串或数字，则执行完成。 但是，如果一个字段产生一个对象值，则该查询将应用于他的子字段。 这样一直迭代到标量值。 GraphQL查询始终以标量值结束。</p>\n<h2 id=\"根字段和解析器（Root-fields-amp-resolvers）\"><a href=\"#根字段和解析器（Root-fields-amp-resolvers）\" class=\"headerlink\" title=\"根字段和解析器（Root fields &amp; resolvers）\"></a>根字段和解析器（Root fields &amp; resolvers）</h2><p>每个GraphQL服务器的最顶层是一个特殊的类型，表示GraphQL API中所有可能入口点，通常称为根类型（Root type）或查询类型(Query type)。</p>\n<p>在这个例子中，我们的查询类型提供了一个接受参数<code>id</code> 的<code>human</code>字段。此字段的解析函数可能通过访问数据库来构造并返回一个<code>Human</code>对象。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Query: &#123;</span><br><span class=\"line\">  human(obj, args, context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> context.db.loadHumanByID(args.id).then(</span><br><span class=\"line\">      userData =&gt; <span class=\"keyword\">new</span> Human(userData)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该示例使用JavaScript编写，但是GraphQL服务器可以使用许多<a href=\"http://graphql.org/code/\" target=\"_blank\" rel=\"noopener\">不同的语言</a>构建。 解析器函数接收三个参数：</p>\n<ul>\n<li><code>obj</code> 前一个对象，对于查询类型（Query type）中的字段来说不常用。</li>\n<li><code>args</code> GraphQL提供的参数。</li>\n<li><code>context</code> 提供给每个解析器并保存重要的上下文信息（如当前登录的用户、访问数据库）的值。<h2 id=\"异步解析器（Asynchronous-resolvers）\"><a href=\"#异步解析器（Asynchronous-resolvers）\" class=\"headerlink\" title=\"异步解析器（Asynchronous resolvers）\"></a>异步解析器（Asynchronous resolvers）</h2>我们来仔细看看这个解析器函数发生了什么：<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">human(obj, args, context) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> context.db.loadHumanByID(args.id).then(</span><br><span class=\"line\">    userData =&gt; <span class=\"keyword\">new</span> Human(userData)</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><code>context</code>用于提供对数据库的访问，通过GraphQL查询提供的参数<code>id</code>来向数据库查询数据。 由于数据库查询是异步操作，所以返回一个Promise。 在JavaScript中，Promises用于处理异步值，但是在许多语言中都存在相同的概念，通常称为 <em>Futures</em> ， <em>Tasks</em> 或 <em>Deferred</em> 。 当数据库返回时，我们可以构造并返回一个新的 <em>Human</em> 对象。</p>\n<p>另外，虽然解析器函数需要留意Promises的使用，但是GraphQL查询不会。 在执行期间，GraphQL将等待Promises/Futures和Tasks完成，然后继续，并以最佳并发方式执行此操作。</p>\n<h2 id=\"微型解析器（Trivial-resolvers）\"><a href=\"#微型解析器（Trivial-resolvers）\" class=\"headerlink\" title=\"微型解析器（Trivial resolvers）\"></a>微型解析器（Trivial resolvers）</h2><p>至此，我们已经得到了<code>Human</code>对象，GraphQL将在这个对象内所要求的字段中继续执行。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Human: &#123;</span><br><span class=\"line\">  name(obj, args, context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj.name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>GraphQL服务由类型系统组成，它能够帮助服务确定下一步做什么的。 即使在<code>human</code>字段返回之前，GraphQL知道下一步将是解决<code>Human</code>中的字段，因为类型系统告诉<code>human</code>字段将返回一个<code>Human</code>。</p>\n<p>上面代码中的名称解析是很直接的。 调用名称解析函数，然后obj参数来自于上一个字段返回的新的<code>Human</code>对象。 我们期望<code>Human</code>对象有一个<code>name</code>属性，我们可以直接读取并返回。</p>\n<p>实际上，许多GraphQL库可以让你省略这个简单的解决方案，一个约定：假如一个字段没有提供解析函数，那么应该读取和返回同名的属性。</p>\n<h2 id=\"标量强转（Scalar-coercion）\"><a href=\"#标量强转（Scalar-coercion）\" class=\"headerlink\" title=\"标量强转（Scalar coercion）\"></a>标量强转（Scalar coercion）</h2><p>当<code>name</code>字段正在解析时，<code>appearsIn</code>和<code>starships</code>字段也可以同时进行解析。 <code>appearsIn</code>字段也可以有一个微型解析器，但是让我们进一步了解一下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Human: &#123;</span><br><span class=\"line\">  appearsIn(obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj.appearsIn <span class=\"comment\">// returns [ 4, 5, 6 ]</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请注意，我们的类型系统声明<code>appearsIn</code>将返回一直枚举值中的一个，但此函数却返回数字！实际上，如果我们查看结果，我们将看到正在返回适当的枚举值。 这是怎么回事？</p>\n<p>这是标量强转的一个例子。 类型系统知道期望的类型并将解析器函数返回的值转换为API约定中的内容。 在例子中，我们的服务器上可能会定义一个Enum，它在内部使用数字比如4,5和6，但在GraphQL类型系统中将它们表示为枚举值。</p>\n<h2 id=\"列表解析器（List-resolvers）\"><a href=\"#列表解析器（List-resolvers）\" class=\"headerlink\" title=\"列表解析器（List resolvers）\"></a>列表解析器（List resolvers）</h2><p>之前我们已经看到了<code>appearsIn</code>字段返回列表的情况，因为这是系统期望的类型，列表中的每个项将被被强转为对应的枚举类型。 当<code>starships</code>解析时会发生什么？</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Human: &#123;</span><br><span class=\"line\">  starships(obj, args, context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj.starshipIDs.map(</span><br><span class=\"line\">      id =&gt; context.db.loadStarshipByID(id).then(</span><br><span class=\"line\">        shipData =&gt; <span class=\"keyword\">new</span> Starship(shipData)</span><br><span class=\"line\">      )</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该字段的解析器不是单单返回一个Promise，它返回了一个Promises列表。 <code>Human</code>对象有他们驾驶的<code>Starships</code>的id列表，但是我们需要通过所有这些id来获得真正的<code>Starship</code>对象。</p>\n<p>GraphQL将在继续之前同时等待所有这些Promises，并且当剩下一个对象列表时，它将同时继续加载每个这些项目上的<code>name</code>字段。</p>\n<h2 id=\"产出结果（Producing-the-result）\"><a href=\"#产出结果（Producing-the-result）\" class=\"headerlink\" title=\"产出结果（Producing the result）\"></a>产出结果（Producing the result）</h2><p>当每个字段被解析时，结果值被放置到键值映射中，字段名称（或别名）作为键，解析出来的值作为值，这这过程从查询底部叶子节点的字段往上直到原始字段的根查询类型。 总而言之，它们产生一个镜像的原始查询结构，然后可以将其发送（通常为JSON）到请求的客户端。</p>\n<p>我们来看看最初的查询，看看这些解析函数如何产生一个结果：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: 1002) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">    starships &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"starships\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Millenium Falcon\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Imperial shuttle\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"GraphQL Learn (1) - Queries and Mutations","date":"2017-08-14T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n在此页面上，你将详细了解如何查询GrahQL服务器。\n\n## 字段（Fields）\n最简单的，GraphQL是关于要求对象上的特定字段。我们先来看一个非常简单的查询，当我们运行它时得到结果：\n\n```graphql\n{\n  hero {\n    name\n  }\n}\n```\n```js\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\"\n    }\n  }\n}\n```\n可以看到，查询与结果的形状完全相同。这对于GraphQL是至关重要的，因为您总是收到您期望的内容，并且服务器确切知道客户端要求哪些字段。\n<!-- more -->\n字段名返回一个String类型，在这种情况下是星球大战主角“R2-D2”的名称。\n\n>哦，还有一件事: 上面的查询是互动的。这意味着您可以随意更改它，并看到新的结果。尝试在查询中向`hero`对象添加一个`appearIn`字段，并查看新结果。\n\n在前面的例子中，我们只是要求我们返回一个String类型的主角名字，但字段也可以引用对象。在这种情况下，您可以对该对象的字段进行子查询。 GraphQL查询可以遍历相关对象及其字段，让客户端在一个请求中获取大量相关数据，而不是像传统的REST架构中一样需要进行几次往返。\n\n```graphql\n{\n  hero {\n    name\n    # Queries can have comments!\n    friends {\n      name\n    }\n  }\n}\n```\n```js\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"friends\": [\n        {\n          \"name\": \"Luke Skywalker\"\n        },\n        {\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"name\": \"Leia Organa\"\n        }\n      ]\n    }\n  }\n}\n```\n请注意，在此示例中，`friends`字段返回一个项目数组。 GraphQL查询对于单个项或多个项列表写法上相同，但是我们根据schema中记录的内容知道预期获得的是哪一种。\n\n## 参数（Arguments）\n如果我们唯一可以做的是遍历对象及其字段，则GraphQL已经是数据提取的非常有用的语言。但是如果你还能将参数传递给字段的话，事情会变得更有趣。\n```graphql\n{\n  human(id: \"1000\") {\n    name\n    height\n  }\n}\n```\n```js\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Luke Skywalker\",\n      \"height\": 1.72\n    }\n  }\n}\n```\n在像REST这样的系统中，您只能传递一组参数(paramter和url query)。但是在GraphQL中，每个字段和嵌套对象都可以获取自己的参数集，从而使一次GraphQL查询可以完全代替多个传统的API请求。您甚至可以将参数传递到标量字段中并在服务器上实现数据转换，而不需要在客户端上进行。\n\n```graphql\n{\n  human(id: \"1000\") {\n    name\n    height(unit: FOOT)\n  }\n}\n```\n\n```js\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Luke Skywalker\",\n      \"height\": 5.6430448\n    }\n  }\n}\n```\n\n参数可以是很多不同的类型。在上面的例子中，我们使用了一个枚举类型，它表示一组有限的选项之一（在这种情况下是长度单位，METER或FOOT）。 GraphQL带有默认的类型，但是GraphQL服务器也可以声明自定义类型。只要能将它们序列化为可传输的格式。\n\n\n\n## 别名（Aliases）\n也许您已经注意到，相对应的结果字段名与查询字段名相同，但却不包括该字段的查询参数，因此您不能直接使用不同的参数查询相同的字段。这就是为什么你需要别名的原因。\n```graphql\n{\n  empireHero: hero(episode: EMPIRE) {\n    name\n  }\n  jediHero: hero(episode: JEDI) {\n    name\n  }\n}\n```\n\n```js\n{\n  \"data\": {\n    \"empireHero\": {\n      \"name\": \"Luke Skywalker\"\n    },\n    \"jediHero\": {\n      \"name\": \"R2-D2\"\n    }\n  }\n}\n```\n\n\n\n## 片段（Fragments）\n\n假设我们的应用中存在一个比较复杂的页面，可以一次性展示两个角色并列出他们的朋友信息。可以想象，这样一个查询可能会很快变得复杂，因为我们需要重复写角色字段至少两次。\n\n这就是为什么GraphQL包含“片段”这种可重用单元。片段让您构建一组字段，然后我们可以将它们包含在需要的查询中。以下是使用片段解决上述情况的示例：\n\n```graphql\n{\n  leftComparison: hero(episode: EMPIRE) {\n    ...comparisonFields\n  }\n  rightComparison: hero(episode: JEDI) {\n    ...comparisonFields\n  }\n}\n\nfragment comparisonFields on Character {\n  name\n  appearsIn\n  friends {\n    name\n  }\n}\n```\n\n```js\n\n{\n  \"data\": {\n    \"leftComparison\": {\n      \"name\": \"Luke Skywalker\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"friends\": [\n        {\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"name\": \"Leia Organa\"\n        },\n        {\n          \"name\": \"C-3PO\"\n        },\n        {\n          \"name\": \"R2-D2\"\n        }\n      ]\n    },\n    \"rightComparison\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"friends\": [\n        {\n          \"name\": \"Luke Skywalker\"\n        },\n        {\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"name\": \"Leia Organa\"\n        }\n      ]\n    }\n  }\n}\n```\n如果重复这些字段，您可以看到上述查询将如何重复。片段的概念经常用于将复杂的应用程序数据需求分解成更小的块，特别是当您需要将大量具有不同片段的UI组件合并到一个初始数据请求时。\n\n## 变量（variables）\n\n到目前为止，我们一直在查询字符串中写入所有的参数。 但在大多数应用程序中，字段的参数将是动态的：例如，可能会有一个下拉列表，您可以选择您感兴趣的星球大战插曲，或搜索字段或一组过滤器。\n\n在查询字符串中直接传递这些动态参数并不是一个好主意，因为我们的客户端代码需要在运行时动态地处理查询字符串，并将其序列化为特定于图形的格式。 相反，GraphQL具有将查询中的动态值参数化的一级方法(first-class way)，并将其作为单独的字典传递。 这些值称为 _变量_ 。\n\n当开始使用变量之时，我们需要做三件事情：\n\n1. 用`$variableName`替换查询语句中静态的值\n2. 声明`$variableName`为一个被查询语句接收的变量之一\n3. 将`$variableName: value`写入到一种传输专用的变量字典中(通常是JSON)，用来与查询语句分别传输到服务器上。\n\n整合后的结果：\n\n- query\n\n  ```graphql\n  query HeroNameAndFriends($episode: Episode) {\n    hero(episode: $episode) {\n      name\n      friends {\n        name\n      }\n    }\n  }\n  ```\n\n- variables\n\n  ```json\n  {\n    \"episode\": \"JEDI\"\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"hero\": {\n        \"name\": \"R2-D2\",\n        \"friends\": [\n          {\n            \"name\": \"Luke Skywalker\"\n          },\n          {\n            \"name\": \"Han Solo\"\n          },\n          {\n            \"name\": \"Leia Organa\"\n          }\n        ]\n      }\n    }\n  }\n  ```\n\n现在，在我们的客户端代码中，我们可以简单地传递一个不同的变量，而不需要构造一个全新的查询。 这通常也是一个好的做法，表示我们的查询中的哪些参数预期是动态的 - 我们不应该使用字符串插值来从用户提供的值构造查询。\n\n### 变量定义\n\n变量定义是上面查询中的（`$episode：Episode`）部分。 它的作用就像类型语言中函数的参数定义一样。 它列出所有变量，前缀为$，后跟其类型（当前为`Episode`）。\n\n所有声明的变量必须是标量，枚举或输入对象类型。 因此，如果要将复杂对象传递到字段中，则需要知道在服务器上匹配的输入类型。 在“架构”页面上了解有关输入对象类型的更多信息。\n\n变量定义可以是可选的或必需的。 在上面的情况下，因为没有！ 在Episode类型后面，所以它是可选的。 但是，如果要将变量传递给需要非空参数的字段，那么该变量也必须是必需的。\n\n要了解有关这些变量定义的语法的更多信息，学习GraphQL模式语言非常有用。 模式语言在Schema页面中有详细的说明。\n\n### 默认变量\n\n可以在变量的类型声明后面添加该变量的默认值\n\n```graphql\nquery HeroNameAndFriends($episode: Episode = \"JEDI\") {\n  hero(episode: $episode) {\n    name\n    friends {\n      name\n    }\n  }\n}\n```\n\n## 操作名（Operation  name）\n\n从上面的查询例子我们可以看到一个`HeroNameAndFriends`的操作名。但到目前为止，我们大部分是在速记语法，省略查询关键字和查询名称，但在生产中，这钟写法会使我们的代码不明确。\n\n想想这就像你最喜欢的编程语言中的函数名。 例如，在JavaScript中，我们可以轻松地使用匿名函数，但是当我们给一个函数一个名字时，跟踪它更容易，调试我们的代码，并在被调用时记录。 以同样的方式，GraphQL查询和变量名称以及片段名称可以作为服务器端的一个有用的调试工具来识别不同的GraphQL请求。\n\n## 指令（Directives）\n\n我们上面讨论了变量如何使我们避免进行手动字符串插值来构造动态查询。 在参数中传递变量解决了这些问题的一部分，但是我们也可能需要一种使用变量来动态地更改查询的结构和形状的方法。 例如，我们可以想象一个UI组件，它具有一个总结和详细的视图，其中一个包含比另一个更多的字段。让我们来为这样的组件构建一个查询语句：\n\n- query\n\n  ```graphql\n  query Hero($episode: Episode, $withFriends: Boolean!) {\n    hero(episode: $episode) {\n      name\n      friends @include(if: $withFriends) {\n        name\n      }\n    }\n  }\n  ```\n\n- variables\n\n  ```json\n  {\n    \"episode\": \"JEDI\",\n    \"withFriends\": false\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"hero\": {\n        \"name\": \"R2-D2\"\n      }\n    }\n  }\n  ```\n\n尝试编辑上面的变量（比如将`true`传给`withFriends`），看看结果如何变化。\n\n我们需要在GraphQL中使用一个新功能，称为一个指令。 一个指令可以附加到字段或片段包含，并且可以以服务器的任何方式影响查询的执行。 核心GraphQL规范仅包含两个指令，这些指令必须由任何符合规范的GraphQL服务器实现支持：\n\n- `@include(if: Boolean)` 仅当参数为`true`时返回结果才包括这个字段\n- `@skip(if: Boolean)` 当参数为`true`时跳过这个字段\n\n指令可用于摆脱需要执行字符串操作以在查询中添加和删除字段的情况。 服务器实现也可以通过定义全新的指令来添加实验功能。\n\n## 修改（Mutations）\n\n大多数关于GraphQL的讨论集中于数据获取，但是任何完整的数据平台也需要一种修改服务器端数据的方法。\n\n在REST中，任何请求可能会导致在服务器上造成一些副作用，但按照惯例，建议不要使用GET请求来修改数据。 GraphQL是类似的：技术上任何查询都可以被实现来进行数据写入。 但是，建立一个约定，任何导致写入的操作都应该通过修改操作显式发送。\n\n就像查询一样，如果修改字段返回一个对象类型，可以要求嵌套字段。 这可以在更新后获取对象的新状态。 我们来看一个简单的例子：\n\n- mutation\n\n  ```graphql\n  mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {\n    createReview(episode: $ep, review: $review) {\n      stars\n      commentary\n    }\n  }\n  ```\n\n- varialbes\n\n  ```json\n  {\n    \"ep\": \"JEDI\",\n    \"review\": {\n      \"stars\": 5,\n      \"commentary\": \"This is a great movie!\"\n    }\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"createReview\": {\n        \"stars\": 5,\n        \"commentary\": \"This is a great movie!\"\n      }\n    }\n  }\n  ```\n\n注意`createReview`字段是如何返回新创建的`review`中的`commentary`和`stars`字段的。 这在修改已有字段的时候尤其有用，例如，当增加一个字段时，我们可以通过一个请求来同时修改该字段并查询该字段的新值。\n\n您可能还会注意到，在本示例中，我们传入的评论变量不是标量。 它是一个输入对象类型，可以作为参数传入的特殊种类的对象类型。 详细了解“架构”页面上的输入类型。\n\n### 修改多个字段\n\n像查询操作一样，一个修改操作可以包含多个字段，但是两者之间有一个重大的差异：   \n\n__查询操作是并行的，而修改操作是串行的__\n\n这意味着，如果我们在一个修改操作中两次修改`incremenetCredits`字段的操作，第一个操作在保证结束后才会执行第二个操作。避免出现竞争情况。\n\n\n\n## 内联片段（inline Fragments）\n\n跟其他类型系统一样，GraphQL也可以定义接口（Interfaces）和联合类型（Union Types）。详情见schema guide\n\n你可以使用内联片段来访问一个接口或者联合类型中所包含的数据。用下面这个例子可以很方便的说明：\n\n- query\n\n  ```graphql\n  query HeroForEpisode($ep: Episode!) {\n    hero(episode: $ep) {\n      name\n      ... on Droid {\n        primaryFunction\n      }\n      ... on Human {\n        height\n      }\n    }\n  }\n  ```\n\n- variables\n\n  ```json\n  {\n    \"ep\": \"JEDI\"\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"hero\": {\n        \"name\": \"R2-D2\",\n        \"primaryFunction\": \"Astromech\"\n      }\n    }\n  }\n  ```\n\n在这个查询中，`hero`字段返回类型为`Character`，它可能是`Human`或`Droid`，这取决于参数`episode`。 在直接选择中，您只能访问`Character`接口中存在的字段，如`name`。\n\n要访问具体类型的字段，您需要使用特定类型（type condition）的内联片段。 第一个片段在`Droid`上被标记为`...`，所以只有当从`hero`返回的`Character`是`Droid`类型时，`primaryFunction`字段才会被执行。 类似于`Human`类型中的`height`字段。\n\n命名片段也可以以相同的方式使用，因为命名片段始终包含限定类型。\n\n### 元字段（Meta fields）\n\n鉴于有些情况下您不知道从GraphQL服务返回的类型，您需要一些方法来确定如何处理客户端上的数据。 GraphQL允许您在查询中的任何位置请求`__typename`，一个元字段，以获取该点上对象类型的名称。\n\n- query\n\n  ```graphql\n  {\n    search(text: \"an\") {\n      __typename\n      ... on Human {\n        name\n      }\n      ... on Droid {\n        name\n      }\n      ... on Starship {\n        name\n      }\n    }\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"search\": [\n        {\n          \"__typename\": \"Human\",\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"__typename\": \"Droid\",\n          \"name\": \"Leia Organa\"\n        },\n        {\n          \"__typename\": \"Starship\",\n          \"name\": \"TIE Advanced x1\"\n        }\n      ]\n    }\n  }\n  ```\n\n在上述查询中，`search`返回可以是三个选项之一的联合类型。 在没有`__typename`字段的情况下，不可能将客户端的不同类型告诉客户端。\n\nGraphQL服务提供了少量的元字段，其余的公开 于“内省”系统。","source":"_posts/GraphQL Learn (1) - Queries and Mutations.md","raw":"---\ntitle: GraphQL Learn (1) - Queries and Mutations\ntags: [GraphQL]\ncategories: [Web]\ndate: 2017-8-15\ngrammar_cjkRuby: true\n---\n\n在此页面上，你将详细了解如何查询GrahQL服务器。\n\n## 字段（Fields）\n最简单的，GraphQL是关于要求对象上的特定字段。我们先来看一个非常简单的查询，当我们运行它时得到结果：\n\n```graphql\n{\n  hero {\n    name\n  }\n}\n```\n```js\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\"\n    }\n  }\n}\n```\n可以看到，查询与结果的形状完全相同。这对于GraphQL是至关重要的，因为您总是收到您期望的内容，并且服务器确切知道客户端要求哪些字段。\n<!-- more -->\n字段名返回一个String类型，在这种情况下是星球大战主角“R2-D2”的名称。\n\n>哦，还有一件事: 上面的查询是互动的。这意味着您可以随意更改它，并看到新的结果。尝试在查询中向`hero`对象添加一个`appearIn`字段，并查看新结果。\n\n在前面的例子中，我们只是要求我们返回一个String类型的主角名字，但字段也可以引用对象。在这种情况下，您可以对该对象的字段进行子查询。 GraphQL查询可以遍历相关对象及其字段，让客户端在一个请求中获取大量相关数据，而不是像传统的REST架构中一样需要进行几次往返。\n\n```graphql\n{\n  hero {\n    name\n    # Queries can have comments!\n    friends {\n      name\n    }\n  }\n}\n```\n```js\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"friends\": [\n        {\n          \"name\": \"Luke Skywalker\"\n        },\n        {\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"name\": \"Leia Organa\"\n        }\n      ]\n    }\n  }\n}\n```\n请注意，在此示例中，`friends`字段返回一个项目数组。 GraphQL查询对于单个项或多个项列表写法上相同，但是我们根据schema中记录的内容知道预期获得的是哪一种。\n\n## 参数（Arguments）\n如果我们唯一可以做的是遍历对象及其字段，则GraphQL已经是数据提取的非常有用的语言。但是如果你还能将参数传递给字段的话，事情会变得更有趣。\n```graphql\n{\n  human(id: \"1000\") {\n    name\n    height\n  }\n}\n```\n```js\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Luke Skywalker\",\n      \"height\": 1.72\n    }\n  }\n}\n```\n在像REST这样的系统中，您只能传递一组参数(paramter和url query)。但是在GraphQL中，每个字段和嵌套对象都可以获取自己的参数集，从而使一次GraphQL查询可以完全代替多个传统的API请求。您甚至可以将参数传递到标量字段中并在服务器上实现数据转换，而不需要在客户端上进行。\n\n```graphql\n{\n  human(id: \"1000\") {\n    name\n    height(unit: FOOT)\n  }\n}\n```\n\n```js\n{\n  \"data\": {\n    \"human\": {\n      \"name\": \"Luke Skywalker\",\n      \"height\": 5.6430448\n    }\n  }\n}\n```\n\n参数可以是很多不同的类型。在上面的例子中，我们使用了一个枚举类型，它表示一组有限的选项之一（在这种情况下是长度单位，METER或FOOT）。 GraphQL带有默认的类型，但是GraphQL服务器也可以声明自定义类型。只要能将它们序列化为可传输的格式。\n\n\n\n## 别名（Aliases）\n也许您已经注意到，相对应的结果字段名与查询字段名相同，但却不包括该字段的查询参数，因此您不能直接使用不同的参数查询相同的字段。这就是为什么你需要别名的原因。\n```graphql\n{\n  empireHero: hero(episode: EMPIRE) {\n    name\n  }\n  jediHero: hero(episode: JEDI) {\n    name\n  }\n}\n```\n\n```js\n{\n  \"data\": {\n    \"empireHero\": {\n      \"name\": \"Luke Skywalker\"\n    },\n    \"jediHero\": {\n      \"name\": \"R2-D2\"\n    }\n  }\n}\n```\n\n\n\n## 片段（Fragments）\n\n假设我们的应用中存在一个比较复杂的页面，可以一次性展示两个角色并列出他们的朋友信息。可以想象，这样一个查询可能会很快变得复杂，因为我们需要重复写角色字段至少两次。\n\n这就是为什么GraphQL包含“片段”这种可重用单元。片段让您构建一组字段，然后我们可以将它们包含在需要的查询中。以下是使用片段解决上述情况的示例：\n\n```graphql\n{\n  leftComparison: hero(episode: EMPIRE) {\n    ...comparisonFields\n  }\n  rightComparison: hero(episode: JEDI) {\n    ...comparisonFields\n  }\n}\n\nfragment comparisonFields on Character {\n  name\n  appearsIn\n  friends {\n    name\n  }\n}\n```\n\n```js\n\n{\n  \"data\": {\n    \"leftComparison\": {\n      \"name\": \"Luke Skywalker\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"friends\": [\n        {\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"name\": \"Leia Organa\"\n        },\n        {\n          \"name\": \"C-3PO\"\n        },\n        {\n          \"name\": \"R2-D2\"\n        }\n      ]\n    },\n    \"rightComparison\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"friends\": [\n        {\n          \"name\": \"Luke Skywalker\"\n        },\n        {\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"name\": \"Leia Organa\"\n        }\n      ]\n    }\n  }\n}\n```\n如果重复这些字段，您可以看到上述查询将如何重复。片段的概念经常用于将复杂的应用程序数据需求分解成更小的块，特别是当您需要将大量具有不同片段的UI组件合并到一个初始数据请求时。\n\n## 变量（variables）\n\n到目前为止，我们一直在查询字符串中写入所有的参数。 但在大多数应用程序中，字段的参数将是动态的：例如，可能会有一个下拉列表，您可以选择您感兴趣的星球大战插曲，或搜索字段或一组过滤器。\n\n在查询字符串中直接传递这些动态参数并不是一个好主意，因为我们的客户端代码需要在运行时动态地处理查询字符串，并将其序列化为特定于图形的格式。 相反，GraphQL具有将查询中的动态值参数化的一级方法(first-class way)，并将其作为单独的字典传递。 这些值称为 _变量_ 。\n\n当开始使用变量之时，我们需要做三件事情：\n\n1. 用`$variableName`替换查询语句中静态的值\n2. 声明`$variableName`为一个被查询语句接收的变量之一\n3. 将`$variableName: value`写入到一种传输专用的变量字典中(通常是JSON)，用来与查询语句分别传输到服务器上。\n\n整合后的结果：\n\n- query\n\n  ```graphql\n  query HeroNameAndFriends($episode: Episode) {\n    hero(episode: $episode) {\n      name\n      friends {\n        name\n      }\n    }\n  }\n  ```\n\n- variables\n\n  ```json\n  {\n    \"episode\": \"JEDI\"\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"hero\": {\n        \"name\": \"R2-D2\",\n        \"friends\": [\n          {\n            \"name\": \"Luke Skywalker\"\n          },\n          {\n            \"name\": \"Han Solo\"\n          },\n          {\n            \"name\": \"Leia Organa\"\n          }\n        ]\n      }\n    }\n  }\n  ```\n\n现在，在我们的客户端代码中，我们可以简单地传递一个不同的变量，而不需要构造一个全新的查询。 这通常也是一个好的做法，表示我们的查询中的哪些参数预期是动态的 - 我们不应该使用字符串插值来从用户提供的值构造查询。\n\n### 变量定义\n\n变量定义是上面查询中的（`$episode：Episode`）部分。 它的作用就像类型语言中函数的参数定义一样。 它列出所有变量，前缀为$，后跟其类型（当前为`Episode`）。\n\n所有声明的变量必须是标量，枚举或输入对象类型。 因此，如果要将复杂对象传递到字段中，则需要知道在服务器上匹配的输入类型。 在“架构”页面上了解有关输入对象类型的更多信息。\n\n变量定义可以是可选的或必需的。 在上面的情况下，因为没有！ 在Episode类型后面，所以它是可选的。 但是，如果要将变量传递给需要非空参数的字段，那么该变量也必须是必需的。\n\n要了解有关这些变量定义的语法的更多信息，学习GraphQL模式语言非常有用。 模式语言在Schema页面中有详细的说明。\n\n### 默认变量\n\n可以在变量的类型声明后面添加该变量的默认值\n\n```graphql\nquery HeroNameAndFriends($episode: Episode = \"JEDI\") {\n  hero(episode: $episode) {\n    name\n    friends {\n      name\n    }\n  }\n}\n```\n\n## 操作名（Operation  name）\n\n从上面的查询例子我们可以看到一个`HeroNameAndFriends`的操作名。但到目前为止，我们大部分是在速记语法，省略查询关键字和查询名称，但在生产中，这钟写法会使我们的代码不明确。\n\n想想这就像你最喜欢的编程语言中的函数名。 例如，在JavaScript中，我们可以轻松地使用匿名函数，但是当我们给一个函数一个名字时，跟踪它更容易，调试我们的代码，并在被调用时记录。 以同样的方式，GraphQL查询和变量名称以及片段名称可以作为服务器端的一个有用的调试工具来识别不同的GraphQL请求。\n\n## 指令（Directives）\n\n我们上面讨论了变量如何使我们避免进行手动字符串插值来构造动态查询。 在参数中传递变量解决了这些问题的一部分，但是我们也可能需要一种使用变量来动态地更改查询的结构和形状的方法。 例如，我们可以想象一个UI组件，它具有一个总结和详细的视图，其中一个包含比另一个更多的字段。让我们来为这样的组件构建一个查询语句：\n\n- query\n\n  ```graphql\n  query Hero($episode: Episode, $withFriends: Boolean!) {\n    hero(episode: $episode) {\n      name\n      friends @include(if: $withFriends) {\n        name\n      }\n    }\n  }\n  ```\n\n- variables\n\n  ```json\n  {\n    \"episode\": \"JEDI\",\n    \"withFriends\": false\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"hero\": {\n        \"name\": \"R2-D2\"\n      }\n    }\n  }\n  ```\n\n尝试编辑上面的变量（比如将`true`传给`withFriends`），看看结果如何变化。\n\n我们需要在GraphQL中使用一个新功能，称为一个指令。 一个指令可以附加到字段或片段包含，并且可以以服务器的任何方式影响查询的执行。 核心GraphQL规范仅包含两个指令，这些指令必须由任何符合规范的GraphQL服务器实现支持：\n\n- `@include(if: Boolean)` 仅当参数为`true`时返回结果才包括这个字段\n- `@skip(if: Boolean)` 当参数为`true`时跳过这个字段\n\n指令可用于摆脱需要执行字符串操作以在查询中添加和删除字段的情况。 服务器实现也可以通过定义全新的指令来添加实验功能。\n\n## 修改（Mutations）\n\n大多数关于GraphQL的讨论集中于数据获取，但是任何完整的数据平台也需要一种修改服务器端数据的方法。\n\n在REST中，任何请求可能会导致在服务器上造成一些副作用，但按照惯例，建议不要使用GET请求来修改数据。 GraphQL是类似的：技术上任何查询都可以被实现来进行数据写入。 但是，建立一个约定，任何导致写入的操作都应该通过修改操作显式发送。\n\n就像查询一样，如果修改字段返回一个对象类型，可以要求嵌套字段。 这可以在更新后获取对象的新状态。 我们来看一个简单的例子：\n\n- mutation\n\n  ```graphql\n  mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {\n    createReview(episode: $ep, review: $review) {\n      stars\n      commentary\n    }\n  }\n  ```\n\n- varialbes\n\n  ```json\n  {\n    \"ep\": \"JEDI\",\n    \"review\": {\n      \"stars\": 5,\n      \"commentary\": \"This is a great movie!\"\n    }\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"createReview\": {\n        \"stars\": 5,\n        \"commentary\": \"This is a great movie!\"\n      }\n    }\n  }\n  ```\n\n注意`createReview`字段是如何返回新创建的`review`中的`commentary`和`stars`字段的。 这在修改已有字段的时候尤其有用，例如，当增加一个字段时，我们可以通过一个请求来同时修改该字段并查询该字段的新值。\n\n您可能还会注意到，在本示例中，我们传入的评论变量不是标量。 它是一个输入对象类型，可以作为参数传入的特殊种类的对象类型。 详细了解“架构”页面上的输入类型。\n\n### 修改多个字段\n\n像查询操作一样，一个修改操作可以包含多个字段，但是两者之间有一个重大的差异：   \n\n__查询操作是并行的，而修改操作是串行的__\n\n这意味着，如果我们在一个修改操作中两次修改`incremenetCredits`字段的操作，第一个操作在保证结束后才会执行第二个操作。避免出现竞争情况。\n\n\n\n## 内联片段（inline Fragments）\n\n跟其他类型系统一样，GraphQL也可以定义接口（Interfaces）和联合类型（Union Types）。详情见schema guide\n\n你可以使用内联片段来访问一个接口或者联合类型中所包含的数据。用下面这个例子可以很方便的说明：\n\n- query\n\n  ```graphql\n  query HeroForEpisode($ep: Episode!) {\n    hero(episode: $ep) {\n      name\n      ... on Droid {\n        primaryFunction\n      }\n      ... on Human {\n        height\n      }\n    }\n  }\n  ```\n\n- variables\n\n  ```json\n  {\n    \"ep\": \"JEDI\"\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"hero\": {\n        \"name\": \"R2-D2\",\n        \"primaryFunction\": \"Astromech\"\n      }\n    }\n  }\n  ```\n\n在这个查询中，`hero`字段返回类型为`Character`，它可能是`Human`或`Droid`，这取决于参数`episode`。 在直接选择中，您只能访问`Character`接口中存在的字段，如`name`。\n\n要访问具体类型的字段，您需要使用特定类型（type condition）的内联片段。 第一个片段在`Droid`上被标记为`...`，所以只有当从`hero`返回的`Character`是`Droid`类型时，`primaryFunction`字段才会被执行。 类似于`Human`类型中的`height`字段。\n\n命名片段也可以以相同的方式使用，因为命名片段始终包含限定类型。\n\n### 元字段（Meta fields）\n\n鉴于有些情况下您不知道从GraphQL服务返回的类型，您需要一些方法来确定如何处理客户端上的数据。 GraphQL允许您在查询中的任何位置请求`__typename`，一个元字段，以获取该点上对象类型的名称。\n\n- query\n\n  ```graphql\n  {\n    search(text: \"an\") {\n      __typename\n      ... on Human {\n        name\n      }\n      ... on Droid {\n        name\n      }\n      ... on Starship {\n        name\n      }\n    }\n  }\n  ```\n\n- result\n\n  ```json\n  {\n    \"data\": {\n      \"search\": [\n        {\n          \"__typename\": \"Human\",\n          \"name\": \"Han Solo\"\n        },\n        {\n          \"__typename\": \"Droid\",\n          \"name\": \"Leia Organa\"\n        },\n        {\n          \"__typename\": \"Starship\",\n          \"name\": \"TIE Advanced x1\"\n        }\n      ]\n    }\n  }\n  ```\n\n在上述查询中，`search`返回可以是三个选项之一的联合类型。 在没有`__typename`字段的情况下，不可能将客户端的不同类型告诉客户端。\n\nGraphQL服务提供了少量的元字段，其余的公开 于“内省”系统。","slug":"GraphQL Learn (1) - Queries and Mutations","published":1,"updated":"2019-10-11T05:50:15.634Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck1lqzyga0004egqqlbayex1o","content":"<p>在此页面上，你将详细了解如何查询GrahQL服务器。</p>\n<h2 id=\"字段（Fields）\"><a href=\"#字段（Fields）\" class=\"headerlink\" title=\"字段（Fields）\"></a>字段（Fields）</h2><p>最简单的，GraphQL是关于要求对象上的特定字段。我们先来看一个非常简单的查询，当我们运行它时得到结果：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到，查询与结果的形状完全相同。这对于GraphQL是至关重要的，因为您总是收到您期望的内容，并且服务器确切知道客户端要求哪些字段。<br><a id=\"more\"></a><br>字段名返回一个String类型，在这种情况下是星球大战主角“R2-D2”的名称。</p>\n<blockquote>\n<p>哦，还有一件事: 上面的查询是互动的。这意味着您可以随意更改它，并看到新的结果。尝试在查询中向<code>hero</code>对象添加一个<code>appearIn</code>字段，并查看新结果。</p>\n</blockquote>\n<p>在前面的例子中，我们只是要求我们返回一个String类型的主角名字，但字段也可以引用对象。在这种情况下，您可以对该对象的字段进行子查询。 GraphQL查询可以遍历相关对象及其字段，让客户端在一个请求中获取大量相关数据，而不是像传统的REST架构中一样需要进行几次往返。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    # Queries can have comments!</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请注意，在此示例中，<code>friends</code>字段返回一个项目数组。 GraphQL查询对于单个项或多个项列表写法上相同，但是我们根据schema中记录的内容知道预期获得的是哪一种。</p>\n<h2 id=\"参数（Arguments）\"><a href=\"#参数（Arguments）\" class=\"headerlink\" title=\"参数（Arguments）\"></a>参数（Arguments）</h2><p>如果我们唯一可以做的是遍历对象及其字段，则GraphQL已经是数据提取的非常有用的语言。但是如果你还能将参数传递给字段的话，事情会变得更有趣。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: &quot;1000&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    height</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"height\"</span>: <span class=\"number\">1.72</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在像REST这样的系统中，您只能传递一组参数(paramter和url query)。但是在GraphQL中，每个字段和嵌套对象都可以获取自己的参数集，从而使一次GraphQL查询可以完全代替多个传统的API请求。您甚至可以将参数传递到标量字段中并在服务器上实现数据转换，而不需要在客户端上进行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: &quot;1000&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    height(unit: FOOT)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"height\"</span>: <span class=\"number\">5.6430448</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>参数可以是很多不同的类型。在上面的例子中，我们使用了一个枚举类型，它表示一组有限的选项之一（在这种情况下是长度单位，METER或FOOT）。 GraphQL带有默认的类型，但是GraphQL服务器也可以声明自定义类型。只要能将它们序列化为可传输的格式。</p>\n<h2 id=\"别名（Aliases）\"><a href=\"#别名（Aliases）\" class=\"headerlink\" title=\"别名（Aliases）\"></a>别名（Aliases）</h2><p>也许您已经注意到，相对应的结果字段名与查询字段名相同，但却不包括该字段的查询参数，因此您不能直接使用不同的参数查询相同的字段。这就是为什么你需要别名的原因。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  empireHero: hero(episode: EMPIRE) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  jediHero: hero(episode: JEDI) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"empireHero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"jediHero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"片段（Fragments）\"><a href=\"#片段（Fragments）\" class=\"headerlink\" title=\"片段（Fragments）\"></a>片段（Fragments）</h2><p>假设我们的应用中存在一个比较复杂的页面，可以一次性展示两个角色并列出他们的朋友信息。可以想象，这样一个查询可能会很快变得复杂，因为我们需要重复写角色字段至少两次。</p>\n<p>这就是为什么GraphQL包含“片段”这种可重用单元。片段让您构建一组字段，然后我们可以将它们包含在需要的查询中。以下是使用片段解决上述情况的示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  leftComparison: hero(episode: EMPIRE) &#123;</span><br><span class=\"line\">    ...comparisonFields</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  rightComparison: hero(episode: JEDI) &#123;</span><br><span class=\"line\">    ...comparisonFields</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment comparisonFields on Character &#123;</span><br><span class=\"line\">  name</span><br><span class=\"line\">  appearsIn</span><br><span class=\"line\">  friends &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"leftComparison\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"string\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"rightComparison\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"string\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果重复这些字段，您可以看到上述查询将如何重复。片段的概念经常用于将复杂的应用程序数据需求分解成更小的块，特别是当您需要将大量具有不同片段的UI组件合并到一个初始数据请求时。</p>\n<h2 id=\"变量（variables）\"><a href=\"#变量（variables）\" class=\"headerlink\" title=\"变量（variables）\"></a>变量（variables）</h2><p>到目前为止，我们一直在查询字符串中写入所有的参数。 但在大多数应用程序中，字段的参数将是动态的：例如，可能会有一个下拉列表，您可以选择您感兴趣的星球大战插曲，或搜索字段或一组过滤器。</p>\n<p>在查询字符串中直接传递这些动态参数并不是一个好主意，因为我们的客户端代码需要在运行时动态地处理查询字符串，并将其序列化为特定于图形的格式。 相反，GraphQL具有将查询中的动态值参数化的一级方法(first-class way)，并将其作为单独的字典传递。 这些值称为 _变量_ 。</p>\n<p>当开始使用变量之时，我们需要做三件事情：</p>\n<ol>\n<li>用<code>$variableName</code>替换查询语句中静态的值</li>\n<li>声明<code>$variableName</code>为一个被查询语句接收的变量之一</li>\n<li>将<code>$variableName: value</code>写入到一种传输专用的变量字典中(通常是JSON)，用来与查询语句分别传输到服务器上。</li>\n</ol>\n<p>整合后的结果：</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroNameAndFriends($episode: Episode) &#123;</span><br><span class=\"line\">  hero(episode: $episode) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>variables</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"episode\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>现在，在我们的客户端代码中，我们可以简单地传递一个不同的变量，而不需要构造一个全新的查询。 这通常也是一个好的做法，表示我们的查询中的哪些参数预期是动态的 - 我们不应该使用字符串插值来从用户提供的值构造查询。</p>\n<h3 id=\"变量定义\"><a href=\"#变量定义\" class=\"headerlink\" title=\"变量定义\"></a>变量定义</h3><p>变量定义是上面查询中的（<code>$episode：Episode</code>）部分。 它的作用就像类型语言中函数的参数定义一样。 它列出所有变量，前缀为$，后跟其类型（当前为<code>Episode</code>）。</p>\n<p>所有声明的变量必须是标量，枚举或输入对象类型。 因此，如果要将复杂对象传递到字段中，则需要知道在服务器上匹配的输入类型。 在“架构”页面上了解有关输入对象类型的更多信息。</p>\n<p>变量定义可以是可选的或必需的。 在上面的情况下，因为没有！ 在Episode类型后面，所以它是可选的。 但是，如果要将变量传递给需要非空参数的字段，那么该变量也必须是必需的。</p>\n<p>要了解有关这些变量定义的语法的更多信息，学习GraphQL模式语言非常有用。 模式语言在Schema页面中有详细的说明。</p>\n<h3 id=\"默认变量\"><a href=\"#默认变量\" class=\"headerlink\" title=\"默认变量\"></a>默认变量</h3><p>可以在变量的类型声明后面添加该变量的默认值</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroNameAndFriends($episode: Episode = &quot;JEDI&quot;) &#123;</span><br><span class=\"line\">  hero(episode: $episode) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"操作名（Operation-name）\"><a href=\"#操作名（Operation-name）\" class=\"headerlink\" title=\"操作名（Operation  name）\"></a>操作名（Operation  name）</h2><p>从上面的查询例子我们可以看到一个<code>HeroNameAndFriends</code>的操作名。但到目前为止，我们大部分是在速记语法，省略查询关键字和查询名称，但在生产中，这钟写法会使我们的代码不明确。</p>\n<p>想想这就像你最喜欢的编程语言中的函数名。 例如，在JavaScript中，我们可以轻松地使用匿名函数，但是当我们给一个函数一个名字时，跟踪它更容易，调试我们的代码，并在被调用时记录。 以同样的方式，GraphQL查询和变量名称以及片段名称可以作为服务器端的一个有用的调试工具来识别不同的GraphQL请求。</p>\n<h2 id=\"指令（Directives）\"><a href=\"#指令（Directives）\" class=\"headerlink\" title=\"指令（Directives）\"></a>指令（Directives）</h2><p>我们上面讨论了变量如何使我们避免进行手动字符串插值来构造动态查询。 在参数中传递变量解决了这些问题的一部分，但是我们也可能需要一种使用变量来动态地更改查询的结构和形状的方法。 例如，我们可以想象一个UI组件，它具有一个总结和详细的视图，其中一个包含比另一个更多的字段。让我们来为这样的组件构建一个查询语句：</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query Hero($episode: Episode, $withFriends: Boolean!) &#123;</span><br><span class=\"line\">  hero(episode: $episode) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    friends @include(if: $withFriends) &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>variables</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"episode\"</span>: <span class=\"string\">\"JEDI\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"withFriends\"</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>尝试编辑上面的变量（比如将<code>true</code>传给<code>withFriends</code>），看看结果如何变化。</p>\n<p>我们需要在GraphQL中使用一个新功能，称为一个指令。 一个指令可以附加到字段或片段包含，并且可以以服务器的任何方式影响查询的执行。 核心GraphQL规范仅包含两个指令，这些指令必须由任何符合规范的GraphQL服务器实现支持：</p>\n<ul>\n<li><code>@include(if: Boolean)</code> 仅当参数为<code>true</code>时返回结果才包括这个字段</li>\n<li><code>@skip(if: Boolean)</code> 当参数为<code>true</code>时跳过这个字段</li>\n</ul>\n<p>指令可用于摆脱需要执行字符串操作以在查询中添加和删除字段的情况。 服务器实现也可以通过定义全新的指令来添加实验功能。</p>\n<h2 id=\"修改（Mutations）\"><a href=\"#修改（Mutations）\" class=\"headerlink\" title=\"修改（Mutations）\"></a>修改（Mutations）</h2><p>大多数关于GraphQL的讨论集中于数据获取，但是任何完整的数据平台也需要一种修改服务器端数据的方法。</p>\n<p>在REST中，任何请求可能会导致在服务器上造成一些副作用，但按照惯例，建议不要使用GET请求来修改数据。 GraphQL是类似的：技术上任何查询都可以被实现来进行数据写入。 但是，建立一个约定，任何导致写入的操作都应该通过修改操作显式发送。</p>\n<p>就像查询一样，如果修改字段返回一个对象类型，可以要求嵌套字段。 这可以在更新后获取对象的新状态。 我们来看一个简单的例子：</p>\n<ul>\n<li><p>mutation</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;</span><br><span class=\"line\">  createReview(episode: $ep, review: $review) &#123;</span><br><span class=\"line\">    stars</span><br><span class=\"line\">    commentary</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>varialbes</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"review\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"createReview\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>注意<code>createReview</code>字段是如何返回新创建的<code>review</code>中的<code>commentary</code>和<code>stars</code>字段的。 这在修改已有字段的时候尤其有用，例如，当增加一个字段时，我们可以通过一个请求来同时修改该字段并查询该字段的新值。</p>\n<p>您可能还会注意到，在本示例中，我们传入的评论变量不是标量。 它是一个输入对象类型，可以作为参数传入的特殊种类的对象类型。 详细了解“架构”页面上的输入类型。</p>\n<h3 id=\"修改多个字段\"><a href=\"#修改多个字段\" class=\"headerlink\" title=\"修改多个字段\"></a>修改多个字段</h3><p>像查询操作一样，一个修改操作可以包含多个字段，但是两者之间有一个重大的差异：   </p>\n<p><strong>查询操作是并行的，而修改操作是串行的</strong></p>\n<p>这意味着，如果我们在一个修改操作中两次修改<code>incremenetCredits</code>字段的操作，第一个操作在保证结束后才会执行第二个操作。避免出现竞争情况。</p>\n<h2 id=\"内联片段（inline-Fragments）\"><a href=\"#内联片段（inline-Fragments）\" class=\"headerlink\" title=\"内联片段（inline Fragments）\"></a>内联片段（inline Fragments）</h2><p>跟其他类型系统一样，GraphQL也可以定义接口（Interfaces）和联合类型（Union Types）。详情见schema guide</p>\n<p>你可以使用内联片段来访问一个接口或者联合类型中所包含的数据。用下面这个例子可以很方便的说明：</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroForEpisode($ep: Episode!) &#123;</span><br><span class=\"line\">  hero(episode: $ep) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Human &#123;</span><br><span class=\"line\">      height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>variables</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>在这个查询中，<code>hero</code>字段返回类型为<code>Character</code>，它可能是<code>Human</code>或<code>Droid</code>，这取决于参数<code>episode</code>。 在直接选择中，您只能访问<code>Character</code>接口中存在的字段，如<code>name</code>。</p>\n<p>要访问具体类型的字段，您需要使用特定类型（type condition）的内联片段。 第一个片段在<code>Droid</code>上被标记为<code>...</code>，所以只有当从<code>hero</code>返回的<code>Character</code>是<code>Droid</code>类型时，<code>primaryFunction</code>字段才会被执行。 类似于<code>Human</code>类型中的<code>height</code>字段。</p>\n<p>命名片段也可以以相同的方式使用，因为命名片段始终包含限定类型。</p>\n<h3 id=\"元字段（Meta-fields）\"><a href=\"#元字段（Meta-fields）\" class=\"headerlink\" title=\"元字段（Meta fields）\"></a>元字段（Meta fields）</h3><p>鉴于有些情况下您不知道从GraphQL服务返回的类型，您需要一些方法来确定如何处理客户端上的数据。 GraphQL允许您在查询中的任何位置请求<code>__typename</code>，一个元字段，以获取该点上对象类型的名称。</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  search(text: &quot;an&quot;) &#123;</span><br><span class=\"line\">    __typename</span><br><span class=\"line\">    ... on Human &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Starship &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"search\"</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"__typename\"</span>: <span class=\"string\">\"Human\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"__typename\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"__typename\"</span>: <span class=\"string\">\"Starship\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"TIE Advanced x1\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>在上述查询中，<code>search</code>返回可以是三个选项之一的联合类型。 在没有<code>__typename</code>字段的情况下，不可能将客户端的不同类型告诉客户端。</p>\n<p>GraphQL服务提供了少量的元字段，其余的公开 于“内省”系统。</p>\n","site":{"data":{}},"excerpt":"<p>在此页面上，你将详细了解如何查询GrahQL服务器。</p>\n<h2 id=\"字段（Fields）\"><a href=\"#字段（Fields）\" class=\"headerlink\" title=\"字段（Fields）\"></a>字段（Fields）</h2><p>最简单的，GraphQL是关于要求对象上的特定字段。我们先来看一个非常简单的查询，当我们运行它时得到结果：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可以看到，查询与结果的形状完全相同。这对于GraphQL是至关重要的，因为您总是收到您期望的内容，并且服务器确切知道客户端要求哪些字段。<br>","more":"<br>字段名返回一个String类型，在这种情况下是星球大战主角“R2-D2”的名称。</p>\n<blockquote>\n<p>哦，还有一件事: 上面的查询是互动的。这意味着您可以随意更改它，并看到新的结果。尝试在查询中向<code>hero</code>对象添加一个<code>appearIn</code>字段，并查看新结果。</p>\n</blockquote>\n<p>在前面的例子中，我们只是要求我们返回一个String类型的主角名字，但字段也可以引用对象。在这种情况下，您可以对该对象的字段进行子查询。 GraphQL查询可以遍历相关对象及其字段，让客户端在一个请求中获取大量相关数据，而不是像传统的REST架构中一样需要进行几次往返。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    # Queries can have comments!</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>请注意，在此示例中，<code>friends</code>字段返回一个项目数组。 GraphQL查询对于单个项或多个项列表写法上相同，但是我们根据schema中记录的内容知道预期获得的是哪一种。</p>\n<h2 id=\"参数（Arguments）\"><a href=\"#参数（Arguments）\" class=\"headerlink\" title=\"参数（Arguments）\"></a>参数（Arguments）</h2><p>如果我们唯一可以做的是遍历对象及其字段，则GraphQL已经是数据提取的非常有用的语言。但是如果你还能将参数传递给字段的话，事情会变得更有趣。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: &quot;1000&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    height</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"height\"</span>: <span class=\"number\">1.72</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在像REST这样的系统中，您只能传递一组参数(paramter和url query)。但是在GraphQL中，每个字段和嵌套对象都可以获取自己的参数集，从而使一次GraphQL查询可以完全代替多个传统的API请求。您甚至可以将参数传递到标量字段中并在服务器上实现数据转换，而不需要在客户端上进行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  human(id: &quot;1000&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    height(unit: FOOT)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"human\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"height\"</span>: <span class=\"number\">5.6430448</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>参数可以是很多不同的类型。在上面的例子中，我们使用了一个枚举类型，它表示一组有限的选项之一（在这种情况下是长度单位，METER或FOOT）。 GraphQL带有默认的类型，但是GraphQL服务器也可以声明自定义类型。只要能将它们序列化为可传输的格式。</p>\n<h2 id=\"别名（Aliases）\"><a href=\"#别名（Aliases）\" class=\"headerlink\" title=\"别名（Aliases）\"></a>别名（Aliases）</h2><p>也许您已经注意到，相对应的结果字段名与查询字段名相同，但却不包括该字段的查询参数，因此您不能直接使用不同的参数查询相同的字段。这就是为什么你需要别名的原因。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  empireHero: hero(episode: EMPIRE) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  jediHero: hero(episode: JEDI) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"empireHero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"jediHero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"片段（Fragments）\"><a href=\"#片段（Fragments）\" class=\"headerlink\" title=\"片段（Fragments）\"></a>片段（Fragments）</h2><p>假设我们的应用中存在一个比较复杂的页面，可以一次性展示两个角色并列出他们的朋友信息。可以想象，这样一个查询可能会很快变得复杂，因为我们需要重复写角色字段至少两次。</p>\n<p>这就是为什么GraphQL包含“片段”这种可重用单元。片段让您构建一组字段，然后我们可以将它们包含在需要的查询中。以下是使用片段解决上述情况的示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  leftComparison: hero(episode: EMPIRE) &#123;</span><br><span class=\"line\">    ...comparisonFields</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  rightComparison: hero(episode: JEDI) &#123;</span><br><span class=\"line\">    ...comparisonFields</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment comparisonFields on Character &#123;</span><br><span class=\"line\">  name</span><br><span class=\"line\">  appearsIn</span><br><span class=\"line\">  friends &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"leftComparison\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"string\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"rightComparison\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"string\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果重复这些字段，您可以看到上述查询将如何重复。片段的概念经常用于将复杂的应用程序数据需求分解成更小的块，特别是当您需要将大量具有不同片段的UI组件合并到一个初始数据请求时。</p>\n<h2 id=\"变量（variables）\"><a href=\"#变量（variables）\" class=\"headerlink\" title=\"变量（variables）\"></a>变量（variables）</h2><p>到目前为止，我们一直在查询字符串中写入所有的参数。 但在大多数应用程序中，字段的参数将是动态的：例如，可能会有一个下拉列表，您可以选择您感兴趣的星球大战插曲，或搜索字段或一组过滤器。</p>\n<p>在查询字符串中直接传递这些动态参数并不是一个好主意，因为我们的客户端代码需要在运行时动态地处理查询字符串，并将其序列化为特定于图形的格式。 相反，GraphQL具有将查询中的动态值参数化的一级方法(first-class way)，并将其作为单独的字典传递。 这些值称为 _变量_ 。</p>\n<p>当开始使用变量之时，我们需要做三件事情：</p>\n<ol>\n<li>用<code>$variableName</code>替换查询语句中静态的值</li>\n<li>声明<code>$variableName</code>为一个被查询语句接收的变量之一</li>\n<li>将<code>$variableName: value</code>写入到一种传输专用的变量字典中(通常是JSON)，用来与查询语句分别传输到服务器上。</li>\n</ol>\n<p>整合后的结果：</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroNameAndFriends($episode: Episode) &#123;</span><br><span class=\"line\">  hero(episode: $episode) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>variables</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"episode\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>现在，在我们的客户端代码中，我们可以简单地传递一个不同的变量，而不需要构造一个全新的查询。 这通常也是一个好的做法，表示我们的查询中的哪些参数预期是动态的 - 我们不应该使用字符串插值来从用户提供的值构造查询。</p>\n<h3 id=\"变量定义\"><a href=\"#变量定义\" class=\"headerlink\" title=\"变量定义\"></a>变量定义</h3><p>变量定义是上面查询中的（<code>$episode：Episode</code>）部分。 它的作用就像类型语言中函数的参数定义一样。 它列出所有变量，前缀为$，后跟其类型（当前为<code>Episode</code>）。</p>\n<p>所有声明的变量必须是标量，枚举或输入对象类型。 因此，如果要将复杂对象传递到字段中，则需要知道在服务器上匹配的输入类型。 在“架构”页面上了解有关输入对象类型的更多信息。</p>\n<p>变量定义可以是可选的或必需的。 在上面的情况下，因为没有！ 在Episode类型后面，所以它是可选的。 但是，如果要将变量传递给需要非空参数的字段，那么该变量也必须是必需的。</p>\n<p>要了解有关这些变量定义的语法的更多信息，学习GraphQL模式语言非常有用。 模式语言在Schema页面中有详细的说明。</p>\n<h3 id=\"默认变量\"><a href=\"#默认变量\" class=\"headerlink\" title=\"默认变量\"></a>默认变量</h3><p>可以在变量的类型声明后面添加该变量的默认值</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroNameAndFriends($episode: Episode = &quot;JEDI&quot;) &#123;</span><br><span class=\"line\">  hero(episode: $episode) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"操作名（Operation-name）\"><a href=\"#操作名（Operation-name）\" class=\"headerlink\" title=\"操作名（Operation  name）\"></a>操作名（Operation  name）</h2><p>从上面的查询例子我们可以看到一个<code>HeroNameAndFriends</code>的操作名。但到目前为止，我们大部分是在速记语法，省略查询关键字和查询名称，但在生产中，这钟写法会使我们的代码不明确。</p>\n<p>想想这就像你最喜欢的编程语言中的函数名。 例如，在JavaScript中，我们可以轻松地使用匿名函数，但是当我们给一个函数一个名字时，跟踪它更容易，调试我们的代码，并在被调用时记录。 以同样的方式，GraphQL查询和变量名称以及片段名称可以作为服务器端的一个有用的调试工具来识别不同的GraphQL请求。</p>\n<h2 id=\"指令（Directives）\"><a href=\"#指令（Directives）\" class=\"headerlink\" title=\"指令（Directives）\"></a>指令（Directives）</h2><p>我们上面讨论了变量如何使我们避免进行手动字符串插值来构造动态查询。 在参数中传递变量解决了这些问题的一部分，但是我们也可能需要一种使用变量来动态地更改查询的结构和形状的方法。 例如，我们可以想象一个UI组件，它具有一个总结和详细的视图，其中一个包含比另一个更多的字段。让我们来为这样的组件构建一个查询语句：</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query Hero($episode: Episode, $withFriends: Boolean!) &#123;</span><br><span class=\"line\">  hero(episode: $episode) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    friends @include(if: $withFriends) &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>variables</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"episode\"</span>: <span class=\"string\">\"JEDI\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"withFriends\"</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>尝试编辑上面的变量（比如将<code>true</code>传给<code>withFriends</code>），看看结果如何变化。</p>\n<p>我们需要在GraphQL中使用一个新功能，称为一个指令。 一个指令可以附加到字段或片段包含，并且可以以服务器的任何方式影响查询的执行。 核心GraphQL规范仅包含两个指令，这些指令必须由任何符合规范的GraphQL服务器实现支持：</p>\n<ul>\n<li><code>@include(if: Boolean)</code> 仅当参数为<code>true</code>时返回结果才包括这个字段</li>\n<li><code>@skip(if: Boolean)</code> 当参数为<code>true</code>时跳过这个字段</li>\n</ul>\n<p>指令可用于摆脱需要执行字符串操作以在查询中添加和删除字段的情况。 服务器实现也可以通过定义全新的指令来添加实验功能。</p>\n<h2 id=\"修改（Mutations）\"><a href=\"#修改（Mutations）\" class=\"headerlink\" title=\"修改（Mutations）\"></a>修改（Mutations）</h2><p>大多数关于GraphQL的讨论集中于数据获取，但是任何完整的数据平台也需要一种修改服务器端数据的方法。</p>\n<p>在REST中，任何请求可能会导致在服务器上造成一些副作用，但按照惯例，建议不要使用GET请求来修改数据。 GraphQL是类似的：技术上任何查询都可以被实现来进行数据写入。 但是，建立一个约定，任何导致写入的操作都应该通过修改操作显式发送。</p>\n<p>就像查询一样，如果修改字段返回一个对象类型，可以要求嵌套字段。 这可以在更新后获取对象的新状态。 我们来看一个简单的例子：</p>\n<ul>\n<li><p>mutation</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;</span><br><span class=\"line\">  createReview(episode: $ep, review: $review) &#123;</span><br><span class=\"line\">    stars</span><br><span class=\"line\">    commentary</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>varialbes</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"review\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"createReview\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>注意<code>createReview</code>字段是如何返回新创建的<code>review</code>中的<code>commentary</code>和<code>stars</code>字段的。 这在修改已有字段的时候尤其有用，例如，当增加一个字段时，我们可以通过一个请求来同时修改该字段并查询该字段的新值。</p>\n<p>您可能还会注意到，在本示例中，我们传入的评论变量不是标量。 它是一个输入对象类型，可以作为参数传入的特殊种类的对象类型。 详细了解“架构”页面上的输入类型。</p>\n<h3 id=\"修改多个字段\"><a href=\"#修改多个字段\" class=\"headerlink\" title=\"修改多个字段\"></a>修改多个字段</h3><p>像查询操作一样，一个修改操作可以包含多个字段，但是两者之间有一个重大的差异：   </p>\n<p><strong>查询操作是并行的，而修改操作是串行的</strong></p>\n<p>这意味着，如果我们在一个修改操作中两次修改<code>incremenetCredits</code>字段的操作，第一个操作在保证结束后才会执行第二个操作。避免出现竞争情况。</p>\n<h2 id=\"内联片段（inline-Fragments）\"><a href=\"#内联片段（inline-Fragments）\" class=\"headerlink\" title=\"内联片段（inline Fragments）\"></a>内联片段（inline Fragments）</h2><p>跟其他类型系统一样，GraphQL也可以定义接口（Interfaces）和联合类型（Union Types）。详情见schema guide</p>\n<p>你可以使用内联片段来访问一个接口或者联合类型中所包含的数据。用下面这个例子可以很方便的说明：</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroForEpisode($ep: Episode!) &#123;</span><br><span class=\"line\">  hero(episode: $ep) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Human &#123;</span><br><span class=\"line\">      height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>variables</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>在这个查询中，<code>hero</code>字段返回类型为<code>Character</code>，它可能是<code>Human</code>或<code>Droid</code>，这取决于参数<code>episode</code>。 在直接选择中，您只能访问<code>Character</code>接口中存在的字段，如<code>name</code>。</p>\n<p>要访问具体类型的字段，您需要使用特定类型（type condition）的内联片段。 第一个片段在<code>Droid</code>上被标记为<code>...</code>，所以只有当从<code>hero</code>返回的<code>Character</code>是<code>Droid</code>类型时，<code>primaryFunction</code>字段才会被执行。 类似于<code>Human</code>类型中的<code>height</code>字段。</p>\n<p>命名片段也可以以相同的方式使用，因为命名片段始终包含限定类型。</p>\n<h3 id=\"元字段（Meta-fields）\"><a href=\"#元字段（Meta-fields）\" class=\"headerlink\" title=\"元字段（Meta fields）\"></a>元字段（Meta fields）</h3><p>鉴于有些情况下您不知道从GraphQL服务返回的类型，您需要一些方法来确定如何处理客户端上的数据。 GraphQL允许您在查询中的任何位置请求<code>__typename</code>，一个元字段，以获取该点上对象类型的名称。</p>\n<ul>\n<li><p>query</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  search(text: &quot;an&quot;) &#123;</span><br><span class=\"line\">    __typename</span><br><span class=\"line\">    ... on Human &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Starship &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>result</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"search\"</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"__typename\"</span>: <span class=\"string\">\"Human\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"__typename\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"__typename\"</span>: <span class=\"string\">\"Starship\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"TIE Advanced x1\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>在上述查询中，<code>search</code>返回可以是三个选项之一的联合类型。 在没有<code>__typename</code>字段的情况下，不可能将客户端的不同类型告诉客户端。</p>\n<p>GraphQL服务提供了少量的元字段，其余的公开 于“内省”系统。</p>"},{"title":"GraphQL Learn (2) - Schemas and Types","date":"2017-08-14T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n\n在此页面上，您将了解有关GraphQL类型系统的所有知识，以及如何描述可查询哪些数据。 由于GraphQL可以与任何后端框架或编程语言一起使用，因此我们将远离实现特定的详细信息，仅讨论概念。\n\n### 类型系统（Type System）\n\n\n\n如果您以前看过GraphQL查询，那么你应该知道GraphQL查询语言基本上是在对象上选择字段。 所以在以下查询中：\n\n```graphql\n{\n  hero {\n    name\n    appearsIn\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ]\n    }\n  }\n}\n```\n<!--more-->\n\n\n1. 从一个特殊的 \"root\"对象开始\n2. 在它里面选择一个`hero`字段\n3. 在`hero`返回的对象中，我们继续选择 `name` 和 `appearsIn` 字段\n\n因为GraphQL查询的形状与结果非常相似，所以您可以预测什么是查询将返回，而不必关心服务器的设置。 但是我们还是需要对我们所请求的数据进行详细的描述： \n\n- 我们可以选择哪些字段？ \n- 他们可能返回什么样的对象？ \n- 这些子对象里面包含哪些字段？ \n\n这就是schema所需要解决的问题。\n\n每个GraphQL服务定义一组完全描述可以在该服务上查询的可能数据的类型。 然后，当收到查询时，它们将根据该架构进行验证和执行。.\n\n### 类型语句（Type language）\n\nGraphQL服务可以用任何语言编写。我们不能依赖特定的编程语言语法（如JavaScript），因此我们将使用“GraphQL schema 语言” ，它类似于查询语言，并允许我们以语言无关的方式谈论GraphQL的架构。\n\n### 对象的类型和字段（Object types and fields）\n\nGraphQL的最基本的组件是对象类型，表示你可以从服务中获取的一种对象，以及它具有哪些字段。 在GraphQL schema语言中，我们可以这样表示：\n\n```graphql\ntype Character {\n  name: String!\n  appearsIn: [Episode]!\n}\n```\n\n可读性已经很高了，但是让我们再过一遍，以便于让我们在细节上拥有共同的语言：\n\n- `Character`是一个对象类型，大多数情况下，schema里面的type都是一个对象\n- `name`和`appearsIn`是`Character`中的字段。意味着在任何查询包含`Character` 类的时候`name`和`appearsIn`是仅有且必须出现在其中的字段\n- `String`是内置的标量类型之一，标量是GraphQL中的最小的类型，不能再做子选择了。 我们会稍后再看标量类型。\n\n\n- `String!`代表着这个字段是不为空的，GraphQL服务保证在这个字段上返回一个不为空的值。\n- `[Episode]!`代表着一个包含`Episode`对象的数列，它也是不为空的，因此当你查询`appearsIn`字段时，GraphQL永远会返回一个数组，即使是一个空数组。\n\n现在，您知道GraphQL对象类型是什么样子了，并且掌握了如何读取GraphQL类型语言的基础知识。\n\n### 参数（Arguments）\n\nGraphQL对象类型上的每个字段都可以有零个或多个参数，例如下面的`length`字段：\n\n```graphql\ntype Starship {\n  id: ID!\n  name: String!\n  length(unit: LengthUnit = METER): Float\n}\n```\n\n所有参数都是有命名的。与JavaScript和Python这样的语言不同，函数采用有序参数列表，GraphQL中的所有参数都是通过名称进行传递。上面例子中，`length`字段有一个定义的参数，`unit`。\n\n参数可以是必需的或可选的。当参数是可选的时候，我们可以定义一个默认值 。上面例子中，如果`unit`参数没有被传递，默认情况下它将被设置为`METER`。\n\n\n\n### Query和Mutation类型（The Query and Mutation types）\n\nschema中的大多数类型将只是普通对象类型，但其中有两种特殊的类型：\n\n```graphql\nschema {\n  query: Query\n  mutation: Mutation\n}\n```\n\n每个GraphQL服务都有一个`query`类型，但可能有也可能没有`mutation`类型。 这些类型与常规对象类型相同，但它们是特殊的，因为它们定义了每个GraphQL查询的入口点。 所以如果你看到一个查询：\n\n```graphql\nquery {\n  hero {\n    name\n  }\n  droid(id: \"2000\") {\n    name\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\"\n    },\n    \"droid\": {\n      \"name\": \"C-3PO\"\n    }\n  }\n}\n```\n\n\n\n这意味着GraphQL服务需要一个具有`hero`和`droid`字段的`query`类型：\n\n```graphql\ntype Query {\n  hero(episode: Episode): Character\n  droid(id: ID!): Droid\n}\n```\n\n`Mutation`相同，您可以定义`Mutation`类型上的字段，这些字段就是你能变更的根字段。\n\n重要的是要记住，除了作为模式的“入口点”的特殊状态之外，“查询和变更”类型与任何其他GraphQL对象类型相同，它们的字段的工作方式完全相同。\n\n\n\n### 标量类型（Scalar types）\n\nGraphQL对象类型具有名称和字段，但在某些时候，这些字段必须解析为某些具体数据。 这就是标量类型的来历：它们代表查询最低端的叶子节点。下面查询中，`name`和`appearsIn`将会被解析为标量类型（因为这两个字段没有任何子字段，他们是本次查询的叶子节点）：\n\n```graphql\n{\n  hero {\n    name\n    appearsIn\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ]\n    }\n  }\n}\n```\n\n\n\nGraphQL默认自带了一些变量类型：\n\n- `Int`: 带符号32位的整数.\n- `Float`: 带符号的双精度浮点数.\n- `String`: UTF-8的字符串.\n- `Boolean`: `true` 或`false`.\n- `ID`: ID标量类型表示一个唯一的标识，通常用于重新获取对象或作为缓存中的键。 ID类型其实就是String类型; 然而将其定义为ID表示它是没有可读性的。\n\n在大多数GraphQL服务实现中，还有一种方法来自定义标量类型。 例如，我们可以定义一个日期类型：\n\n```graphql\nscalar Date\n```\n\n然后由我们的自己来实现该自定义类型如何序列化，反序列化和验证。 例如，您可以指定Date类型应始终序列化为整数时间戳，并且让你的客户端也知道该格式。\n\n\n\n### 枚举类型（Enumeration types）\n\n也称为枚举（ _Enums_ ），枚举类型是一种特殊类型的标量，仅限于一组特定的允许值。 这样你可以：\n\n1. 验证此类型的任何参数是允许的值之一\n2. 通过类型系统沟通一个字段永远是一组有限的值\n\n以下是GraphQL Schema语言中的枚举定义：\n\n```graphql\nenum Episode {\n  NEWHOPE\n  EMPIRE\n  JEDI\n}\n```\n\n这意味着无论何时我们在Schema中使用`Episode`类型时，其对应的值永远都是`NEWHOPE`, `EMPIRE`,  `JEDI`中间的一个。\n\n请注意，各种语言的GraphQL服务实现将以自己的语言特定方式来处理枚举。 以支持枚举作“为一流公民”的语言，某些实现可能会利用这一点; 在没有枚举支持的JavaScript语言中，这些值可能在内部映射到一组整数。 但是，这些细节不会泄露给客户端，客户端可以完全按照枚举值的字符串名称进行操作。\n\n\n\n### 列表和非空类型（Lists and Non-Null）\n\n对象类型，标量和枚举是GraphQL中唯一可以定义的类型。 但是当您在Schema的其他部分或查询变量声明中使用这些类型时，可以使用类型修饰符来影响这些值的验证规则。 我们来看一个例子：\n\n```graphql\ntype Character {\n  name: String!\n  appearsIn: [Episode]!\n}\n```\n\n在这里，我们使用一个String类型，并通过在它之后添加一个感叹号将其标记为一个非空类型。 这意味着我们的服务器总是期望为此字段返回一个非空值，如果最终得到一个空值，实际上会触发一个GraphQL执行错误，让客户端知道出现了一些问题。\n\n在定义字段的参数时，也可以使用非空类型修饰符，如果将null值作为该参数传递，则GraphQL服务器将返回验证错误，无论是在GraphQL字符串还是变量中。\n\n```graphql\nquery DroidById($id: ID!) {\n  droid(id: $id) {\n    name\n  }\n}\n```\n\n```json\n{\n  \"id\": null\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Variable \\\"$id\\\" of required type \\\"ID!\\\" was not provided.\",\n      \"locations\": [\n        {\n          \"line\": 1,\n          \"column\": 17\n        }\n      ]\n    }\n  ]\n}\n```\n\n\n\n列表以类似的方式工作：我们可以使用类型修饰符将类型标记为List，这表示该字段将返回该类型的数组。 在模式语言中，通过将类型包装在方括号`[`和`]`中来表示。 它与参数的表现相同但验证步骤将期望该值的数组。\n\n非空修饰符和列表修饰符可以一起使用，例如，你可以要求一个由非空字符串组成的列表：\n\n```graphql\nmyField: [String!]\n```\n\n这意味着列表本身可以为空，但它不能有任何空的成员。例如，在返回的JSON中：\n\n```js\nmyField: null // valid\nmyField: [] // valid\nmyField: ['a', 'b'] // valid\nmyField: ['a', null, 'b'] // error\n```\n\n现在，让我们定义一个由字符串组成的非空数组：\n\n```graphql\nmyField: [String]!\n```\n\n这意味着列表本身不能为空，但它可以包含空值：\n\n```js\nmyField: null // error\nmyField: [] // valid\nmyField: ['a', 'b'] // valid\nmyField: ['a', null, 'b'] // valid\n```\n\n您可以根据需要随意嵌套任意数量的非空和列表修饰符。\n\n### 接口（Interfaces）\n\n像许多类型的系统一样，GraphQL支持接口。 接口是一种抽象类型，它包含一组类型必须包含已实现该接口的字段。\n\n例如，你可以有一个`Character`接口表示星球大战三部曲中的任何角色：\n\n```graphql\ninterface Character {\n  id: ID!\n  name: String!\n  friends: [Character]\n  appearsIn: [Episode]!\n}\n```\n\n这意味着，任何实现了`Character`接口的类型，都必须拥有这些字段，包括他们的参数和返回类型。例如，下面列举了一些实现`Character`接口的类型：\n\n```graphql\ntype Human implements Character {\n  id: ID!\n  name: String!\n  friends: [Character]\n  appearsIn: [Episode]!\n  starships: [Starship]\n  totalCredits: Int\n}\n\ntype Droid implements Character {\n  id: ID!\n  name: String!\n  friends: [Character]\n  appearsIn: [Episode]!\n  primaryFunction: String\n}\n```\n\n您可以看到，这两种类型都具有`Character`接口中的所有字段，还可以引入特定类型字符的额外字段，`totalCredits`，`starships`和`primaryFunction`。\n\n当您要返回一个对象或一组对象时，接口很有用，但这些对象可能有几种不同的类型。\n\n请注意以下查询会产生错误：\n\n```graphql\n# { \"graphiql\": true, \"variables\": { \"ep\": \"JEDI\" } }\nquery HeroForEpisode($ep: Episode!) {\n  hero(episode: $ep) {\n    name\n    primaryFunction\n  }\n}\n```\n\n```json\n{\n  \"ep\": \"JEDI\"\n}\n```\n\n\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n`hero`字段返回字符类型，这意味着它可能是`Human`或`Droid`，取决于`episode`参数。 在上面的查询中，您只能询问`Character`接口中存在的字段，不包括`primaryFunction`。\n\n为了得到在一个特定对象类型中的字段，你需要使用内联片段(inline fragment)\n\n```graphql\nquery HeroForEpisode($ep: Episode!) {\n  hero(episode: $ep) {\n    name\n    ... on Droid {\n      primaryFunction\n    }\n  }\n}\n```\n\n```json\n{\n  \"ep\": \"JEDI\"\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"primaryFunction\": \"Astromech\"\n    }\n  }\n}\n```\n\n\n\n### 联合类型（Union types）\n\n\n\n联合类型与接口非常相似，但它们不能指定类型之间的任何公共字段。\n\n```graphql\nunion SearchResult = Human | Droid | Starship\n```\n\n当Schema返回了一个`SearchResult`类型，我们实际上可能会得到一个`Human`，一个`Droid`或者一个`Starship`。 注意，联合类型的成员需要是具体的对象类型; 您不能在接口或其他联合类型之上再创造一个联合类型。（扁平结构）\n\n在这种情况下，如果查询返回的是`SearchResult`这样的联合类型字段，则需要使用条件片段才能查询其中的任意子字段：\n\n```graphql\n{\n  search(text: \"an\") {\n    ... on Human {\n      name\n      height\n    }\n    ... on Droid {\n      name\n      primaryFunction\n    }\n    ... on Starship {\n      name\n      length\n    }\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"search\": [\n      {\n        \"name\": \"Han Solo\",\n        \"height\": 1.8\n      },\n      {\n        \"name\": \"Leia Organa\",\n        \"height\": 1.5\n      },\n      {\n        \"name\": \"TIE Advanced x1\",\n        \"length\": 9.2\n      }\n    ]\n  }\n}\n```\n\n\n\n### 输入类型（Input types）\n\n到目前为止，我们只谈到将标量值（如枚举或字符串）作为参数传递到一个字段中。 但您也可以轻松地传递复杂的对象。 这在变更（Mutation）的情况下特别有价值，在这种情况下，您可能想要传入要创建的整个对象。 在GraphQL Schema语言中，输入类型与常规对象类型完全相同，但使用关键字`input`而不是`type`：\n\n```graphql\ninput ReviewInput {\n  stars: Int!\n  commentary: String\n}\n```\n\n下面是如何在变更语句中使用输入类型对象的例子：\n\n```graphql\nmutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {\n  createReview(episode: $ep, review: $review) {\n    stars\n    commentary\n  }\n}\n```\n\n```json\n{\n  \"ep\": \"JEDI\",\n  \"review\": {\n    \"stars\": 5,\n    \"commentary\": \"This is a great movie!\"\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"createReview\": {\n      \"stars\": 5,\n      \"commentary\": \"This is a great movie!\"\n    }\n  }\n}\n```\n\n\n\n输入类型对象上的字段本身可以引用其他输入类型对象，但是您不能在Schema中混合输入和输出类型。 输入类型对象也不能在其字段上有参数。","source":"_posts/GraphQL Learn (2) - Schemas and Types.md","raw":"---\ntitle: GraphQL Learn (2) - Schemas and Types\ncategories: [Web]\ndate: 2017-8-15\ntags: [GraphQL]\ngrammar_cjkRuby: true\n---\n\n\n在此页面上，您将了解有关GraphQL类型系统的所有知识，以及如何描述可查询哪些数据。 由于GraphQL可以与任何后端框架或编程语言一起使用，因此我们将远离实现特定的详细信息，仅讨论概念。\n\n### 类型系统（Type System）\n\n\n\n如果您以前看过GraphQL查询，那么你应该知道GraphQL查询语言基本上是在对象上选择字段。 所以在以下查询中：\n\n```graphql\n{\n  hero {\n    name\n    appearsIn\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ]\n    }\n  }\n}\n```\n<!--more-->\n\n\n1. 从一个特殊的 \"root\"对象开始\n2. 在它里面选择一个`hero`字段\n3. 在`hero`返回的对象中，我们继续选择 `name` 和 `appearsIn` 字段\n\n因为GraphQL查询的形状与结果非常相似，所以您可以预测什么是查询将返回，而不必关心服务器的设置。 但是我们还是需要对我们所请求的数据进行详细的描述： \n\n- 我们可以选择哪些字段？ \n- 他们可能返回什么样的对象？ \n- 这些子对象里面包含哪些字段？ \n\n这就是schema所需要解决的问题。\n\n每个GraphQL服务定义一组完全描述可以在该服务上查询的可能数据的类型。 然后，当收到查询时，它们将根据该架构进行验证和执行。.\n\n### 类型语句（Type language）\n\nGraphQL服务可以用任何语言编写。我们不能依赖特定的编程语言语法（如JavaScript），因此我们将使用“GraphQL schema 语言” ，它类似于查询语言，并允许我们以语言无关的方式谈论GraphQL的架构。\n\n### 对象的类型和字段（Object types and fields）\n\nGraphQL的最基本的组件是对象类型，表示你可以从服务中获取的一种对象，以及它具有哪些字段。 在GraphQL schema语言中，我们可以这样表示：\n\n```graphql\ntype Character {\n  name: String!\n  appearsIn: [Episode]!\n}\n```\n\n可读性已经很高了，但是让我们再过一遍，以便于让我们在细节上拥有共同的语言：\n\n- `Character`是一个对象类型，大多数情况下，schema里面的type都是一个对象\n- `name`和`appearsIn`是`Character`中的字段。意味着在任何查询包含`Character` 类的时候`name`和`appearsIn`是仅有且必须出现在其中的字段\n- `String`是内置的标量类型之一，标量是GraphQL中的最小的类型，不能再做子选择了。 我们会稍后再看标量类型。\n\n\n- `String!`代表着这个字段是不为空的，GraphQL服务保证在这个字段上返回一个不为空的值。\n- `[Episode]!`代表着一个包含`Episode`对象的数列，它也是不为空的，因此当你查询`appearsIn`字段时，GraphQL永远会返回一个数组，即使是一个空数组。\n\n现在，您知道GraphQL对象类型是什么样子了，并且掌握了如何读取GraphQL类型语言的基础知识。\n\n### 参数（Arguments）\n\nGraphQL对象类型上的每个字段都可以有零个或多个参数，例如下面的`length`字段：\n\n```graphql\ntype Starship {\n  id: ID!\n  name: String!\n  length(unit: LengthUnit = METER): Float\n}\n```\n\n所有参数都是有命名的。与JavaScript和Python这样的语言不同，函数采用有序参数列表，GraphQL中的所有参数都是通过名称进行传递。上面例子中，`length`字段有一个定义的参数，`unit`。\n\n参数可以是必需的或可选的。当参数是可选的时候，我们可以定义一个默认值 。上面例子中，如果`unit`参数没有被传递，默认情况下它将被设置为`METER`。\n\n\n\n### Query和Mutation类型（The Query and Mutation types）\n\nschema中的大多数类型将只是普通对象类型，但其中有两种特殊的类型：\n\n```graphql\nschema {\n  query: Query\n  mutation: Mutation\n}\n```\n\n每个GraphQL服务都有一个`query`类型，但可能有也可能没有`mutation`类型。 这些类型与常规对象类型相同，但它们是特殊的，因为它们定义了每个GraphQL查询的入口点。 所以如果你看到一个查询：\n\n```graphql\nquery {\n  hero {\n    name\n  }\n  droid(id: \"2000\") {\n    name\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\"\n    },\n    \"droid\": {\n      \"name\": \"C-3PO\"\n    }\n  }\n}\n```\n\n\n\n这意味着GraphQL服务需要一个具有`hero`和`droid`字段的`query`类型：\n\n```graphql\ntype Query {\n  hero(episode: Episode): Character\n  droid(id: ID!): Droid\n}\n```\n\n`Mutation`相同，您可以定义`Mutation`类型上的字段，这些字段就是你能变更的根字段。\n\n重要的是要记住，除了作为模式的“入口点”的特殊状态之外，“查询和变更”类型与任何其他GraphQL对象类型相同，它们的字段的工作方式完全相同。\n\n\n\n### 标量类型（Scalar types）\n\nGraphQL对象类型具有名称和字段，但在某些时候，这些字段必须解析为某些具体数据。 这就是标量类型的来历：它们代表查询最低端的叶子节点。下面查询中，`name`和`appearsIn`将会被解析为标量类型（因为这两个字段没有任何子字段，他们是本次查询的叶子节点）：\n\n```graphql\n{\n  hero {\n    name\n    appearsIn\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ]\n    }\n  }\n}\n```\n\n\n\nGraphQL默认自带了一些变量类型：\n\n- `Int`: 带符号32位的整数.\n- `Float`: 带符号的双精度浮点数.\n- `String`: UTF-8的字符串.\n- `Boolean`: `true` 或`false`.\n- `ID`: ID标量类型表示一个唯一的标识，通常用于重新获取对象或作为缓存中的键。 ID类型其实就是String类型; 然而将其定义为ID表示它是没有可读性的。\n\n在大多数GraphQL服务实现中，还有一种方法来自定义标量类型。 例如，我们可以定义一个日期类型：\n\n```graphql\nscalar Date\n```\n\n然后由我们的自己来实现该自定义类型如何序列化，反序列化和验证。 例如，您可以指定Date类型应始终序列化为整数时间戳，并且让你的客户端也知道该格式。\n\n\n\n### 枚举类型（Enumeration types）\n\n也称为枚举（ _Enums_ ），枚举类型是一种特殊类型的标量，仅限于一组特定的允许值。 这样你可以：\n\n1. 验证此类型的任何参数是允许的值之一\n2. 通过类型系统沟通一个字段永远是一组有限的值\n\n以下是GraphQL Schema语言中的枚举定义：\n\n```graphql\nenum Episode {\n  NEWHOPE\n  EMPIRE\n  JEDI\n}\n```\n\n这意味着无论何时我们在Schema中使用`Episode`类型时，其对应的值永远都是`NEWHOPE`, `EMPIRE`,  `JEDI`中间的一个。\n\n请注意，各种语言的GraphQL服务实现将以自己的语言特定方式来处理枚举。 以支持枚举作“为一流公民”的语言，某些实现可能会利用这一点; 在没有枚举支持的JavaScript语言中，这些值可能在内部映射到一组整数。 但是，这些细节不会泄露给客户端，客户端可以完全按照枚举值的字符串名称进行操作。\n\n\n\n### 列表和非空类型（Lists and Non-Null）\n\n对象类型，标量和枚举是GraphQL中唯一可以定义的类型。 但是当您在Schema的其他部分或查询变量声明中使用这些类型时，可以使用类型修饰符来影响这些值的验证规则。 我们来看一个例子：\n\n```graphql\ntype Character {\n  name: String!\n  appearsIn: [Episode]!\n}\n```\n\n在这里，我们使用一个String类型，并通过在它之后添加一个感叹号将其标记为一个非空类型。 这意味着我们的服务器总是期望为此字段返回一个非空值，如果最终得到一个空值，实际上会触发一个GraphQL执行错误，让客户端知道出现了一些问题。\n\n在定义字段的参数时，也可以使用非空类型修饰符，如果将null值作为该参数传递，则GraphQL服务器将返回验证错误，无论是在GraphQL字符串还是变量中。\n\n```graphql\nquery DroidById($id: ID!) {\n  droid(id: $id) {\n    name\n  }\n}\n```\n\n```json\n{\n  \"id\": null\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Variable \\\"$id\\\" of required type \\\"ID!\\\" was not provided.\",\n      \"locations\": [\n        {\n          \"line\": 1,\n          \"column\": 17\n        }\n      ]\n    }\n  ]\n}\n```\n\n\n\n列表以类似的方式工作：我们可以使用类型修饰符将类型标记为List，这表示该字段将返回该类型的数组。 在模式语言中，通过将类型包装在方括号`[`和`]`中来表示。 它与参数的表现相同但验证步骤将期望该值的数组。\n\n非空修饰符和列表修饰符可以一起使用，例如，你可以要求一个由非空字符串组成的列表：\n\n```graphql\nmyField: [String!]\n```\n\n这意味着列表本身可以为空，但它不能有任何空的成员。例如，在返回的JSON中：\n\n```js\nmyField: null // valid\nmyField: [] // valid\nmyField: ['a', 'b'] // valid\nmyField: ['a', null, 'b'] // error\n```\n\n现在，让我们定义一个由字符串组成的非空数组：\n\n```graphql\nmyField: [String]!\n```\n\n这意味着列表本身不能为空，但它可以包含空值：\n\n```js\nmyField: null // error\nmyField: [] // valid\nmyField: ['a', 'b'] // valid\nmyField: ['a', null, 'b'] // valid\n```\n\n您可以根据需要随意嵌套任意数量的非空和列表修饰符。\n\n### 接口（Interfaces）\n\n像许多类型的系统一样，GraphQL支持接口。 接口是一种抽象类型，它包含一组类型必须包含已实现该接口的字段。\n\n例如，你可以有一个`Character`接口表示星球大战三部曲中的任何角色：\n\n```graphql\ninterface Character {\n  id: ID!\n  name: String!\n  friends: [Character]\n  appearsIn: [Episode]!\n}\n```\n\n这意味着，任何实现了`Character`接口的类型，都必须拥有这些字段，包括他们的参数和返回类型。例如，下面列举了一些实现`Character`接口的类型：\n\n```graphql\ntype Human implements Character {\n  id: ID!\n  name: String!\n  friends: [Character]\n  appearsIn: [Episode]!\n  starships: [Starship]\n  totalCredits: Int\n}\n\ntype Droid implements Character {\n  id: ID!\n  name: String!\n  friends: [Character]\n  appearsIn: [Episode]!\n  primaryFunction: String\n}\n```\n\n您可以看到，这两种类型都具有`Character`接口中的所有字段，还可以引入特定类型字符的额外字段，`totalCredits`，`starships`和`primaryFunction`。\n\n当您要返回一个对象或一组对象时，接口很有用，但这些对象可能有几种不同的类型。\n\n请注意以下查询会产生错误：\n\n```graphql\n# { \"graphiql\": true, \"variables\": { \"ep\": \"JEDI\" } }\nquery HeroForEpisode($ep: Episode!) {\n  hero(episode: $ep) {\n    name\n    primaryFunction\n  }\n}\n```\n\n```json\n{\n  \"ep\": \"JEDI\"\n}\n```\n\n\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n`hero`字段返回字符类型，这意味着它可能是`Human`或`Droid`，取决于`episode`参数。 在上面的查询中，您只能询问`Character`接口中存在的字段，不包括`primaryFunction`。\n\n为了得到在一个特定对象类型中的字段，你需要使用内联片段(inline fragment)\n\n```graphql\nquery HeroForEpisode($ep: Episode!) {\n  hero(episode: $ep) {\n    name\n    ... on Droid {\n      primaryFunction\n    }\n  }\n}\n```\n\n```json\n{\n  \"ep\": \"JEDI\"\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"primaryFunction\": \"Astromech\"\n    }\n  }\n}\n```\n\n\n\n### 联合类型（Union types）\n\n\n\n联合类型与接口非常相似，但它们不能指定类型之间的任何公共字段。\n\n```graphql\nunion SearchResult = Human | Droid | Starship\n```\n\n当Schema返回了一个`SearchResult`类型，我们实际上可能会得到一个`Human`，一个`Droid`或者一个`Starship`。 注意，联合类型的成员需要是具体的对象类型; 您不能在接口或其他联合类型之上再创造一个联合类型。（扁平结构）\n\n在这种情况下，如果查询返回的是`SearchResult`这样的联合类型字段，则需要使用条件片段才能查询其中的任意子字段：\n\n```graphql\n{\n  search(text: \"an\") {\n    ... on Human {\n      name\n      height\n    }\n    ... on Droid {\n      name\n      primaryFunction\n    }\n    ... on Starship {\n      name\n      length\n    }\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"search\": [\n      {\n        \"name\": \"Han Solo\",\n        \"height\": 1.8\n      },\n      {\n        \"name\": \"Leia Organa\",\n        \"height\": 1.5\n      },\n      {\n        \"name\": \"TIE Advanced x1\",\n        \"length\": 9.2\n      }\n    ]\n  }\n}\n```\n\n\n\n### 输入类型（Input types）\n\n到目前为止，我们只谈到将标量值（如枚举或字符串）作为参数传递到一个字段中。 但您也可以轻松地传递复杂的对象。 这在变更（Mutation）的情况下特别有价值，在这种情况下，您可能想要传入要创建的整个对象。 在GraphQL Schema语言中，输入类型与常规对象类型完全相同，但使用关键字`input`而不是`type`：\n\n```graphql\ninput ReviewInput {\n  stars: Int!\n  commentary: String\n}\n```\n\n下面是如何在变更语句中使用输入类型对象的例子：\n\n```graphql\nmutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {\n  createReview(episode: $ep, review: $review) {\n    stars\n    commentary\n  }\n}\n```\n\n```json\n{\n  \"ep\": \"JEDI\",\n  \"review\": {\n    \"stars\": 5,\n    \"commentary\": \"This is a great movie!\"\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"createReview\": {\n      \"stars\": 5,\n      \"commentary\": \"This is a great movie!\"\n    }\n  }\n}\n```\n\n\n\n输入类型对象上的字段本身可以引用其他输入类型对象，但是您不能在Schema中混合输入和输出类型。 输入类型对象也不能在其字段上有参数。","slug":"GraphQL Learn (2) - Schemas and Types","published":1,"updated":"2019-10-11T05:50:15.635Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck1lqzygd0005egqqusf217a0","content":"<p>在此页面上，您将了解有关GraphQL类型系统的所有知识，以及如何描述可查询哪些数据。 由于GraphQL可以与任何后端框架或编程语言一起使用，因此我们将远离实现特定的详细信息，仅讨论概念。</p>\n<h3 id=\"类型系统（Type-System）\"><a href=\"#类型系统（Type-System）\" class=\"headerlink\" title=\"类型系统（Type System）\"></a>类型系统（Type System）</h3><p>如果您以前看过GraphQL查询，那么你应该知道GraphQL查询语言基本上是在对象上选择字段。 所以在以下查询中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<ol>\n<li>从一个特殊的 “root”对象开始</li>\n<li>在它里面选择一个<code>hero</code>字段</li>\n<li>在<code>hero</code>返回的对象中，我们继续选择 <code>name</code> 和 <code>appearsIn</code> 字段</li>\n</ol>\n<p>因为GraphQL查询的形状与结果非常相似，所以您可以预测什么是查询将返回，而不必关心服务器的设置。 但是我们还是需要对我们所请求的数据进行详细的描述： </p>\n<ul>\n<li>我们可以选择哪些字段？ </li>\n<li>他们可能返回什么样的对象？ </li>\n<li>这些子对象里面包含哪些字段？ </li>\n</ul>\n<p>这就是schema所需要解决的问题。</p>\n<p>每个GraphQL服务定义一组完全描述可以在该服务上查询的可能数据的类型。 然后，当收到查询时，它们将根据该架构进行验证和执行。.</p>\n<h3 id=\"类型语句（Type-language）\"><a href=\"#类型语句（Type-language）\" class=\"headerlink\" title=\"类型语句（Type language）\"></a>类型语句（Type language）</h3><p>GraphQL服务可以用任何语言编写。我们不能依赖特定的编程语言语法（如JavaScript），因此我们将使用“GraphQL schema 语言” ，它类似于查询语言，并允许我们以语言无关的方式谈论GraphQL的架构。</p>\n<h3 id=\"对象的类型和字段（Object-types-and-fields）\"><a href=\"#对象的类型和字段（Object-types-and-fields）\" class=\"headerlink\" title=\"对象的类型和字段（Object types and fields）\"></a>对象的类型和字段（Object types and fields）</h3><p>GraphQL的最基本的组件是对象类型，表示你可以从服务中获取的一种对象，以及它具有哪些字段。 在GraphQL schema语言中，我们可以这样表示：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Character &#123;</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可读性已经很高了，但是让我们再过一遍，以便于让我们在细节上拥有共同的语言：</p>\n<ul>\n<li><code>Character</code>是一个对象类型，大多数情况下，schema里面的type都是一个对象</li>\n<li><code>name</code>和<code>appearsIn</code>是<code>Character</code>中的字段。意味着在任何查询包含<code>Character</code> 类的时候<code>name</code>和<code>appearsIn</code>是仅有且必须出现在其中的字段</li>\n<li><code>String</code>是内置的标量类型之一，标量是GraphQL中的最小的类型，不能再做子选择了。 我们会稍后再看标量类型。</li>\n</ul>\n<ul>\n<li><code>String!</code>代表着这个字段是不为空的，GraphQL服务保证在这个字段上返回一个不为空的值。</li>\n<li><code>[Episode]!</code>代表着一个包含<code>Episode</code>对象的数列，它也是不为空的，因此当你查询<code>appearsIn</code>字段时，GraphQL永远会返回一个数组，即使是一个空数组。</li>\n</ul>\n<p>现在，您知道GraphQL对象类型是什么样子了，并且掌握了如何读取GraphQL类型语言的基础知识。</p>\n<h3 id=\"参数（Arguments）\"><a href=\"#参数（Arguments）\" class=\"headerlink\" title=\"参数（Arguments）\"></a>参数（Arguments）</h3><p>GraphQL对象类型上的每个字段都可以有零个或多个参数，例如下面的<code>length</code>字段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Starship &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  length(unit: LengthUnit = METER): Float</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>所有参数都是有命名的。与JavaScript和Python这样的语言不同，函数采用有序参数列表，GraphQL中的所有参数都是通过名称进行传递。上面例子中，<code>length</code>字段有一个定义的参数，<code>unit</code>。</p>\n<p>参数可以是必需的或可选的。当参数是可选的时候，我们可以定义一个默认值 。上面例子中，如果<code>unit</code>参数没有被传递，默认情况下它将被设置为<code>METER</code>。</p>\n<h3 id=\"Query和Mutation类型（The-Query-and-Mutation-types）\"><a href=\"#Query和Mutation类型（The-Query-and-Mutation-types）\" class=\"headerlink\" title=\"Query和Mutation类型（The Query and Mutation types）\"></a>Query和Mutation类型（The Query and Mutation types）</h3><p>schema中的大多数类型将只是普通对象类型，但其中有两种特殊的类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">schema &#123;</span><br><span class=\"line\">  query: Query</span><br><span class=\"line\">  mutation: Mutation</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每个GraphQL服务都有一个<code>query</code>类型，但可能有也可能没有<code>mutation</code>类型。 这些类型与常规对象类型相同，但它们是特殊的，因为它们定义了每个GraphQL查询的入口点。 所以如果你看到一个查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query &#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  droid(id: &quot;2000&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"droid\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这意味着GraphQL服务需要一个具有<code>hero</code>和<code>droid</code>字段的<code>query</code>类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Query &#123;</span><br><span class=\"line\">  hero(episode: Episode): Character</span><br><span class=\"line\">  droid(id: ID!): Droid</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>Mutation</code>相同，您可以定义<code>Mutation</code>类型上的字段，这些字段就是你能变更的根字段。</p>\n<p>重要的是要记住，除了作为模式的“入口点”的特殊状态之外，“查询和变更”类型与任何其他GraphQL对象类型相同，它们的字段的工作方式完全相同。</p>\n<h3 id=\"标量类型（Scalar-types）\"><a href=\"#标量类型（Scalar-types）\" class=\"headerlink\" title=\"标量类型（Scalar types）\"></a>标量类型（Scalar types）</h3><p>GraphQL对象类型具有名称和字段，但在某些时候，这些字段必须解析为某些具体数据。 这就是标量类型的来历：它们代表查询最低端的叶子节点。下面查询中，<code>name</code>和<code>appearsIn</code>将会被解析为标量类型（因为这两个字段没有任何子字段，他们是本次查询的叶子节点）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>GraphQL默认自带了一些变量类型：</p>\n<ul>\n<li><code>Int</code>: 带符号32位的整数.</li>\n<li><code>Float</code>: 带符号的双精度浮点数.</li>\n<li><code>String</code>: UTF-8的字符串.</li>\n<li><code>Boolean</code>: <code>true</code> 或<code>false</code>.</li>\n<li><code>ID</code>: ID标量类型表示一个唯一的标识，通常用于重新获取对象或作为缓存中的键。 ID类型其实就是String类型; 然而将其定义为ID表示它是没有可读性的。</li>\n</ul>\n<p>在大多数GraphQL服务实现中，还有一种方法来自定义标量类型。 例如，我们可以定义一个日期类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scalar Date</span><br></pre></td></tr></table></figure>\n<p>然后由我们的自己来实现该自定义类型如何序列化，反序列化和验证。 例如，您可以指定Date类型应始终序列化为整数时间戳，并且让你的客户端也知道该格式。</p>\n<h3 id=\"枚举类型（Enumeration-types）\"><a href=\"#枚举类型（Enumeration-types）\" class=\"headerlink\" title=\"枚举类型（Enumeration types）\"></a>枚举类型（Enumeration types）</h3><p>也称为枚举（ <em>Enums</em> ），枚举类型是一种特殊类型的标量，仅限于一组特定的允许值。 这样你可以：</p>\n<ol>\n<li>验证此类型的任何参数是允许的值之一</li>\n<li>通过类型系统沟通一个字段永远是一组有限的值</li>\n</ol>\n<p>以下是GraphQL Schema语言中的枚举定义：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">enum Episode &#123;</span><br><span class=\"line\">  NEWHOPE</span><br><span class=\"line\">  EMPIRE</span><br><span class=\"line\">  JEDI</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这意味着无论何时我们在Schema中使用<code>Episode</code>类型时，其对应的值永远都是<code>NEWHOPE</code>, <code>EMPIRE</code>,  <code>JEDI</code>中间的一个。</p>\n<p>请注意，各种语言的GraphQL服务实现将以自己的语言特定方式来处理枚举。 以支持枚举作“为一流公民”的语言，某些实现可能会利用这一点; 在没有枚举支持的JavaScript语言中，这些值可能在内部映射到一组整数。 但是，这些细节不会泄露给客户端，客户端可以完全按照枚举值的字符串名称进行操作。</p>\n<h3 id=\"列表和非空类型（Lists-and-Non-Null）\"><a href=\"#列表和非空类型（Lists-and-Non-Null）\" class=\"headerlink\" title=\"列表和非空类型（Lists and Non-Null）\"></a>列表和非空类型（Lists and Non-Null）</h3><p>对象类型，标量和枚举是GraphQL中唯一可以定义的类型。 但是当您在Schema的其他部分或查询变量声明中使用这些类型时，可以使用类型修饰符来影响这些值的验证规则。 我们来看一个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Character &#123;</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在这里，我们使用一个String类型，并通过在它之后添加一个感叹号将其标记为一个非空类型。 这意味着我们的服务器总是期望为此字段返回一个非空值，如果最终得到一个空值，实际上会触发一个GraphQL执行错误，让客户端知道出现了一些问题。</p>\n<p>在定义字段的参数时，也可以使用非空类型修饰符，如果将null值作为该参数传递，则GraphQL服务器将返回验证错误，无论是在GraphQL字符串还是变量中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query DroidById($id: ID!) &#123;</span><br><span class=\"line\">  droid(id: $id) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"id\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Variable \\\"$id\\\" of required type \\\"ID!\\\" was not provided.\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">17</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>列表以类似的方式工作：我们可以使用类型修饰符将类型标记为List，这表示该字段将返回该类型的数组。 在模式语言中，通过将类型包装在方括号<code>[</code>和<code>]</code>中来表示。 它与参数的表现相同但验证步骤将期望该值的数组。</p>\n<p>非空修饰符和列表修饰符可以一起使用，例如，你可以要求一个由非空字符串组成的列表：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: [String!]</span><br></pre></td></tr></table></figure>\n<p>这意味着列表本身可以为空，但它不能有任何空的成员。例如，在返回的JSON中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: <span class=\"literal\">null</span> <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"literal\">null</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<p>现在，让我们定义一个由字符串组成的非空数组：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: [String]!</span><br></pre></td></tr></table></figure>\n<p>这意味着列表本身不能为空，但它可以包含空值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: <span class=\"literal\">null</span> <span class=\"comment\">// error</span></span><br><span class=\"line\">myField: [] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"literal\">null</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// valid</span></span><br></pre></td></tr></table></figure>\n<p>您可以根据需要随意嵌套任意数量的非空和列表修饰符。</p>\n<h3 id=\"接口（Interfaces）\"><a href=\"#接口（Interfaces）\" class=\"headerlink\" title=\"接口（Interfaces）\"></a>接口（Interfaces）</h3><p>像许多类型的系统一样，GraphQL支持接口。 接口是一种抽象类型，它包含一组类型必须包含已实现该接口的字段。</p>\n<p>例如，你可以有一个<code>Character</code>接口表示星球大战三部曲中的任何角色：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface Character &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  friends: [Character]</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这意味着，任何实现了<code>Character</code>接口的类型，都必须拥有这些字段，包括他们的参数和返回类型。例如，下面列举了一些实现<code>Character</code>接口的类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Human implements Character &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  friends: [Character]</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">  starships: [Starship]</span><br><span class=\"line\">  totalCredits: Int</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type Droid implements Character &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  friends: [Character]</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">  primaryFunction: String</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>您可以看到，这两种类型都具有<code>Character</code>接口中的所有字段，还可以引入特定类型字符的额外字段，<code>totalCredits</code>，<code>starships</code>和<code>primaryFunction</code>。</p>\n<p>当您要返回一个对象或一组对象时，接口很有用，但这些对象可能有几种不同的类型。</p>\n<p>请注意以下查询会产生错误：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true, &quot;variables&quot;: &#123; &quot;ep&quot;: &quot;JEDI&quot; &#125; &#125;</span><br><span class=\"line\">query HeroForEpisode($ep: Episode!) &#123;</span><br><span class=\"line\">  hero(episode: $ep) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    primaryFunction</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>hero</code>字段返回字符类型，这意味着它可能是<code>Human</code>或<code>Droid</code>，取决于<code>episode</code>参数。 在上面的查询中，您只能询问<code>Character</code>接口中存在的字段，不包括<code>primaryFunction</code>。</p>\n<p>为了得到在一个特定对象类型中的字段，你需要使用内联片段(inline fragment)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroForEpisode($ep: Episode!) &#123;</span><br><span class=\"line\">  hero(episode: $ep) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"联合类型（Union-types）\"><a href=\"#联合类型（Union-types）\" class=\"headerlink\" title=\"联合类型（Union types）\"></a>联合类型（Union types）</h3><p>联合类型与接口非常相似，但它们不能指定类型之间的任何公共字段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">union SearchResult = Human | Droid | Starship</span><br></pre></td></tr></table></figure>\n<p>当Schema返回了一个<code>SearchResult</code>类型，我们实际上可能会得到一个<code>Human</code>，一个<code>Droid</code>或者一个<code>Starship</code>。 注意，联合类型的成员需要是具体的对象类型; 您不能在接口或其他联合类型之上再创造一个联合类型。（扁平结构）</p>\n<p>在这种情况下，如果查询返回的是<code>SearchResult</code>这样的联合类型字段，则需要使用条件片段才能查询其中的任意子字段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  search(text: &quot;an&quot;) &#123;</span><br><span class=\"line\">    ... on Human &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Starship &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      length</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"search\"</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"height\"</span>: <span class=\"number\">1.8</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"height\"</span>: <span class=\"number\">1.5</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"TIE Advanced x1\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"length\"</span>: <span class=\"number\">9.2</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"输入类型（Input-types）\"><a href=\"#输入类型（Input-types）\" class=\"headerlink\" title=\"输入类型（Input types）\"></a>输入类型（Input types）</h3><p>到目前为止，我们只谈到将标量值（如枚举或字符串）作为参数传递到一个字段中。 但您也可以轻松地传递复杂的对象。 这在变更（Mutation）的情况下特别有价值，在这种情况下，您可能想要传入要创建的整个对象。 在GraphQL Schema语言中，输入类型与常规对象类型完全相同，但使用关键字<code>input</code>而不是<code>type</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input ReviewInput &#123;</span><br><span class=\"line\">  stars: Int!</span><br><span class=\"line\">  commentary: String</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>下面是如何在变更语句中使用输入类型对象的例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;</span><br><span class=\"line\">  createReview(episode: $ep, review: $review) &#123;</span><br><span class=\"line\">    stars</span><br><span class=\"line\">    commentary</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"review\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"createReview\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输入类型对象上的字段本身可以引用其他输入类型对象，但是您不能在Schema中混合输入和输出类型。 输入类型对象也不能在其字段上有参数。</p>\n","site":{"data":{}},"excerpt":"<p>在此页面上，您将了解有关GraphQL类型系统的所有知识，以及如何描述可查询哪些数据。 由于GraphQL可以与任何后端框架或编程语言一起使用，因此我们将远离实现特定的详细信息，仅讨论概念。</p>\n<h3 id=\"类型系统（Type-System）\"><a href=\"#类型系统（Type-System）\" class=\"headerlink\" title=\"类型系统（Type System）\"></a>类型系统（Type System）</h3><p>如果您以前看过GraphQL查询，那么你应该知道GraphQL查询语言基本上是在对象上选择字段。 所以在以下查询中：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","more":"<ol>\n<li>从一个特殊的 “root”对象开始</li>\n<li>在它里面选择一个<code>hero</code>字段</li>\n<li>在<code>hero</code>返回的对象中，我们继续选择 <code>name</code> 和 <code>appearsIn</code> 字段</li>\n</ol>\n<p>因为GraphQL查询的形状与结果非常相似，所以您可以预测什么是查询将返回，而不必关心服务器的设置。 但是我们还是需要对我们所请求的数据进行详细的描述： </p>\n<ul>\n<li>我们可以选择哪些字段？ </li>\n<li>他们可能返回什么样的对象？ </li>\n<li>这些子对象里面包含哪些字段？ </li>\n</ul>\n<p>这就是schema所需要解决的问题。</p>\n<p>每个GraphQL服务定义一组完全描述可以在该服务上查询的可能数据的类型。 然后，当收到查询时，它们将根据该架构进行验证和执行。.</p>\n<h3 id=\"类型语句（Type-language）\"><a href=\"#类型语句（Type-language）\" class=\"headerlink\" title=\"类型语句（Type language）\"></a>类型语句（Type language）</h3><p>GraphQL服务可以用任何语言编写。我们不能依赖特定的编程语言语法（如JavaScript），因此我们将使用“GraphQL schema 语言” ，它类似于查询语言，并允许我们以语言无关的方式谈论GraphQL的架构。</p>\n<h3 id=\"对象的类型和字段（Object-types-and-fields）\"><a href=\"#对象的类型和字段（Object-types-and-fields）\" class=\"headerlink\" title=\"对象的类型和字段（Object types and fields）\"></a>对象的类型和字段（Object types and fields）</h3><p>GraphQL的最基本的组件是对象类型，表示你可以从服务中获取的一种对象，以及它具有哪些字段。 在GraphQL schema语言中，我们可以这样表示：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Character &#123;</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>可读性已经很高了，但是让我们再过一遍，以便于让我们在细节上拥有共同的语言：</p>\n<ul>\n<li><code>Character</code>是一个对象类型，大多数情况下，schema里面的type都是一个对象</li>\n<li><code>name</code>和<code>appearsIn</code>是<code>Character</code>中的字段。意味着在任何查询包含<code>Character</code> 类的时候<code>name</code>和<code>appearsIn</code>是仅有且必须出现在其中的字段</li>\n<li><code>String</code>是内置的标量类型之一，标量是GraphQL中的最小的类型，不能再做子选择了。 我们会稍后再看标量类型。</li>\n</ul>\n<ul>\n<li><code>String!</code>代表着这个字段是不为空的，GraphQL服务保证在这个字段上返回一个不为空的值。</li>\n<li><code>[Episode]!</code>代表着一个包含<code>Episode</code>对象的数列，它也是不为空的，因此当你查询<code>appearsIn</code>字段时，GraphQL永远会返回一个数组，即使是一个空数组。</li>\n</ul>\n<p>现在，您知道GraphQL对象类型是什么样子了，并且掌握了如何读取GraphQL类型语言的基础知识。</p>\n<h3 id=\"参数（Arguments）\"><a href=\"#参数（Arguments）\" class=\"headerlink\" title=\"参数（Arguments）\"></a>参数（Arguments）</h3><p>GraphQL对象类型上的每个字段都可以有零个或多个参数，例如下面的<code>length</code>字段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Starship &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  length(unit: LengthUnit = METER): Float</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>所有参数都是有命名的。与JavaScript和Python这样的语言不同，函数采用有序参数列表，GraphQL中的所有参数都是通过名称进行传递。上面例子中，<code>length</code>字段有一个定义的参数，<code>unit</code>。</p>\n<p>参数可以是必需的或可选的。当参数是可选的时候，我们可以定义一个默认值 。上面例子中，如果<code>unit</code>参数没有被传递，默认情况下它将被设置为<code>METER</code>。</p>\n<h3 id=\"Query和Mutation类型（The-Query-and-Mutation-types）\"><a href=\"#Query和Mutation类型（The-Query-and-Mutation-types）\" class=\"headerlink\" title=\"Query和Mutation类型（The Query and Mutation types）\"></a>Query和Mutation类型（The Query and Mutation types）</h3><p>schema中的大多数类型将只是普通对象类型，但其中有两种特殊的类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">schema &#123;</span><br><span class=\"line\">  query: Query</span><br><span class=\"line\">  mutation: Mutation</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每个GraphQL服务都有一个<code>query</code>类型，但可能有也可能没有<code>mutation</code>类型。 这些类型与常规对象类型相同，但它们是特殊的，因为它们定义了每个GraphQL查询的入口点。 所以如果你看到一个查询：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query &#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  droid(id: &quot;2000&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"droid\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这意味着GraphQL服务需要一个具有<code>hero</code>和<code>droid</code>字段的<code>query</code>类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Query &#123;</span><br><span class=\"line\">  hero(episode: Episode): Character</span><br><span class=\"line\">  droid(id: ID!): Droid</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>Mutation</code>相同，您可以定义<code>Mutation</code>类型上的字段，这些字段就是你能变更的根字段。</p>\n<p>重要的是要记住，除了作为模式的“入口点”的特殊状态之外，“查询和变更”类型与任何其他GraphQL对象类型相同，它们的字段的工作方式完全相同。</p>\n<h3 id=\"标量类型（Scalar-types）\"><a href=\"#标量类型（Scalar-types）\" class=\"headerlink\" title=\"标量类型（Scalar types）\"></a>标量类型（Scalar types）</h3><p>GraphQL对象类型具有名称和字段，但在某些时候，这些字段必须解析为某些具体数据。 这就是标量类型的来历：它们代表查询最低端的叶子节点。下面查询中，<code>name</code>和<code>appearsIn</code>将会被解析为标量类型（因为这两个字段没有任何子字段，他们是本次查询的叶子节点）：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    appearsIn</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>GraphQL默认自带了一些变量类型：</p>\n<ul>\n<li><code>Int</code>: 带符号32位的整数.</li>\n<li><code>Float</code>: 带符号的双精度浮点数.</li>\n<li><code>String</code>: UTF-8的字符串.</li>\n<li><code>Boolean</code>: <code>true</code> 或<code>false</code>.</li>\n<li><code>ID</code>: ID标量类型表示一个唯一的标识，通常用于重新获取对象或作为缓存中的键。 ID类型其实就是String类型; 然而将其定义为ID表示它是没有可读性的。</li>\n</ul>\n<p>在大多数GraphQL服务实现中，还有一种方法来自定义标量类型。 例如，我们可以定义一个日期类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scalar Date</span><br></pre></td></tr></table></figure>\n<p>然后由我们的自己来实现该自定义类型如何序列化，反序列化和验证。 例如，您可以指定Date类型应始终序列化为整数时间戳，并且让你的客户端也知道该格式。</p>\n<h3 id=\"枚举类型（Enumeration-types）\"><a href=\"#枚举类型（Enumeration-types）\" class=\"headerlink\" title=\"枚举类型（Enumeration types）\"></a>枚举类型（Enumeration types）</h3><p>也称为枚举（ <em>Enums</em> ），枚举类型是一种特殊类型的标量，仅限于一组特定的允许值。 这样你可以：</p>\n<ol>\n<li>验证此类型的任何参数是允许的值之一</li>\n<li>通过类型系统沟通一个字段永远是一组有限的值</li>\n</ol>\n<p>以下是GraphQL Schema语言中的枚举定义：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">enum Episode &#123;</span><br><span class=\"line\">  NEWHOPE</span><br><span class=\"line\">  EMPIRE</span><br><span class=\"line\">  JEDI</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这意味着无论何时我们在Schema中使用<code>Episode</code>类型时，其对应的值永远都是<code>NEWHOPE</code>, <code>EMPIRE</code>,  <code>JEDI</code>中间的一个。</p>\n<p>请注意，各种语言的GraphQL服务实现将以自己的语言特定方式来处理枚举。 以支持枚举作“为一流公民”的语言，某些实现可能会利用这一点; 在没有枚举支持的JavaScript语言中，这些值可能在内部映射到一组整数。 但是，这些细节不会泄露给客户端，客户端可以完全按照枚举值的字符串名称进行操作。</p>\n<h3 id=\"列表和非空类型（Lists-and-Non-Null）\"><a href=\"#列表和非空类型（Lists-and-Non-Null）\" class=\"headerlink\" title=\"列表和非空类型（Lists and Non-Null）\"></a>列表和非空类型（Lists and Non-Null）</h3><p>对象类型，标量和枚举是GraphQL中唯一可以定义的类型。 但是当您在Schema的其他部分或查询变量声明中使用这些类型时，可以使用类型修饰符来影响这些值的验证规则。 我们来看一个例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Character &#123;</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在这里，我们使用一个String类型，并通过在它之后添加一个感叹号将其标记为一个非空类型。 这意味着我们的服务器总是期望为此字段返回一个非空值，如果最终得到一个空值，实际上会触发一个GraphQL执行错误，让客户端知道出现了一些问题。</p>\n<p>在定义字段的参数时，也可以使用非空类型修饰符，如果将null值作为该参数传递，则GraphQL服务器将返回验证错误，无论是在GraphQL字符串还是变量中。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query DroidById($id: ID!) &#123;</span><br><span class=\"line\">  droid(id: $id) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"id\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Variable \\\"$id\\\" of required type \\\"ID!\\\" was not provided.\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">17</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>列表以类似的方式工作：我们可以使用类型修饰符将类型标记为List，这表示该字段将返回该类型的数组。 在模式语言中，通过将类型包装在方括号<code>[</code>和<code>]</code>中来表示。 它与参数的表现相同但验证步骤将期望该值的数组。</p>\n<p>非空修饰符和列表修饰符可以一起使用，例如，你可以要求一个由非空字符串组成的列表：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: [String!]</span><br></pre></td></tr></table></figure>\n<p>这意味着列表本身可以为空，但它不能有任何空的成员。例如，在返回的JSON中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: <span class=\"literal\">null</span> <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"literal\">null</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// error</span></span><br></pre></td></tr></table></figure>\n<p>现在，让我们定义一个由字符串组成的非空数组：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: [String]!</span><br></pre></td></tr></table></figure>\n<p>这意味着列表本身不能为空，但它可以包含空值：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myField: <span class=\"literal\">null</span> <span class=\"comment\">// error</span></span><br><span class=\"line\">myField: [] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// valid</span></span><br><span class=\"line\">myField: [<span class=\"string\">'a'</span>, <span class=\"literal\">null</span>, <span class=\"string\">'b'</span>] <span class=\"comment\">// valid</span></span><br></pre></td></tr></table></figure>\n<p>您可以根据需要随意嵌套任意数量的非空和列表修饰符。</p>\n<h3 id=\"接口（Interfaces）\"><a href=\"#接口（Interfaces）\" class=\"headerlink\" title=\"接口（Interfaces）\"></a>接口（Interfaces）</h3><p>像许多类型的系统一样，GraphQL支持接口。 接口是一种抽象类型，它包含一组类型必须包含已实现该接口的字段。</p>\n<p>例如，你可以有一个<code>Character</code>接口表示星球大战三部曲中的任何角色：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface Character &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  friends: [Character]</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这意味着，任何实现了<code>Character</code>接口的类型，都必须拥有这些字段，包括他们的参数和返回类型。例如，下面列举了一些实现<code>Character</code>接口的类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type Human implements Character &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  friends: [Character]</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">  starships: [Starship]</span><br><span class=\"line\">  totalCredits: Int</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type Droid implements Character &#123;</span><br><span class=\"line\">  id: ID!</span><br><span class=\"line\">  name: String!</span><br><span class=\"line\">  friends: [Character]</span><br><span class=\"line\">  appearsIn: [Episode]!</span><br><span class=\"line\">  primaryFunction: String</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>您可以看到，这两种类型都具有<code>Character</code>接口中的所有字段，还可以引入特定类型字符的额外字段，<code>totalCredits</code>，<code>starships</code>和<code>primaryFunction</code>。</p>\n<p>当您要返回一个对象或一组对象时，接口很有用，但这些对象可能有几种不同的类型。</p>\n<p>请注意以下查询会产生错误：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true, &quot;variables&quot;: &#123; &quot;ep&quot;: &quot;JEDI&quot; &#125; &#125;</span><br><span class=\"line\">query HeroForEpisode($ep: Episode!) &#123;</span><br><span class=\"line\">  hero(episode: $ep) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    primaryFunction</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>hero</code>字段返回字符类型，这意味着它可能是<code>Human</code>或<code>Droid</code>，取决于<code>episode</code>参数。 在上面的查询中，您只能询问<code>Character</code>接口中存在的字段，不包括<code>primaryFunction</code>。</p>\n<p>为了得到在一个特定对象类型中的字段，你需要使用内联片段(inline fragment)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">query HeroForEpisode($ep: Episode!) &#123;</span><br><span class=\"line\">  hero(episode: $ep) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"联合类型（Union-types）\"><a href=\"#联合类型（Union-types）\" class=\"headerlink\" title=\"联合类型（Union types）\"></a>联合类型（Union types）</h3><p>联合类型与接口非常相似，但它们不能指定类型之间的任何公共字段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">union SearchResult = Human | Droid | Starship</span><br></pre></td></tr></table></figure>\n<p>当Schema返回了一个<code>SearchResult</code>类型，我们实际上可能会得到一个<code>Human</code>，一个<code>Droid</code>或者一个<code>Starship</code>。 注意，联合类型的成员需要是具体的对象类型; 您不能在接口或其他联合类型之上再创造一个联合类型。（扁平结构）</p>\n<p>在这种情况下，如果查询返回的是<code>SearchResult</code>这样的联合类型字段，则需要使用条件片段才能查询其中的任意子字段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  search(text: &quot;an&quot;) &#123;</span><br><span class=\"line\">    ... on Human &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      height</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ... on Starship &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      length</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"search\"</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"height\"</span>: <span class=\"number\">1.8</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"height\"</span>: <span class=\"number\">1.5</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"TIE Advanced x1\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"length\"</span>: <span class=\"number\">9.2</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"输入类型（Input-types）\"><a href=\"#输入类型（Input-types）\" class=\"headerlink\" title=\"输入类型（Input types）\"></a>输入类型（Input types）</h3><p>到目前为止，我们只谈到将标量值（如枚举或字符串）作为参数传递到一个字段中。 但您也可以轻松地传递复杂的对象。 这在变更（Mutation）的情况下特别有价值，在这种情况下，您可能想要传入要创建的整个对象。 在GraphQL Schema语言中，输入类型与常规对象类型完全相同，但使用关键字<code>input</code>而不是<code>type</code>：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input ReviewInput &#123;</span><br><span class=\"line\">  stars: Int!</span><br><span class=\"line\">  commentary: String</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>下面是如何在变更语句中使用输入类型对象的例子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;</span><br><span class=\"line\">  createReview(episode: $ep, review: $review) &#123;</span><br><span class=\"line\">    stars</span><br><span class=\"line\">    commentary</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"ep\"</span>: <span class=\"string\">\"JEDI\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"review\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"createReview\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"stars\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"commentary\"</span>: <span class=\"string\">\"This is a great movie!\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输入类型对象上的字段本身可以引用其他输入类型对象，但是您不能在Schema中混合输入和输出类型。 输入类型对象也不能在其字段上有参数。</p>"},{"title":"GraphQL Learn (3) - Validation","date":"2017-08-14T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n通过使用类型系统，可以预先确定GraphQL查询是否有效。 这样可以让服务器和客户端有效地通知开发人员在创建无效查询时，无需在运行时检查。\n\n对于我们的星球大战示例，文件[starWarsValidation-test.js](https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsValidation-test.js)包含许多无效的查询，可以用来测试当前实现的验证器。\n\n首先，我们来看一个复杂的有效查询。 这是一个嵌套查询，类似于上一节的一个示例，但将重复的字段分解成一个片段：\n\n```graphql\n{\n  hero {\n    ...NameAndAppearances\n    friends {\n      ...NameAndAppearances\n      friends {\n        ...NameAndAppearances\n      }\n    }\n  }\n}\n\nfragment NameAndAppearances on Character {\n  name\n  appearsIn\n}\n```\n<!--more-->\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"friends\": [\n        {\n          \"name\": \"Luke Skywalker\",\n          \"appearsIn\": [\n            \"NEWHOPE\",\n            \"EMPIRE\",\n            \"JEDI\"\n          ],\n          \"friends\": [\n            {\n              \"name\": \"Han Solo\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"Leia Organa\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"C-3PO\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"R2-D2\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            }\n          ]\n        },\n        {\n          \"name\": \"Han Solo\",\n          \"appearsIn\": [\n            \"NEWHOPE\",\n            \"EMPIRE\",\n            \"JEDI\"\n          ],\n          \"friends\": [\n            {\n              \"name\": \"Luke Skywalker\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"Leia Organa\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"R2-D2\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            }\n          ]\n        },\n        {\n          \"name\": \"Leia Organa\",\n          \"appearsIn\": [\n            \"NEWHOPE\",\n            \"EMPIRE\",\n            \"JEDI\"\n          ],\n          \"friends\": [\n            {\n              \"name\": \"Luke Skywalker\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"Han Solo\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"C-3PO\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"R2-D2\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  }\n}\n```\n\n这个查询是合法的，让我们看一些非法的查询：\n\n片段不能引用自身或创建一个循环，因为这可能导致无限循环！ 以上是上述相同的查询，但没有弄明白的三层的嵌套关系。\n\n```graphql\n# { \"graphiql\": true }\n{\n  hero {\n    ...NameAndAppearancesAndFriends\n  }\n}\n\nfragment NameAndAppearancesAndFriends on Character {\n  name\n  appearsIn\n  friends {\n    ...NameAndAppearancesAndFriends\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot spread fragment \\\"NameAndAppearancesAndFriends\\\" within itself.\",\n      \"locations\": [\n        {\n          \"line\": 11,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n当我们查询字段时，我们必须查询给定类型上存在的字段。 所以当`hereo`返回一个`Character`时，我们必须在一个`Character`字段上查询，然而该类型没有`favoriteSpaceship`字段，因此此查询无效：\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: favoriteSpaceship does not exist on Character\n{\n  hero {\n    favoriteSpaceship\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n\n\n每当我们查询一个字段并返回除标量或枚举之外的东西时，我们需要指定我们想从字段中获取的数据。 `hero`返回一个`Character`，而我们一直在请求其中的字段，如`name`和`appearIn`; 如果我们忽略，查询将不合法：\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: hero is not a scalar, so fields are needed\n{\n  hero\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n类似地，如果一个字段是一个标量，查询其中的其他字段就没有意义，这样做会使查询不合法：\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: name is a scalar, so fields are not permitted\n{\n  hero {\n    name {\n      firstCharacterOfName\n    }\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Field \\\"name\\\" must not have a selection since type \\\"String!\\\" has no subfields.\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 10\n        }\n      ]\n    }\n  ]\n}\n```\n\n之前，有人指出，查询只能查询有关类型的字段; 当我们查询返回一个`Character`的`hero`时，我们只能查询`Character`上存在的字段。 如果要直接查询R2-D2s的主要功能，会发生什么？\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: primaryFunction does not exist on Character\n{\n  hero {\n    name\n    primaryFunction\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\",\n      \"locations\": [\n        {\n          \"line\": 5,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n该查询无效，因为`primaryFunction`不是`Character`上字段。 我们想要一些判断，如果`Character`是`Droid`，则获取primaryFunction，否则忽略该字段。 我们可以使用前面介绍的片段（Fragment）来做到这一点。 通过设置一个在`Droid`上定义的片段并包含它，我们确保我们只查询已定义的`primaryFunction`。\n\n```graphql\n# { \"graphiql\": true }\n{\n  hero {\n    name\n    ...DroidFields\n  }\n}\n\nfragment DroidFields on Droid {\n  primaryFunction\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"primaryFunction\": \"Astromech\"\n    }\n  }\n}\n```\n\n这个查询是合法的，但它有点冗长; 当我们需要多次使用它时，命名片段是有价值的，但是如果我们只使用一次，我们可以直接使用内联片段。\n\n```graphql\n# { \"graphiql\": true }\n{\n  hero {\n    name\n    ... on Droid {\n      primaryFunction\n    }\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"primaryFunction\": \"Astromech\"\n    }\n  }\n}\n```\n\n以上只是验证系统的表面一层，事实上存在这很多验证规则来确保GraphQL查询具有良好的语义和意义。规范中的\"Validation\"章节有更详细的介绍。[validation](https://github.com/graphql/graphql-js/blob/master/src/validation) 中包含了GraphQL符合规范的代码实现。\n\n","source":"_posts/GraphQL Learn (3) - Validation.md","raw":"---\ntitle: GraphQL Learn (3) - Validation\ncategories: [Web]\ndate: 2017-8-15\ntags: [GraphQL]\ngrammar_cjkRuby: true\n---\n\n通过使用类型系统，可以预先确定GraphQL查询是否有效。 这样可以让服务器和客户端有效地通知开发人员在创建无效查询时，无需在运行时检查。\n\n对于我们的星球大战示例，文件[starWarsValidation-test.js](https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsValidation-test.js)包含许多无效的查询，可以用来测试当前实现的验证器。\n\n首先，我们来看一个复杂的有效查询。 这是一个嵌套查询，类似于上一节的一个示例，但将重复的字段分解成一个片段：\n\n```graphql\n{\n  hero {\n    ...NameAndAppearances\n    friends {\n      ...NameAndAppearances\n      friends {\n        ...NameAndAppearances\n      }\n    }\n  }\n}\n\nfragment NameAndAppearances on Character {\n  name\n  appearsIn\n}\n```\n<!--more-->\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"appearsIn\": [\n        \"NEWHOPE\",\n        \"EMPIRE\",\n        \"JEDI\"\n      ],\n      \"friends\": [\n        {\n          \"name\": \"Luke Skywalker\",\n          \"appearsIn\": [\n            \"NEWHOPE\",\n            \"EMPIRE\",\n            \"JEDI\"\n          ],\n          \"friends\": [\n            {\n              \"name\": \"Han Solo\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"Leia Organa\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"C-3PO\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"R2-D2\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            }\n          ]\n        },\n        {\n          \"name\": \"Han Solo\",\n          \"appearsIn\": [\n            \"NEWHOPE\",\n            \"EMPIRE\",\n            \"JEDI\"\n          ],\n          \"friends\": [\n            {\n              \"name\": \"Luke Skywalker\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"Leia Organa\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"R2-D2\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            }\n          ]\n        },\n        {\n          \"name\": \"Leia Organa\",\n          \"appearsIn\": [\n            \"NEWHOPE\",\n            \"EMPIRE\",\n            \"JEDI\"\n          ],\n          \"friends\": [\n            {\n              \"name\": \"Luke Skywalker\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"Han Solo\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"C-3PO\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            },\n            {\n              \"name\": \"R2-D2\",\n              \"appearsIn\": [\n                \"NEWHOPE\",\n                \"EMPIRE\",\n                \"JEDI\"\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  }\n}\n```\n\n这个查询是合法的，让我们看一些非法的查询：\n\n片段不能引用自身或创建一个循环，因为这可能导致无限循环！ 以上是上述相同的查询，但没有弄明白的三层的嵌套关系。\n\n```graphql\n# { \"graphiql\": true }\n{\n  hero {\n    ...NameAndAppearancesAndFriends\n  }\n}\n\nfragment NameAndAppearancesAndFriends on Character {\n  name\n  appearsIn\n  friends {\n    ...NameAndAppearancesAndFriends\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot spread fragment \\\"NameAndAppearancesAndFriends\\\" within itself.\",\n      \"locations\": [\n        {\n          \"line\": 11,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n当我们查询字段时，我们必须查询给定类型上存在的字段。 所以当`hereo`返回一个`Character`时，我们必须在一个`Character`字段上查询，然而该类型没有`favoriteSpaceship`字段，因此此查询无效：\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: favoriteSpaceship does not exist on Character\n{\n  hero {\n    favoriteSpaceship\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n\n\n每当我们查询一个字段并返回除标量或枚举之外的东西时，我们需要指定我们想从字段中获取的数据。 `hero`返回一个`Character`，而我们一直在请求其中的字段，如`name`和`appearIn`; 如果我们忽略，查询将不合法：\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: hero is not a scalar, so fields are needed\n{\n  hero\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n类似地，如果一个字段是一个标量，查询其中的其他字段就没有意义，这样做会使查询不合法：\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: name is a scalar, so fields are not permitted\n{\n  hero {\n    name {\n      firstCharacterOfName\n    }\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Field \\\"name\\\" must not have a selection since type \\\"String!\\\" has no subfields.\",\n      \"locations\": [\n        {\n          \"line\": 4,\n          \"column\": 10\n        }\n      ]\n    }\n  ]\n}\n```\n\n之前，有人指出，查询只能查询有关类型的字段; 当我们查询返回一个`Character`的`hero`时，我们只能查询`Character`上存在的字段。 如果要直接查询R2-D2s的主要功能，会发生什么？\n\n```graphql\n# { \"graphiql\": true }\n# INVALID: primaryFunction does not exist on Character\n{\n  hero {\n    name\n    primaryFunction\n  }\n}\n```\n\n```json\n{\n  \"errors\": [\n    {\n      \"message\": \"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\",\n      \"locations\": [\n        {\n          \"line\": 5,\n          \"column\": 5\n        }\n      ]\n    }\n  ]\n}\n```\n\n该查询无效，因为`primaryFunction`不是`Character`上字段。 我们想要一些判断，如果`Character`是`Droid`，则获取primaryFunction，否则忽略该字段。 我们可以使用前面介绍的片段（Fragment）来做到这一点。 通过设置一个在`Droid`上定义的片段并包含它，我们确保我们只查询已定义的`primaryFunction`。\n\n```graphql\n# { \"graphiql\": true }\n{\n  hero {\n    name\n    ...DroidFields\n  }\n}\n\nfragment DroidFields on Droid {\n  primaryFunction\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"primaryFunction\": \"Astromech\"\n    }\n  }\n}\n```\n\n这个查询是合法的，但它有点冗长; 当我们需要多次使用它时，命名片段是有价值的，但是如果我们只使用一次，我们可以直接使用内联片段。\n\n```graphql\n# { \"graphiql\": true }\n{\n  hero {\n    name\n    ... on Droid {\n      primaryFunction\n    }\n  }\n}\n```\n\n```json\n{\n  \"data\": {\n    \"hero\": {\n      \"name\": \"R2-D2\",\n      \"primaryFunction\": \"Astromech\"\n    }\n  }\n}\n```\n\n以上只是验证系统的表面一层，事实上存在这很多验证规则来确保GraphQL查询具有良好的语义和意义。规范中的\"Validation\"章节有更详细的介绍。[validation](https://github.com/graphql/graphql-js/blob/master/src/validation) 中包含了GraphQL符合规范的代码实现。\n\n","slug":"GraphQL Learn (3) - Validation","published":1,"updated":"2019-10-11T05:50:15.637Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck1lqzygh0007egqqjuoye9zh","content":"<p>通过使用类型系统，可以预先确定GraphQL查询是否有效。 这样可以让服务器和客户端有效地通知开发人员在创建无效查询时，无需在运行时检查。</p>\n<p>对于我们的星球大战示例，文件<a href=\"https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsValidation-test.js\" target=\"_blank\" rel=\"noopener\">starWarsValidation-test.js</a>包含许多无效的查询，可以用来测试当前实现的验证器。</p>\n<p>首先，我们来看一个复杂的有效查询。 这是一个嵌套查询，类似于上一节的一个示例，但将重复的字段分解成一个片段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    ...NameAndAppearances</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      ...NameAndAppearances</span><br><span class=\"line\">      friends &#123;</span><br><span class=\"line\">        ...NameAndAppearances</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment NameAndAppearances on Character &#123;</span><br><span class=\"line\">  name</span><br><span class=\"line\">  appearsIn</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">            <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">            <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">            <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个查询是合法的，让我们看一些非法的查询：</p>\n<p>片段不能引用自身或创建一个循环，因为这可能导致无限循环！ 以上是上述相同的查询，但没有弄明白的三层的嵌套关系。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    ...NameAndAppearancesAndFriends</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment NameAndAppearancesAndFriends on Character &#123;</span><br><span class=\"line\">  name</span><br><span class=\"line\">  appearsIn</span><br><span class=\"line\">  friends &#123;</span><br><span class=\"line\">    ...NameAndAppearancesAndFriends</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot spread fragment \\\"NameAndAppearancesAndFriends\\\" within itself.\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">11</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>当我们查询字段时，我们必须查询给定类型上存在的字段。 所以当<code>hereo</code>返回一个<code>Character</code>时，我们必须在一个<code>Character</code>字段上查询，然而该类型没有<code>favoriteSpaceship</code>字段，因此此查询无效：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: favoriteSpaceship does not exist on Character</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    favoriteSpaceship</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每当我们查询一个字段并返回除标量或枚举之外的东西时，我们需要指定我们想从字段中获取的数据。 <code>hero</code>返回一个<code>Character</code>，而我们一直在请求其中的字段，如<code>name</code>和<code>appearIn</code>; 如果我们忽略，查询将不合法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: hero is not a scalar, so fields are needed</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>类似地，如果一个字段是一个标量，查询其中的其他字段就没有意义，这样做会使查询不合法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: name is a scalar, so fields are not permitted</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name &#123;</span><br><span class=\"line\">      firstCharacterOfName</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Field \\\"name\\\" must not have a selection since type \\\"String!\\\" has no subfields.\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">10</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>之前，有人指出，查询只能查询有关类型的字段; 当我们查询返回一个<code>Character</code>的<code>hero</code>时，我们只能查询<code>Character</code>上存在的字段。 如果要直接查询R2-D2s的主要功能，会发生什么？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: primaryFunction does not exist on Character</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    primaryFunction</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该查询无效，因为<code>primaryFunction</code>不是<code>Character</code>上字段。 我们想要一些判断，如果<code>Character</code>是<code>Droid</code>，则获取primaryFunction，否则忽略该字段。 我们可以使用前面介绍的片段（Fragment）来做到这一点。 通过设置一个在<code>Droid</code>上定义的片段并包含它，我们确保我们只查询已定义的<code>primaryFunction</code>。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ...DroidFields</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment DroidFields on Droid &#123;</span><br><span class=\"line\">  primaryFunction</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个查询是合法的，但它有点冗长; 当我们需要多次使用它时，命名片段是有价值的，但是如果我们只使用一次，我们可以直接使用内联片段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以上只是验证系统的表面一层，事实上存在这很多验证规则来确保GraphQL查询具有良好的语义和意义。规范中的”Validation”章节有更详细的介绍。<a href=\"https://github.com/graphql/graphql-js/blob/master/src/validation\" target=\"_blank\" rel=\"noopener\">validation</a> 中包含了GraphQL符合规范的代码实现。</p>\n","site":{"data":{}},"excerpt":"<p>通过使用类型系统，可以预先确定GraphQL查询是否有效。 这样可以让服务器和客户端有效地通知开发人员在创建无效查询时，无需在运行时检查。</p>\n<p>对于我们的星球大战示例，文件<a href=\"https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsValidation-test.js\" target=\"_blank\" rel=\"noopener\">starWarsValidation-test.js</a>包含许多无效的查询，可以用来测试当前实现的验证器。</p>\n<p>首先，我们来看一个复杂的有效查询。 这是一个嵌套查询，类似于上一节的一个示例，但将重复的字段分解成一个片段：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    ...NameAndAppearances</span><br><span class=\"line\">    friends &#123;</span><br><span class=\"line\">      ...NameAndAppearances</span><br><span class=\"line\">      friends &#123;</span><br><span class=\"line\">        ...NameAndAppearances</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment NameAndAppearances on Character &#123;</span><br><span class=\"line\">  name</span><br><span class=\"line\">  appearsIn</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","more":"<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">            <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">            <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Leia Organa\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">            <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">          <span class=\"attr\">\"friends\"</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Luke Skywalker\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Han Solo\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"C-3PO\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"appearsIn\"</span>: [</span><br><span class=\"line\">                <span class=\"string\">\"NEWHOPE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"EMPIRE\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"JEDI\"</span></span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个查询是合法的，让我们看一些非法的查询：</p>\n<p>片段不能引用自身或创建一个循环，因为这可能导致无限循环！ 以上是上述相同的查询，但没有弄明白的三层的嵌套关系。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    ...NameAndAppearancesAndFriends</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment NameAndAppearancesAndFriends on Character &#123;</span><br><span class=\"line\">  name</span><br><span class=\"line\">  appearsIn</span><br><span class=\"line\">  friends &#123;</span><br><span class=\"line\">    ...NameAndAppearancesAndFriends</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot spread fragment \\\"NameAndAppearancesAndFriends\\\" within itself.\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">11</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>当我们查询字段时，我们必须查询给定类型上存在的字段。 所以当<code>hereo</code>返回一个<code>Character</code>时，我们必须在一个<code>Character</code>字段上查询，然而该类型没有<code>favoriteSpaceship</code>字段，因此此查询无效：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: favoriteSpaceship does not exist on Character</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    favoriteSpaceship</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每当我们查询一个字段并返回除标量或枚举之外的东西时，我们需要指定我们想从字段中获取的数据。 <code>hero</code>返回一个<code>Character</code>，而我们一直在请求其中的字段，如<code>name</code>和<code>appearIn</code>; 如果我们忽略，查询将不合法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: hero is not a scalar, so fields are needed</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"favoriteSpaceship\\\" on type \\\"Character\\\".\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>类似地，如果一个字段是一个标量，查询其中的其他字段就没有意义，这样做会使查询不合法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: name is a scalar, so fields are not permitted</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name &#123;</span><br><span class=\"line\">      firstCharacterOfName</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Field \\\"name\\\" must not have a selection since type \\\"String!\\\" has no subfields.\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">10</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>之前，有人指出，查询只能查询有关类型的字段; 当我们查询返回一个<code>Character</code>的<code>hero</code>时，我们只能查询<code>Character</code>上存在的字段。 如果要直接查询R2-D2s的主要功能，会发生什么？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\"># INVALID: primaryFunction does not exist on Character</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    primaryFunction</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"errors\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"message\"</span>: <span class=\"string\">\"Cannot query field \\\"primaryFunction\\\" on type \\\"Character\\\". Did you mean to use an inline fragment on \\\"Droid\\\"?\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"locations\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"line\"</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"column\"</span>: <span class=\"number\">5</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该查询无效，因为<code>primaryFunction</code>不是<code>Character</code>上字段。 我们想要一些判断，如果<code>Character</code>是<code>Droid</code>，则获取primaryFunction，否则忽略该字段。 我们可以使用前面介绍的片段（Fragment）来做到这一点。 通过设置一个在<code>Droid</code>上定义的片段并包含它，我们确保我们只查询已定义的<code>primaryFunction</code>。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ...DroidFields</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fragment DroidFields on Droid &#123;</span><br><span class=\"line\">  primaryFunction</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个查询是合法的，但它有点冗长; 当我们需要多次使用它时，命名片段是有价值的，但是如果我们只使用一次，我们可以直接使用内联片段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  hero &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    ... on Droid &#123;</span><br><span class=\"line\">      primaryFunction</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"hero\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"R2-D2\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"primaryFunction\"</span>: <span class=\"string\">\"Astromech\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以上只是验证系统的表面一层，事实上存在这很多验证规则来确保GraphQL查询具有良好的语义和意义。规范中的”Validation”章节有更详细的介绍。<a href=\"https://github.com/graphql/graphql-js/blob/master/src/validation\" target=\"_blank\" rel=\"noopener\">validation</a> 中包含了GraphQL符合规范的代码实现。</p>"},{"title":"GraphQL Learn (5) - Introspection","date":"2017-08-14T16:00:00.000Z","grammar_cjkRuby":true,"_content":"\n\n查询GraphQL架构有关它支持的查询的信息通常很有用。 GraphQL允许我们使用内省系统来做到这一点！对于我们的星球大战例子来说，文件[starWarsIntrospection-test.js](https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsIntrospection-test.js)包含许多查询内省系统的查询，并且是一个完整的按照规范实现的测试文件。\n\n我们设计了类型系统，所以我们应该知道系统中可用的类型。但是如果不知道，我们还可以通过查询__schema字段来询问GraphQL。这个字段始终存在于根类型中。\n<!--more-->\n\n```graphql\n# { \"graphiql\": true }\n{\n  __schema {\n    types {\n      name\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__schema\": {\n      \"types\": [\n        {\n          \"name\": \"Query\"\n        },\n        {\n          \"name\": \"Episode\"\n        },\n        {\n          \"name\": \"Character\"\n        },\n        {\n          \"name\": \"ID\"\n        },\n        {\n          \"name\": \"String\"\n        },\n        {\n          \"name\": \"Int\"\n        },\n        {\n          \"name\": \"FriendsConnection\"\n        },\n        {\n          \"name\": \"FriendsEdge\"\n        },\n        {\n          \"name\": \"PageInfo\"\n        },\n        {\n          \"name\": \"Boolean\"\n        },\n        {\n          \"name\": \"Review\"\n        },\n        {\n          \"name\": \"SearchResult\"\n        },\n        {\n          \"name\": \"Human\"\n        },\n        {\n          \"name\": \"LengthUnit\"\n        },\n        {\n          \"name\": \"Float\"\n        },\n        {\n          \"name\": \"Starship\"\n        },\n        {\n          \"name\": \"Droid\"\n        },\n        {\n          \"name\": \"Mutation\"\n        },\n        {\n          \"name\": \"ReviewInput\"\n        },\n        {\n          \"name\": \"__Schema\"\n        },\n        {\n          \"name\": \"__Type\"\n        },\n        {\n          \"name\": \"__TypeKind\"\n        },\n        {\n          \"name\": \"__Field\"\n        },\n        {\n          \"name\": \"__InputValue\"\n        },\n        {\n          \"name\": \"__EnumValue\"\n        },\n        {\n          \"name\": \"__Directive\"\n        },\n        {\n          \"name\": \"__DirectiveLocation\"\n        }\n      ]\n    }\n  }\n}\n```\n\n哇哦，这上面输出了很多类型，他们代表什么？让我们对他们进行一下分类：\n\n - **Query, Character, Human, Episode, Droid** - 这些都是我们在类型系统中定义的类型\n - **String, Boolean** - 这些是类型系统中内建的标量类型\n - ** \\_\\_Schema, \\_\\_Type, \\_\\_TypeKind, \\_\\_Field, \\_\\_InputValue, _\\_EnumValue, \\_\\_Directive  ** 这些名字都用双下划线做前缀，用来表示是内省系统里的类型。\n\n现在，让我们开始探索系统可用的查询。首先，当设计我们的类型系统时，我们指定了一个起始查询的类型，让内省系统告诉我们起始查询的名字：\n\n```graphql\n# { \"graphiql\": true }\n{\n  __schema {\n    queryType {\n      name\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__schema\": {\n      \"queryType\": {\n        \"name\": \"Query\"\n      }\n    }\n  }\n}\n```\n\n返回的结果与类型系统部分中所描述的匹配，`Query`类型是我们将要开始的地方！ 请注意，这里的命名只是为了方便，我们可以将`Query`类型命名为其他任何东西，如果我们指定它是查询的起始类型，系统仍然会返回相应的结果。虽然将它命名为`Query` 是一个比较实用的约定。\n\n让我们来看看`Droid`类型：\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\"\n    }\n  }\n}\n```\n\n如果我们需要知道更多的关于Droid的信息，比如说其中的一个接口或对象呢？\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    kind\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"kind\": \"OBJECT\"\n    }\n  }\n}\n```\n\n`kind`返回一个`__TypeKind`的枚举类型，值为`OBJECT1`，如果我们直接查询`Character`而不在接口里面的话呢？\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Character\") {\n    name\n    kind\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Character\",\n      \"kind\": \"INTERFACE\"\n    }\n  }\n}\n```\n\n知道一个对象所包含的所有字段是很常见的需求。所以，让我们继续查询`Droid`上面的内省系统：\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    fields {\n      name\n      type {\n        name\n        kind\n      }\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"fields\": [\n        {\n          \"name\": \"id\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"name\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"friends\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"LIST\"\n          }\n        },\n        {\n          \"name\": \"friendsConnection\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"appearsIn\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"primaryFunction\",\n          \"type\": {\n            \"name\": \"String\",\n            \"kind\": \"SCALAR\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n这些就是我们在`Droid`上面定义的字段！\n\n`id`看起来有点奇怪，它没有类型的名称。 因为它是一种“封装”的`NON_NULL`类型。 如果我们查询该字段类型的`ofType`信息，我们将会得到一个ID类型，告诉我们这是一个非空ID。\n相似的，`friends`和`appearsIn`也没有类型名，因为他们是一个`LIST`封装过的类型。我们可以查询他们的`ofType`信息，我们将会得到一个`LIST`类型。\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    fields {\n      name\n      type {\n        name\n        kind\n        ofType {\n          name\n          kind\n        }\n      }\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"fields\": [\n        {\n          \"name\": \"id\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": \"ID\",\n              \"kind\": \"SCALAR\"\n            }\n          }\n        },\n        {\n          \"name\": \"name\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": \"String\",\n              \"kind\": \"SCALAR\"\n            }\n          }\n        },\n        {\n          \"name\": \"friends\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"LIST\",\n            \"ofType\": {\n              \"name\": \"Character\",\n              \"kind\": \"INTERFACE\"\n            }\n          }\n        },\n        {\n          \"name\": \"friendsConnection\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": \"FriendsConnection\",\n              \"kind\": \"OBJECT\"\n            }\n          }\n        },\n        {\n          \"name\": \"appearsIn\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": null,\n              \"kind\": \"LIST\"\n            }\n          }\n        },\n        {\n          \"name\": \"primaryFunction\",\n          \"type\": {\n            \"name\": \"String\",\n            \"kind\": \"SCALAR\",\n            \"ofType\": null\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n让我们在这个非常适合作为一个工具的内省系统特性上结束本教程。让用户向系统本身查询文档！\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    description\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"description\": \"An autonomous mechanical character in the Star Wars universe\"\n    }\n  }\n}\n```\n\n我们可以使用内省系统访问有关类型系统的文档，并创造一种文档浏览器或富IDE的体验。\n\n这些只是内省系统的冰山一角，我们还可以查询枚举值、一个类型实现的接口等等。 我们甚至可以内省我们的内省系统本身。 该规范在“Introspection”部分中有关于该主题的更多细节，GraphQL.js中的 [introspection](https://github.com/graphql/graphql-js/blob/master/src/type/introspection.js)文件包含规范的代码实现。","source":"_posts/GraphQL Learn (5) - Introspection.md","raw":"---\ntitle: GraphQL Learn (5) - Introspection\ncategories: [Web]\ndate: 2017-8-15\ntags: [GraphQL]\ngrammar_cjkRuby: true\n---\n\n\n查询GraphQL架构有关它支持的查询的信息通常很有用。 GraphQL允许我们使用内省系统来做到这一点！对于我们的星球大战例子来说，文件[starWarsIntrospection-test.js](https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsIntrospection-test.js)包含许多查询内省系统的查询，并且是一个完整的按照规范实现的测试文件。\n\n我们设计了类型系统，所以我们应该知道系统中可用的类型。但是如果不知道，我们还可以通过查询__schema字段来询问GraphQL。这个字段始终存在于根类型中。\n<!--more-->\n\n```graphql\n# { \"graphiql\": true }\n{\n  __schema {\n    types {\n      name\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__schema\": {\n      \"types\": [\n        {\n          \"name\": \"Query\"\n        },\n        {\n          \"name\": \"Episode\"\n        },\n        {\n          \"name\": \"Character\"\n        },\n        {\n          \"name\": \"ID\"\n        },\n        {\n          \"name\": \"String\"\n        },\n        {\n          \"name\": \"Int\"\n        },\n        {\n          \"name\": \"FriendsConnection\"\n        },\n        {\n          \"name\": \"FriendsEdge\"\n        },\n        {\n          \"name\": \"PageInfo\"\n        },\n        {\n          \"name\": \"Boolean\"\n        },\n        {\n          \"name\": \"Review\"\n        },\n        {\n          \"name\": \"SearchResult\"\n        },\n        {\n          \"name\": \"Human\"\n        },\n        {\n          \"name\": \"LengthUnit\"\n        },\n        {\n          \"name\": \"Float\"\n        },\n        {\n          \"name\": \"Starship\"\n        },\n        {\n          \"name\": \"Droid\"\n        },\n        {\n          \"name\": \"Mutation\"\n        },\n        {\n          \"name\": \"ReviewInput\"\n        },\n        {\n          \"name\": \"__Schema\"\n        },\n        {\n          \"name\": \"__Type\"\n        },\n        {\n          \"name\": \"__TypeKind\"\n        },\n        {\n          \"name\": \"__Field\"\n        },\n        {\n          \"name\": \"__InputValue\"\n        },\n        {\n          \"name\": \"__EnumValue\"\n        },\n        {\n          \"name\": \"__Directive\"\n        },\n        {\n          \"name\": \"__DirectiveLocation\"\n        }\n      ]\n    }\n  }\n}\n```\n\n哇哦，这上面输出了很多类型，他们代表什么？让我们对他们进行一下分类：\n\n - **Query, Character, Human, Episode, Droid** - 这些都是我们在类型系统中定义的类型\n - **String, Boolean** - 这些是类型系统中内建的标量类型\n - ** \\_\\_Schema, \\_\\_Type, \\_\\_TypeKind, \\_\\_Field, \\_\\_InputValue, _\\_EnumValue, \\_\\_Directive  ** 这些名字都用双下划线做前缀，用来表示是内省系统里的类型。\n\n现在，让我们开始探索系统可用的查询。首先，当设计我们的类型系统时，我们指定了一个起始查询的类型，让内省系统告诉我们起始查询的名字：\n\n```graphql\n# { \"graphiql\": true }\n{\n  __schema {\n    queryType {\n      name\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__schema\": {\n      \"queryType\": {\n        \"name\": \"Query\"\n      }\n    }\n  }\n}\n```\n\n返回的结果与类型系统部分中所描述的匹配，`Query`类型是我们将要开始的地方！ 请注意，这里的命名只是为了方便，我们可以将`Query`类型命名为其他任何东西，如果我们指定它是查询的起始类型，系统仍然会返回相应的结果。虽然将它命名为`Query` 是一个比较实用的约定。\n\n让我们来看看`Droid`类型：\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\"\n    }\n  }\n}\n```\n\n如果我们需要知道更多的关于Droid的信息，比如说其中的一个接口或对象呢？\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    kind\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"kind\": \"OBJECT\"\n    }\n  }\n}\n```\n\n`kind`返回一个`__TypeKind`的枚举类型，值为`OBJECT1`，如果我们直接查询`Character`而不在接口里面的话呢？\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Character\") {\n    name\n    kind\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Character\",\n      \"kind\": \"INTERFACE\"\n    }\n  }\n}\n```\n\n知道一个对象所包含的所有字段是很常见的需求。所以，让我们继续查询`Droid`上面的内省系统：\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    fields {\n      name\n      type {\n        name\n        kind\n      }\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"fields\": [\n        {\n          \"name\": \"id\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"name\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"friends\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"LIST\"\n          }\n        },\n        {\n          \"name\": \"friendsConnection\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"appearsIn\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\"\n          }\n        },\n        {\n          \"name\": \"primaryFunction\",\n          \"type\": {\n            \"name\": \"String\",\n            \"kind\": \"SCALAR\"\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n这些就是我们在`Droid`上面定义的字段！\n\n`id`看起来有点奇怪，它没有类型的名称。 因为它是一种“封装”的`NON_NULL`类型。 如果我们查询该字段类型的`ofType`信息，我们将会得到一个ID类型，告诉我们这是一个非空ID。\n相似的，`friends`和`appearsIn`也没有类型名，因为他们是一个`LIST`封装过的类型。我们可以查询他们的`ofType`信息，我们将会得到一个`LIST`类型。\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    fields {\n      name\n      type {\n        name\n        kind\n        ofType {\n          name\n          kind\n        }\n      }\n    }\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"fields\": [\n        {\n          \"name\": \"id\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": \"ID\",\n              \"kind\": \"SCALAR\"\n            }\n          }\n        },\n        {\n          \"name\": \"name\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": \"String\",\n              \"kind\": \"SCALAR\"\n            }\n          }\n        },\n        {\n          \"name\": \"friends\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"LIST\",\n            \"ofType\": {\n              \"name\": \"Character\",\n              \"kind\": \"INTERFACE\"\n            }\n          }\n        },\n        {\n          \"name\": \"friendsConnection\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": \"FriendsConnection\",\n              \"kind\": \"OBJECT\"\n            }\n          }\n        },\n        {\n          \"name\": \"appearsIn\",\n          \"type\": {\n            \"name\": null,\n            \"kind\": \"NON_NULL\",\n            \"ofType\": {\n              \"name\": null,\n              \"kind\": \"LIST\"\n            }\n          }\n        },\n        {\n          \"name\": \"primaryFunction\",\n          \"type\": {\n            \"name\": \"String\",\n            \"kind\": \"SCALAR\",\n            \"ofType\": null\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n让我们在这个非常适合作为一个工具的内省系统特性上结束本教程。让用户向系统本身查询文档！\n\n```graphql\n# { \"graphiql\": true }\n{\n  __type(name: \"Droid\") {\n    name\n    description\n  }\n}\n```\n```json\n{\n  \"data\": {\n    \"__type\": {\n      \"name\": \"Droid\",\n      \"description\": \"An autonomous mechanical character in the Star Wars universe\"\n    }\n  }\n}\n```\n\n我们可以使用内省系统访问有关类型系统的文档，并创造一种文档浏览器或富IDE的体验。\n\n这些只是内省系统的冰山一角，我们还可以查询枚举值、一个类型实现的接口等等。 我们甚至可以内省我们的内省系统本身。 该规范在“Introspection”部分中有关于该主题的更多细节，GraphQL.js中的 [introspection](https://github.com/graphql/graphql-js/blob/master/src/type/introspection.js)文件包含规范的代码实现。","slug":"GraphQL Learn (5) - Introspection","published":1,"updated":"2019-10-11T05:50:15.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck1lqzygk0009egqqoomb6vxt","content":"<p>查询GraphQL架构有关它支持的查询的信息通常很有用。 GraphQL允许我们使用内省系统来做到这一点！对于我们的星球大战例子来说，文件<a href=\"https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsIntrospection-test.js\" target=\"_blank\" rel=\"noopener\">starWarsIntrospection-test.js</a>包含许多查询内省系统的查询，并且是一个完整的按照规范实现的测试文件。</p>\n<p>我们设计了类型系统，所以我们应该知道系统中可用的类型。但是如果不知道，我们还可以通过查询__schema字段来询问GraphQL。这个字段始终存在于根类型中。<br><a id=\"more\"></a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __schema &#123;</span><br><span class=\"line\">    types &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__schema\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"types\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Query\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Episode\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Character\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ID\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Int\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"FriendsConnection\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"FriendsEdge\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"PageInfo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Boolean\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Review\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"SearchResult\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Human\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"LengthUnit\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Float\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Starship\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Mutation\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ReviewInput\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Schema\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Type\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__TypeKind\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Field\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__InputValue\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__EnumValue\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Directive\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__DirectiveLocation\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>哇哦，这上面输出了很多类型，他们代表什么？让我们对他们进行一下分类：</p>\n<ul>\n<li><strong>Query, Character, Human, Episode, Droid</strong> - 这些都是我们在类型系统中定义的类型</li>\n<li><strong>String, Boolean</strong> - 这些是类型系统中内建的标量类型</li>\n<li><strong> __Schema, __Type, __TypeKind, __Field, __InputValue, __EnumValue, __Directive  </strong> 这些名字都用双下划线做前缀，用来表示是内省系统里的类型。</li>\n</ul>\n<p>现在，让我们开始探索系统可用的查询。首先，当设计我们的类型系统时，我们指定了一个起始查询的类型，让内省系统告诉我们起始查询的名字：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __schema &#123;</span><br><span class=\"line\">    queryType &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__schema\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"queryType\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Query\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>返回的结果与类型系统部分中所描述的匹配，<code>Query</code>类型是我们将要开始的地方！ 请注意，这里的命名只是为了方便，我们可以将<code>Query</code>类型命名为其他任何东西，如果我们指定它是查询的起始类型，系统仍然会返回相应的结果。虽然将它命名为<code>Query</code> 是一个比较实用的约定。</p>\n<p>让我们来看看<code>Droid</code>类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果我们需要知道更多的关于Droid的信息，比如说其中的一个接口或对象呢？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    kind</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"OBJECT\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>kind</code>返回一个<code>__TypeKind</code>的枚举类型，值为<code>OBJECT1</code>，如果我们直接查询<code>Character</code>而不在接口里面的话呢？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Character&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    kind</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Character\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"INTERFACE\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>知道一个对象所包含的所有字段是很常见的需求。所以，让我们继续查询<code>Droid</code>上面的内省系统：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    fields &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      type &#123;</span><br><span class=\"line\">        name</span><br><span class=\"line\">        kind</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"fields\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"id\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"name\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friends\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"LIST\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friendsConnection\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"appearsIn\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"primaryFunction\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这些就是我们在<code>Droid</code>上面定义的字段！</p>\n<p><code>id</code>看起来有点奇怪，它没有类型的名称。 因为它是一种“封装”的<code>NON_NULL</code>类型。 如果我们查询该字段类型的<code>ofType</code>信息，我们将会得到一个ID类型，告诉我们这是一个非空ID。<br>相似的，<code>friends</code>和<code>appearsIn</code>也没有类型名，因为他们是一个<code>LIST</code>封装过的类型。我们可以查询他们的<code>ofType</code>信息，我们将会得到一个<code>LIST</code>类型。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    fields &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      type &#123;</span><br><span class=\"line\">        name</span><br><span class=\"line\">        kind</span><br><span class=\"line\">        ofType &#123;</span><br><span class=\"line\">          name</span><br><span class=\"line\">          kind</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"fields\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"id\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ID\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"name\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friends\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"LIST\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Character\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"INTERFACE\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friendsConnection\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"FriendsConnection\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"OBJECT\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"appearsIn\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"LIST\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"primaryFunction\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>让我们在这个非常适合作为一个工具的内省系统特性上结束本教程。让用户向系统本身查询文档！</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    description</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"An autonomous mechanical character in the Star Wars universe\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们可以使用内省系统访问有关类型系统的文档，并创造一种文档浏览器或富IDE的体验。</p>\n<p>这些只是内省系统的冰山一角，我们还可以查询枚举值、一个类型实现的接口等等。 我们甚至可以内省我们的内省系统本身。 该规范在“Introspection”部分中有关于该主题的更多细节，GraphQL.js中的 <a href=\"https://github.com/graphql/graphql-js/blob/master/src/type/introspection.js\" target=\"_blank\" rel=\"noopener\">introspection</a>文件包含规范的代码实现。</p>\n","site":{"data":{}},"excerpt":"<p>查询GraphQL架构有关它支持的查询的信息通常很有用。 GraphQL允许我们使用内省系统来做到这一点！对于我们的星球大战例子来说，文件<a href=\"https://github.com/graphql/graphql-js/blob/master/src/__tests__/starWarsIntrospection-test.js\" target=\"_blank\" rel=\"noopener\">starWarsIntrospection-test.js</a>包含许多查询内省系统的查询，并且是一个完整的按照规范实现的测试文件。</p>\n<p>我们设计了类型系统，所以我们应该知道系统中可用的类型。但是如果不知道，我们还可以通过查询__schema字段来询问GraphQL。这个字段始终存在于根类型中。<br>","more":"</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __schema &#123;</span><br><span class=\"line\">    types &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__schema\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"types\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Query\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Episode\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Character\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ID\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Int\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"FriendsConnection\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"FriendsEdge\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"PageInfo\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Boolean\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Review\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"SearchResult\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Human\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"LengthUnit\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Float\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Starship\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Mutation\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ReviewInput\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Schema\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Type\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__TypeKind\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Field\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__InputValue\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__EnumValue\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__Directive\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"__DirectiveLocation\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>哇哦，这上面输出了很多类型，他们代表什么？让我们对他们进行一下分类：</p>\n<ul>\n<li><strong>Query, Character, Human, Episode, Droid</strong> - 这些都是我们在类型系统中定义的类型</li>\n<li><strong>String, Boolean</strong> - 这些是类型系统中内建的标量类型</li>\n<li><strong> __Schema, __Type, __TypeKind, __Field, __InputValue, __EnumValue, __Directive  </strong> 这些名字都用双下划线做前缀，用来表示是内省系统里的类型。</li>\n</ul>\n<p>现在，让我们开始探索系统可用的查询。首先，当设计我们的类型系统时，我们指定了一个起始查询的类型，让内省系统告诉我们起始查询的名字：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __schema &#123;</span><br><span class=\"line\">    queryType &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__schema\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"queryType\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Query\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>返回的结果与类型系统部分中所描述的匹配，<code>Query</code>类型是我们将要开始的地方！ 请注意，这里的命名只是为了方便，我们可以将<code>Query</code>类型命名为其他任何东西，如果我们指定它是查询的起始类型，系统仍然会返回相应的结果。虽然将它命名为<code>Query</code> 是一个比较实用的约定。</p>\n<p>让我们来看看<code>Droid</code>类型：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果我们需要知道更多的关于Droid的信息，比如说其中的一个接口或对象呢？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    kind</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"OBJECT\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>kind</code>返回一个<code>__TypeKind</code>的枚举类型，值为<code>OBJECT1</code>，如果我们直接查询<code>Character</code>而不在接口里面的话呢？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Character&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    kind</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Character\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"INTERFACE\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>知道一个对象所包含的所有字段是很常见的需求。所以，让我们继续查询<code>Droid</code>上面的内省系统：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    fields &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      type &#123;</span><br><span class=\"line\">        name</span><br><span class=\"line\">        kind</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"fields\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"id\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"name\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friends\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"LIST\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friendsConnection\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"appearsIn\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"primaryFunction\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这些就是我们在<code>Droid</code>上面定义的字段！</p>\n<p><code>id</code>看起来有点奇怪，它没有类型的名称。 因为它是一种“封装”的<code>NON_NULL</code>类型。 如果我们查询该字段类型的<code>ofType</code>信息，我们将会得到一个ID类型，告诉我们这是一个非空ID。<br>相似的，<code>friends</code>和<code>appearsIn</code>也没有类型名，因为他们是一个<code>LIST</code>封装过的类型。我们可以查询他们的<code>ofType</code>信息，我们将会得到一个<code>LIST</code>类型。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    fields &#123;</span><br><span class=\"line\">      name</span><br><span class=\"line\">      type &#123;</span><br><span class=\"line\">        name</span><br><span class=\"line\">        kind</span><br><span class=\"line\">        ofType &#123;</span><br><span class=\"line\">          name</span><br><span class=\"line\">          kind</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"fields\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"id\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ID\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"name\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friends\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"LIST\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Character\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"INTERFACE\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"friendsConnection\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"FriendsConnection\"</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"OBJECT\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"appearsIn\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"NON_NULL\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">\"name\"</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">              <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"LIST\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"primaryFunction\"</span>,</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"String\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"kind\"</span>: <span class=\"string\">\"SCALAR\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"ofType\"</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>让我们在这个非常适合作为一个工具的内省系统特性上结束本教程。让用户向系统本身查询文档！</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#123; &quot;graphiql&quot;: true &#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __type(name: &quot;Droid&quot;) &#123;</span><br><span class=\"line\">    name</span><br><span class=\"line\">    description</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"data\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"__type\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"Droid\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"An autonomous mechanical character in the Star Wars universe\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们可以使用内省系统访问有关类型系统的文档，并创造一种文档浏览器或富IDE的体验。</p>\n<p>这些只是内省系统的冰山一角，我们还可以查询枚举值、一个类型实现的接口等等。 我们甚至可以内省我们的内省系统本身。 该规范在“Introspection”部分中有关于该主题的更多细节，GraphQL.js中的 <a href=\"https://github.com/graphql/graphql-js/blob/master/src/type/introspection.js\" target=\"_blank\" rel=\"noopener\">introspection</a>文件包含规范的代码实现。</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"ciz5e9kzd00015rgx6k961ovc","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9kzz000c5rgx8pu9vv73"},{"post_id":"ciz5e9kzi00025rgxgb9pkka7","category_id":"ciz5e9kzv00085rgxd6kfi2t0","_id":"ciz5e9l06000i5rgxflsujptp"},{"post_id":"ciz5e9kzo00055rgxprbvyyew","category_id":"ciz5e9kzv00085rgxd6kfi2t0","_id":"ciz5e9l0a000o5rgxw9bzfu6q"},{"post_id":"ciz5e9l07000l5rgxzo0le3mq","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l0c000t5rgx1fduy4w0"},{"post_id":"ciz5e9kzr00065rgxgfv57oer","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l0d000x5rgxjkhnobke"},{"post_id":"ciz5e9l0b000s5rgxvdm64ll5","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l0e000z5rgx4lp461oh"},{"post_id":"ciz5e9kzt00075rgx4dode31m","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l0g00115rgxae5gc87a"},{"post_id":"ciz5e9l0c000u5rgx0sf30szz","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l0g00145rgx5pae0bzv"},{"post_id":"ciz5e9kzx000b5rgxrqv52hhc","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l0g00165rgxypgu1gp4"},{"post_id":"ciz5e9kzz000d5rgxvzuy4rvc","category_id":"ciz5e9l0f00105rgxx1q2l8uv","_id":"ciz5e9l0h001a5rgxoe73rn4o"},{"post_id":"ciz5e9l04000g5rgxsv7kvyd5","category_id":"ciz5e9l0g00175rgxbg8ss62i","_id":"ciz5e9l0i001d5rgx80s2rwsn"},{"post_id":"ciz5e9l05000h5rgx0f0d2u3l","category_id":"ciz5e9l0h001b5rgxeijiytjl","_id":"ciz5e9l0j001h5rgxpfzsmmce"},{"post_id":"ciz5e9l09000n5rgxxtie0sci","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ciz5e9l0k001m5rgxguyo6vhk"},{"post_id":"ciz5e9l0d000y5rgxd1jr5dm2","category_id":"ciz5e9l0j001j5rgxpw3qul8d","_id":"ciz5e9l0k001p5rgx8ed91wkk"},{"post_id":"ciz5e9l17002v5rgxops3py9w","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1b002z5rgxr8wytw22"},{"post_id":"ciz5e9l19002w5rgx79vzuwrs","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1d00335rgx11j1oyq3"},{"post_id":"ciz5e9l1a002y5rgxyc60cllz","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1e00365rgxoszjiblk"},{"post_id":"ciz5e9l1c00315rgxhcf5vj43","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1f00385rgxxsxw8sdk"},{"post_id":"ciz5e9l1d00355rgxh9f3w4oh","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1h003c5rgxkbarm70c"},{"post_id":"ciz5e9l1e00375rgxqoju7e8i","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1i003e5rgxrwr4geal"},{"post_id":"ciz5e9l1f00395rgx5vxux2pl","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1k003h5rgxznfxjl4q"},{"post_id":"ciz5e9l1h003d5rgx25rdqo0a","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l1m003k5rgx540m5326"},{"post_id":"ciz5e9l1i003f5rgxwnrdaper","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1p003o5rgxmbx3w0vw"},{"post_id":"ciz5e9l1k003i5rgxrvzlzvpx","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l1r003s5rgx523z9b0r"},{"post_id":"ciz5e9l1r003t5rgx7ww6bs4l","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l1w00405rgx847ciny5"},{"post_id":"ciz5e9l1t003w5rgxge72vaj8","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l1y00445rgx0klqcvk3"},{"post_id":"ciz5e9l1n003l5rgxakgqajcx","category_id":"ciz5e9l1q003q5rgx5sqpruu5","_id":"ciz5e9l2100485rgx279uj18r"},{"post_id":"ciz5e9l1v003y5rgxpr7jpvgd","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ciz5e9l22004c5rgx9vfwy9pv"},{"post_id":"ciz5e9l1p003p5rgx68tnxzmz","category_id":"ciz5e9l1q003q5rgx5sqpruu5","_id":"ciz5e9l23004f5rgx9bbreevl"},{"post_id":"ciz5e9l1y00465rgx9t3o7gv0","category_id":"ciz5e9l0g00175rgxbg8ss62i","_id":"ciz5e9l24004k5rgxdf6tbwl1"},{"post_id":"ciz5e9l22004e5rgxwu69cxu8","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l26004n5rgxybm0a9o9"},{"post_id":"ciz5e9l1w00435rgxcv5gdy3r","category_id":"ciz5e9l2100475rgxkis8v4ek","_id":"ciz5e9l27004r5rgxrkl736ab"},{"post_id":"ciz5e9l23004h5rgx4muzrsh9","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l2a004v5rgx5trsg2id"},{"post_id":"ciz5e9l25004m5rgxyqsm7a5t","category_id":"ciz5e9l2100475rgxkis8v4ek","_id":"ciz5e9l2b004x5rgxpsybhy15"},{"post_id":"ciz5e9l21004a5rgxtp6trlpu","category_id":"ciz5e9l24004i5rgxvx5z7bdx","_id":"ciz5e9l2d00515rgxskkpx2pu"},{"post_id":"ciz5e9l27004s5rgx0f6vl7n6","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"ciz5e9l2g00555rgxjtcq0h5c"},{"post_id":"ciz5e9l2b004z5rgxo8rmx87z","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l2h00595rgxe50gdgs6"},{"post_id":"ciz5e9l26004p5rgxh0s4298g","category_id":"ciz5e9l29004u5rgxeykp4y99","_id":"ciz5e9l2j005c5rgx1rb1n48s"},{"post_id":"ciz5e9l2d00525rgxjsqgoac2","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l2l005g5rgxmabd9hp2"},{"post_id":"ciz5e9l2g00565rgxm4721oq0","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l2l005i5rgxzcqd73af"},{"post_id":"ciz5e9l2a004w5rgxfs7hp83k","category_id":"ciz5e9l2e00535rgxc9w4w50f","_id":"ciz5e9l2m005l5rgxvzovd8km"},{"post_id":"ciz5e9l2h005a5rgx42jo1ofr","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l2m005n5rgxluyhlwyj"},{"post_id":"ciz5e9l2j005d5rgxtb7z1kn6","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"ciz5e9l2m005q5rgx03a5wuq1"},{"post_id":"cizt7c0j70000awgs27d414yh","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"cizt7c0k10002awgs2tzrlgm8"},{"post_id":"cizt7c0k70006awgs6es5wjqc","category_id":"ciz5e9kzk00035rgxthvkzp4k","_id":"cizt7c0k90008awgsbx9hxkt0"},{"post_id":"cj1q5qb6o0000oqgxmben6x83","category_id":"ciz5e9l07000j5rgxfcgnkvtm","_id":"cj1q5qb7q0002oqgxp35vivbn"},{"post_id":"ck1lqzyf60000egqq5lsl9yev","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ck1lqzyfm0002egqqbwyomyma"},{"post_id":"ck1lqzyga0004egqqlbayex1o","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ck1lqzygm000aegqqys553p7m"},{"post_id":"ck1lqzygd0005egqqusf217a0","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ck1lqzygq000cegqqcdwnmlwf"},{"post_id":"ck1lqzygh0007egqqjuoye9zh","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ck1lqzygu000eegqqeiqdnzp0"},{"post_id":"ck1lqzygk0009egqqoomb6vxt","category_id":"ciz5e9l0i001e5rgx2bsi3qov","_id":"ck1lqzygw000fegqqnccc1gd4"}],"PostTag":[{"post_id":"ciz5e9kzd00015rgx6k961ovc","tag_id":"ciz5e9kzn00045rgx65v6587p","_id":"ciz5e9kzw000a5rgxkl8d4ign"},{"post_id":"ciz5e9kzi00025rgxgb9pkka7","tag_id":"ciz5e9kzv00095rgxaw0k2w89","_id":"ciz5e9l08000m5rgxqtb3pg9c"},{"post_id":"ciz5e9kzi00025rgxgb9pkka7","tag_id":"ciz5e9l01000f5rgxme1ogazb","_id":"ciz5e9l0a000p5rgxsat3lqwj"},{"post_id":"ciz5e9kzo00055rgxprbvyyew","tag_id":"ciz5e9kzv00095rgxaw0k2w89","_id":"ciz5e9l0g00135rgxm5pg89xq"},{"post_id":"ciz5e9kzo00055rgxprbvyyew","tag_id":"ciz5e9l01000f5rgxme1ogazb","_id":"ciz5e9l0g00155rgxl45l5dfe"},{"post_id":"ciz5e9kzo00055rgxprbvyyew","tag_id":"ciz5e9l0d000w5rgxvz9hmo39","_id":"ciz5e9l0h00195rgx6es4m3l8"},{"post_id":"ciz5e9kzr00065rgxgfv57oer","tag_id":"ciz5e9l0g00125rgx8vztqt4n","_id":"ciz5e9l0i001g5rgx2iyrj59h"},{"post_id":"ciz5e9kzr00065rgxgfv57oer","tag_id":"ciz5e9l0g00185rgxs7kpv6jn","_id":"ciz5e9l0j001i5rgxb9afpoza"},{"post_id":"ciz5e9kzr00065rgxgfv57oer","tag_id":"ciz5e9l0h001c5rgx80nf8jgo","_id":"ciz5e9l0k001l5rgxnsptmrsw"},{"post_id":"ciz5e9kzt00075rgx4dode31m","tag_id":"ciz5e9l0g00125rgx8vztqt4n","_id":"ciz5e9l0k001n5rgxrtgwj5rc"},{"post_id":"ciz5e9kzx000b5rgxrqv52hhc","tag_id":"ciz5e9l0j001k5rgxwsexnm88","_id":"ciz5e9l0m001t5rgxqklx64wu"},{"post_id":"ciz5e9kzx000b5rgxrqv52hhc","tag_id":"ciz5e9l0k001o5rgxr3wvn7ze","_id":"ciz5e9l0m001u5rgx69f7surv"},{"post_id":"ciz5e9kzx000b5rgxrqv52hhc","tag_id":"ciz5e9l0k001q5rgxixyxcr6f","_id":"ciz5e9l0m001w5rgx7va8j77t"},{"post_id":"ciz5e9kzx000b5rgxrqv52hhc","tag_id":"ciz5e9l0l001r5rgxkabcsl3q","_id":"ciz5e9l0n001x5rgxi60qmzk8"},{"post_id":"ciz5e9kzz000d5rgxvzuy4rvc","tag_id":"ciz5e9l0l001s5rgxohkf1nbf","_id":"ciz5e9l0o00205rgxecafsw86"},{"post_id":"ciz5e9kzz000d5rgxvzuy4rvc","tag_id":"ciz5e9l0m001v5rgxcj0armp4","_id":"ciz5e9l0o00215rgxhzep14ge"},{"post_id":"ciz5e9kzz000d5rgxvzuy4rvc","tag_id":"ciz5e9l0n001y5rgx778m72cg","_id":"ciz5e9l0o00235rgxthd30z1k"},{"post_id":"ciz5e9l04000g5rgxsv7kvyd5","tag_id":"ciz5e9l0o001z5rgx5cetlt5p","_id":"ciz5e9l0p00265rgxfny5z3sn"},{"post_id":"ciz5e9l04000g5rgxsv7kvyd5","tag_id":"ciz5e9l0o00225rgxip1vaw2g","_id":"ciz5e9l0p00275rgxa8ed80ba"},{"post_id":"ciz5e9l04000g5rgxsv7kvyd5","tag_id":"ciz5e9l0o00245rgxftlmfmni","_id":"ciz5e9l0p00295rgxv9afxsdv"},{"post_id":"ciz5e9l05000h5rgx0f0d2u3l","tag_id":"ciz5e9l0o00255rgxi7c1k2cl","_id":"ciz5e9l0r002d5rgxauwugvjv"},{"post_id":"ciz5e9l05000h5rgx0f0d2u3l","tag_id":"ciz5e9l0p00285rgx2uqyxc52","_id":"ciz5e9l0r002e5rgxpf5qfva8"},{"post_id":"ciz5e9l05000h5rgx0f0d2u3l","tag_id":"ciz5e9l0p002a5rgxlm9qmhpv","_id":"ciz5e9l0r002g5rgx3sxsqxxz"},{"post_id":"ciz5e9l05000h5rgx0f0d2u3l","tag_id":"ciz5e9l0q002b5rgx8ngegtwp","_id":"ciz5e9l0r002h5rgx9y3tqjqk"},{"post_id":"ciz5e9l07000l5rgxzo0le3mq","tag_id":"ciz5e9l0q002c5rgxq7ptb9qf","_id":"ciz5e9l0r002j5rgx8k7vxknl"},{"post_id":"ciz5e9l09000n5rgxxtie0sci","tag_id":"ciz5e9l0r002f5rgxn1vycchn","_id":"ciz5e9l0r002m5rgxgg8w4hda"},{"post_id":"ciz5e9l09000n5rgxxtie0sci","tag_id":"ciz5e9l0r002i5rgxfrwrarvs","_id":"ciz5e9l0s002n5rgxndtxooal"},{"post_id":"ciz5e9l09000n5rgxxtie0sci","tag_id":"ciz5e9l0r002k5rgx9p7wzq9s","_id":"ciz5e9l0s002p5rgxx6lx4gun"},{"post_id":"ciz5e9l0b000s5rgxvdm64ll5","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l0s002q5rgxp5f5xn4f"},{"post_id":"ciz5e9l0c000u5rgx0sf30szz","tag_id":"ciz5e9l0s002o5rgx3fb1ilzq","_id":"ciz5e9l0s002s5rgxywvjz6kv"},{"post_id":"ciz5e9l0c000u5rgx0sf30szz","tag_id":"ciz5e9kzn00045rgx65v6587p","_id":"ciz5e9l0s002t5rgxy319k140"},{"post_id":"ciz5e9l0d000y5rgxd1jr5dm2","tag_id":"ciz5e9l0s002r5rgx8qen89ql","_id":"ciz5e9l0s002u5rgxsvkjqc3s"},{"post_id":"ciz5e9l17002v5rgxops3py9w","tag_id":"ciz5e9l0s002o5rgx3fb1ilzq","_id":"ciz5e9l1a002x5rgxf1680urh"},{"post_id":"ciz5e9l17002v5rgxops3py9w","tag_id":"ciz5e9l0q002c5rgxq7ptb9qf","_id":"ciz5e9l1b00305rgxi2zglz00"},{"post_id":"ciz5e9l19002w5rgx79vzuwrs","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l1d00345rgxo289kwke"},{"post_id":"ciz5e9l1a002y5rgxyc60cllz","tag_id":"ciz5e9l1d00325rgxrp1j8ton","_id":"ciz5e9l1h003b5rgxr3f7sd6u"},{"post_id":"ciz5e9l1i003f5rgxwnrdaper","tag_id":"ciz5e9l0s002o5rgx3fb1ilzq","_id":"ciz5e9l1m003j5rgx17fltvge"},{"post_id":"ciz5e9l1k003i5rgxrvzlzvpx","tag_id":"ciz5e9l0s002o5rgx3fb1ilzq","_id":"ciz5e9l1o003n5rgxwfov0hze"},{"post_id":"ciz5e9l1k003i5rgxrvzlzvpx","tag_id":"ciz5e9kzn00045rgx65v6587p","_id":"ciz5e9l1r003r5rgxernqzpyw"},{"post_id":"ciz5e9l1c00315rgxhcf5vj43","tag_id":"ciz5e9l1g003a5rgxcjyjgt67","_id":"ciz5e9l1t003v5rgxw7zwolq7"},{"post_id":"ciz5e9l1c00315rgxhcf5vj43","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l1u003x5rgx0yy017ml"},{"post_id":"ciz5e9l1c00315rgxhcf5vj43","tag_id":"ciz5e9l1k003g5rgxuw1potcd","_id":"ciz5e9l1w00415rgx4qshba33"},{"post_id":"ciz5e9l1d00355rgxh9f3w4oh","tag_id":"ciz5e9l1g003a5rgxcjyjgt67","_id":"ciz5e9l1y00455rgxocb4lskf"},{"post_id":"ciz5e9l1d00355rgxh9f3w4oh","tag_id":"ciz5e9l1t003u5rgx2yffwjt1","_id":"ciz5e9l2100495rgxo1i86plg"},{"post_id":"ciz5e9l1d00355rgxh9f3w4oh","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l22004d5rgxnd4jluf8"},{"post_id":"ciz5e9l1w00435rgxcv5gdy3r","tag_id":"ciz5e9kzn00045rgx65v6587p","_id":"ciz5e9l23004g5rgxldikdkod"},{"post_id":"ciz5e9l1e00375rgxqoju7e8i","tag_id":"ciz5e9l1w00425rgxaw8tnsbt","_id":"ciz5e9l24004l5rgxps84voe8"},{"post_id":"ciz5e9l1f00395rgx5vxux2pl","tag_id":"ciz5e9l21004b5rgxtv856von","_id":"ciz5e9l26004o5rgx56qu0vei"},{"post_id":"ciz5e9l1h003d5rgx25rdqo0a","tag_id":"ciz5e9l24004j5rgxuhj5t2z8","_id":"ciz5e9l29004t5rgxe4khmv6g"},{"post_id":"ciz5e9l1n003l5rgxakgqajcx","tag_id":"ciz5e9l0r002k5rgx9p7wzq9s","_id":"ciz5e9l2d00505rgxnvcptcau"},{"post_id":"ciz5e9l1n003l5rgxakgqajcx","tag_id":"ciz5e9l27004q5rgx3cjmmc1b","_id":"ciz5e9l2f00545rgxzzagosos"},{"post_id":"ciz5e9l2b004z5rgxo8rmx87z","tag_id":"ciz5e9l0s002o5rgx3fb1ilzq","_id":"ciz5e9l2h00585rgxc46zt68e"},{"post_id":"ciz5e9l1p003p5rgx68tnxzmz","tag_id":"ciz5e9l2b004y5rgxhk088l7p","_id":"ciz5e9l2j005b5rgxc2wkbtrt"},{"post_id":"ciz5e9l1p003p5rgx68tnxzmz","tag_id":"ciz5e9l0r002k5rgx9p7wzq9s","_id":"ciz5e9l2l005f5rgx71fl55b1"},{"post_id":"ciz5e9l2h005a5rgx42jo1ofr","tag_id":"ciz5e9l0q002c5rgxq7ptb9qf","_id":"ciz5e9l2l005h5rgx2v13e1m5"},{"post_id":"ciz5e9l1r003t5rgx7ww6bs4l","tag_id":"ciz5e9l24004j5rgxuhj5t2z8","_id":"ciz5e9l2m005k5rgxr27gvu0j"},{"post_id":"ciz5e9l2j005d5rgxtb7z1kn6","tag_id":"ciz5e9l0s002o5rgx3fb1ilzq","_id":"ciz5e9l2m005m5rgxkrluena1"},{"post_id":"ciz5e9l1t003w5rgxge72vaj8","tag_id":"ciz5e9l24004j5rgxuhj5t2z8","_id":"ciz5e9l2m005p5rgxwpjussue"},{"post_id":"ciz5e9l1v003y5rgxpr7jpvgd","tag_id":"ciz5e9l2l005j5rgx4gm2ecu2","_id":"ciz5e9l2n005t5rgxrc9cxy56"},{"post_id":"ciz5e9l1v003y5rgxpr7jpvgd","tag_id":"ciz5e9l2m005o5rgxn23jgjyk","_id":"ciz5e9l2n005u5rgxy6t8djf4"},{"post_id":"ciz5e9l1v003y5rgxpr7jpvgd","tag_id":"ciz5e9l2m005r5rgx1h9opij6","_id":"ciz5e9l2n005w5rgxqqj3hxjv"},{"post_id":"ciz5e9l1y00465rgx9t3o7gv0","tag_id":"ciz5e9l2n005s5rgxmieywmqb","_id":"ciz5e9l2n005y5rgxjtfsb71a"},{"post_id":"ciz5e9l1y00465rgx9t3o7gv0","tag_id":"ciz5e9l2n005v5rgxngg6jjv9","_id":"ciz5e9l2n005z5rgxqhq3nfoh"},{"post_id":"ciz5e9l21004a5rgxtp6trlpu","tag_id":"ciz5e9l2n005x5rgxebxgjvku","_id":"ciz5e9l2o00625rgxgxpxoo3t"},{"post_id":"ciz5e9l21004a5rgxtp6trlpu","tag_id":"ciz5e9l2o00605rgx2qyz6df9","_id":"ciz5e9l2o00635rgxxultl569"},{"post_id":"ciz5e9l22004e5rgxwu69cxu8","tag_id":"ciz5e9l2o00615rgx8oh4jfyr","_id":"ciz5e9l2p00665rgxkmi0j9h6"},{"post_id":"ciz5e9l22004e5rgxwu69cxu8","tag_id":"ciz5e9l2o00645rgx79rdeskw","_id":"ciz5e9l2p00675rgxzk5a4cux"},{"post_id":"ciz5e9l22004e5rgxwu69cxu8","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l2p00695rgxb1ajjird"},{"post_id":"ciz5e9l22004e5rgxwu69cxu8","tag_id":"ciz5e9l1g003a5rgxcjyjgt67","_id":"ciz5e9l2p006a5rgxhbvg2w1k"},{"post_id":"ciz5e9l23004h5rgx4muzrsh9","tag_id":"ciz5e9l2o00615rgx8oh4jfyr","_id":"ciz5e9l2q006c5rgxr7vp8hjw"},{"post_id":"ciz5e9l23004h5rgx4muzrsh9","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l2q006d5rgxbi08rq2u"},{"post_id":"ciz5e9l23004h5rgx4muzrsh9","tag_id":"ciz5e9l1g003a5rgxcjyjgt67","_id":"ciz5e9l2q006f5rgxhnv6dysu"},{"post_id":"ciz5e9l23004h5rgx4muzrsh9","tag_id":"ciz5e9l2p00685rgxxiqmmxt1","_id":"ciz5e9l2q006g5rgxgx5wn2bj"},{"post_id":"ciz5e9l25004m5rgxyqsm7a5t","tag_id":"ciz5e9l2p006b5rgxbq42zdo2","_id":"ciz5e9l2r006i5rgxhd5pxlmw"},{"post_id":"ciz5e9l26004p5rgxh0s4298g","tag_id":"ciz5e9l2q006e5rgxzricx1w2","_id":"ciz5e9l2r006j5rgx19nulrx9"},{"post_id":"ciz5e9l26004p5rgxh0s4298g","tag_id":"ciz5e9l0r002k5rgx9p7wzq9s","_id":"ciz5e9l2r006l5rgx8rri5cvp"},{"post_id":"ciz5e9l27004s5rgx0f6vl7n6","tag_id":"ciz5e9l2q006h5rgxb9ph7qzb","_id":"ciz5e9l2r006m5rgxgecalf63"},{"post_id":"ciz5e9l27004s5rgx0f6vl7n6","tag_id":"ciz5e9l24004j5rgxuhj5t2z8","_id":"ciz5e9l2r006n5rgxi91dr2lv"},{"post_id":"ciz5e9l2a004w5rgxfs7hp83k","tag_id":"ciz5e9l2r006k5rgxihi37quj","_id":"ciz5e9l2s006p5rgx6i2vffxw"},{"post_id":"ciz5e9l2d00525rgxjsqgoac2","tag_id":"ciz5e9l2r006o5rgxegafzeih","_id":"ciz5e9l2s006r5rgxaxouf2z6"},{"post_id":"ciz5e9l2g00565rgxm4721oq0","tag_id":"ciz5e9l2o00615rgx8oh4jfyr","_id":"ciz5e9l2t006s5rgx4stnvek6"},{"post_id":"ciz5e9l2g00565rgxm4721oq0","tag_id":"ciz5e9l0r002l5rgxdnndm1nm","_id":"ciz5e9l2t006t5rgxow35uqqh"},{"post_id":"ciz5e9l2g00565rgxm4721oq0","tag_id":"ciz5e9l1g003a5rgxcjyjgt67","_id":"ciz5e9l2t006u5rgxacikerd9"},{"post_id":"cizt7c0j70000awgs27d414yh","tag_id":"cizt7c0jl0001awgsixapi8sy","_id":"cizt7c0k40004awgs8mmn1dvl"},{"post_id":"cizt7c0j70000awgs27d414yh","tag_id":"cizt7c0k20003awgsex128chi","_id":"cizt7c0k50005awgsuqvm8mqh"},{"post_id":"cizt7c0k70006awgs6es5wjqc","tag_id":"cizt7c0jl0001awgsixapi8sy","_id":"cizt7c0k90007awgsu2zxspz1"},{"post_id":"cizt7c0k70006awgs6es5wjqc","tag_id":"cizt7c0k20003awgsex128chi","_id":"cizt7c0k90009awgsi6g39hau"},{"post_id":"cj1q5qb6o0000oqgxmben6x83","tag_id":"cj1q5qb730001oqgx09fns5sq","_id":"cj1q5qb7s0004oqgxwg7xg23p"},{"post_id":"cj1q5qb6o0000oqgxmben6x83","tag_id":"cj1q5qb7r0003oqgx5exid65d","_id":"cj1q5qb7t0005oqgxey0dzsgy"},{"post_id":"ck1lqzyf60000egqq5lsl9yev","tag_id":"ck1lqzyfd0001egqqysj3rb85","_id":"ck1lqzyfo0003egqqo8fs4e6c"},{"post_id":"ck1lqzyga0004egqqlbayex1o","tag_id":"ck1lqzyfd0001egqqysj3rb85","_id":"ck1lqzygg0006egqqxragxncs"},{"post_id":"ck1lqzygd0005egqqusf217a0","tag_id":"ck1lqzyfd0001egqqysj3rb85","_id":"ck1lqzygj0008egqqbvhdjiyw"},{"post_id":"ck1lqzygh0007egqqjuoye9zh","tag_id":"ck1lqzyfd0001egqqysj3rb85","_id":"ck1lqzygo000begqqjcd3okn4"},{"post_id":"ck1lqzygk0009egqqoomb6vxt","tag_id":"ck1lqzyfd0001egqqysj3rb85","_id":"ck1lqzygs000degqqrry3bkbi"}],"Tag":[{"name":"只言片语","_id":"ciz5e9kzn00045rgx65v6587p"},{"name":"C#","_id":"ciz5e9kzv00095rgxaw0k2w89"},{"name":"asp.net mvc4","_id":"ciz5e9l01000f5rgxme1ogazb"},{"name":"simplemembership","_id":"ciz5e9l0d000w5rgxvz9hmo39"},{"name":"centos","_id":"ciz5e9l0g00125rgx8vztqt4n"},{"name":"tmux","_id":"ciz5e9l0g00185rgxs7kpv6jn"},{"name":"prezto","_id":"ciz5e9l0h001c5rgx80nf8jgo"},{"name":"deepin","_id":"ciz5e9l0j001k5rgxwsexnm88"},{"name":"ppa","_id":"ciz5e9l0k001o5rgxr3wvn7ze"},{"name":"octotree","_id":"ciz5e9l0k001q5rgxixyxcr6f"},{"name":"infinality fonts","_id":"ciz5e9l0l001r5rgxkabcsl3q"},{"name":"openwrt","_id":"ciz5e9l0l001s5rgxohkf1nbf"},{"name":"git","_id":"ciz5e9l0m001v5rgxcj0armp4"},{"name":"go","_id":"ciz5e9l0n001y5rgx778m72cg"},{"name":"meow","_id":"ciz5e9l0o001z5rgx5cetlt5p"},{"name":"docker","_id":"ciz5e9l0o00225rgxip1vaw2g"},{"name":"kubernetes","_id":"ciz5e9l0o00245rgxftlmfmni"},{"name":"路由器","_id":"ciz5e9l0o00255rgxi7c1k2cl"},{"name":"科学上网","_id":"ciz5e9l0p00285rgx2uqyxc52"},{"name":"Shadowsocks","_id":"ciz5e9l0p002a5rgxlm9qmhpv"},{"name":"ChinaDNS","_id":"ciz5e9l0q002b5rgx8ngegtwp"},{"name":"暴力","_id":"ciz5e9l0q002c5rgxq7ptb9qf"},{"name":"javascirpt","_id":"ciz5e9l0r002f5rgxn1vycchn"},{"name":"dom","_id":"ciz5e9l0r002i5rgxfrwrarvs"},{"name":"html","_id":"ciz5e9l0r002k5rgx9p7wzq9s"},{"name":"图论","_id":"ciz5e9l0r002l5rgxdnndm1nm"},{"name":"数论","_id":"ciz5e9l0s002o5rgx3fb1ilzq"},{"name":"github","_id":"ciz5e9l0s002r5rgx8qen89ql"},{"name":"DP","_id":"ciz5e9l1d00325rgxrp1j8ton"},{"name":"tarjan","_id":"ciz5e9l1g003a5rgxcjyjgt67"},{"name":"树的直径","_id":"ciz5e9l1k003g5rgxuw1potcd"},{"name":"树形DP","_id":"ciz5e9l1t003u5rgx2yffwjt1"},{"name":"矩阵,暴力","_id":"ciz5e9l1w00425rgxaw8tnsbt"},{"name":"网络流","_id":"ciz5e9l21004b5rgxtv856von"},{"name":"DE/WM","_id":"ciz5e9l24004j5rgxuhj5t2z8"},{"name":"instantclick","_id":"ciz5e9l27004q5rgx3cjmmc1b"},{"name":"美化","_id":"ciz5e9l2b004y5rgxhk088l7p"},{"name":"网易云音乐","_id":"ciz5e9l2l005j5rgx4gm2ecu2"},{"name":"API","_id":"ciz5e9l2m005o5rgxn23jgjyk"},{"name":"Encryption","_id":"ciz5e9l2m005r5rgx1h9opij6"},{"name":"openstack","_id":"ciz5e9l2n005s5rgxmieywmqb"},{"name":"neutron","_id":"ciz5e9l2n005v5rgxngg6jjv9"},{"name":"python","_id":"ciz5e9l2n005x5rgxebxgjvku"},{"name":"gtk","_id":"ciz5e9l2o00605rgx2qyz6df9"},{"name":"LCA","_id":"ciz5e9l2o00615rgx8oh4jfyr"},{"name":"RMQ","_id":"ciz5e9l2o00645rgx79rdeskw"},{"name":"倍增","_id":"ciz5e9l2p00685rgxxiqmmxt1"},{"name":"shadowsocks","_id":"ciz5e9l2p006b5rgxbq42zdo2"},{"name":"sublime text","_id":"ciz5e9l2q006e5rgxzricx1w2"},{"name":"xfce4","_id":"ciz5e9l2q006h5rgxb9ph7qzb"},{"name":"linux","_id":"ciz5e9l2r006k5rgxihi37quj"},{"name":"组合","_id":"ciz5e9l2r006o5rgxegafzeih"},{"name":"algorithm","_id":"cizt7c0jl0001awgsixapi8sy"},{"name":"golang","_id":"cizt7c0k20003awgsex128chi"},{"name":"gnome","_id":"cj1q5qb730001oqgx09fns5sq"},{"name":"i3wm","_id":"cj1q5qb7r0003oqgx5exid65d"},{"name":"GraphQL","_id":"ck1lqzyfd0001egqqysj3rb85"}]}}